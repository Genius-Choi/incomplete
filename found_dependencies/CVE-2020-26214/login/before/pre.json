[
    {
        "line": 29,
        "fullcodeline": "userdn = current_app.config['LDAP_DOMAINS'][domain] % username"
    },
    {
        "line": 51,
        "fullcodeline": "user = User.find_by_username(username=login)"
    },
    {
        "line": 61,
        "fullcodeline": "groups = list()"
    },
    {
        "line": 81,
        "fullcodeline": "user.update_last_login()"
    },
    {
        "line": 83,
        "fullcodeline": "scopes = Permission.lookup(login=login, roles=user.roles + groups)"
    },
    {
        "line": 84,
        "fullcodeline": "customers = get_customers(login=login, groups=[user.domain] + groups)"
    },
    {
        "line": 86,
        "fullcodeline": "auth_audit_trail.send(current_app._get_current_object(), event='basic-ldap-login', message='user login via LDAP',"
    },
    {
        "line": 91,
        "fullcodeline": "token = create_token(user_id=user.id, name=user.name, login=user.email, provider='ldap',"
    },
    {
        "line": 26,
        "fullcodeline": "if domain not in current_app.config['LDAP_DOMAINS']:"
    },
    {
        "line": 42,
        "fullcodeline": "if not email_verified:"
    },
    {
        "line": 52,
        "fullcodeline": "if not user:"
    },
    {
        "line": 79,
        "fullcodeline": "if user.status != 'active':"
    },
    {
        "line": 94,
        "fullcodeline": "return jsonify(token=token.tokenize)"
    },
    {
        "line": 4,
        "fullcodeline": "ldap.set_option(ldap.OPT_X_TLS_REQUIRE_CERT, ldap.OPT_X_TLS_ALLOW)"
    },
    {
        "line": 8,
        "fullcodeline": "login = request.json.get('username', None) or request.json['email']"
    },
    {
        "line": 9,
        "fullcodeline": "password = request.json['password']"
    },
    {
        "line": 27,
        "fullcodeline": "raise ApiError('unauthorized domain', 403)"
    },
    {
        "line": 33,
        "fullcodeline": "trace_level = 2 if current_app.debug else 0"
    },
    {
        "line": 34,
        "fullcodeline": "ldap_connection = ldap.initialize(current_app.config['LDAP_URL'], trace_level=trace_level)"
    },
    {
        "line": 35,
        "fullcodeline": "ldap_connection.simple_bind_s(userdn, password)"
    },
    {
        "line": 53,
        "fullcodeline": "user = User(name=username, login=login, password='', email=email,"
    },
    {
        "line": 63,
        "fullcodeline": "groups_filters = current_app.config.get('LDAP_DOMAINS_GROUP', {})"
    },
    {
        "line": 64,
        "fullcodeline": "base_dns = current_app.config.get('LDAP_DOMAINS_BASEDN', {})"
    },
    {
        "line": 80,
        "fullcodeline": "raise ApiError('User {} not active'.format(login), 403)"
    },
    {
        "line": 14,
        "fullcodeline": "if '\\\\' in login:"
    },
    {
        "line": 65,
        "fullcodeline": "if domain in groups_filters and domain in base_dns:"
    },
    {
        "line": 11,
        "fullcodeline": "raise ApiError(\"must supply 'username' and 'password'\", 401)"
    },
    {
        "line": 16,
        "fullcodeline": "email = ''"
    },
    {
        "line": 17,
        "fullcodeline": "email_verified = False"
    },
    {
        "line": 20,
        "fullcodeline": "email = login"
    },
    {
        "line": 21,
        "fullcodeline": "email_verified = True"
    },
    {
        "line": 23,
        "fullcodeline": "raise ApiError('expected username with domain', 401)"
    },
    {
        "line": 37,
        "fullcodeline": "raise ApiError('invalid username or password', 401)"
    },
    {
        "line": 39,
        "fullcodeline": "raise ApiError(str(e), 500)"
    },
    {
        "line": 44,
        "fullcodeline": "ldap_result = ldap_connection.search_s(userdn, ldap.SCOPE_SUBTREE, '(objectClass=*)', ['mail'])"
    },
    {
        "line": 45,
        "fullcodeline": "email = ldap_result[0][1]['mail'][0].decode(sys.stdout.encoding)"
    },
    {
        "line": 46,
        "fullcodeline": "email_verified = True"
    },
    {
        "line": 56,
        "fullcodeline": "user = user.create()"
    },
    {
        "line": 66,
        "fullcodeline": "resultID = ldap_connection.search("
    },
    {
        "line": 76,
        "fullcodeline": "raise ApiError(str(e), 500)"
    },
    {
        "line": 15,
        "fullcodeline": "domain, username = login.split('\\\\')"
    },
    {
        "line": 19,
        "fullcodeline": "username, domain = login.split('@')"
    },
    {
        "line": 72,
        "fullcodeline": "resultTypes, results = ldap_connection.result(resultID)"
    },
    {
        "line": 73,
        "fullcodeline": "for _dn, attributes in results:"
    },
    {
        "line": 48,
        "fullcodeline": "email = '{}@{}'.format(username, domain)"
    },
    {
        "line": 58,
        "fullcodeline": "ApiError(str(e), 500)"
    },
    {
        "line": 70,
        "fullcodeline": "['cn']"
    },
    {
        "line": 69,
        "fullcodeline": "groups_filters[domain].format(username=username, email=email, userdn=userdn),"
    },
    {
        "line": 74,
        "fullcodeline": "groups.append(attributes['cn'][0].decode('utf-8'))"
    }
]