[
    {
        "line": 2,
        "fullcodeline": "cmd(archiver, \"rcreate\", RK_ENCRYPTION)"
    },
    {
        "line": 3,
        "fullcodeline": "create_src_archive(archiver, \"archive_tam\")"
    },
    {
        "line": 4,
        "fullcodeline": "archive_id_pre_check = cmd(archiver, \"rlist\", \"--format='{name} {id}{NL}'\")"
    },
    {
        "line": 5,
        "fullcodeline": "repository = Repository(archiver.repository_path, exclusive=True)"
    },
    {
        "line": 8,
        "fullcodeline": "output = cmd(archiver, \"rlist\", \"--format='{name} tam:{tam}{NL}'\")"
    },
    {
        "line": 9,
        "fullcodeline": "assert \"archive_tam tam:verified\" in output  # good"
    },
    {
        "line": 10,
        "fullcodeline": "assert \"archive_no_tam tam:none\" in output  # could be borg < 1.0.9 archive or fake"
    },
    {
        "line": 11,
        "fullcodeline": "cmd(archiver, \"check\", \"--repair\")"
    },
    {
        "line": 12,
        "fullcodeline": "output = cmd(archiver, \"rlist\", \"--format='{name} tam:{tam}{NL}'\")"
    },
    {
        "line": 13,
        "fullcodeline": "assert \"archive_tam tam:verified\" in output  # TAM-verified archive still there"
    },
    {
        "line": 14,
        "fullcodeline": "assert \"archive_no_tam\" not in output  # check got rid of untrusted not TAM-verified archive"
    },
    {
        "line": 15,
        "fullcodeline": "archive_id_post_check = cmd(archiver, \"rlist\", \"--format='{name} {id}{NL}'\")"
    },
    {
        "line": 16,
        "fullcodeline": "assert archive_id_post_check == archive_id_pre_check  # rebuild_refcounts didn't change archive_tam archive id"
    },
    {
        "line": 6,
        "fullcodeline": "with repository:"
    },
    {
        "line": 7,
        "fullcodeline": "write_archive_without_tam(repository, \"archive_no_tam\")"
    }
]