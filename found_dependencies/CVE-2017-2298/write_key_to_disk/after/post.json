[
    {
        "line": 6,
        "fullcodeline": "publickey_dir = lookup_config_option('publickey_dir')"
    },
    {
        "line": 4,
        "fullcodeline": "return unless lookup_config_option('learn_public_keys') =~ /^1|y/"
    },
    {
        "line": 8,
        "fullcodeline": "unless publickey_dir"
    },
    {
        "line": 13,
        "fullcodeline": "if File.directory?(publickey_dir)"
    },
    {
        "line": 9,
        "fullcodeline": "Log.info(\"Public key sent with request but no publickey_dir defined in configuration. Not writing key to disk.\")"
    },
    {
        "line": 15,
        "fullcodeline": "old_keyfile = File.join(File.expand_path(publickey_dir), \"#{identity}_pub.pem\")"
    },
    {
        "line": 16,
        "fullcodeline": "unless File.expand_path(old_keyfile) == old_keyfile"
    },
    {
        "line": 21,
        "fullcodeline": "if File.exists?(old_keyfile)"
    },
    {
        "line": 37,
        "fullcodeline": "raise(\"Cannot write public key to '%s'. Directory does not exist.\" % publickey_dir)"
    },
    {
        "line": 17,
        "fullcodeline": "Log.warn(\"Identity returned by server would result in directory traversal. Not writing key to disk.\")"
    },
    {
        "line": 33,
        "fullcodeline": "Log.debug(\"Discovered a new public key for '%s'. Writing to '%s'\" % [identity, publickey_dir])"
    },
    {
        "line": 24,
        "fullcodeline": "unless old_key == key"
    },
    {
        "line": 34,
        "fullcodeline": "File.open(old_keyfile, 'w') { |f| f.puts key }"
    },
    {
        "line": 22,
        "fullcodeline": "old_key = File.read(old_keyfile).chomp"
    },
    {
        "line": 25,
        "fullcodeline": "unless lookup_config_option('overwrite_stored_keys', 'n') =~ /^1|y/"
    },
    {
        "line": 28,
        "fullcodeline": "Log.warn(\"Public key sent from '%s' does not match the stored key. Overwriting.\" % identity)"
    },
    {
        "line": 26,
        "fullcodeline": "Log.warn(\"Public key sent from '%s' does not match the stored key. Not overwriting.\" % identity)"
    },
    {
        "line": 29,
        "fullcodeline": "File.open(old_keyfile, 'w') { |f| f.puts key }"
    }
]