[
    {
        "line": 4,
        "fullcodeline": "size_t len = data->key_length >> 3;"
    },
    {
        "line": 6,
        "fullcodeline": "u8 rbuf[300];"
    },
    {
        "line": 7,
        "fullcodeline": "u8 sbuf[4],*p;"
    },
    {
        "line": 9,
        "fullcodeline": "SC_FUNC_CALLED(card->ctx, SC_LOG_DEBUG_VERBOSE);"
    },
    {
        "line": 12,
        "fullcodeline": "sc_format_apdu(card, &apdu, SC_APDU_CASE_3_SHORT, 0x22, 0x01, 0xB8);"
    },
    {
        "line": 13,
        "fullcodeline": "apdu.lc=0x04;"
    },
    {
        "line": 14,
        "fullcodeline": "sbuf[0]=0x83;"
    },
    {
        "line": 15,
        "fullcodeline": "sbuf[1]=0x02;"
    },
    {
        "line": 16,
        "fullcodeline": "sbuf[2]=data->key_id;"
    },
    {
        "line": 17,
        "fullcodeline": "sbuf[3]=0x2A;"
    },
    {
        "line": 18,
        "fullcodeline": "apdu.data = sbuf;"
    },
    {
        "line": 19,
        "fullcodeline": "apdu.datalen=4;"
    },
    {
        "line": 20,
        "fullcodeline": "apdu.lc=4;"
    },
    {
        "line": 21,
        "fullcodeline": "apdu.le=0;"
    },
    {
        "line": 23,
        "fullcodeline": "r=entersafe_transmit_apdu(card, &apdu, 0,0,0,0);"
    },
    {
        "line": 24,
        "fullcodeline": "SC_TEST_RET(card->ctx, SC_LOG_DEBUG_NORMAL, r, \"APDU transmit failed\");"
    },
    {
        "line": 25,
        "fullcodeline": "SC_TEST_RET(card->ctx, SC_LOG_DEBUG_NORMAL, sc_check_sw(card,apdu.sw1,apdu.sw2),\"EnterSafe set MSE failed\");"
    },
    {
        "line": 28,
        "fullcodeline": "sc_format_apdu(card, &apdu, SC_APDU_CASE_3_SHORT, 0x46,  0x00, 0x00);"
    },
    {
        "line": 29,
        "fullcodeline": "apdu.le      = 0;"
    },
    {
        "line": 30,
        "fullcodeline": "sbuf[0] = (u8)(data->key_length >> 8);"
    },
    {
        "line": 31,
        "fullcodeline": "sbuf[1] = (u8)(data->key_length);"
    },
    {
        "line": 32,
        "fullcodeline": "apdu.data    = sbuf;"
    },
    {
        "line": 33,
        "fullcodeline": "apdu.lc      = 2;"
    },
    {
        "line": 34,
        "fullcodeline": "apdu.datalen = 2;"
    },
    {
        "line": 36,
        "fullcodeline": "r = entersafe_transmit_apdu(card, &apdu,0,0,0,0);"
    },
    {
        "line": 37,
        "fullcodeline": "SC_TEST_RET(card->ctx, SC_LOG_DEBUG_NORMAL, r, \"APDU transmit failed\");"
    },
    {
        "line": 38,
        "fullcodeline": "SC_TEST_RET(card->ctx, SC_LOG_DEBUG_NORMAL, sc_check_sw(card,apdu.sw1,apdu.sw2),\"EnterSafe generate keypair failed\");"
    },
    {
        "line": 41,
        "fullcodeline": "sc_format_apdu(card, &apdu, SC_APDU_CASE_2_SHORT, 0xE6,  0x2A, data->key_id);"
    },
    {
        "line": 42,
        "fullcodeline": "apdu.cla     = 0x80;"
    },
    {
        "line": 43,
        "fullcodeline": "apdu.resp    = rbuf;"
    },
    {
        "line": 44,
        "fullcodeline": "apdu.resplen = sizeof(rbuf);"
    },
    {
        "line": 45,
        "fullcodeline": "apdu.le      = 256;"
    },
    {
        "line": 46,
        "fullcodeline": "r = entersafe_transmit_apdu(card, &apdu,0,0,0,0);"
    },
    {
        "line": 47,
        "fullcodeline": "SC_TEST_RET(card->ctx, SC_LOG_DEBUG_NORMAL, r, \"APDU transmit failed\");"
    },
    {
        "line": 48,
        "fullcodeline": "SC_TEST_RET(card->ctx, SC_LOG_DEBUG_NORMAL, sc_check_sw(card,apdu.sw1,apdu.sw2),\"EnterSafe get pukey failed\");"
    },
    {
        "line": 50,
        "fullcodeline": "data->modulus = malloc(len);"
    },
    {
        "line": 54,
        "fullcodeline": "p=rbuf;"
    },
    {
        "line": 57,
        "fullcodeline": "p+=2+p[1];"
    },
    {
        "line": 61,
        "fullcodeline": "++p;"
    },
    {
        "line": 74,
        "fullcodeline": "entersafe_reverse_buffer(p,len);"
    },
    {
        "line": 75,
        "fullcodeline": "memcpy(data->modulus,p,len);"
    },
    {
        "line": 77,
        "fullcodeline": "SC_FUNC_RETURN(card->ctx, SC_LOG_DEBUG_VERBOSE,SC_SUCCESS);"
    },
    {
        "line": 51,
        "fullcodeline": "if (!data->modulus)"
    },
    {
        "line": 55,
        "fullcodeline": "if (*p!='E')"
    },
    {
        "line": 59,
        "fullcodeline": "if (*p!='N')"
    },
    {
        "line": 62,
        "fullcodeline": "if(*p++>0x80)"
    },
    {
        "line": 52,
        "fullcodeline": "SC_FUNC_RETURN(card->ctx, SC_LOG_DEBUG_VERBOSE, SC_ERROR_OUT_OF_MEMORY);"
    },
    {
        "line": 56,
        "fullcodeline": "SC_FUNC_RETURN(card->ctx, SC_LOG_DEBUG_VERBOSE, SC_ERROR_INVALID_DATA);"
    },
    {
        "line": 60,
        "fullcodeline": "SC_FUNC_RETURN(card->ctx, SC_LOG_DEBUG_VERBOSE, SC_ERROR_INVALID_DATA);"
    },
    {
        "line": 64,
        "fullcodeline": "u8 len_bytes=(*(p-1))&0x0f;"
    },
    {
        "line": 65,
        "fullcodeline": "size_t module_len=0;"
    },
    {
        "line": 66,
        "fullcodeline": "while(len_bytes!=0)"
    },
    {
        "line": 68,
        "fullcodeline": "module_len=module_len<<8;"
    },
    {
        "line": 69,
        "fullcodeline": "module_len+=*p++;"
    },
    {
        "line": 70,
        "fullcodeline": "--len_bytes;"
    }
]