[
    {
        "line": 4,
        "fullcodeline": "size_t block_size = (KEY_TYPE_AES == key_type ? 16 : 8);"
    },
    {
        "line": 5,
        "fullcodeline": "unsigned char mac[4096] = { 0 };"
    },
    {
        "line": 7,
        "fullcodeline": "unsigned char icv[16] = { 0 };"
    },
    {
        "line": 8,
        "fullcodeline": "int i = (KEY_TYPE_AES == key_type ? 15 : 7);"
    },
    {
        "line": 9,
        "fullcodeline": "epass2003_exdata *exdata = NULL;"
    },
    {
        "line": 14,
        "fullcodeline": "exdata = (epass2003_exdata *)card->drv_data;"
    },
    {
        "line": 45,
        "fullcodeline": "memset(icv, 0, sizeof(icv));"
    },
    {
        "line": 46,
        "fullcodeline": "memcpy(icv, exdata->icv_mac, 16);"
    },
    {
        "line": 60,
        "fullcodeline": "*mac_tlv_len = 2 + 8;"
    },
    {
        "line": 11,
        "fullcodeline": "if (!card->drv_data)"
    },
    {
        "line": 16,
        "fullcodeline": "if (0 == data_tlv_len && 0 == le_tlv_len) {"
    },
    {
        "line": 34,
        "fullcodeline": "for (; i >= 0; i--) {"
    },
    {
        "line": 47,
        "fullcodeline": "if (KEY_TYPE_AES == key_type) {"
    },
    {
        "line": 17,
        "fullcodeline": "mac_len = block_size;"
    },
    {
        "line": 48,
        "fullcodeline": "aes128_encrypt_cbc(exdata->sk_mac, 16, icv, apdu_buf, mac_len, mac);"
    },
    {
        "line": 49,
        "fullcodeline": "memcpy(mac_tlv + 2, &mac[mac_len - 16], 8);"
    },
    {
        "line": 21,
        "fullcodeline": "*(apdu_buf + block_size + data_tlv_len + le_tlv_len) = 0x80;"
    },
    {
        "line": 29,
        "fullcodeline": "memset((apdu_buf + block_size + data_tlv_len + le_tlv_len + 1),"
    },
    {
        "line": 35,
        "fullcodeline": "if (exdata->icv_mac[i] == 0xff) {"
    },
    {
        "line": 52,
        "fullcodeline": "unsigned char iv[8] = { 0 };"
    },
    {
        "line": 53,
        "fullcodeline": "unsigned char tmp[8] = { 0 };"
    },
    {
        "line": 54,
        "fullcodeline": "des_encrypt_cbc(exdata->sk_mac, 8, icv, apdu_buf, mac_len, mac);"
    },
    {
        "line": 55,
        "fullcodeline": "des_decrypt_cbc(&exdata->sk_mac[8], 8, iv, &mac[mac_len - 8], 8, tmp);"
    },
    {
        "line": 56,
        "fullcodeline": "memset(iv, 0x00, 8);"
    },
    {
        "line": 57,
        "fullcodeline": "des_encrypt_cbc(exdata->sk_mac, 8, iv, tmp, 8, mac_tlv + 2);"
    },
    {
        "line": 22,
        "fullcodeline": "if ((data_tlv_len + le_tlv_len + 1) % block_size)"
    },
    {
        "line": 30,
        "fullcodeline": "0, (mac_len - (data_tlv_len + le_tlv_len + 1)));"
    },
    {
        "line": 36,
        "fullcodeline": "exdata->icv_mac[i] = 0;"
    },
    {
        "line": 23,
        "fullcodeline": "mac_len = (((data_tlv_len + le_tlv_len + 1) / block_size) +"
    },
    {
        "line": 39,
        "fullcodeline": "exdata->icv_mac[i]++;"
    },
    {
        "line": 27,
        "fullcodeline": "mac_len = data_tlv_len + le_tlv_len + 1 + block_size;"
    }
]