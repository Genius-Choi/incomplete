[
    {
        "line": 2,
        "fullcodeline": "message = { post_id: post.id, reactions: [reaction, previous_reaction].compact.uniq }"
    },
    {
        "line": 4,
        "fullcodeline": "opts = {}"
    },
    {
        "line": 1,
        "fullcodeline": "def publish_change_to_clients!(post, reaction: nil, previous_reaction: nil)"
    },
    {
        "line": 6,
        "fullcodeline": "opts = secure_audience if secure_audience[:user_ids] != [] && secure_audience[:group_ids] != []"
    },
    {
        "line": 8,
        "fullcodeline": "MessageBus.publish(\"/topic/#{post.topic.id}/reactions\", message, opts)"
    },
    {
        "line": 5,
        "fullcodeline": "secure_audience = post.topic.secure_audience_publish_messages"
    }
]