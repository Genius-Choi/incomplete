[
    {
        "line": 3,
        "fullcodeline": "tctx.options.normalize_outbound_headers = normalize"
    },
    {
        "line": 4,
        "fullcodeline": "tctx.options.validate_inbound_headers = False"
    },
    {
        "line": 6,
        "fullcodeline": "server = Placeholder(Server)"
    },
    {
        "line": 7,
        "fullcodeline": "flow = Placeholder(HTTPFlow)"
    },
    {
        "line": 10,
        "fullcodeline": "request_headers = list(example_request_headers) + [(b\"Should-Not-Be-Capitalized! \", b\" :) \")]"
    },
    {
        "line": 11,
        "fullcodeline": "request_headers_lower = [(k.lower(), v) for (k, v) in request_headers]"
    },
    {
        "line": 12,
        "fullcodeline": "response_headers = list(example_response_headers) + [(b\"Same\", b\"Here\")]"
    },
    {
        "line": 13,
        "fullcodeline": "response_headers_lower = [(k.lower(), v) for (k, v) in response_headers]"
    },
    {
        "line": 15,
        "fullcodeline": "initial = Placeholder(bytes)"
    },
    {
        "line": 16,
        "fullcodeline": "assert ("
    },
    {
        "line": 28,
        "fullcodeline": "frames = decode_frames(initial())"
    },
    {
        "line": 29,
        "fullcodeline": "assert [type(x) for x in frames] == ["
    },
    {
        "line": 33,
        "fullcodeline": "assert hpack.hpack.Decoder().decode(frames[1].data, True) == request_headers_lower if normalize else request_headers"
    },
    {
        "line": 35,
        "fullcodeline": "sff = FrameFactory()"
    },
    {
        "line": 37,
        "fullcodeline": "playbook"
    },
    {
        "line": 46,
        "fullcodeline": "hdrs = response_headers_lower if normalize else response_headers"
    },
    {
        "line": 47,
        "fullcodeline": "assert playbook << SendData(tctx.client, cff.build_headers_frame(hdrs, flags=[\"END_STREAM\"]).serialize())"
    },
    {
        "line": 49,
        "fullcodeline": "assert flow().request.headers.fields == ((b\"Should-Not-Be-Capitalized! \", b\" :) \"),)"
    },
    {
        "line": 50,
        "fullcodeline": "assert flow().response.headers.fields == ((b\"Same\", b\"Here\"),)"
    },
    {
        "line": 8,
        "fullcodeline": "playbook, cff = start_h2_client(tctx)"
    },
    {
        "line": 17,
        "fullcodeline": "playbook"
    },
    {
        "line": 26,
        "fullcodeline": "<< SendData(server, initial)"
    },
    {
        "line": 41,
        "fullcodeline": "<< http.HttpResponseHook(flow)"
    },
    {
        "line": 45,
        "fullcodeline": "playbook << Log(\"Lowercased 'Same' header as uppercase is not allowed with HTTP/2.\")"
    },
    {
        "line": 25,
        "fullcodeline": ">> reply(None, side_effect=make_h2)"
    },
    {
        "line": 24,
        "fullcodeline": "<< OpenConnection(server)"
    },
    {
        "line": 39,
        "fullcodeline": "<< http.HttpResponseHeadersHook(flow)"
    },
    {
        "line": 38,
        "fullcodeline": ">> DataReceived(server, sff.build_headers_frame(response_headers, flags=[\"END_STREAM\"]).serialize())"
    },
    {
        "line": 22,
        "fullcodeline": "<< http.HttpRequestHook(flow)"
    },
    {
        "line": 20,
        "fullcodeline": "<< http.HttpRequestHeadersHook(flow)"
    },
    {
        "line": 18,
        "fullcodeline": ">> DataReceived(tctx.client,"
    },
    {
        "line": 19,
        "fullcodeline": "cff.build_headers_frame(request_headers, flags=[\"END_STREAM\"]).serialize())"
    }
]