[
    {
        "line": 3,
        "fullcodeline": "DECLARE_DISP_PTR(ptr);"
    },
    {
        "line": 4,
        "fullcodeline": "struct ec_session *s = NULL;"
    },
    {
        "line": 5,
        "fullcodeline": "void *ident = NULL;"
    },
    {
        "line": 6,
        "fullcodeline": "char tmp[MAX_ASCII_ADDR_LEN];"
    },
    {
        "line": 10,
        "fullcodeline": "(void) DECODE_DATA;"
    },
    {
        "line": 11,
        "fullcodeline": "(void) DECODE_DATALEN;"
    },
    {
        "line": 12,
        "fullcodeline": "(void) DECODED_LEN;"
    },
    {
        "line": 14,
        "fullcodeline": "if (FROM_CLIENT(\"postgresql\", PACKET)) {"
    },
    {
        "line": 18,
        "fullcodeline": "dissect_create_ident(&ident, PACKET, DISSECT_CODE(dissector_postgresql));"
    },
    {
        "line": 15,
        "fullcodeline": "if (PACKET->DATA.len < 4)"
    },
    {
        "line": 80,
        "fullcodeline": "dissect_create_ident(&ident, PACKET, DISSECT_CODE(dissector_postgresql));"
    },
    {
        "line": 21,
        "fullcodeline": "if (session_get(&s, ident, DISSECT_IDENT_LEN) == -ENOTFOUND) {"
    },
    {
        "line": 23,
        "fullcodeline": "unsigned char *u = memmem(ptr, PACKET->DATA.len, \"user\", 4);"
    },
    {
        "line": 24,
        "fullcodeline": "unsigned char *d = memmem(ptr, PACKET->DATA.len, \"database\", 8);"
    },
    {
        "line": 82,
        "fullcodeline": "if (session_get(&s, ident, DISSECT_IDENT_LEN) == ESUCCESS) {"
    },
    {
        "line": 25,
        "fullcodeline": "if (!memcmp(ptr + 4, \"\\x00\\x03\\x00\\x00\", 4) && u && d) {"
    },
    {
        "line": 47,
        "fullcodeline": "conn_status = (struct postgresql_status *) s->data;"
    },
    {
        "line": 83,
        "fullcodeline": "conn_status = (struct postgresql_status *) s->data;"
    },
    {
        "line": 27,
        "fullcodeline": "dissect_create_session(&s, PACKET, DISSECT_CODE(dissector_postgresql));"
    },
    {
        "line": 30,
        "fullcodeline": "SAFE_CALLOC(s->data, 1, sizeof(struct postgresql_status));"
    },
    {
        "line": 32,
        "fullcodeline": "conn_status = (struct postgresql_status *) s->data;"
    },
    {
        "line": 84,
        "fullcodeline": "if (conn_status->status == WAIT_AUTH &&"
    },
    {
        "line": 86,
        "fullcodeline": "!memcmp(ptr + 5, \"\\x00\\x00\\x00\\x05\", 4)) {"
    },
    {
        "line": 85,
        "fullcodeline": "ptr[0] == 'R' && !memcmp(ptr + 1, \"\\x00\\x00\\x00\\x0c\", 4)  &&"
    },
    {
        "line": 51,
        "fullcodeline": "if (ptr[0] == 'p' && conn_status->type == MD5) {"
    },
    {
        "line": 61,
        "fullcodeline": "memcpy(conn_status->hash, ptr + 5 + 3, 32);"
    },
    {
        "line": 62,
        "fullcodeline": "conn_status->hash[32] = 0;"
    },
    {
        "line": 63,
        "fullcodeline": "DISSECT_MSG(\"%s:$postgres$%s*%s*%s:%s:%d\\n\", conn_status->user, conn_status->user, conn_status->salt, conn_status->hash, ip_addr_ntoa(&PACKET->L3.dst, tmp), ntohs(PACKET->L4.dst));"
    },
    {
        "line": 64,
        "fullcodeline": "dissect_wipe_session(PACKET, DISSECT_CODE(dissector_postgresql));"
    },
    {
        "line": 94,
        "fullcodeline": "else if (conn_status->status == WAIT_AUTH &&"
    },
    {
        "line": 96,
        "fullcodeline": "!memcmp(ptr + 5, \"\\x00\\x00\\x00\\x03\", 4)) {"
    },
    {
        "line": 95,
        "fullcodeline": "ptr[0] == 'R' && !memcmp(ptr + 1, \"\\x00\\x00\\x00\\x08\", 4)  &&"
    },
    {
        "line": 66,
        "fullcodeline": "else if (ptr[0] == 'p' && conn_status->type == CT) {"
    },
    {
        "line": 69,
        "fullcodeline": "GET_ULONG_BE(length, ptr, 1);"
    },
    {
        "line": 71,
        "fullcodeline": "conn_status->password[length - 4] = 0;"
    },
    {
        "line": 70,
        "fullcodeline": "strncpy((char*)conn_status->password, (char*)(ptr + 5), length - 4);"
    },
    {
        "line": 72,
        "fullcodeline": "DISSECT_MSG(\"PostgreSQL credentials:%s-%d:%s:%s\\n\", ip_addr_ntoa(&PACKET->L3.dst, tmp), ntohs(PACKET->L4.dst), conn_status->user, conn_status->password);"
    },
    {
        "line": 73,
        "fullcodeline": "dissect_wipe_session(PACKET, DISSECT_CODE(dissector_postgresql));"
    }
]