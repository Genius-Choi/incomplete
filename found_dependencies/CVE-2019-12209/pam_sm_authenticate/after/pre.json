[
    {
        "line": 4,
        "fullcodeline": "struct passwd *pw = NULL, pw_s;"
    },
    {
        "line": 5,
        "fullcodeline": "const char *user = NULL;"
    },
    {
        "line": 8,
        "fullcodeline": "cfg_t *cfg = &cfg_st;"
    },
    {
        "line": 9,
        "fullcodeline": "char buffer[BUFSIZE];"
    },
    {
        "line": 10,
        "fullcodeline": "char *buf = NULL;"
    },
    {
        "line": 14,
        "fullcodeline": "int retval = PAM_IGNORE;"
    },
    {
        "line": 15,
        "fullcodeline": "device_t *devices = NULL;"
    },
    {
        "line": 16,
        "fullcodeline": "unsigned n_devices = 0;"
    },
    {
        "line": 17,
        "fullcodeline": "int openasuser = 0;"
    },
    {
        "line": 18,
        "fullcodeline": "int should_free_origin = 0;"
    },
    {
        "line": 19,
        "fullcodeline": "int should_free_appid = 0;"
    },
    {
        "line": 20,
        "fullcodeline": "int should_free_auth_file = 0;"
    },
    {
        "line": 21,
        "fullcodeline": "int should_free_authpending_file = 0;"
    },
    {
        "line": 22,
        "fullcodeline": "PAM_MODUTIL_DEF_PRIVS(privs);"
    },
    {
        "line": 24,
        "fullcodeline": "parse_cfg(flags, argc, argv, cfg);"
    },
    {
        "line": 61,
        "fullcodeline": "devices = malloc(sizeof(device_t) * cfg->max_devs);"
    },
    {
        "line": 68,
        "fullcodeline": "pgu_ret = pam_get_user(pamh, &user, NULL);"
    },
    {
        "line": 75,
        "fullcodeline": "DBG(\"Requesting authentication for user %s\", user);"
    },
    {
        "line": 77,
        "fullcodeline": "gpn_ret = getpwnam_r(user, &pw_s, buffer, sizeof(buffer), &pw);"
    },
    {
        "line": 86,
        "fullcodeline": "DBG(\"Found user %s\", user);"
    },
    {
        "line": 87,
        "fullcodeline": "DBG(\"Home directory for %s is %s\", user, pw->pw_dir);"
    },
    {
        "line": 151,
        "fullcodeline": "retval = get_devices_from_authfile(cfg->auth_file, user, cfg->max_devs,"
    },
    {
        "line": 203,
        "fullcodeline": "int authpending_file_descriptor = -1;"
    },
    {
        "line": 241,
        "fullcodeline": "retval = PAM_SUCCESS;"
    },
    {
        "line": 244,
        "fullcodeline": "free_devices(devices, n_devices);"
    },
    {
        "line": 275,
        "fullcodeline": "DBG(\"done. [%s]\", pam_strerror(pamh, retval));"
    },
    {
        "line": 26,
        "fullcodeline": "if (!cfg->origin) {"
    },
    {
        "line": 44,
        "fullcodeline": "if (!cfg->appid) {"
    },
    {
        "line": 56,
        "fullcodeline": "if (cfg->max_devs == 0) {"
    },
    {
        "line": 62,
        "fullcodeline": "if (!devices) {"
    },
    {
        "line": 69,
        "fullcodeline": "if (pgu_ret != PAM_SUCCESS || user == NULL) {"
    },
    {
        "line": 78,
        "fullcodeline": "if (gpn_ret != 0 || pw == NULL || pw->pw_dir == NULL ||"
    },
    {
        "line": 89,
        "fullcodeline": "if (!cfg->auth_file) {"
    },
    {
        "line": 139,
        "fullcodeline": "if (!openasuser) {"
    },
    {
        "line": 163,
        "fullcodeline": "if (retval != 1) {"
    },
    {
        "line": 169,
        "fullcodeline": "if (n_devices == 0) {"
    },
    {
        "line": 186,
        "fullcodeline": "if (!cfg->authpending_file) {"
    },
    {
        "line": 216,
        "fullcodeline": "if (cfg->manual == 0) {"
    },
    {
        "line": 228,
        "fullcodeline": "if (authpending_file_descriptor >= 0) {"
    },
    {
        "line": 235,
        "fullcodeline": "if (retval != 1) {"
    },
    {
        "line": 271,
        "fullcodeline": "if (cfg->alwaysok && retval != PAM_SUCCESS) {"
    },
    {
        "line": 27,
        "fullcodeline": "strcpy(buffer, DEFAULT_ORIGIN_PREFIX);"
    },
    {
        "line": 34,
        "fullcodeline": "DBG(\"Origin not specified, using \\\"%s\\\"\", buffer);"
    },
    {
        "line": 35,
        "fullcodeline": "cfg->origin = strdup(buffer);"
    },
    {
        "line": 45,
        "fullcodeline": "DBG(\"Appid not specified, using the same value of origin (%s)\","
    },
    {
        "line": 47,
        "fullcodeline": "cfg->appid = strdup(cfg->origin);"
    },
    {
        "line": 57,
        "fullcodeline": "DBG(\"Maximum devices number not set. Using default (%d)\", MAX_DEVS);"
    },
    {
        "line": 58,
        "fullcodeline": "cfg->max_devs = MAX_DEVS;"
    },
    {
        "line": 63,
        "fullcodeline": "DBG(\"Unable to allocate memory\");"
    },
    {
        "line": 64,
        "fullcodeline": "retval = PAM_IGNORE;"
    },
    {
        "line": 70,
        "fullcodeline": "DBG(\"Unable to access user %s\", user);"
    },
    {
        "line": 71,
        "fullcodeline": "retval = PAM_CONV_ERR;"
    },
    {
        "line": 79,
        "fullcodeline": "pw->pw_dir[0] != '/') {"
    },
    {
        "line": 80,
        "fullcodeline": "DBG(\"Unable to retrieve credentials for user %s, (%s)\", user,"
    },
    {
        "line": 82,
        "fullcodeline": "retval = PAM_USER_UNKNOWN;"
    },
    {
        "line": 90,
        "fullcodeline": "buf = NULL;"
    },
    {
        "line": 91,
        "fullcodeline": "authfile_dir = secure_getenv(DEFAULT_AUTHFILE_DIR_VAR);"
    },
    {
        "line": 130,
        "fullcodeline": "DBG(\"Using authentication file %s\", buf);"
    },
    {
        "line": 132,
        "fullcodeline": "cfg->auth_file = buf; /* cfg takes ownership */"
    },
    {
        "line": 133,
        "fullcodeline": "should_free_auth_file = 1;"
    },
    {
        "line": 134,
        "fullcodeline": "buf = NULL;"
    },
    {
        "line": 140,
        "fullcodeline": "openasuser = geteuid() == 0 && cfg->openasuser;"
    },
    {
        "line": 143,
        "fullcodeline": "DBG(\"Dropping privileges\");"
    },
    {
        "line": 149,
        "fullcodeline": "DBG(\"Switched to uid %i\", pw->pw_uid);"
    },
    {
        "line": 160,
        "fullcodeline": "DBG(\"Restored privileges\");"
    },
    {
        "line": 166,
        "fullcodeline": "n_devices = 0;"
    },
    {
        "line": 187,
        "fullcodeline": "int actual_size = snprintf(buffer, BUFSIZE, DEFAULT_AUTHPENDING_FILE_PATH, getuid());"
    },
    {
        "line": 205,
        "fullcodeline": "DBG(\"Using file '%s' for emitting touch request notifications\", cfg->authpending_file);"
    },
    {
        "line": 208,
        "fullcodeline": "authpending_file_descriptor ="
    },
    {
        "line": 222,
        "fullcodeline": "retval = do_authentication(cfg, devices, n_devices, pamh);"
    },
    {
        "line": 236,
        "fullcodeline": "DBG(\"do_authentication returned %d\", retval);"
    },
    {
        "line": 237,
        "fullcodeline": "retval = PAM_AUTH_ERR;"
    },
    {
        "line": 248,
        "fullcodeline": "buf = NULL;"
    },
    {
        "line": 252,
        "fullcodeline": "free((char *) cfg->origin);"
    },
    {
        "line": 253,
        "fullcodeline": "cfg->origin = NULL;"
    },
    {
        "line": 257,
        "fullcodeline": "free((char *) cfg->appid);"
    },
    {
        "line": 258,
        "fullcodeline": "cfg->appid = NULL;"
    },
    {
        "line": 262,
        "fullcodeline": "free((char *) cfg->auth_file);"
    },
    {
        "line": 263,
        "fullcodeline": "cfg->auth_file = NULL;"
    },
    {
        "line": 267,
        "fullcodeline": "free((char *) cfg->authpending_file);"
    },
    {
        "line": 268,
        "fullcodeline": "cfg->authpending_file = NULL;"
    },
    {
        "line": 272,
        "fullcodeline": "DBG(\"alwaysok needed (otherwise return with %d)\", retval);"
    },
    {
        "line": 273,
        "fullcodeline": "retval = PAM_SUCCESS;"
    },
    {
        "line": 278,
        "fullcodeline": "fclose(cfg->debug_file);"
    },
    {
        "line": 29,
        "fullcodeline": "if (gethostname(buffer + strlen(DEFAULT_ORIGIN_PREFIX),"
    },
    {
        "line": 36,
        "fullcodeline": "if (!cfg->origin) {"
    },
    {
        "line": 48,
        "fullcodeline": "if (!cfg->appid) {"
    },
    {
        "line": 81,
        "fullcodeline": "strerror(errno));"
    },
    {
        "line": 92,
        "fullcodeline": "if (!authfile_dir) {"
    },
    {
        "line": 136,
        "fullcodeline": "DBG(\"Using authentication file %s\", cfg->auth_file);"
    },
    {
        "line": 144,
        "fullcodeline": "if (pam_modutil_drop_priv(pamh, &privs, pw)) {"
    },
    {
        "line": 155,
        "fullcodeline": "if (pam_modutil_regain_priv(pamh, &privs)) {"
    },
    {
        "line": 188,
        "fullcodeline": "if (actual_size >= 0 && actual_size < BUFSIZE) {"
    },
    {
        "line": 191,
        "fullcodeline": "if (!cfg->authpending_file) {"
    },
    {
        "line": 209,
        "fullcodeline": "open(cfg->authpending_file, O_RDONLY | O_CREAT | O_CLOEXEC | O_NOFOLLOW | O_NOCTTY, 0664);"
    },
    {
        "line": 210,
        "fullcodeline": "if (authpending_file_descriptor < 0) {"
    },
    {
        "line": 224,
        "fullcodeline": "retval = do_manual_authentication(cfg, devices, n_devices, pamh);"
    },
    {
        "line": 229,
        "fullcodeline": "if (close(authpending_file_descriptor) < 0) {"
    },
    {
        "line": 30,
        "fullcodeline": "BUFSIZE - strlen(DEFAULT_ORIGIN_PREFIX)) == -1) {"
    },
    {
        "line": 31,
        "fullcodeline": "DBG(\"Unable to get host name\");"
    },
    {
        "line": 37,
        "fullcodeline": "DBG(\"Unable to allocate memory\");"
    },
    {
        "line": 49,
        "fullcodeline": "DBG(\"Unable to allocate memory\")"
    },
    {
        "line": 93,
        "fullcodeline": "DBG(\"Variable %s is not set. Using default value ($HOME/.config/)\","
    },
    {
        "line": 95,
        "fullcodeline": "authfile_dir_len ="
    },
    {
        "line": 97,
        "fullcodeline": "buf = malloc(sizeof(char) * (authfile_dir_len));"
    },
    {
        "line": 106,
        "fullcodeline": "openasuser = geteuid() == 0 ? 1 : 0;"
    },
    {
        "line": 108,
        "fullcodeline": "snprintf(buf, authfile_dir_len,"
    },
    {
        "line": 145,
        "fullcodeline": "DBG(\"Unable to switch user to uid %i\", pw->pw_uid);"
    },
    {
        "line": 146,
        "fullcodeline": "retval = PAM_IGNORE;"
    },
    {
        "line": 156,
        "fullcodeline": "DBG(\"could not restore privileges\");"
    },
    {
        "line": 157,
        "fullcodeline": "retval = PAM_IGNORE;"
    },
    {
        "line": 171,
        "fullcodeline": "DBG(\"Found no devices but nouserok specified. Skipping authentication\");"
    },
    {
        "line": 172,
        "fullcodeline": "retval = PAM_SUCCESS;"
    },
    {
        "line": 189,
        "fullcodeline": "cfg->authpending_file = strdup(buffer);"
    },
    {
        "line": 192,
        "fullcodeline": "DBG(\"Unable to allocate memory for the authpending_file, touch request notifications will not be emitted\");"
    },
    {
        "line": 197,
        "fullcodeline": "if (strlen(cfg->authpending_file) == 0) {"
    },
    {
        "line": 211,
        "fullcodeline": "DBG(\"Unable to emit 'authentication started' notification by opening the file '%s', (%s)\","
    },
    {
        "line": 218,
        "fullcodeline": "converse(pamh, PAM_PROMPT_ECHO_ON,"
    },
    {
        "line": 230,
        "fullcodeline": "DBG(\"Unable to emit 'authentication stopped' notification by closing the file '%s', (%s)\","
    },
    {
        "line": 40,
        "fullcodeline": "should_free_origin = 1;"
    },
    {
        "line": 52,
        "fullcodeline": "should_free_appid = 1;"
    },
    {
        "line": 96,
        "fullcodeline": "strlen(pw->pw_dir) + strlen(\"/.config\") + strlen(DEFAULT_AUTHFILE) + 1;"
    },
    {
        "line": 99,
        "fullcodeline": "if (!buf) {"
    },
    {
        "line": 111,
        "fullcodeline": "DBG(\"Variable %s set to %s\", DEFAULT_AUTHFILE_DIR_VAR, authfile_dir);"
    },
    {
        "line": 112,
        "fullcodeline": "authfile_dir_len = strlen(authfile_dir) + strlen(DEFAULT_AUTHFILE) + 1;"
    },
    {
        "line": 113,
        "fullcodeline": "buf = malloc(sizeof(char) * (authfile_dir_len));"
    },
    {
        "line": 121,
        "fullcodeline": "snprintf(buf, authfile_dir_len,"
    },
    {
        "line": 194,
        "fullcodeline": "should_free_authpending_file = 1;"
    },
    {
        "line": 198,
        "fullcodeline": "DBG(\"authpending_file is set to an empty value, touch request notifications will be disabled\");"
    },
    {
        "line": 199,
        "fullcodeline": "cfg->authpending_file = NULL;"
    },
    {
        "line": 212,
        "fullcodeline": "cfg->authpending_file, strerror(errno));"
    },
    {
        "line": 219,
        "fullcodeline": "cfg->prompt != NULL ? cfg->prompt : DEFAULT_PROMPT);"
    },
    {
        "line": 231,
        "fullcodeline": "cfg->authpending_file, strerror(errno));"
    },
    {
        "line": 100,
        "fullcodeline": "DBG(\"Unable to allocate memory\");"
    },
    {
        "line": 101,
        "fullcodeline": "retval = PAM_IGNORE;"
    },
    {
        "line": 115,
        "fullcodeline": "if (!buf) {"
    },
    {
        "line": 124,
        "fullcodeline": "if (!openasuser) {"
    },
    {
        "line": 174,
        "fullcodeline": "} else if (retval != 1) {"
    },
    {
        "line": 116,
        "fullcodeline": "DBG(\"Unable to allocate memory\");"
    },
    {
        "line": 117,
        "fullcodeline": "retval = PAM_IGNORE;"
    },
    {
        "line": 125,
        "fullcodeline": "DBG(\"WARNING: not dropping privileges when reading %s, please \""
    },
    {
        "line": 175,
        "fullcodeline": "DBG(\"Unable to get devices from file %s\", cfg->auth_file);"
    },
    {
        "line": 176,
        "fullcodeline": "retval = PAM_AUTHINFO_UNAVAIL;"
    },
    {
        "line": 179,
        "fullcodeline": "DBG(\"Found no devices. Aborting.\");"
    },
    {
        "line": 180,
        "fullcodeline": "retval = PAM_AUTHINFO_UNAVAIL;"
    }
]