[
    {
        "line": 4,
        "fullcodeline": "struct passwd *pw = NULL, pw_s;"
    },
    {
        "line": 5,
        "fullcodeline": "const char *user = NULL;"
    },
    {
        "line": 8,
        "fullcodeline": "cfg_t *cfg = &cfg_st;"
    },
    {
        "line": 9,
        "fullcodeline": "char buffer[BUFSIZE];"
    },
    {
        "line": 10,
        "fullcodeline": "char *buf = NULL;"
    },
    {
        "line": 14,
        "fullcodeline": "int retval = PAM_IGNORE;"
    },
    {
        "line": 15,
        "fullcodeline": "device_t *devices = NULL;"
    },
    {
        "line": 16,
        "fullcodeline": "unsigned n_devices = 0;"
    },
    {
        "line": 18,
        "fullcodeline": "int should_free_origin = 0;"
    },
    {
        "line": 19,
        "fullcodeline": "int should_free_appid = 0;"
    },
    {
        "line": 20,
        "fullcodeline": "int should_free_auth_file = 0;"
    },
    {
        "line": 21,
        "fullcodeline": "int should_free_authpending_file = 0;"
    },
    {
        "line": 23,
        "fullcodeline": "parse_cfg(flags, argc, argv, cfg);"
    },
    {
        "line": 60,
        "fullcodeline": "devices = malloc(sizeof(device_t) * cfg->max_devs);"
    },
    {
        "line": 67,
        "fullcodeline": "pgu_ret = pam_get_user(pamh, &user, NULL);"
    },
    {
        "line": 74,
        "fullcodeline": "DBG(\"Requesting authentication for user %s\", user);"
    },
    {
        "line": 76,
        "fullcodeline": "gpn_ret = getpwnam_r(user, &pw_s, buffer, sizeof(buffer), &pw);"
    },
    {
        "line": 85,
        "fullcodeline": "DBG(\"Found user %s\", user);"
    },
    {
        "line": 86,
        "fullcodeline": "DBG(\"Home directory for %s is %s\", user, pw->pw_dir);"
    },
    {
        "line": 130,
        "fullcodeline": "openasuser = geteuid() == 0 && cfg->openasuser;"
    },
    {
        "line": 139,
        "fullcodeline": "retval = get_devices_from_authfile(cfg->auth_file, user, cfg->max_devs,"
    },
    {
        "line": 191,
        "fullcodeline": "int authpending_file_descriptor = -1;"
    },
    {
        "line": 229,
        "fullcodeline": "retval = PAM_SUCCESS;"
    },
    {
        "line": 232,
        "fullcodeline": "free_devices(devices, n_devices);"
    },
    {
        "line": 263,
        "fullcodeline": "DBG(\"done. [%s]\", pam_strerror(pamh, retval));"
    },
    {
        "line": 25,
        "fullcodeline": "if (!cfg->origin) {"
    },
    {
        "line": 43,
        "fullcodeline": "if (!cfg->appid) {"
    },
    {
        "line": 55,
        "fullcodeline": "if (cfg->max_devs == 0) {"
    },
    {
        "line": 61,
        "fullcodeline": "if (!devices) {"
    },
    {
        "line": 68,
        "fullcodeline": "if (pgu_ret != PAM_SUCCESS || user == NULL) {"
    },
    {
        "line": 77,
        "fullcodeline": "if (gpn_ret != 0 || pw == NULL || pw->pw_dir == NULL ||"
    },
    {
        "line": 88,
        "fullcodeline": "if (!cfg->auth_file) {"
    },
    {
        "line": 151,
        "fullcodeline": "if (retval != 1) {"
    },
    {
        "line": 157,
        "fullcodeline": "if (n_devices == 0) {"
    },
    {
        "line": 174,
        "fullcodeline": "if (!cfg->authpending_file) {"
    },
    {
        "line": 204,
        "fullcodeline": "if (cfg->manual == 0) {"
    },
    {
        "line": 216,
        "fullcodeline": "if (authpending_file_descriptor >= 0) {"
    },
    {
        "line": 223,
        "fullcodeline": "if (retval != 1) {"
    },
    {
        "line": 259,
        "fullcodeline": "if (cfg->alwaysok && retval != PAM_SUCCESS) {"
    },
    {
        "line": 26,
        "fullcodeline": "strcpy(buffer, DEFAULT_ORIGIN_PREFIX);"
    },
    {
        "line": 33,
        "fullcodeline": "DBG(\"Origin not specified, using \\\"%s\\\"\", buffer);"
    },
    {
        "line": 34,
        "fullcodeline": "cfg->origin = strdup(buffer);"
    },
    {
        "line": 44,
        "fullcodeline": "DBG(\"Appid not specified, using the same value of origin (%s)\","
    },
    {
        "line": 46,
        "fullcodeline": "cfg->appid = strdup(cfg->origin);"
    },
    {
        "line": 56,
        "fullcodeline": "DBG(\"Maximum devices number not set. Using default (%d)\", MAX_DEVS);"
    },
    {
        "line": 57,
        "fullcodeline": "cfg->max_devs = MAX_DEVS;"
    },
    {
        "line": 62,
        "fullcodeline": "DBG(\"Unable to allocate memory\");"
    },
    {
        "line": 63,
        "fullcodeline": "retval = PAM_IGNORE;"
    },
    {
        "line": 69,
        "fullcodeline": "DBG(\"Unable to access user %s\", user);"
    },
    {
        "line": 70,
        "fullcodeline": "retval = PAM_CONV_ERR;"
    },
    {
        "line": 78,
        "fullcodeline": "pw->pw_dir[0] != '/') {"
    },
    {
        "line": 79,
        "fullcodeline": "DBG(\"Unable to retrieve credentials for user %s, (%s)\", user,"
    },
    {
        "line": 81,
        "fullcodeline": "retval = PAM_USER_UNKNOWN;"
    },
    {
        "line": 89,
        "fullcodeline": "buf = NULL;"
    },
    {
        "line": 90,
        "fullcodeline": "authfile_dir = secure_getenv(DEFAULT_AUTHFILE_DIR_VAR);"
    },
    {
        "line": 121,
        "fullcodeline": "DBG(\"Using default authentication file %s\", buf);"
    },
    {
        "line": 123,
        "fullcodeline": "cfg->auth_file = buf; /* cfg takes ownership */"
    },
    {
        "line": 124,
        "fullcodeline": "should_free_auth_file = 1;"
    },
    {
        "line": 125,
        "fullcodeline": "buf = NULL;"
    },
    {
        "line": 137,
        "fullcodeline": "DBG(\"Switched to uid %i\", pw_s.pw_uid);"
    },
    {
        "line": 148,
        "fullcodeline": "DBG(\"Switched back to uid 0\");"
    },
    {
        "line": 154,
        "fullcodeline": "n_devices = 0;"
    },
    {
        "line": 175,
        "fullcodeline": "int actual_size = snprintf(buffer, BUFSIZE, DEFAULT_AUTHPENDING_FILE_PATH, getuid());"
    },
    {
        "line": 193,
        "fullcodeline": "DBG(\"Using file '%s' for emitting touch request notifications\", cfg->authpending_file);"
    },
    {
        "line": 196,
        "fullcodeline": "authpending_file_descriptor ="
    },
    {
        "line": 210,
        "fullcodeline": "retval = do_authentication(cfg, devices, n_devices, pamh);"
    },
    {
        "line": 224,
        "fullcodeline": "DBG(\"do_authentication returned %d\", retval);"
    },
    {
        "line": 225,
        "fullcodeline": "retval = PAM_AUTH_ERR;"
    },
    {
        "line": 236,
        "fullcodeline": "buf = NULL;"
    },
    {
        "line": 240,
        "fullcodeline": "free((char *) cfg->origin);"
    },
    {
        "line": 241,
        "fullcodeline": "cfg->origin = NULL;"
    },
    {
        "line": 245,
        "fullcodeline": "free((char *) cfg->appid);"
    },
    {
        "line": 246,
        "fullcodeline": "cfg->appid = NULL;"
    },
    {
        "line": 250,
        "fullcodeline": "free((char *) cfg->auth_file);"
    },
    {
        "line": 251,
        "fullcodeline": "cfg->auth_file = NULL;"
    },
    {
        "line": 255,
        "fullcodeline": "free((char *) cfg->authpending_file);"
    },
    {
        "line": 256,
        "fullcodeline": "cfg->authpending_file = NULL;"
    },
    {
        "line": 260,
        "fullcodeline": "DBG(\"alwaysok needed (otherwise return with %d)\", retval);"
    },
    {
        "line": 261,
        "fullcodeline": "retval = PAM_SUCCESS;"
    },
    {
        "line": 266,
        "fullcodeline": "fclose(cfg->debug_file);"
    },
    {
        "line": 28,
        "fullcodeline": "if (gethostname(buffer + strlen(DEFAULT_ORIGIN_PREFIX),"
    },
    {
        "line": 35,
        "fullcodeline": "if (!cfg->origin) {"
    },
    {
        "line": 47,
        "fullcodeline": "if (!cfg->appid) {"
    },
    {
        "line": 80,
        "fullcodeline": "strerror(errno));"
    },
    {
        "line": 91,
        "fullcodeline": "if (!authfile_dir) {"
    },
    {
        "line": 127,
        "fullcodeline": "DBG(\"Using authentication file %s\", cfg->auth_file);"
    },
    {
        "line": 132,
        "fullcodeline": "if (seteuid(pw_s.pw_uid)) {"
    },
    {
        "line": 143,
        "fullcodeline": "if (seteuid(0)) {"
    },
    {
        "line": 176,
        "fullcodeline": "if (actual_size >= 0 && actual_size < BUFSIZE) {"
    },
    {
        "line": 179,
        "fullcodeline": "if (!cfg->authpending_file) {"
    },
    {
        "line": 197,
        "fullcodeline": "open(cfg->authpending_file, O_RDONLY | O_CREAT | O_CLOEXEC | O_NOFOLLOW | O_NOCTTY, 0664);"
    },
    {
        "line": 198,
        "fullcodeline": "if (authpending_file_descriptor < 0) {"
    },
    {
        "line": 212,
        "fullcodeline": "retval = do_manual_authentication(cfg, devices, n_devices, pamh);"
    },
    {
        "line": 217,
        "fullcodeline": "if (close(authpending_file_descriptor) < 0) {"
    },
    {
        "line": 29,
        "fullcodeline": "BUFSIZE - strlen(DEFAULT_ORIGIN_PREFIX)) == -1) {"
    },
    {
        "line": 30,
        "fullcodeline": "DBG(\"Unable to get host name\");"
    },
    {
        "line": 36,
        "fullcodeline": "DBG(\"Unable to allocate memory\");"
    },
    {
        "line": 48,
        "fullcodeline": "DBG(\"Unable to allocate memory\")"
    },
    {
        "line": 92,
        "fullcodeline": "DBG(\"Variable %s is not set. Using default value ($HOME/.config/)\","
    },
    {
        "line": 94,
        "fullcodeline": "authfile_dir_len ="
    },
    {
        "line": 96,
        "fullcodeline": "buf = malloc(sizeof(char) * (authfile_dir_len));"
    },
    {
        "line": 104,
        "fullcodeline": "snprintf(buf, authfile_dir_len,"
    },
    {
        "line": 133,
        "fullcodeline": "DBG(\"Unable to switch user to uid %i\", pw_s.pw_uid);"
    },
    {
        "line": 134,
        "fullcodeline": "retval = PAM_IGNORE;"
    },
    {
        "line": 144,
        "fullcodeline": "DBG(\"Unable to switch back to uid 0\");"
    },
    {
        "line": 145,
        "fullcodeline": "retval = PAM_IGNORE;"
    },
    {
        "line": 159,
        "fullcodeline": "DBG(\"Found no devices but nouserok specified. Skipping authentication\");"
    },
    {
        "line": 160,
        "fullcodeline": "retval = PAM_SUCCESS;"
    },
    {
        "line": 177,
        "fullcodeline": "cfg->authpending_file = strdup(buffer);"
    },
    {
        "line": 180,
        "fullcodeline": "DBG(\"Unable to allocate memory for the authpending_file, touch request notifications will not be emitted\");"
    },
    {
        "line": 185,
        "fullcodeline": "if (strlen(cfg->authpending_file) == 0) {"
    },
    {
        "line": 199,
        "fullcodeline": "DBG(\"Unable to emit 'authentication started' notification by opening the file '%s', (%s)\","
    },
    {
        "line": 206,
        "fullcodeline": "converse(pamh, PAM_PROMPT_ECHO_ON,"
    },
    {
        "line": 218,
        "fullcodeline": "DBG(\"Unable to emit 'authentication stopped' notification by closing the file '%s', (%s)\","
    },
    {
        "line": 39,
        "fullcodeline": "should_free_origin = 1;"
    },
    {
        "line": 51,
        "fullcodeline": "should_free_appid = 1;"
    },
    {
        "line": 95,
        "fullcodeline": "strlen(pw->pw_dir) + strlen(\"/.config\") + strlen(DEFAULT_AUTHFILE) + 1;"
    },
    {
        "line": 98,
        "fullcodeline": "if (!buf) {"
    },
    {
        "line": 107,
        "fullcodeline": "DBG(\"Variable %s set to %s\", DEFAULT_AUTHFILE_DIR_VAR, authfile_dir);"
    },
    {
        "line": 108,
        "fullcodeline": "authfile_dir_len = strlen(authfile_dir) + strlen(DEFAULT_AUTHFILE) + 1;"
    },
    {
        "line": 109,
        "fullcodeline": "buf = malloc(sizeof(char) * (authfile_dir_len));"
    },
    {
        "line": 117,
        "fullcodeline": "snprintf(buf, authfile_dir_len,"
    },
    {
        "line": 182,
        "fullcodeline": "should_free_authpending_file = 1;"
    },
    {
        "line": 186,
        "fullcodeline": "DBG(\"authpending_file is set to an empty value, touch request notifications will be disabled\");"
    },
    {
        "line": 187,
        "fullcodeline": "cfg->authpending_file = NULL;"
    },
    {
        "line": 200,
        "fullcodeline": "cfg->authpending_file, strerror(errno));"
    },
    {
        "line": 207,
        "fullcodeline": "cfg->prompt != NULL ? cfg->prompt : DEFAULT_PROMPT);"
    },
    {
        "line": 219,
        "fullcodeline": "cfg->authpending_file, strerror(errno));"
    },
    {
        "line": 99,
        "fullcodeline": "DBG(\"Unable to allocate memory\");"
    },
    {
        "line": 100,
        "fullcodeline": "retval = PAM_IGNORE;"
    },
    {
        "line": 111,
        "fullcodeline": "if (!buf) {"
    },
    {
        "line": 162,
        "fullcodeline": "} else if (retval != 1) {"
    },
    {
        "line": 112,
        "fullcodeline": "DBG(\"Unable to allocate memory\");"
    },
    {
        "line": 113,
        "fullcodeline": "retval = PAM_IGNORE;"
    },
    {
        "line": 163,
        "fullcodeline": "DBG(\"Unable to get devices from file %s\", cfg->auth_file);"
    },
    {
        "line": 164,
        "fullcodeline": "retval = PAM_AUTHINFO_UNAVAIL;"
    },
    {
        "line": 167,
        "fullcodeline": "DBG(\"Found no devices. Aborting.\");"
    },
    {
        "line": 168,
        "fullcodeline": "retval = PAM_AUTHINFO_UNAVAIL;"
    }
]