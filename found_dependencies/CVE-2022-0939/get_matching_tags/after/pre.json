[
    {
        "line": 2,
        "fullcodeline": "tag_dict = {'tags': []}"
    },
    {
        "line": 3,
        "fullcodeline": "q = calibre_db.session.query(db.Books).filter(calibre_db.common_filters(True))"
    },
    {
        "line": 5,
        "fullcodeline": "author_input = request.args.get('author_name') or ''"
    },
    {
        "line": 6,
        "fullcodeline": "title_input = request.args.get('book_title') or ''"
    },
    {
        "line": 7,
        "fullcodeline": "include_tag_inputs = request.args.getlist('include_tag') or ''"
    },
    {
        "line": 8,
        "fullcodeline": "exclude_tag_inputs = request.args.getlist('exclude_tag') or ''"
    },
    {
        "line": 9,
        "fullcodeline": "q = q.filter(db.Books.authors.any(func.lower(db.Authors.name).ilike(\"%\" + author_input + \"%\")),"
    },
    {
        "line": 21,
        "fullcodeline": "json_dumps = json.dumps(tag_dict)"
    },
    {
        "line": 4,
        "fullcodeline": "calibre_db.session.connection().connection.connection.create_function(\"lower\", 1, db.lcase)"
    },
    {
        "line": 11,
        "fullcodeline": "if len(include_tag_inputs) > 0:"
    },
    {
        "line": 14,
        "fullcodeline": "if len(exclude_tag_inputs) > 0:"
    },
    {
        "line": 17,
        "fullcodeline": "for book in q:"
    },
    {
        "line": 10,
        "fullcodeline": "func.lower(db.Books.title).ilike(\"%\" + title_input + \"%\"))"
    },
    {
        "line": 12,
        "fullcodeline": "for tag in include_tag_inputs:"
    },
    {
        "line": 15,
        "fullcodeline": "for tag in exclude_tag_inputs:"
    },
    {
        "line": 18,
        "fullcodeline": "for tag in book.tags:"
    },
    {
        "line": 13,
        "fullcodeline": "q = q.filter(db.Books.tags.any(db.Tags.id == tag))"
    },
    {
        "line": 16,
        "fullcodeline": "q = q.filter(not_(db.Books.tags.any(db.Tags.id == tag)))"
    },
    {
        "line": 19,
        "fullcodeline": "if tag.id not in tag_dict['tags']:"
    },
    {
        "line": 20,
        "fullcodeline": "tag_dict['tags'].append(tag.id)"
    }
]