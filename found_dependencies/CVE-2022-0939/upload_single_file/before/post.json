[
    {
        "line": 3,
        "fullcodeline": "if 'btn-upload-format' in request.files:"
    },
    {
        "line": 6,
        "fullcodeline": "if requested_file.filename != '':"
    },
    {
        "line": 19,
        "fullcodeline": "file_name = book.path.rsplit('/', 1)[-1]"
    },
    {
        "line": 20,
        "fullcodeline": "filepath = os.path.normpath(os.path.join(config.config_calibre_dir, book.path))"
    },
    {
        "line": 21,
        "fullcodeline": "saved_filename = os.path.join(filepath, file_name + '.' + file_ext)"
    },
    {
        "line": 36,
        "fullcodeline": "file_size = os.path.getsize(saved_filename)"
    },
    {
        "line": 37,
        "fullcodeline": "is_format = calibre_db.get_book_format(book_id, file_ext.upper())"
    },
    {
        "line": 55,
        "fullcodeline": "link = '<a href=\"{}\">{}</a>'.format(url_for('web.show_book', book_id=book.id), escape(book.title))"
    },
    {
        "line": 56,
        "fullcodeline": "uploadText=_(u\"File format %(ext)s added to %(book)s\", ext=file_ext.upper(), book=link)"
    },
    {
        "line": 57,
        "fullcodeline": "WorkerThread.add(current_user.name, TaskUpload(uploadText, escape(book.title)))"
    },
    {
        "line": 7,
        "fullcodeline": "if not current_user.role_upload():"
    },
    {
        "line": 9,
        "fullcodeline": "if '.' in requested_file.filename:"
    },
    {
        "line": 24,
        "fullcodeline": "if not os.path.exists(filepath):"
    },
    {
        "line": 59,
        "fullcodeline": "return uploader.process("
    },
    {
        "line": 8,
        "fullcodeline": "abort(403)"
    },
    {
        "line": 10,
        "fullcodeline": "file_ext = requested_file.filename.rsplit('.', 1)[-1].lower()"
    },
    {
        "line": 16,
        "fullcodeline": "flash(_('File to be uploaded must have an extension'), category=\"error\")"
    },
    {
        "line": 31,
        "fullcodeline": "requested_file.save(saved_filename)"
    },
    {
        "line": 41,
        "fullcodeline": "log.warning('Book format %s already existing', file_ext.upper())"
    },
    {
        "line": 60,
        "fullcodeline": "saved_filename, *os.path.splitext(requested_file.filename),"
    },
    {
        "line": 11,
        "fullcodeline": "if file_ext not in constants.EXTENSIONS_UPLOAD and '' not in constants.EXTENSIONS_UPLOAD:"
    },
    {
        "line": 17,
        "fullcodeline": "return redirect(url_for('web.show_book', book_id=book.id))"
    },
    {
        "line": 12,
        "fullcodeline": "flash(_(\"File extension '%(ext)s' is not allowed to be uploaded to this server\", ext=file_ext),"
    },
    {
        "line": 26,
        "fullcodeline": "os.makedirs(filepath)"
    },
    {
        "line": 33,
        "fullcodeline": "flash(_(u\"Failed to store file %(file)s.\", file=saved_filename), category=\"error\")"
    },
    {
        "line": 44,
        "fullcodeline": "db_format = db.Data(book_id, file_ext.upper(), file_size, file_name)"
    },
    {
        "line": 47,
        "fullcodeline": "calibre_db.update_title_sort(config)"
    },
    {
        "line": 14,
        "fullcodeline": "return redirect(url_for('web.show_book', book_id=book.id))"
    },
    {
        "line": 34,
        "fullcodeline": "return redirect(url_for('web.show_book', book_id=book.id))"
    },
    {
        "line": 45,
        "fullcodeline": "calibre_db.session.add(db_format)"
    },
    {
        "line": 46,
        "fullcodeline": "calibre_db.session.commit()"
    },
    {
        "line": 28,
        "fullcodeline": "flash(_(u\"Failed to create path %(path)s (Permission denied).\", path=filepath), category=\"error\")"
    },
    {
        "line": 50,
        "fullcodeline": "log.error_or_exception(\"Database error: {}\".format(e))"
    },
    {
        "line": 51,
        "fullcodeline": "flash(_(u\"Database error: %(error)s.\", error=e.orig), category=\"error\")"
    },
    {
        "line": 29,
        "fullcodeline": "return redirect(url_for('web.show_book', book_id=book.id))"
    },
    {
        "line": 49,
        "fullcodeline": "calibre_db.session.rollback()"
    },
    {
        "line": 52,
        "fullcodeline": "return redirect(url_for('web.show_book', book_id=book.id))"
    }
]