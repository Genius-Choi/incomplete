[
    {
        "line": 2,
        "fullcodeline": "char * code_hash = config->glewlwyd_config->glewlwyd_callback_generate_hash(config->glewlwyd_config, code), * expiration_clause = NULL, * scope_list = NULL, * tmp;"
    },
    {
        "line": 3,
        "fullcodeline": "json_t * j_query, * j_result = NULL, * j_result_scope = NULL, * j_return, * j_element = NULL, * j_scope_param;"
    },
    {
        "line": 5,
        "fullcodeline": "size_t index = 0;"
    },
    {
        "line": 6,
        "fullcodeline": "json_int_t maximum_duration = config->refresh_token_duration, maximum_duration_override = -1;"
    },
    {
        "line": 7,
        "fullcodeline": "int rolling_refresh = config->refresh_token_rolling, rolling_refresh_override = -1;"
    },
    {
        "line": 128,
        "fullcodeline": "o_free(code_hash);"
    },
    {
        "line": 9,
        "fullcodeline": "if (code_hash != NULL) {"
    },
    {
        "line": 17,
        "fullcodeline": "j_query = json_pack(\"{sss[ssss]s{sssssssss{ssss}}}\","
    },
    {
        "line": 39,
        "fullcodeline": "o_free(expiration_clause);"
    },
    {
        "line": 40,
        "fullcodeline": "res = h_select(config->glewlwyd_config->glewlwyd_config->conn, j_query, &j_result, NULL);"
    },
    {
        "line": 41,
        "fullcodeline": "json_decref(j_query);"
    },
    {
        "line": 123,
        "fullcodeline": "json_decref(j_result);"
    },
    {
        "line": 10,
        "fullcodeline": "if (config->glewlwyd_config->glewlwyd_config->conn->type==HOEL_DB_TYPE_MARIADB) {"
    },
    {
        "line": 42,
        "fullcodeline": "if (res == H_OK) {"
    },
    {
        "line": 125,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"validate_authorization_code - oauth2 - Error glewlwyd_callback_generate_hash\");"
    },
    {
        "line": 126,
        "fullcodeline": "j_return = json_pack(\"{si}\", \"result\", G_ERROR);"
    },
    {
        "line": 11,
        "fullcodeline": "expiration_clause = o_strdup(\"> NOW()\");"
    },
    {
        "line": 43,
        "fullcodeline": "if (json_array_size(j_result)) {"
    },
    {
        "line": 119,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"validate_authorization_code - oauth2 - Error executing j_query (1)\");"
    },
    {
        "line": 120,
        "fullcodeline": "config->glewlwyd_config->glewlwyd_plugin_callback_metrics_increment_counter(config->glewlwyd_config, GLWD_METRICS_DATABSE_ERROR, 1, NULL);"
    },
    {
        "line": 121,
        "fullcodeline": "j_return = json_pack(\"{si}\", \"result\", G_ERROR_DB);"
    },
    {
        "line": 12,
        "fullcodeline": "} else if (config->glewlwyd_config->glewlwyd_config->conn->type==HOEL_DB_TYPE_PGSQL) {"
    },
    {
        "line": 13,
        "fullcodeline": "expiration_clause = o_strdup(\"> NOW()\");"
    },
    {
        "line": 44,
        "fullcodeline": "if (json_integer_value(json_object_get(json_array_get(j_result, 0), \"enabled\"))) {"
    },
    {
        "line": 116,
        "fullcodeline": "j_return = json_pack(\"{si}\", \"result\", G_ERROR_UNAUTHORIZED);"
    },
    {
        "line": 15,
        "fullcodeline": "expiration_clause = o_strdup(\"> (strftime('%s','now'))\");"
    },
    {
        "line": 45,
        "fullcodeline": "if ((res = validate_code_challenge(config, json_array_get(j_result, 0), code_verifier)) == G_OK) {"
    },
    {
        "line": 113,
        "fullcodeline": "j_return = json_pack(\"{si}\", \"result\", G_ERROR_UNAUTHORIZED);"
    },
    {
        "line": 46,
        "fullcodeline": "j_query = json_pack(\"{sss[s]s{sO}}\","
    },
    {
        "line": 54,
        "fullcodeline": "res = h_select(config->glewlwyd_config->glewlwyd_config->conn, j_query, &j_result_scope, NULL);"
    },
    {
        "line": 55,
        "fullcodeline": "json_decref(j_query);"
    },
    {
        "line": 98,
        "fullcodeline": "json_decref(j_result_scope);"
    },
    {
        "line": 108,
        "fullcodeline": "if (json_true() == json_object_get(config->j_params, \"auth-type-code-revoke-replayed\")) {"
    },
    {
        "line": 56,
        "fullcodeline": "if (res == H_OK && json_array_size(j_result_scope) > 0) {"
    },
    {
        "line": 53,
        "fullcodeline": "json_object_get(json_array_get(j_result, 0), \"gpgc_id\"));"
    },
    {
        "line": 99,
        "fullcodeline": "} else if (res == G_ERROR_UNAUTHORIZED) {"
    },
    {
        "line": 109,
        "fullcodeline": "if (revoke_tokens_from_code(config, json_integer_value(json_object_get(json_array_get(j_result, 0), \"gpgc_id\")), ip_source) != G_OK) {"
    },
    {
        "line": 57,
        "fullcodeline": "if (!json_object_set_new(json_array_get(j_result, 0), \"scope\", json_array())) {"
    },
    {
        "line": 94,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"validate_authorization_code - oauth2 - Error executing j_query (2)\");"
    },
    {
        "line": 95,
        "fullcodeline": "config->glewlwyd_config->glewlwyd_plugin_callback_metrics_increment_counter(config->glewlwyd_config, GLWD_METRICS_DATABSE_ERROR, 1, NULL);"
    },
    {
        "line": 96,
        "fullcodeline": "j_return = json_pack(\"{si}\", \"result\", G_ERROR_DB);"
    },
    {
        "line": 100,
        "fullcodeline": "j_return = json_pack(\"{si}\", \"result\", G_ERROR_UNAUTHORIZED);"
    },
    {
        "line": 110,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"validate_authorization_code - oauth2 - Error revoke_tokens_from_code\");"
    },
    {
        "line": 58,
        "fullcodeline": "json_array_foreach(j_result_scope, index, j_element) {"
    },
    {
        "line": 84,
        "fullcodeline": "json_object_set_new(json_array_get(j_result, 0), \"scope_list\", json_string(scope_list));"
    },
    {
        "line": 85,
        "fullcodeline": "json_object_set_new(json_array_get(j_result, 0), \"refresh-token-rolling\", rolling_refresh?json_true():json_false());"
    },
    {
        "line": 86,
        "fullcodeline": "json_object_set_new(json_array_get(j_result, 0), \"refresh-token-duration\", json_integer(maximum_duration));"
    },
    {
        "line": 87,
        "fullcodeline": "j_return = json_pack(\"{sisO}\", \"result\", G_OK, \"code\", json_array_get(j_result, 0));"
    },
    {
        "line": 88,
        "fullcodeline": "o_free(scope_list);"
    },
    {
        "line": 76,
        "fullcodeline": "json_array_append(json_object_get(json_array_get(j_result, 0), \"scope\"), j_element);"
    },
    {
        "line": 78,
        "fullcodeline": "if (rolling_refresh_override > -1) {"
    },
    {
        "line": 81,
        "fullcodeline": "if (maximum_duration_override > -1) {"
    },
    {
        "line": 90,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"validate_authorization_code - oauth2 - Error allocating resources for json_array()\");"
    },
    {
        "line": 91,
        "fullcodeline": "j_return = json_pack(\"{si}\", \"result\", G_ERROR_MEMORY);"
    },
    {
        "line": 101,
        "fullcodeline": "} else if (res == G_ERROR_PARAM) {"
    },
    {
        "line": 59,
        "fullcodeline": "if (scope_list == NULL) {"
    },
    {
        "line": 66,
        "fullcodeline": "if ((j_scope_param = get_scope_parameters(config, json_string_value(json_object_get(j_element, \"name\")))) != NULL) {"
    },
    {
        "line": 70,
        "fullcodeline": "if (json_object_get(j_element, \"refresh-token-rolling\") != NULL && rolling_refresh_override != 0) {"
    },
    {
        "line": 73,
        "fullcodeline": "if (json_integer_value(json_object_get(j_element, \"refresh-token-duration\")) && (json_integer_value(json_object_get(j_element, \"refresh-token-duration\")) < maximum_duration_override || maximum_duration_override == -1)) {"
    },
    {
        "line": 79,
        "fullcodeline": "rolling_refresh = rolling_refresh_override;"
    },
    {
        "line": 82,
        "fullcodeline": "maximum_duration = maximum_duration_override;"
    },
    {
        "line": 102,
        "fullcodeline": "j_return = json_pack(\"{si}\", \"result\", G_ERROR_PARAM);"
    },
    {
        "line": 60,
        "fullcodeline": "scope_list = o_strdup(json_string_value(json_object_get(j_element, \"name\")));"
    },
    {
        "line": 67,
        "fullcodeline": "json_object_update(j_element, j_scope_param);"
    },
    {
        "line": 68,
        "fullcodeline": "json_decref(j_scope_param);"
    },
    {
        "line": 71,
        "fullcodeline": "rolling_refresh_override = json_object_get(j_element, \"refresh-token-rolling\")==json_true();"
    },
    {
        "line": 74,
        "fullcodeline": "maximum_duration_override = json_integer_value(json_object_get(j_element, \"refresh-token-duration\"));"
    },
    {
        "line": 104,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"validate_authorization_code - oauth2 - Error validate_code_challenge\");"
    },
    {
        "line": 105,
        "fullcodeline": "j_return = json_pack(\"{si}\", \"result\", G_ERROR);"
    },
    {
        "line": 62,
        "fullcodeline": "tmp = msprintf(\"%s %s\", scope_list, json_string_value(json_object_get(j_element, \"name\")));"
    },
    {
        "line": 63,
        "fullcodeline": "o_free(scope_list);"
    },
    {
        "line": 64,
        "fullcodeline": "scope_list = tmp;"
    }
]