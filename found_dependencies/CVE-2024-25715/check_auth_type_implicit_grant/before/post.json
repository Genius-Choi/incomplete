[
    {
        "line": 2,
        "fullcodeline": "struct _oauth2_config * config = (struct _oauth2_config *)user_data;"
    },
    {
        "line": 3,
        "fullcodeline": "const char * ip_source = get_ip_source(request, config->glewlwyd_config->glewlwyd_config->originating_ip_header);"
    },
    {
        "line": 4,
        "fullcodeline": "char * redirect_url, * issued_for, * state_encoded = NULL, * state_param = NULL;"
    },
    {
        "line": 6,
        "fullcodeline": "* j_client = check_client_valid(config, u_map_get(request->map_url, \"client_id\"), request->auth_basic_user, request->auth_basic_password, u_map_get(request->map_url, \"redirect_uri\"), GLEWLWYD_AUTHORIZATION_TYPE_IMPLICIT, 1, ip_source);"
    },
    {
        "line": 124,
        "fullcodeline": "o_free(state_param);"
    },
    {
        "line": 125,
        "fullcodeline": "json_decref(j_client);"
    },
    {
        "line": 10,
        "fullcodeline": "if (u_map_get(request->map_url, \"state\") != NULL) {"
    },
    {
        "line": 18,
        "fullcodeline": "if (check_result_value(j_client, G_OK)) {"
    },
    {
        "line": 11,
        "fullcodeline": "state_encoded = ulfius_url_encode(u_map_get(request->map_url, \"state\"));"
    },
    {
        "line": 12,
        "fullcodeline": "state_param = msprintf(\"&state=%s\", state_encoded);"
    },
    {
        "line": 13,
        "fullcodeline": "o_free(state_encoded);"
    },
    {
        "line": 15,
        "fullcodeline": "state_param = o_strdup(\"\");"
    },
    {
        "line": 20,
        "fullcodeline": "if (u_map_has_key(request->map_url, \"g_continue\")) {"
    },
    {
        "line": 119,
        "fullcodeline": "response->status = 302;"
    },
    {
        "line": 120,
        "fullcodeline": "redirect_url = msprintf(\"%s%serror=unauthorized_client%s%s\", u_map_get(request->map_url, \"redirect_uri\"), (o_strchr(u_map_get(request->map_url, \"redirect_uri\"), '?')!=NULL?\"&\":\"?\"), (u_map_get(request->map_url, \"state\")!=NULL?\"&state=\":\"\"), (u_map_get(request->map_url, \"state\")!=NULL?u_map_get(request->map_url, \"state\"):\"\"));"
    },
    {
        "line": 121,
        "fullcodeline": "ulfius_add_header_to_response(response, \"Location\", redirect_url);"
    },
    {
        "line": 122,
        "fullcodeline": "o_free(redirect_url);"
    },
    {
        "line": 21,
        "fullcodeline": "if (!o_strnullempty(u_map_get(request->map_url, \"scope\"))) {"
    },
    {
        "line": 112,
        "fullcodeline": "redirect_url = get_login_url(config, request, \"auth\", u_map_get(request->map_url, \"client_id\"), u_map_get(request->map_url, \"scope\"), NULL);"
    },
    {
        "line": 113,
        "fullcodeline": "ulfius_add_header_to_response(response, \"Location\", redirect_url);"
    },
    {
        "line": 114,
        "fullcodeline": "o_free(redirect_url);"
    },
    {
        "line": 115,
        "fullcodeline": "response->status = 302;"
    },
    {
        "line": 22,
        "fullcodeline": "j_session = validate_session_client_scope(config, request, u_map_get(request->map_url, \"client_id\"), u_map_get(request->map_url, \"scope\"));"
    },
    {
        "line": 102,
        "fullcodeline": "json_decref(j_session);"
    },
    {
        "line": 23,
        "fullcodeline": "if (check_result_value(j_session, G_OK)) {"
    },
    {
        "line": 105,
        "fullcodeline": "response->status = 302;"
    },
    {
        "line": 106,
        "fullcodeline": "redirect_url = msprintf(\"%s%serror=invalid_scope%s\", u_map_get(request->map_url, \"redirect_uri\"), (o_strchr(u_map_get(request->map_url, \"redirect_uri\"), '?')!=NULL?\"&\":\"?\"), state_param);"
    },
    {
        "line": 107,
        "fullcodeline": "ulfius_add_header_to_response(response, \"Location\", redirect_url);"
    },
    {
        "line": 108,
        "fullcodeline": "o_free(redirect_url);"
    },
    {
        "line": 24,
        "fullcodeline": "if (json_object_get(json_object_get(j_session, \"session\"), \"authorization_required\") == json_false()) {"
    },
    {
        "line": 27,
        "fullcodeline": "issued_for = get_client_hostname(request, config->glewlwyd_config->glewlwyd_config->originating_ip_header);"
    },
    {
        "line": 80,
        "fullcodeline": "o_free(issued_for);"
    },
    {
        "line": 88,
        "fullcodeline": "} else if (check_result_value(j_session, G_ERROR_UNAUTHORIZED)) {"
    },
    {
        "line": 28,
        "fullcodeline": "if (issued_for != NULL) {"
    },
    {
        "line": 83,
        "fullcodeline": "redirect_url = get_login_url(config, request, \"auth\", u_map_get(request->map_url, \"client_id\"), u_map_get(request->map_url, \"scope\"), NULL);"
    },
    {
        "line": 84,
        "fullcodeline": "ulfius_add_header_to_response(response, \"Location\", redirect_url);"
    },
    {
        "line": 85,
        "fullcodeline": "o_free(redirect_url);"
    },
    {
        "line": 86,
        "fullcodeline": "response->status = 302;"
    },
    {
        "line": 90,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_DEBUG, \"check_auth_type_implicit_grant - oauth2 - Scope list '%s' is not allowed for user '%s', origin: %s\", u_map_get(request->map_url, \"scope\"), json_string_value(json_object_get(json_object_get(json_object_get(j_session, \"session\"), \"user\"), \"username\")), ip_source);"
    },
    {
        "line": 91,
        "fullcodeline": "response->status = 302;"
    },
    {
        "line": 92,
        "fullcodeline": "redirect_url = msprintf(\"%s%serror=invalid_scope%s\", u_map_get(request->map_url, \"redirect_uri\"), (o_strchr(u_map_get(request->map_url, \"redirect_uri\"), '?')!=NULL?\"&\":\"?\"), state_param);"
    },
    {
        "line": 93,
        "fullcodeline": "ulfius_add_header_to_response(response, \"Location\", redirect_url);"
    },
    {
        "line": 94,
        "fullcodeline": "o_free(redirect_url);"
    },
    {
        "line": 29,
        "fullcodeline": "time(&now);"
    },
    {
        "line": 72,
        "fullcodeline": "o_free(access_token);"
    },
    {
        "line": 96,
        "fullcodeline": "redirect_url = msprintf(\"%s%serror=server_error\", u_map_get(request->map_url, \"redirect_uri\"), (o_strchr(u_map_get(request->map_url, \"redirect_uri\"), '?')!=NULL?\"&\":\"?\"));"
    },
    {
        "line": 97,
        "fullcodeline": "ulfius_add_header_to_response(response, \"Location\", redirect_url);"
    },
    {
        "line": 98,
        "fullcodeline": "o_free(redirect_url);"
    },
    {
        "line": 99,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"check_auth_type_implicit_grant - oauth2 - Error validate_session_client_scope\");"
    },
    {
        "line": 100,
        "fullcodeline": "response->status = 302;"
    },
    {
        "line": 30,
        "fullcodeline": "if ((access_token = generate_access_token(config,"
    },
    {
        "line": 74,
        "fullcodeline": "redirect_url = msprintf(\"%s%serror=server_error\", u_map_get(request->map_url, \"redirect_uri\"), (o_strchr(u_map_get(request->map_url, \"redirect_uri\"), '?')!=NULL?\"&\":\"?\"));"
    },
    {
        "line": 75,
        "fullcodeline": "ulfius_add_header_to_response(response, \"Location\", redirect_url);"
    },
    {
        "line": 76,
        "fullcodeline": "o_free(redirect_url);"
    },
    {
        "line": 77,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"check_auth_type_implicit_grant - oauth2 - Error get_client_hostname\");"
    },
    {
        "line": 78,
        "fullcodeline": "response->status = 302;"
    },
    {
        "line": 37,
        "fullcodeline": "if (serialize_access_token(config, GLEWLWYD_AUTHORIZATION_TYPE_IMPLICIT, 0, json_string_value(json_object_get(json_object_get(json_object_get(j_session, \"session\"), \"user\"), \"username\")), u_map_get(request->map_url, \"client_id\"), json_string_value(json_object_get(json_object_get(j_session, \"session\"), \"scope_filtered\")), now, issued_for, u_map_get_case(request->map_header, \"user-agent\"), access_token) == G_OK) {"
    },
    {
        "line": 66,
        "fullcodeline": "redirect_url = msprintf(\"%s%serror=server_error\", u_map_get(request->map_url, \"redirect_uri\"), (o_strchr(u_map_get(request->map_url, \"redirect_uri\"), '?')!=NULL?\"&\":\"?\"));"
    },
    {
        "line": 67,
        "fullcodeline": "ulfius_add_header_to_response(response, \"Location\", redirect_url);"
    },
    {
        "line": 68,
        "fullcodeline": "o_free(redirect_url);"
    },
    {
        "line": 69,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"check_auth_type_implicit_grant - oauth2 - Error generate_access_token\");"
    },
    {
        "line": 70,
        "fullcodeline": "response->status = 302;"
    },
    {
        "line": 31,
        "fullcodeline": "json_string_value(json_object_get(json_object_get(json_object_get(j_session, \"session\"), \"user\"), \"username\")),"
    },
    {
        "line": 32,
        "fullcodeline": "u_map_get(request->map_url, \"client_id\"),"
    },
    {
        "line": 33,
        "fullcodeline": "json_object_get(json_object_get(j_session, \"session\"), \"user\"),"
    },
    {
        "line": 34,
        "fullcodeline": "json_string_value(json_object_get(json_object_get(j_session, \"session\"), \"scope_filtered\")),"
    },
    {
        "line": 38,
        "fullcodeline": "if (config->glewlwyd_config->glewlwyd_callback_trigger_session_used(config->glewlwyd_config, request, json_string_value(json_object_get(json_object_get(j_session, \"session\"), \"scope_filtered\"))) == G_OK) {"
    },
    {
        "line": 59,
        "fullcodeline": "redirect_url = msprintf(\"%s%serror=server_error\", u_map_get(request->map_url, \"redirect_uri\"), (o_strchr(u_map_get(request->map_url, \"redirect_uri\"), '?')!=NULL?\"&\":\"?\"));"
    },
    {
        "line": 60,
        "fullcodeline": "ulfius_add_header_to_response(response, \"Location\", redirect_url);"
    },
    {
        "line": 61,
        "fullcodeline": "o_free(redirect_url);"
    },
    {
        "line": 62,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"check_auth_type_implicit_grant - oauth2 - Error serialize_access_token\");"
    },
    {
        "line": 63,
        "fullcodeline": "response->status = 302;"
    },
    {
        "line": 46,
        "fullcodeline": "ulfius_add_header_to_response(response, \"Location\", redirect_url);"
    },
    {
        "line": 47,
        "fullcodeline": "o_free(redirect_url);"
    },
    {
        "line": 48,
        "fullcodeline": "response->status = 302;"
    },
    {
        "line": 49,
        "fullcodeline": "config->glewlwyd_config->glewlwyd_plugin_callback_metrics_increment_counter(config->glewlwyd_config, GLWD_METRICS_OAUTH2_USER_ACCESS_TOKEN, 1, \"plugin\", config->name, \"response_type\", \"code\", NULL);"
    },
    {
        "line": 50,
        "fullcodeline": "config->glewlwyd_config->glewlwyd_plugin_callback_metrics_increment_counter(config->glewlwyd_config, GLWD_METRICS_OAUTH2_USER_ACCESS_TOKEN, 1, \"plugin\", config->name, NULL);"
    },
    {
        "line": 52,
        "fullcodeline": "redirect_url = msprintf(\"%s%serror=server_error\", u_map_get(request->map_url, \"redirect_uri\"), (o_strchr(u_map_get(request->map_url, \"redirect_uri\"), '?')!=NULL?\"&\":\"?\"));"
    },
    {
        "line": 53,
        "fullcodeline": "ulfius_add_header_to_response(response, \"Location\", redirect_url);"
    },
    {
        "line": 54,
        "fullcodeline": "o_free(redirect_url);"
    },
    {
        "line": 55,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"check_auth_type_implicit_grant - oauth2 - Error glewlwyd_callback_trigger_session_used\");"
    },
    {
        "line": 56,
        "fullcodeline": "response->status = 302;"
    }
]