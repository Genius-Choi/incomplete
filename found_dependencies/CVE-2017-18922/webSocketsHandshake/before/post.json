[
    {
        "line": 4,
        "fullcodeline": "int n, linestart = 0, len = 0, llen, base64 = TRUE;"
    },
    {
        "line": 5,
        "fullcodeline": "char prefix[5], trailer[17];"
    },
    {
        "line": 6,
        "fullcodeline": "char *path = NULL, *host = NULL, *origin = NULL, *protocol = NULL;"
    },
    {
        "line": 7,
        "fullcodeline": "char *key1 = NULL, *key2 = NULL, *key3 = NULL;"
    },
    {
        "line": 8,
        "fullcodeline": "char *sec_ws_origin = NULL;"
    },
    {
        "line": 9,
        "fullcodeline": "char *sec_ws_key = NULL;"
    },
    {
        "line": 10,
        "fullcodeline": "char sec_ws_version = 0;"
    },
    {
        "line": 11,
        "fullcodeline": "ws_ctx_t *wsctx = NULL;"
    },
    {
        "line": 13,
        "fullcodeline": "buf = (char *) malloc(WEBSOCKETS_MAX_HANDSHAKE_LEN);"
    },
    {
        "line": 18,
        "fullcodeline": "response = (char *) malloc(WEBSOCKETS_MAX_HANDSHAKE_LEN);"
    },
    {
        "line": 174,
        "fullcodeline": "free(response);"
    },
    {
        "line": 175,
        "fullcodeline": "free(buf);"
    },
    {
        "line": 178,
        "fullcodeline": "wsctx = calloc(1, sizeof(ws_ctx_t));"
    },
    {
        "line": 188,
        "fullcodeline": "wsctx->base64 = base64;"
    },
    {
        "line": 189,
        "fullcodeline": "cl->wsctx = (wsCtx *)wsctx;"
    },
    {
        "line": 14,
        "fullcodeline": "if (!buf) {"
    },
    {
        "line": 19,
        "fullcodeline": "if (!response) {"
    },
    {
        "line": 25,
        "fullcodeline": "while (len < WEBSOCKETS_MAX_HANDSHAKE_LEN-1) {"
    },
    {
        "line": 108,
        "fullcodeline": "if (!(path && host && (origin || sec_ws_origin))) {"
    },
    {
        "line": 115,
        "fullcodeline": "if ((protocol) && (strstr(protocol, \"binary\"))) {"
    },
    {
        "line": 167,
        "fullcodeline": "if (rfbWriteExact(cl, response, len) < 0) {"
    },
    {
        "line": 15,
        "fullcodeline": "rfbLogPerror(\"webSocketsHandshake: malloc\");"
    },
    {
        "line": 20,
        "fullcodeline": "free(buf);"
    },
    {
        "line": 21,
        "fullcodeline": "rfbLogPerror(\"webSocketsHandshake: malloc\");"
    },
    {
        "line": 40,
        "fullcodeline": "len += 1;"
    },
    {
        "line": 41,
        "fullcodeline": "llen = len - linestart;"
    },
    {
        "line": 109,
        "fullcodeline": "rfbErr(\"webSocketsHandshake: incomplete client handshake\\n\");"
    },
    {
        "line": 110,
        "fullcodeline": "free(response);"
    },
    {
        "line": 111,
        "fullcodeline": "free(buf);"
    },
    {
        "line": 122,
        "fullcodeline": "rfbLog(\"  - webSocketsHandshake: using binary/raw encoding\\n\");"
    },
    {
        "line": 123,
        "fullcodeline": "base64 = FALSE;"
    },
    {
        "line": 124,
        "fullcodeline": "protocol = \"binary\";"
    },
    {
        "line": 141,
        "fullcodeline": "char accept[B64LEN(SHA1_HASH_SIZE) + 1];"
    },
    {
        "line": 142,
        "fullcodeline": "rfbLog(\"  - WebSockets client version hybi-%02d\\n\", sec_ws_version);"
    },
    {
        "line": 143,
        "fullcodeline": "webSocketsGenSha1Key(accept, sizeof(accept), sec_ws_key);"
    },
    {
        "line": 168,
        "fullcodeline": "rfbErr(\"webSocketsHandshake: failed sending WebSockets response\\n\");"
    },
    {
        "line": 169,
        "fullcodeline": "free(response);"
    },
    {
        "line": 170,
        "fullcodeline": "free(buf);"
    },
    {
        "line": 180,
        "fullcodeline": "wsctx->version = WEBSOCKETS_VERSION_HYBI;"
    },
    {
        "line": 181,
        "fullcodeline": "wsctx->encode = webSocketsEncodeHybi;"
    },
    {
        "line": 182,
        "fullcodeline": "wsctx->decode = webSocketsDecodeHybi;"
    },
    {
        "line": 26,
        "fullcodeline": "if ((n = rfbReadExactTimeout(cl, buf+len, 1,"
    },
    {
        "line": 42,
        "fullcodeline": "if (((llen >= 2)) && (buf[len-1] == '\\n')) {"
    },
    {
        "line": 116,
        "fullcodeline": "if (! sec_ws_version) {"
    },
    {
        "line": 126,
        "fullcodeline": "rfbLog(\"  - webSocketsHandshake: using base64 encoding\\n\");"
    },
    {
        "line": 127,
        "fullcodeline": "base64 = TRUE;"
    },
    {
        "line": 144,
        "fullcodeline": "if(strlen(protocol) > 0)"
    },
    {
        "line": 162,
        "fullcodeline": "len = snprintf(response, WEBSOCKETS_MAX_HANDSHAKE_LEN,"
    },
    {
        "line": 184,
        "fullcodeline": "wsctx->version = WEBSOCKETS_VERSION_HIXIE;"
    },
    {
        "line": 185,
        "fullcodeline": "wsctx->encode = webSocketsEncodeHixie;"
    },
    {
        "line": 186,
        "fullcodeline": "wsctx->decode = webSocketsDecodeHixie;"
    },
    {
        "line": 35,
        "fullcodeline": "free(response);"
    },
    {
        "line": 36,
        "fullcodeline": "free(buf);"
    },
    {
        "line": 43,
        "fullcodeline": "line = buf+linestart;"
    },
    {
        "line": 104,
        "fullcodeline": "linestart = len;"
    },
    {
        "line": 117,
        "fullcodeline": "rfbErr(\"webSocketsHandshake: 'binary' protocol not supported with Hixie\\n\");"
    },
    {
        "line": 118,
        "fullcodeline": "free(response);"
    },
    {
        "line": 119,
        "fullcodeline": "free(buf);"
    },
    {
        "line": 128,
        "fullcodeline": "if ((protocol) && (strstr(protocol, \"base64\"))) {"
    },
    {
        "line": 145,
        "fullcodeline": "len = snprintf(response, WEBSOCKETS_MAX_HANDSHAKE_LEN,"
    },
    {
        "line": 153,
        "fullcodeline": "if (!(key1 && key2 && key3)) {"
    },
    {
        "line": 28,
        "fullcodeline": "if ((n < 0) && (errno == ETIMEDOUT)) {"
    },
    {
        "line": 31,
        "fullcodeline": "if (n == 0)"
    },
    {
        "line": 44,
        "fullcodeline": "if ((llen == 2) && (strncmp(\"\\r\\n\", line, 2) == 0)) {"
    },
    {
        "line": 129,
        "fullcodeline": "protocol = \"base64\";"
    },
    {
        "line": 148,
        "fullcodeline": "len = snprintf(response, WEBSOCKETS_MAX_HANDSHAKE_LEN,"
    },
    {
        "line": 154,
        "fullcodeline": "rfbLog(\"  - WebSockets client version hixie-75\\n\");"
    },
    {
        "line": 155,
        "fullcodeline": "prefix[0] = '\\0';"
    },
    {
        "line": 156,
        "fullcodeline": "trailer[0] = '\\0';"
    },
    {
        "line": 32,
        "fullcodeline": "rfbLog(\"webSocketsHandshake: client gone\\n\");"
    },
    {
        "line": 131,
        "fullcodeline": "protocol = \"\";"
    },
    {
        "line": 158,
        "fullcodeline": "rfbLog(\"  - WebSockets client version hixie-76\\n\");"
    },
    {
        "line": 159,
        "fullcodeline": "snprintf(prefix, 5, \"Sec-\");"
    },
    {
        "line": 160,
        "fullcodeline": "webSocketsGenMd5(trailer, key1, key2, key3);"
    },
    {
        "line": 34,
        "fullcodeline": "rfbLogPerror(\"webSocketsHandshake: read\");"
    },
    {
        "line": 45,
        "fullcodeline": "if (key1 && key2) {"
    },
    {
        "line": 58,
        "fullcodeline": "rfbLog(\"Got key3\\n\");"
    },
    {
        "line": 59,
        "fullcodeline": "key3 = buf+len;"
    },
    {
        "line": 60,
        "fullcodeline": "len += 8;"
    },
    {
        "line": 65,
        "fullcodeline": "} else if ((llen >= 16) && ((strncmp(\"GET \", line, min(llen,4))) == 0)) {"
    },
    {
        "line": 46,
        "fullcodeline": "if ((n = rfbReadExact(cl, buf+len, 8)) <= 0) {"
    },
    {
        "line": 62,
        "fullcodeline": "buf[len] = '\\0';"
    },
    {
        "line": 67,
        "fullcodeline": "path = line+4;"
    },
    {
        "line": 68,
        "fullcodeline": "buf[len-11] = '\\0'; /* Trim trailing \" HTTP/1.1\\r\\n\" */"
    },
    {
        "line": 69,
        "fullcodeline": "cl->wspath = strdup(path);"
    },
    {
        "line": 54,
        "fullcodeline": "free(response);"
    },
    {
        "line": 55,
        "fullcodeline": "free(buf);"
    },
    {
        "line": 47,
        "fullcodeline": "if ((n < 0) && (errno == ETIMEDOUT)) {"
    },
    {
        "line": 50,
        "fullcodeline": "if (n == 0)"
    },
    {
        "line": 71,
        "fullcodeline": "} else if ((strncasecmp(\"host: \", line, min(llen,6))) == 0) {"
    },
    {
        "line": 51,
        "fullcodeline": "rfbLog(\"webSocketsHandshake: client gone\\n\");"
    },
    {
        "line": 72,
        "fullcodeline": "host = line+6;"
    },
    {
        "line": 73,
        "fullcodeline": "buf[len-2] = '\\0';"
    },
    {
        "line": 53,
        "fullcodeline": "rfbLogPerror(\"webSocketsHandshake: read\");"
    },
    {
        "line": 75,
        "fullcodeline": "} else if ((strncasecmp(\"origin: \", line, min(llen,8))) == 0) {"
    },
    {
        "line": 76,
        "fullcodeline": "origin = line+8;"
    },
    {
        "line": 77,
        "fullcodeline": "buf[len-2] = '\\0';"
    },
    {
        "line": 79,
        "fullcodeline": "} else if ((strncasecmp(\"sec-websocket-key1: \", line, min(llen,20))) == 0) {"
    },
    {
        "line": 80,
        "fullcodeline": "key1 = line+20;"
    },
    {
        "line": 81,
        "fullcodeline": "buf[len-2] = '\\0';"
    },
    {
        "line": 83,
        "fullcodeline": "} else if ((strncasecmp(\"sec-websocket-key2: \", line, min(llen,20))) == 0) {"
    },
    {
        "line": 84,
        "fullcodeline": "key2 = line+20;"
    },
    {
        "line": 85,
        "fullcodeline": "buf[len-2] = '\\0';"
    },
    {
        "line": 89,
        "fullcodeline": "} else if ((strncasecmp(\"sec-websocket-protocol: \", line, min(llen,24))) == 0) {"
    },
    {
        "line": 90,
        "fullcodeline": "protocol = line+24;"
    },
    {
        "line": 91,
        "fullcodeline": "buf[len-2] = '\\0';"
    },
    {
        "line": 92,
        "fullcodeline": "rfbLog(\"Got protocol: %s\\n\", protocol);"
    },
    {
        "line": 93,
        "fullcodeline": "} else if ((strncasecmp(\"sec-websocket-origin: \", line, min(llen,22))) == 0) {"
    },
    {
        "line": 94,
        "fullcodeline": "sec_ws_origin = line+22;"
    },
    {
        "line": 95,
        "fullcodeline": "buf[len-2] = '\\0';"
    },
    {
        "line": 96,
        "fullcodeline": "} else if ((strncasecmp(\"sec-websocket-key: \", line, min(llen,19))) == 0) {"
    },
    {
        "line": 97,
        "fullcodeline": "sec_ws_key = line+19;"
    },
    {
        "line": 98,
        "fullcodeline": "buf[len-2] = '\\0';"
    },
    {
        "line": 99,
        "fullcodeline": "} else if ((strncasecmp(\"sec-websocket-version: \", line, min(llen,23))) == 0) {"
    },
    {
        "line": 100,
        "fullcodeline": "sec_ws_version = strtol(line+23, NULL, 10);"
    },
    {
        "line": 101,
        "fullcodeline": "buf[len-2] = '\\0';"
    }
]