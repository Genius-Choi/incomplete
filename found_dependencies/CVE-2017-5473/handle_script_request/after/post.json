[
    {
        "line": 4,
        "fullcodeline": "char buf[64], key[64], ifname[MAX_INTERFACE_NAME_LEN];"
    },
    {
        "line": 5,
        "fullcodeline": "char *_cookies, user[64] = { '\\0' }, outbuf[FILENAME_MAX];"
    },
    {
        "line": 8,
        "fullcodeline": "bool csrf_found = false;"
    },
    {
        "line": 13,
        "fullcodeline": "lua_register_classes(L, true); /* Load custom classes */"
    },
    {
        "line": 15,
        "fullcodeline": "lua_pushlightuserdata(L, (char*)conn);"
    },
    {
        "line": 16,
        "fullcodeline": "lua_setglobal(L, CONST_HTTP_CONN);"
    },
    {
        "line": 19,
        "fullcodeline": "lua_newtable(L);"
    },
    {
        "line": 115,
        "fullcodeline": "lua_setglobal(L, \"_GET\"); /* Like in php */"
    },
    {
        "line": 118,
        "fullcodeline": "lua_newtable(L);"
    },
    {
        "line": 119,
        "fullcodeline": "lua_push_str_table_entry(L, \"HTTP_REFERER\", (char*)mg_get_header(conn, \"Referer\"));"
    },
    {
        "line": 120,
        "fullcodeline": "lua_push_str_table_entry(L, \"HTTP_USER_AGENT\", (char*)mg_get_header(conn, \"User-Agent\"));"
    },
    {
        "line": 121,
        "fullcodeline": "lua_push_str_table_entry(L, \"SERVER_NAME\", (char*)mg_get_header(conn, \"Host\"));"
    },
    {
        "line": 122,
        "fullcodeline": "lua_setglobal(L, \"_SERVER\"); /* Like in php */"
    },
    {
        "line": 125,
        "fullcodeline": "lua_newtable(L);"
    },
    {
        "line": 148,
        "fullcodeline": "lua_setglobal(L, \"_COOKIE\"); /* Like in php */"
    },
    {
        "line": 151,
        "fullcodeline": "lua_newtable(L);"
    },
    {
        "line": 153,
        "fullcodeline": "mg_get_cookie(conn, \"user\", user, sizeof(user));"
    },
    {
        "line": 154,
        "fullcodeline": "lua_push_str_table_entry(L, \"user\", user);"
    },
    {
        "line": 155,
        "fullcodeline": "mg_get_cookie(conn, \"session\", buf, sizeof(buf));"
    },
    {
        "line": 156,
        "fullcodeline": "lua_push_str_table_entry(L, \"session\", buf);"
    },
    {
        "line": 159,
        "fullcodeline": "setInterface(user);"
    },
    {
        "line": 161,
        "fullcodeline": "lua_setglobal(L, \"_SESSION\"); /* Like in php */"
    },
    {
        "line": 187,
        "fullcodeline": "rc = luaL_dofile(L, script_path);"
    },
    {
        "line": 10,
        "fullcodeline": "if(!L) return(-1);"
    },
    {
        "line": 20,
        "fullcodeline": "if(request_info->query_string != NULL) {"
    },
    {
        "line": 109,
        "fullcodeline": "if(strstr(request_info->uri, \"/admin/\") && (!csrf_found)) {"
    },
    {
        "line": 126,
        "fullcodeline": "if((_cookies = (char*)mg_get_header(conn, \"Cookie\")) != NULL) {"
    },
    {
        "line": 163,
        "fullcodeline": "if(user[0] != '\\0') {"
    },
    {
        "line": 195,
        "fullcodeline": "if(rc != 0) {"
    },
    {
        "line": 21,
        "fullcodeline": "char *query_string = strdup(request_info->query_string);"
    },
    {
        "line": 110,
        "fullcodeline": "const char *msg = \"Missing CSRF parameter\";"
    },
    {
        "line": 127,
        "fullcodeline": "char *cookies = strdup(_cookies);"
    },
    {
        "line": 131,
        "fullcodeline": "tok = strtok_r(cookies, \"=\", &where);"
    },
    {
        "line": 146,
        "fullcodeline": "free(cookies);"
    },
    {
        "line": 164,
        "fullcodeline": "char val[255];"
    },
    {
        "line": 166,
        "fullcodeline": "lua_pushlightuserdata(L, user);"
    },
    {
        "line": 167,
        "fullcodeline": "lua_setglobal(L, \"user\");"
    },
    {
        "line": 169,
        "fullcodeline": "snprintf(key, sizeof(key), \"ntopng.user.%s.allowed_nets\", user);"
    },
    {
        "line": 178,
        "fullcodeline": "snprintf(key, sizeof(key), CONST_STR_USER_ALLOWED_IFNAME, user);"
    },
    {
        "line": 196,
        "fullcodeline": "const char *err = lua_tostring(L, -1);"
    },
    {
        "line": 198,
        "fullcodeline": "ntop->getTrace()->traceEvent(TRACE_WARNING, \"Script failure [%s][%s]\", script_path, err);"
    },
    {
        "line": 112,
        "fullcodeline": "return(send_error(conn, 500 /* Internal server error */, msg, PAGE_ERROR, request_info->uri, msg));"
    },
    {
        "line": 132,
        "fullcodeline": "while(tok != NULL) {"
    },
    {
        "line": 170,
        "fullcodeline": "if((ntop->getRedis()->get(key, val, sizeof(val)) != -1)"
    },
    {
        "line": 179,
        "fullcodeline": "if(snprintf(key, sizeof(key), CONST_STR_USER_ALLOWED_IFNAME, user)"
    },
    {
        "line": 199,
        "fullcodeline": "return(send_error(conn, 500 /* Internal server error */,"
    },
    {
        "line": 29,
        "fullcodeline": "tok = strtok_r(query_string, \"&\", &where);"
    },
    {
        "line": 104,
        "fullcodeline": "free(query_string);"
    },
    {
        "line": 143,
        "fullcodeline": "tok = strtok_r(NULL, \"=\", &where);"
    },
    {
        "line": 171,
        "fullcodeline": "&& (val[0] != '\\0')) {"
    },
    {
        "line": 172,
        "fullcodeline": "ptree.addAddresses(val);"
    },
    {
        "line": 173,
        "fullcodeline": "lua_pushlightuserdata(L, &ptree);"
    },
    {
        "line": 174,
        "fullcodeline": "lua_setglobal(L, CONST_ALLOWED_NETS);"
    },
    {
        "line": 180,
        "fullcodeline": "&& !ntop->getRedis()->get(key, ifname, sizeof(ifname))) {"
    },
    {
        "line": 181,
        "fullcodeline": "lua_pushlightuserdata(L, ifname);"
    },
    {
        "line": 182,
        "fullcodeline": "lua_setglobal(L, CONST_ALLOWED_IFNAME);"
    },
    {
        "line": 31,
        "fullcodeline": "while(tok != NULL) {"
    },
    {
        "line": 106,
        "fullcodeline": "ntop->getTrace()->traceEvent(TRACE_WARNING, \"Not enough memory\");"
    },
    {
        "line": 135,
        "fullcodeline": "while(tok[0] == ' ') tok++;"
    },
    {
        "line": 137,
        "fullcodeline": "if((val = strtok_r(NULL, \";\", &where)) != NULL) {"
    },
    {
        "line": 33,
        "fullcodeline": "char *_equal = strchr(tok, '=');"
    },
    {
        "line": 101,
        "fullcodeline": "tok = strtok_r(NULL, \"&\", &where);"
    },
    {
        "line": 138,
        "fullcodeline": "lua_push_str_table_entry(L, tok, val);"
    },
    {
        "line": 39,
        "fullcodeline": "_equal[0] = '\\0';"
    },
    {
        "line": 40,
        "fullcodeline": "_equal = &_equal[1];"
    },
    {
        "line": 41,
        "fullcodeline": "len = strlen(_equal);"
    },
    {
        "line": 43,
        "fullcodeline": "purifyHTTPParameter(tok), purifyHTTPParameter(_equal);"
    },
    {
        "line": 47,
        "fullcodeline": "if((equal = (char*)malloc(len+1)) != NULL) {"
    },
    {
        "line": 50,
        "fullcodeline": "Utils::urlDecode(_equal, equal, len+1);"
    },
    {
        "line": 96,
        "fullcodeline": "free(equal);"
    },
    {
        "line": 52,
        "fullcodeline": "if((decoded_buf = http_decode(equal)) != NULL) {"
    },
    {
        "line": 98,
        "fullcodeline": "ntop->getTrace()->traceEvent(TRACE_WARNING, \"Not enough memory\");"
    },
    {
        "line": 55,
        "fullcodeline": "Utils::purifyHTTPparam(tok, true, false);"
    },
    {
        "line": 56,
        "fullcodeline": "Utils::purifyHTTPparam(decoded_buf, false, false);"
    },
    {
        "line": 92,
        "fullcodeline": "lua_push_str_table_entry(L, tok, decoded_buf);"
    },
    {
        "line": 93,
        "fullcodeline": "free(decoded_buf);"
    },
    {
        "line": 59,
        "fullcodeline": "if((decoded_buf[0] == '.')"
    },
    {
        "line": 71,
        "fullcodeline": "if(strcmp(tok, \"csrf\") == 0) {"
    },
    {
        "line": 60,
        "fullcodeline": "&& ((fd = fopen(decoded_buf, \"r\"))"
    },
    {
        "line": 62,
        "fullcodeline": "ntop->getTrace()->traceEvent(TRACE_WARNING, \"Discarded '%s'='%s' as argument is a valid file path\","
    },
    {
        "line": 65,
        "fullcodeline": "decoded_buf[0] = '\\0';"
    },
    {
        "line": 66,
        "fullcodeline": "fclose(fd);"
    },
    {
        "line": 72,
        "fullcodeline": "char rsp[32], user[64] = { '\\0' };"
    },
    {
        "line": 74,
        "fullcodeline": "mg_get_cookie(conn, \"user\", user, sizeof(user));"
    },
    {
        "line": 89,
        "fullcodeline": "csrf_found = true;"
    },
    {
        "line": 61,
        "fullcodeline": "|| (fd = fopen(realpath(decoded_buf, outbuf), \"r\")))) {"
    },
    {
        "line": 76,
        "fullcodeline": "if((ntop->getRedis()->get(decoded_buf, rsp, sizeof(rsp)) == -1)"
    },
    {
        "line": 77,
        "fullcodeline": "|| (strcmp(rsp, user) != 0)) {"
    },
    {
        "line": 78,
        "fullcodeline": "const char *msg = \"The submitted form is expired. Please reload the page and try again\";"
    },
    {
        "line": 80,
        "fullcodeline": "ntop->getTrace()->traceEvent(TRACE_WARNING,"
    },
    {
        "line": 83,
        "fullcodeline": "free(equal);"
    },
    {
        "line": 84,
        "fullcodeline": "return(send_error(conn, 500 /* Internal server error */,"
    },
    {
        "line": 87,
        "fullcodeline": "ntop->getRedis()->delKey(decoded_buf);"
    }
]