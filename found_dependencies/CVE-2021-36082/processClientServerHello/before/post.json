[
    {
        "line": 3,
        "fullcodeline": "struct ndpi_packet_struct *packet = &flow->packet;"
    },
    {
        "line": 5,
        "fullcodeline": "u_int8_t invalid_ja3 = 0;"
    },
    {
        "line": 7,
        "fullcodeline": "char ja3_str[JA3_STR_LEN];"
    },
    {
        "line": 9,
        "fullcodeline": "u_char md5_hash[16];"
    },
    {
        "line": 13,
        "fullcodeline": "char buffer[64] = { '\\0' };"
    },
    {
        "line": 14,
        "fullcodeline": "int is_quic = (quic_version != 0);"
    },
    {
        "line": 15,
        "fullcodeline": "int is_dtls = packet->udp && (!is_quic);"
    },
    {
        "line": 21,
        "fullcodeline": "memset(&ja3, 0, sizeof(ja3));"
    },
    {
        "line": 24,
        "fullcodeline": "total_len = (packet->payload[1] << 16) +  (packet->payload[2] << 8) + packet->payload[3];"
    },
    {
        "line": 29,
        "fullcodeline": "total_len = packet->payload_packet_len;"
    },
    {
        "line": 26,
        "fullcodeline": "if((total_len > packet->payload_packet_len) || (packet->payload[1] != 0x0))"
    },
    {
        "line": 32,
        "fullcodeline": "if(total_len > 4) {"
    },
    {
        "line": 33,
        "fullcodeline": "u_int16_t base_offset    = (!is_dtls) ? 38 : 46;"
    },
    {
        "line": 34,
        "fullcodeline": "u_int16_t version_offset = (!is_dtls) ? 4 : 12;"
    },
    {
        "line": 35,
        "fullcodeline": "u_int16_t offset = (!is_dtls) ? 38 : 46, extension_len, j;"
    },
    {
        "line": 36,
        "fullcodeline": "u_int8_t  session_id_len =  0;"
    },
    {
        "line": 48,
        "fullcodeline": "tls_version = ntohs(*((u_int16_t*)&packet->payload[version_offset]));"
    },
    {
        "line": 38,
        "fullcodeline": "if((base_offset >= total_len) ||"
    },
    {
        "line": 50,
        "fullcodeline": "if(handshake_type == 0x02 /* Server Hello */) {"
    },
    {
        "line": 39,
        "fullcodeline": "(version_offset + 1) >= total_len)"
    },
    {
        "line": 53,
        "fullcodeline": "ja3.server.tls_handshake_version = tls_version;"
    },
    {
        "line": 73,
        "fullcodeline": "ja3.server.num_cipher = 1, ja3.server.cipher[0] = ntohs(*((u_int16_t*)&packet->payload[offset]));"
    },
    {
        "line": 77,
        "fullcodeline": "flow->protos.tls_quic_stun.tls_quic.server_cipher = ja3.server.cipher[0];"
    },
    {
        "line": 83,
        "fullcodeline": "offset += 2 + 1;"
    },
    {
        "line": 93,
        "fullcodeline": "offset += 2;"
    },
    {
        "line": 213,
        "fullcodeline": "ja3_str_len = snprintf(ja3_str, sizeof(ja3_str), \"%u,\", ja3.server.tls_handshake_version);"
    },
    {
        "line": 221,
        "fullcodeline": "rc = snprintf(&ja3_str[ja3_str_len], sizeof(ja3_str)-ja3_str_len, \",\");"
    },
    {
        "line": 253,
        "fullcodeline": "ndpi_MD5Init(&ctx);"
    },
    {
        "line": 254,
        "fullcodeline": "ndpi_MD5Update(&ctx, (const unsigned char *)ja3_str, strlen(ja3_str));"
    },
    {
        "line": 255,
        "fullcodeline": "ndpi_MD5Final(md5_hash, &ctx);"
    },
    {
        "line": 70,
        "fullcodeline": "if((offset+3) > packet->payload_packet_len)"
    },
    {
        "line": 74,
        "fullcodeline": "if((flow->protos.tls_quic_stun.tls_quic.server_unsafe_cipher = ndpi_is_safe_ssl_cipher(ja3.server.cipher[0])) == 1)"
    },
    {
        "line": 85,
        "fullcodeline": "if((offset + 1) < packet->payload_packet_len) /* +1 because we are goint to read 2 bytes */"
    },
    {
        "line": 95,
        "fullcodeline": "for(i=0; i<extension_len; ) {"
    },
    {
        "line": 215,
        "fullcodeline": "for(i=0; i<ja3.server.num_cipher; i++) {"
    },
    {
        "line": 222,
        "fullcodeline": "if(rc > 0 && ja3_str_len + rc < JA3_STR_LEN) ja3_str_len += rc;"
    },
    {
        "line": 226,
        "fullcodeline": "for(i=0; i<ja3.server.num_tls_extension; i++) {"
    },
    {
        "line": 257,
        "fullcodeline": "for(i=0, j=0; i<16; i++) {"
    },
    {
        "line": 64,
        "fullcodeline": "offset += session_id_len + 1;"
    },
    {
        "line": 75,
        "fullcodeline": "ndpi_set_risk(flow, NDPI_TLS_WEAK_CIPHER);"
    },
    {
        "line": 86,
        "fullcodeline": "extension_len = ntohs(*((u_int16_t*)&packet->payload[offset]));"
    },
    {
        "line": 100,
        "fullcodeline": "extension_id  = ntohs(*((u_int16_t*)&packet->payload[offset]));"
    },
    {
        "line": 101,
        "fullcodeline": "extension_len = ntohs(*((u_int16_t*)&packet->payload[offset+2]));"
    },
    {
        "line": 210,
        "fullcodeline": "i += 4 + extension_len, offset += 4 + extension_len;"
    },
    {
        "line": 216,
        "fullcodeline": "rc = snprintf(&ja3_str[ja3_str_len], sizeof(ja3_str)-ja3_str_len, \"%s%u\", (i > 0) ? \"-\" : \"\", ja3.server.cipher[i]);"
    },
    {
        "line": 227,
        "fullcodeline": "int rc = snprintf(&ja3_str[ja3_str_len], sizeof(ja3_str)-ja3_str_len, \"%s%u\", (i > 0) ? \"-\" : \"\", ja3.server.tls_extension[i]);"
    },
    {
        "line": 258,
        "fullcodeline": "int rc = snprintf(&flow->protos.tls_quic_stun.tls_quic.ja3_server[j],"
    },
    {
        "line": 266,
        "fullcodeline": "} else if(handshake_type == 0x01 /* Client Hello */) {"
    },
    {
        "line": 88,
        "fullcodeline": "extension_len = 0;"
    },
    {
        "line": 98,
        "fullcodeline": "if((offset+4) > packet->payload_packet_len) break;"
    },
    {
        "line": 103,
        "fullcodeline": "if(ja3.server.num_tls_extension < MAX_NUM_JA3)"
    },
    {
        "line": 111,
        "fullcodeline": "if(extension_id == 43 /* supported versions */) {"
    },
    {
        "line": 218,
        "fullcodeline": "if(rc <= 0) break; else ja3_str_len += rc;"
    },
    {
        "line": 229,
        "fullcodeline": "if(rc <= 0) break; else ja3_str_len += rc;"
    },
    {
        "line": 233,
        "fullcodeline": "for(i=0; i<ja3.server.num_elliptic_curve_point_format; i++) {"
    },
    {
        "line": 239,
        "fullcodeline": "if(ja3.server.alpn[0] != '\\0') {"
    },
    {
        "line": 260,
        "fullcodeline": "if(rc <= 0) break; else j += rc;"
    },
    {
        "line": 268,
        "fullcodeline": "u_int8_t cookie_len = 0;"
    },
    {
        "line": 270,
        "fullcodeline": "flow->protos.tls_quic_stun.tls_quic.ssl_version = ja3.client.tls_handshake_version = tls_version;"
    },
    {
        "line": 362,
        "fullcodeline": "offset = base_offset + session_id_len + cookie_len + cipher_len + 2;"
    },
    {
        "line": 363,
        "fullcodeline": "offset += (!is_dtls) ? 1 : 2;"
    },
    {
        "line": 66,
        "fullcodeline": "if(tls_version < 0x7F15 /* TLS 1.3 lacks of session id */)"
    },
    {
        "line": 104,
        "fullcodeline": "ja3.server.tls_extension[ja3.server.num_tls_extension++] = extension_id;"
    },
    {
        "line": 234,
        "fullcodeline": "rc = snprintf(&ja3_str[ja3_str_len], sizeof(ja3_str)-ja3_str_len, \"%s%u\","
    },
    {
        "line": 240,
        "fullcodeline": "rc = snprintf(&ja3_str[ja3_str_len], sizeof(ja3_str)-ja3_str_len, \",%s\", ja3.server.alpn);"
    },
    {
        "line": 259,
        "fullcodeline": "sizeof(flow->protos.tls_quic_stun.tls_quic.ja3_server)-j, \"%02x\", md5_hash[i]);"
    },
    {
        "line": 271,
        "fullcodeline": "if(flow->protos.tls_quic_stun.tls_quic.ssl_version < 0x0302) /* TLSv1.1 */"
    },
    {
        "line": 274,
        "fullcodeline": "if((session_id_len+base_offset+3) > packet->payload_packet_len)"
    },
    {
        "line": 277,
        "fullcodeline": "if(!is_dtls) {"
    },
    {
        "line": 295,
        "fullcodeline": "if((cipher_offset+cipher_len) <= total_len) {"
    },
    {
        "line": 365,
        "fullcodeline": "if(offset < total_len) {"
    },
    {
        "line": 67,
        "fullcodeline": "offset += session_id_len+1;"
    },
    {
        "line": 112,
        "fullcodeline": "if(extension_len >= 2) {"
    },
    {
        "line": 236,
        "fullcodeline": "if((rc > 0) && (ja3_str_len + rc < JA3_STR_LEN)) ja3_str_len += rc; else break;"
    },
    {
        "line": 241,
        "fullcodeline": "if((rc > 0) && (ja3_str_len + rc < JA3_STR_LEN)) ja3_str_len += rc;"
    },
    {
        "line": 272,
        "fullcodeline": "ndpi_set_risk(flow, NDPI_TLS_OBSOLETE_VERSION);"
    },
    {
        "line": 278,
        "fullcodeline": "cipher_len = packet->payload[session_id_len+base_offset+2] + (packet->payload[session_id_len+base_offset+1] << 8);"
    },
    {
        "line": 279,
        "fullcodeline": "cipher_offset = base_offset + session_id_len + 3;"
    },
    {
        "line": 296,
        "fullcodeline": "u_int8_t safari_ciphers = 0, chrome_ciphers = 0;"
    },
    {
        "line": 370,
        "fullcodeline": "offset++;"
    },
    {
        "line": 377,
        "fullcodeline": "offset += compression_len;"
    },
    {
        "line": 113,
        "fullcodeline": "u_int16_t tls_version = ntohs(*((u_int16_t*)&packet->payload[offset+4]));"
    },
    {
        "line": 119,
        "fullcodeline": "flow->protos.tls_quic_stun.tls_quic.ssl_version = ja3.server.tls_supported_version = tls_version;"
    },
    {
        "line": 121,
        "fullcodeline": "} else if(extension_id == 16 /* application_layer_protocol_negotiation (ALPN) */) {"
    },
    {
        "line": 235,
        "fullcodeline": "(i > 0) ? \"-\" : \"\", ja3.server.elliptic_curve_point_format[i]);"
    },
    {
        "line": 287,
        "fullcodeline": "cipher_len = ntohs(*((u_int16_t*)&packet->payload[base_offset+session_id_len+cookie_len+2]));"
    },
    {
        "line": 288,
        "fullcodeline": "cipher_offset = base_offset + session_id_len + cookie_len + 4;"
    },
    {
        "line": 298,
        "fullcodeline": "for(i=0; i<cipher_len;) {"
    },
    {
        "line": 351,
        "fullcodeline": "if(chrome_ciphers == 13)"
    },
    {
        "line": 356,
        "fullcodeline": "invalid_ja3 = 1;"
    },
    {
        "line": 379,
        "fullcodeline": "if(offset+1 < total_len) {"
    },
    {
        "line": 122,
        "fullcodeline": "u_int16_t s_offset = offset+4;"
    },
    {
        "line": 123,
        "fullcodeline": "u_int16_t tot_alpn_len = ntohs(*((u_int16_t*)&packet->payload[s_offset]));"
    },
    {
        "line": 124,
        "fullcodeline": "char alpn_str[256];"
    },
    {
        "line": 125,
        "fullcodeline": "u_int8_t alpn_str_len = 0, i;"
    },
    {
        "line": 130,
        "fullcodeline": "s_offset += 2;"
    },
    {
        "line": 131,
        "fullcodeline": "tot_alpn_len += s_offset;"
    },
    {
        "line": 163,
        "fullcodeline": "alpn_str[alpn_str_len] = '\\0';"
    },
    {
        "line": 174,
        "fullcodeline": "snprintf(ja3.server.alpn, sizeof(ja3.server.alpn), \"%s\", alpn_str);"
    },
    {
        "line": 285,
        "fullcodeline": "if((session_id_len+base_offset+cookie_len+4) > packet->payload_packet_len)"
    },
    {
        "line": 299,
        "fullcodeline": "u_int16_t *id = (u_int16_t*)&packet->payload[cipher_offset+i];"
    },
    {
        "line": 348,
        "fullcodeline": "i += 2;"
    },
    {
        "line": 352,
        "fullcodeline": "flow->protos.tls_quic_stun.tls_quic.browser_euristics.is_chrome_tls = 1;"
    },
    {
        "line": 380,
        "fullcodeline": "extensions_len = ntohs(*((u_int16_t*)&packet->payload[offset]));"
    },
    {
        "line": 381,
        "fullcodeline": "offset += 2;"
    },
    {
        "line": 133,
        "fullcodeline": "while(s_offset < tot_alpn_len && s_offset < total_len) {"
    },
    {
        "line": 168,
        "fullcodeline": "if(flow->protos.tls_quic_stun.tls_quic.alpn == NULL)"
    },
    {
        "line": 171,
        "fullcodeline": "if(flow->protos.tls_quic_stun.tls_quic.alpn != NULL)"
    },
    {
        "line": 177,
        "fullcodeline": "for(i=0; ja3.server.alpn[i] != '\\0'; i++)"
    },
    {
        "line": 281,
        "fullcodeline": "cookie_len = packet->payload[base_offset+session_id_len+1];"
    },
    {
        "line": 304,
        "fullcodeline": "if((*id == 0) || (packet->payload[cipher_offset+i] != packet->payload[cipher_offset+i+1])) {"
    },
    {
        "line": 387,
        "fullcodeline": "if((extensions_len+offset) <= total_len) {"
    },
    {
        "line": 169,
        "fullcodeline": "flow->protos.tls_quic_stun.tls_quic.alpn = ndpi_strdup(alpn_str);"
    },
    {
        "line": 172,
        "fullcodeline": "tlsCheckUncommonALPN(flow);"
    },
    {
        "line": 178,
        "fullcodeline": "if(ja3.server.alpn[i] == ',') ja3.server.alpn[i] = '-';"
    },
    {
        "line": 179,
        "fullcodeline": "} else if(extension_id == 11 /* ec_point_formats groups */) {"
    },
    {
        "line": 305,
        "fullcodeline": "u_int16_t cipher_id = ntohs(*id);"
    },
    {
        "line": 353,
        "fullcodeline": "else if(safari_ciphers == 12)"
    },
    {
        "line": 390,
        "fullcodeline": "u_int extension_offset = 0;"
    },
    {
        "line": 928,
        "fullcodeline": "} else if(offset == total_len) {"
    },
    {
        "line": 136,
        "fullcodeline": "if((s_offset + alpn_len) <= tot_alpn_len) {"
    },
    {
        "line": 180,
        "fullcodeline": "u_int16_t s_offset = offset+4 + 1;"
    },
    {
        "line": 311,
        "fullcodeline": "if(ja3.client.num_cipher < MAX_NUM_JA3)"
    },
    {
        "line": 354,
        "fullcodeline": "flow->protos.tls_quic_stun.tls_quic.browser_euristics.is_safari_tls = 1;"
    },
    {
        "line": 393,
        "fullcodeline": "while(extension_offset < extensions_len &&"
    },
    {
        "line": 822,
        "fullcodeline": "if(!invalid_ja3) {"
    },
    {
        "line": 900,
        "fullcodeline": "if((flow->protos.tls_quic_stun.tls_quic.ssl_version >= 0x0303) /* >= TLSv1.2 */"
    },
    {
        "line": 907,
        "fullcodeline": "if(flow->protos.tls_quic_stun.tls_quic.encrypted_sni.esni &&"
    },
    {
        "line": 913,
        "fullcodeline": "if((flow->protos.tls_quic_stun.tls_quic.client_requested_server_name[0] == 0)"
    },
    {
        "line": 134,
        "fullcodeline": "u_int8_t alpn_i, alpn_len = packet->payload[s_offset++];"
    },
    {
        "line": 185,
        "fullcodeline": "if((s_offset+extension_len-1) <= total_len) {"
    },
    {
        "line": 312,
        "fullcodeline": "ja3.client.cipher[ja3.client.num_cipher++] = cipher_id;"
    },
    {
        "line": 323,
        "fullcodeline": "safari_ciphers++;"
    },
    {
        "line": 330,
        "fullcodeline": "chrome_ciphers++;"
    },
    {
        "line": 343,
        "fullcodeline": "safari_ciphers++, chrome_ciphers++;"
    },
    {
        "line": 394,
        "fullcodeline": "offset+extension_offset+4 <= total_len) {"
    },
    {
        "line": 395,
        "fullcodeline": "u_int16_t extension_id, extension_len, extn_off = offset+extension_offset;"
    },
    {
        "line": 398,
        "fullcodeline": "extension_id = ntohs(*((u_int16_t*)&packet->payload[offset+extension_offset]));"
    },
    {
        "line": 399,
        "fullcodeline": "extension_offset += 2;"
    },
    {
        "line": 401,
        "fullcodeline": "extension_len = ntohs(*((u_int16_t*)&packet->payload[offset+extension_offset]));"
    },
    {
        "line": 402,
        "fullcodeline": "extension_offset += 2;"
    },
    {
        "line": 815,
        "fullcodeline": "extension_offset += extension_len; /* Move to the next extension */"
    },
    {
        "line": 826,
        "fullcodeline": "ja3_str_len = snprintf(ja3_str, sizeof(ja3_str), \"%u,\", ja3.client.tls_handshake_version);"
    },
    {
        "line": 834,
        "fullcodeline": "rc = snprintf(&ja3_str[ja3_str_len], sizeof(ja3_str)-ja3_str_len, \",\");"
    },
    {
        "line": 845,
        "fullcodeline": "rc = snprintf(&ja3_str[ja3_str_len], sizeof(ja3_str)-ja3_str_len, \",\");"
    },
    {
        "line": 856,
        "fullcodeline": "rc = snprintf(&ja3_str[ja3_str_len], sizeof(ja3_str)-ja3_str_len, \",\");"
    },
    {
        "line": 875,
        "fullcodeline": "ndpi_MD5Init(&ctx);"
    },
    {
        "line": 876,
        "fullcodeline": "ndpi_MD5Update(&ctx, (const unsigned char *)ja3_str, strlen(ja3_str));"
    },
    {
        "line": 877,
        "fullcodeline": "ndpi_MD5Final(md5_hash, &ctx);"
    },
    {
        "line": 901,
        "fullcodeline": "&& (flow->protos.tls_quic_stun.tls_quic.alpn == NULL) /* No ALPN */) {"
    },
    {
        "line": 902,
        "fullcodeline": "ndpi_set_risk(flow, NDPI_TLS_NOT_CARRYING_HTTPS);"
    },
    {
        "line": 908,
        "fullcodeline": "flow->protos.tls_quic_stun.tls_quic.client_requested_server_name[0] != '\\0') {"
    },
    {
        "line": 909,
        "fullcodeline": "ndpi_set_risk(flow, NDPI_TLS_SUSPICIOUS_ESNI_USAGE);"
    },
    {
        "line": 915,
        "fullcodeline": "&& (flow->protos.tls_quic_stun.tls_quic.encrypted_sni.esni == NULL) /* No ESNI */"
    },
    {
        "line": 918,
        "fullcodeline": "ndpi_set_risk(flow, NDPI_TLS_MISSING_SNI);"
    },
    {
        "line": 141,
        "fullcodeline": "if((alpn_str_len+alpn_len+1) < (sizeof(alpn_str)-1)) {"
    },
    {
        "line": 158,
        "fullcodeline": "ndpi_set_risk(flow, NDPI_TLS_UNCOMMON_ALPN);"
    },
    {
        "line": 314,
        "fullcodeline": "invalid_ja3 = 1;"
    },
    {
        "line": 408,
        "fullcodeline": "if((extension_id == 0) || (packet->payload[extn_off] != packet->payload[extn_off+1])) {"
    },
    {
        "line": 421,
        "fullcodeline": "if(extension_id == 0 /* server name */) {"
    },
    {
        "line": 828,
        "fullcodeline": "for(i=0; i<ja3.client.num_cipher; i++) {"
    },
    {
        "line": 835,
        "fullcodeline": "if((rc > 0) && (ja3_str_len + rc < JA3_STR_LEN)) ja3_str_len += rc;"
    },
    {
        "line": 839,
        "fullcodeline": "for(i=0; i<ja3.client.num_tls_extension; i++) {"
    },
    {
        "line": 846,
        "fullcodeline": "if((rc > 0) && (ja3_str_len + rc < JA3_STR_LEN)) ja3_str_len += rc;"
    },
    {
        "line": 850,
        "fullcodeline": "for(i=0; i<ja3.client.num_elliptic_curve; i++) {"
    },
    {
        "line": 857,
        "fullcodeline": "if((rc > 0) && (ja3_str_len + rc < JA3_STR_LEN)) ja3_str_len += rc;"
    },
    {
        "line": 859,
        "fullcodeline": "for(i=0; i<ja3.client.num_elliptic_curve_point_format; i++) {"
    },
    {
        "line": 879,
        "fullcodeline": "for(i=0, j=0; i<16; i++) {"
    },
    {
        "line": 890,
        "fullcodeline": "if(ndpi_struct->malicious_ja3_automa.ac_automa != NULL) {"
    },
    {
        "line": 914,
        "fullcodeline": "&& (flow->protos.tls_quic_stun.tls_quic.ssl_version >= 0x0302) /* TLSv1.1 */"
    },
    {
        "line": 152,
        "fullcodeline": "s_offset += alpn_len, alpn_str_len += alpn_len;;"
    },
    {
        "line": 186,
        "fullcodeline": "for(i=0; i<extension_len-1; i++) {"
    },
    {
        "line": 203,
        "fullcodeline": "invalid_ja3 = 1;"
    },
    {
        "line": 829,
        "fullcodeline": "rc = snprintf(&ja3_str[ja3_str_len], sizeof(ja3_str)-ja3_str_len, \"%s%u\","
    },
    {
        "line": 840,
        "fullcodeline": "rc = snprintf(&ja3_str[ja3_str_len], sizeof(ja3_str)-ja3_str_len, \"%s%u\","
    },
    {
        "line": 851,
        "fullcodeline": "rc = snprintf(&ja3_str[ja3_str_len], sizeof(ja3_str)-ja3_str_len, \"%s%u\","
    },
    {
        "line": 860,
        "fullcodeline": "rc = snprintf(&ja3_str[ja3_str_len], sizeof(ja3_str)-ja3_str_len, \"%s%u\","
    },
    {
        "line": 866,
        "fullcodeline": "rc = snprintf(&ja3_str[ja3_str_len], sizeof(ja3_str)-ja3_str_len,"
    },
    {
        "line": 880,
        "fullcodeline": "rc = snprintf(&flow->protos.tls_quic_stun.tls_quic.ja3_client[j],"
    },
    {
        "line": 891,
        "fullcodeline": "u_int16_t rc1 = ndpi_match_string(ndpi_struct->malicious_ja3_automa.ac_automa,"
    },
    {
        "line": 142,
        "fullcodeline": "if(alpn_str_len > 0) {"
    },
    {
        "line": 147,
        "fullcodeline": "for(alpn_i=0; alpn_i<alpn_len; alpn_i++)"
    },
    {
        "line": 154,
        "fullcodeline": "ndpi_set_risk(flow, NDPI_TLS_UNCOMMON_ALPN);"
    },
    {
        "line": 411,
        "fullcodeline": "if(ja3.client.num_tls_extension < MAX_NUM_JA3)"
    },
    {
        "line": 427,
        "fullcodeline": "if((offset+extension_offset+4) < packet->payload_packet_len) {"
    },
    {
        "line": 831,
        "fullcodeline": "if((rc > 0) && (ja3_str_len + rc < JA3_STR_LEN)) ja3_str_len += rc; else break;"
    },
    {
        "line": 842,
        "fullcodeline": "if((rc > 0) && (ja3_str_len + rc < JA3_STR_LEN)) ja3_str_len += rc; else break;"
    },
    {
        "line": 853,
        "fullcodeline": "if((rc > 0) && (ja3_str_len + rc < JA3_STR_LEN)) ja3_str_len += rc; else break;"
    },
    {
        "line": 862,
        "fullcodeline": "if((rc > 0) && (ja3_str_len + rc < JA3_STR_LEN)) ja3_str_len += rc; else break;"
    },
    {
        "line": 868,
        "fullcodeline": "if((rc > 0) && (ja3_str_len + rc < JA3_STR_LEN)) ja3_str_len += rc;"
    },
    {
        "line": 883,
        "fullcodeline": "if(rc > 0) j += rc; else break;"
    },
    {
        "line": 894,
        "fullcodeline": "if(rc1 > 0)"
    },
    {
        "line": 143,
        "fullcodeline": "alpn_str[alpn_str_len] = ',';"
    },
    {
        "line": 144,
        "fullcodeline": "alpn_str_len++;"
    },
    {
        "line": 193,
        "fullcodeline": "if(ja3.server.num_elliptic_curve_point_format < MAX_NUM_JA3)"
    },
    {
        "line": 412,
        "fullcodeline": "ja3.client.tls_extension[ja3.client.num_tls_extension++] = extension_id;"
    },
    {
        "line": 429,
        "fullcodeline": "len = (packet->payload[offset+extension_offset+3] << 8) + packet->payload[offset+extension_offset+4];"
    },
    {
        "line": 430,
        "fullcodeline": "len = (u_int)ndpi_min(len, sizeof(buffer)-1);"
    },
    {
        "line": 479,
        "fullcodeline": "} else if(extension_id == 10 /* supported groups */) {"
    },
    {
        "line": 830,
        "fullcodeline": "(i > 0) ? \"-\" : \"\", ja3.client.cipher[i]);"
    },
    {
        "line": 841,
        "fullcodeline": "(i > 0) ? \"-\" : \"\", ja3.client.tls_extension[i]);"
    },
    {
        "line": 852,
        "fullcodeline": "(i > 0) ? \"-\" : \"\", ja3.client.elliptic_curve[i]);"
    },
    {
        "line": 861,
        "fullcodeline": "(i > 0) ? \"-\" : \"\", ja3.client.elliptic_curve_point_format[i]);"
    },
    {
        "line": 881,
        "fullcodeline": "sizeof(flow->protos.tls_quic_stun.tls_quic.ja3_client)-j, \"%02x\","
    },
    {
        "line": 895,
        "fullcodeline": "ndpi_set_risk(flow, NDPI_MALICIOUS_JA3);"
    },
    {
        "line": 187,
        "fullcodeline": "u_int8_t s_group = packet->payload[s_offset+i];"
    },
    {
        "line": 194,
        "fullcodeline": "ja3.server.elliptic_curve_point_format[ja3.server.num_elliptic_curve_point_format++] = s_group;"
    },
    {
        "line": 414,
        "fullcodeline": "invalid_ja3 = 1;"
    },
    {
        "line": 432,
        "fullcodeline": "if((offset+extension_offset+5+len) <= packet->payload_packet_len) {"
    },
    {
        "line": 480,
        "fullcodeline": "u_int16_t s_offset = offset+extension_offset + 2;"
    },
    {
        "line": 149,
        "fullcodeline": "alpn_str[alpn_str_len+alpn_i] = packet->payload[s_offset+alpn_i];"
    },
    {
        "line": 196,
        "fullcodeline": "invalid_ja3 = 1;"
    },
    {
        "line": 433,
        "fullcodeline": "strncpy(buffer, (char*)&packet->payload[offset+extension_offset+5], len);"
    },
    {
        "line": 434,
        "fullcodeline": "buffer[len] = '\\0';"
    },
    {
        "line": 436,
        "fullcodeline": "cleanupServerName(buffer, sizeof(buffer));"
    },
    {
        "line": 438,
        "fullcodeline": "snprintf(flow->protos.tls_quic_stun.tls_quic.client_requested_server_name,"
    },
    {
        "line": 486,
        "fullcodeline": "if((s_offset+extension_len-2) <= total_len) {"
    },
    {
        "line": 444,
        "fullcodeline": "if(!is_quic) {"
    },
    {
        "line": 452,
        "fullcodeline": "if(ndpi_check_dga_name(ndpi_struct, flow,"
    },
    {
        "line": 513,
        "fullcodeline": "} else if(extension_id == 11 /* ec_point_formats groups */) {"
    },
    {
        "line": 454,
        "fullcodeline": "char *sni = flow->protos.tls_quic_stun.tls_quic.client_requested_server_name;"
    },
    {
        "line": 455,
        "fullcodeline": "int len = strlen(sni);"
    },
    {
        "line": 487,
        "fullcodeline": "for(i=0; i<extension_len-2;) {"
    },
    {
        "line": 508,
        "fullcodeline": "invalid_ja3 = 1;"
    },
    {
        "line": 514,
        "fullcodeline": "u_int16_t s_offset = offset+extension_offset + 1;"
    },
    {
        "line": 445,
        "fullcodeline": "if(ndpi_match_hostname_protocol(ndpi_struct, flow, NDPI_PROTOCOL_TLS, buffer, strlen(buffer)))"
    },
    {
        "line": 461,
        "fullcodeline": "if((len >= 4)"
    },
    {
        "line": 488,
        "fullcodeline": "u_int16_t s_group = ntohs(*((u_int16_t*)&packet->payload[s_offset+i]));"
    },
    {
        "line": 505,
        "fullcodeline": "i += 2;"
    },
    {
        "line": 519,
        "fullcodeline": "if((s_offset+extension_len-1) <= total_len) {"
    },
    {
        "line": 446,
        "fullcodeline": "flow->l4.tcp.tls.subprotocol_detected = 1;"
    },
    {
        "line": 448,
        "fullcodeline": "if(ndpi_match_hostname_protocol(ndpi_struct, flow, NDPI_PROTOCOL_QUIC, buffer, strlen(buffer)))"
    },
    {
        "line": 464,
        "fullcodeline": "&& (strncmp(sni, \"www.\", 4) == 0)) /* Not starting with www.... */"
    },
    {
        "line": 465,
        "fullcodeline": "ndpi_set_detected_protocol(ndpi_struct, flow, NDPI_PROTOCOL_TOR, NDPI_PROTOCOL_TLS);"
    },
    {
        "line": 493,
        "fullcodeline": "if((s_group == 0) || (packet->payload[s_offset+i] != packet->payload[s_offset+i+1])) {"
    },
    {
        "line": 542,
        "fullcodeline": "} else if(extension_id == 13 /* signature algorithms */) {"
    },
    {
        "line": 449,
        "fullcodeline": "flow->l4.tcp.tls.subprotocol_detected = 1;"
    },
    {
        "line": 463,
        "fullcodeline": "&& ((strcmp(&sni[len-4], \".com\") == 0) || (strcmp(&sni[len-4], \".net\") == 0))"
    },
    {
        "line": 520,
        "fullcodeline": "for(i=0; i<extension_len-1; i++) {"
    },
    {
        "line": 537,
        "fullcodeline": "invalid_ja3 = 1;"
    },
    {
        "line": 543,
        "fullcodeline": "u_int16_t s_offset = offset+extension_offset, safari_signature_algorithms = 0, chrome_signature_algorithms = 0;"
    },
    {
        "line": 544,
        "fullcodeline": "u_int16_t tot_signature_algorithms_len = ntohs(*((u_int16_t*)&packet->payload[s_offset]));"
    },
    {
        "line": 550,
        "fullcodeline": "s_offset += 2;"
    },
    {
        "line": 551,
        "fullcodeline": "tot_signature_algorithms_len = ndpi_min((sizeof(ja3.client.signature_algorithms) / 2) - 1, tot_signature_algorithms_len);"
    },
    {
        "line": 599,
        "fullcodeline": "ja3.client.signature_algorithms[i*2] = '\\0';"
    },
    {
        "line": 495,
        "fullcodeline": "if(ja3.client.num_elliptic_curve < MAX_NUM_JA3)"
    },
    {
        "line": 521,
        "fullcodeline": "u_int8_t s_group = packet->payload[s_offset+i];"
    },
    {
        "line": 560,
        "fullcodeline": "for(i=0; i<tot_signature_algorithms_len; i++) {"
    },
    {
        "line": 566,
        "fullcodeline": "for(i=0; i<tot_signature_algorithms_len; i+=2) {"
    },
    {
        "line": 593,
        "fullcodeline": "if(safari_signature_algorithms != 8)"
    },
    {
        "line": 596,
        "fullcodeline": "if(chrome_signature_algorithms != 8)"
    },
    {
        "line": 496,
        "fullcodeline": "ja3.client.elliptic_curve[ja3.client.num_elliptic_curve++] = s_group;"
    },
    {
        "line": 527,
        "fullcodeline": "if(ja3.client.num_elliptic_curve_point_format < MAX_NUM_JA3)"
    },
    {
        "line": 561,
        "fullcodeline": "int rc = snprintf(&ja3.client.signature_algorithms[i*2], sizeof(ja3.client.signature_algorithms)-i*2, \"%02X\", packet->payload[s_offset+i]);"
    },
    {
        "line": 567,
        "fullcodeline": "u_int16_t cipher_id = (u_int16_t)ntohs(*((u_int16_t*)&packet->payload[s_offset+i]));"
    },
    {
        "line": 590,
        "fullcodeline": "flow->protos.tls_quic_stun.tls_quic.browser_euristics.is_safari_tls = 0,"
    },
    {
        "line": 594,
        "fullcodeline": "flow->protos.tls_quic_stun.tls_quic.browser_euristics.is_safari_tls = 0;"
    },
    {
        "line": 597,
        "fullcodeline": "flow->protos.tls_quic_stun.tls_quic.browser_euristics.is_chrome_tls = 0;"
    },
    {
        "line": 604,
        "fullcodeline": "} else if(extension_id == 16 /* application_layer_protocol_negotiation */) {"
    },
    {
        "line": 498,
        "fullcodeline": "invalid_ja3 = 1;"
    },
    {
        "line": 528,
        "fullcodeline": "ja3.client.elliptic_curve_point_format[ja3.client.num_elliptic_curve_point_format++] = s_group;"
    },
    {
        "line": 563,
        "fullcodeline": "if(rc < 0) break;"
    },
    {
        "line": 591,
        "fullcodeline": "flow->protos.tls_quic_stun.tls_quic.browser_euristics.is_chrome_tls = 0;"
    },
    {
        "line": 605,
        "fullcodeline": "u_int16_t s_offset = offset+extension_offset;"
    },
    {
        "line": 606,
        "fullcodeline": "u_int16_t tot_alpn_len = ntohs(*((u_int16_t*)&packet->payload[s_offset]));"
    },
    {
        "line": 607,
        "fullcodeline": "char alpn_str[256];"
    },
    {
        "line": 608,
        "fullcodeline": "u_int8_t alpn_str_len = 0, i;"
    },
    {
        "line": 613,
        "fullcodeline": "s_offset += 2;"
    },
    {
        "line": 614,
        "fullcodeline": "tot_alpn_len += s_offset;"
    },
    {
        "line": 641,
        "fullcodeline": "alpn_str[alpn_str_len] = '\\0';"
    },
    {
        "line": 649,
        "fullcodeline": "snprintf(ja3.client.alpn, sizeof(ja3.client.alpn), \"%s\", alpn_str);"
    },
    {
        "line": 530,
        "fullcodeline": "invalid_ja3 = 1;"
    },
    {
        "line": 573,
        "fullcodeline": "flow->protos.tls_quic_stun.tls_quic.browser_euristics.is_firefox_tls = 1;"
    },
    {
        "line": 584,
        "fullcodeline": "chrome_signature_algorithms++, safari_signature_algorithms++;"
    },
    {
        "line": 616,
        "fullcodeline": "while(s_offset < tot_alpn_len && s_offset < total_len) {"
    },
    {
        "line": 646,
        "fullcodeline": "if(flow->protos.tls_quic_stun.tls_quic.alpn == NULL)"
    },
    {
        "line": 652,
        "fullcodeline": "for(i=0; ja3.client.alpn[i] != '\\0'; i++)"
    },
    {
        "line": 647,
        "fullcodeline": "flow->protos.tls_quic_stun.tls_quic.alpn = ndpi_strdup(alpn_str);"
    },
    {
        "line": 653,
        "fullcodeline": "if(ja3.client.alpn[i] == ',') ja3.client.alpn[i] = '-';"
    },
    {
        "line": 655,
        "fullcodeline": "} else if(extension_id == 43 /* supported versions */) {"
    },
    {
        "line": 619,
        "fullcodeline": "if((s_offset + alpn_len) <= tot_alpn_len &&"
    },
    {
        "line": 656,
        "fullcodeline": "u_int16_t s_offset = offset+extension_offset;"
    },
    {
        "line": 657,
        "fullcodeline": "u_int8_t version_len = packet->payload[s_offset];"
    },
    {
        "line": 658,
        "fullcodeline": "char version_str[256];"
    },
    {
        "line": 659,
        "fullcodeline": "u_int8_t version_str_len = 0;"
    },
    {
        "line": 660,
        "fullcodeline": "version_str[0] = 0;"
    },
    {
        "line": 617,
        "fullcodeline": "u_int8_t alpn_i, alpn_len = packet->payload[s_offset++];"
    },
    {
        "line": 620,
        "fullcodeline": "(s_offset + alpn_len) <= total_len) {"
    },
    {
        "line": 665,
        "fullcodeline": "if(version_len == (extension_len-1)) {"
    },
    {
        "line": 625,
        "fullcodeline": "if((alpn_str_len+alpn_len+1) < (sizeof(alpn_str)-1)) {"
    },
    {
        "line": 667,
        "fullcodeline": "u_int16_t supported_versions_offset = 0;"
    },
    {
        "line": 669,
        "fullcodeline": "s_offset++;"
    },
    {
        "line": 707,
        "fullcodeline": "} else if(extension_id == 65486 /* encrypted server name */) {"
    },
    {
        "line": 634,
        "fullcodeline": "s_offset += alpn_len, alpn_str_len += alpn_len;;"
    },
    {
        "line": 672,
        "fullcodeline": "for(j=0; j+1<version_len; j += 2) {"
    },
    {
        "line": 704,
        "fullcodeline": "if(flow->protos.tls_quic_stun.tls_quic.tls_supported_versions == NULL)"
    },
    {
        "line": 712,
        "fullcodeline": "u_int16_t e_offset = offset+extension_offset;"
    },
    {
        "line": 713,
        "fullcodeline": "u_int16_t initial_offset = e_offset;"
    },
    {
        "line": 714,
        "fullcodeline": "u_int16_t e_sni_len, cipher_suite = ntohs(*((u_int16_t*)&packet->payload[e_offset]));"
    },
    {
        "line": 716,
        "fullcodeline": "flow->protos.tls_quic_stun.tls_quic.encrypted_sni.cipher_suite = cipher_suite;"
    },
    {
        "line": 718,
        "fullcodeline": "e_offset += 2; /* Cipher suite len */"
    },
    {
        "line": 721,
        "fullcodeline": "e_offset += 2; /* Group */"
    },
    {
        "line": 722,
        "fullcodeline": "e_offset +=  ntohs(*((u_int16_t*)&packet->payload[e_offset])) + 2; /* Lenght */"
    },
    {
        "line": 626,
        "fullcodeline": "if(alpn_str_len > 0) {"
    },
    {
        "line": 631,
        "fullcodeline": "for(alpn_i=0; alpn_i<alpn_len; alpn_i++)"
    },
    {
        "line": 673,
        "fullcodeline": "u_int16_t tls_version = ntohs(*((u_int16_t*)&packet->payload[s_offset+j]));"
    },
    {
        "line": 705,
        "fullcodeline": "flow->protos.tls_quic_stun.tls_quic.tls_supported_versions = ndpi_strdup(version_str);"
    },
    {
        "line": 724,
        "fullcodeline": "if((e_offset+4) < packet->payload_packet_len) {"
    },
    {
        "line": 627,
        "fullcodeline": "alpn_str[alpn_str_len] = ',';"
    },
    {
        "line": 628,
        "fullcodeline": "alpn_str_len++;"
    },
    {
        "line": 681,
        "fullcodeline": "if((version_str_len+8) < sizeof(version_str)) {"
    },
    {
        "line": 726,
        "fullcodeline": "e_offset +=  ntohs(*((u_int16_t*)&packet->payload[e_offset])) + 2; /* Lenght */"
    },
    {
        "line": 758,
        "fullcodeline": "} else if(extension_id == 65445 || /* QUIC transport parameters (drafts version) */"
    },
    {
        "line": 632,
        "fullcodeline": "alpn_str[alpn_str_len+alpn_i] = packet->payload[s_offset+alpn_i];"
    },
    {
        "line": 682,
        "fullcodeline": "int rc = snprintf(&version_str[version_str_len],"
    },
    {
        "line": 691,
        "fullcodeline": "rc = snprintf(&ja3.client.supported_versions[supported_versions_offset],"
    },
    {
        "line": 728,
        "fullcodeline": "if((e_offset+4) < packet->payload_packet_len) {"
    },
    {
        "line": 759,
        "fullcodeline": "extension_id == 57) { /* QUIC transport parameters (final version) */"
    },
    {
        "line": 760,
        "fullcodeline": "u_int16_t s_offset = offset+extension_offset;"
    },
    {
        "line": 762,
        "fullcodeline": "int using_var_int = is_version_with_var_int_transport_params(quic_version);"
    },
    {
        "line": 686,
        "fullcodeline": "if(rc <= 0)"
    },
    {
        "line": 695,
        "fullcodeline": "if(rc > 0)"
    },
    {
        "line": 729,
        "fullcodeline": "e_sni_len = ntohs(*((u_int16_t*)&packet->payload[e_offset]));"
    },
    {
        "line": 730,
        "fullcodeline": "e_offset += 2;"
    },
    {
        "line": 764,
        "fullcodeline": "if(!using_var_int) {"
    },
    {
        "line": 776,
        "fullcodeline": "while(s_offset < final_offset) {"
    },
    {
        "line": 683,
        "fullcodeline": "sizeof(version_str) - version_str_len, \"%s%s\","
    },
    {
        "line": 684,
        "fullcodeline": "(version_str_len > 0) ? \",\" : \"\","
    },
    {
        "line": 685,
        "fullcodeline": "ndpi_ssl_version2str(flow, tls_version, &unknown_tls_version));"
    },
    {
        "line": 692,
        "fullcodeline": "sizeof(ja3.client.supported_versions)-supported_versions_offset,"
    },
    {
        "line": 693,
        "fullcodeline": "\"%s%04X\", (j > 0) ? \"-\" : \"\", tls_version);"
    },
    {
        "line": 696,
        "fullcodeline": "supported_versions_offset += rc;"
    },
    {
        "line": 732,
        "fullcodeline": "if((e_offset+e_sni_len-extension_len-initial_offset) >= 0 &&"
    },
    {
        "line": 811,
        "fullcodeline": "s_offset += param_len;"
    },
    {
        "line": 689,
        "fullcodeline": "version_str_len += rc;"
    },
    {
        "line": 733,
        "fullcodeline": "e_offset+e_sni_len < packet->payload_packet_len) {"
    },
    {
        "line": 765,
        "fullcodeline": "if(s_offset+1 >= total_len) {"
    },
    {
        "line": 773,
        "fullcodeline": "final_offset = MIN(total_len, s_offset + extension_len);"
    },
    {
        "line": 779,
        "fullcodeline": "if(!using_var_int) {"
    },
    {
        "line": 800,
        "fullcodeline": "if(s_offset+param_len > final_offset)"
    },
    {
        "line": 803,
        "fullcodeline": "if(param_type==0x3129) {"
    },
    {
        "line": 738,
        "fullcodeline": "if(flow->protos.tls_quic_stun.tls_quic.encrypted_sni.esni == NULL) {"
    },
    {
        "line": 766,
        "fullcodeline": "final_offset = 0; /* Force skipping extension */"
    },
    {
        "line": 782,
        "fullcodeline": "param_type = ntohs(*((u_int16_t*)&packet->payload[s_offset]));"
    },
    {
        "line": 783,
        "fullcodeline": "param_len = ntohs(*((u_int16_t*)&packet->payload[s_offset + 2]));"
    },
    {
        "line": 784,
        "fullcodeline": "s_offset += 4;"
    },
    {
        "line": 807,
        "fullcodeline": "http_process_user_agent(ndpi_struct, flow,"
    },
    {
        "line": 739,
        "fullcodeline": "flow->protos.tls_quic_stun.tls_quic.encrypted_sni.esni = (char*)ndpi_malloc(e_sni_len*2+1);"
    },
    {
        "line": 768,
        "fullcodeline": "u_int16_t seq_len = ntohs(*((u_int16_t*)&packet->payload[s_offset]));"
    },
    {
        "line": 769,
        "fullcodeline": "s_offset += 2;"
    },
    {
        "line": 770,
        "fullcodeline": "final_offset = MIN(total_len, s_offset + seq_len);"
    },
    {
        "line": 780,
        "fullcodeline": "if(s_offset+3 >= final_offset)"
    },
    {
        "line": 789,
        "fullcodeline": "s_offset += quic_len(&packet->payload[s_offset], &param_type);"
    },
    {
        "line": 794,
        "fullcodeline": "s_offset += quic_len(&packet->payload[s_offset], &param_len);"
    },
    {
        "line": 786,
        "fullcodeline": "if(s_offset >= final_offset ||"
    },
    {
        "line": 791,
        "fullcodeline": "if(s_offset >= final_offset ||"
    },
    {
        "line": 787,
        "fullcodeline": "(s_offset + quic_len_buffer_still_required(packet->payload[s_offset])) >= final_offset)"
    },
    {
        "line": 792,
        "fullcodeline": "(s_offset + quic_len_buffer_still_required(packet->payload[s_offset])) >= final_offset)"
    },
    {
        "line": 744,
        "fullcodeline": "for(i=e_offset, off=0; i<(e_offset+e_sni_len); i++) {"
    },
    {
        "line": 745,
        "fullcodeline": "int rc = sprintf(&flow->protos.tls_quic_stun.tls_quic.encrypted_sni.esni[off], \"%02X\", packet->payload[i] & 0XFF);"
    },
    {
        "line": 747,
        "fullcodeline": "if(rc <= 0) {"
    },
    {
        "line": 748,
        "fullcodeline": "flow->protos.tls_quic_stun.tls_quic.encrypted_sni.esni[off] = '\\0';"
    },
    {
        "line": 751,
        "fullcodeline": "off += rc;"
    }
]