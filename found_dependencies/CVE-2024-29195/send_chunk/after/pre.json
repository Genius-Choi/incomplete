[
    {
        "line": 5,
        "fullcodeline": "if ((tls_io == NULL) ||"
    },
    {
        "line": 7,
        "fullcodeline": "(size == 0))"
    },
    {
        "line": 9,
        "fullcodeline": "LogError(\"invalid argument detected: CONCRETE_IO_HANDLE tls_io = %p, const void* buffer = %p, size_t size = %lu\", tls_io, buffer, (unsigned long)size);"
    },
    {
        "line": 10,
        "fullcodeline": "result = MU_FAILURE;"
    },
    {
        "line": 6,
        "fullcodeline": "(buffer == NULL) ||"
    },
    {
        "line": 14,
        "fullcodeline": "TLS_IO_INSTANCE* tls_io_instance = (TLS_IO_INSTANCE*)tls_io;"
    },
    {
        "line": 15,
        "fullcodeline": "if (tls_io_instance->tlsio_state != TLSIO_STATE_OPEN)"
    },
    {
        "line": 18,
        "fullcodeline": "result = MU_FAILURE;"
    },
    {
        "line": 23,
        "fullcodeline": "SECURITY_STATUS status = QueryContextAttributes(&tls_io_instance->security_context, SECPKG_ATTR_STREAM_SIZES, &sizes);"
    },
    {
        "line": 24,
        "fullcodeline": "if (status != SEC_E_OK)"
    },
    {
        "line": 26,
        "fullcodeline": "LogError(\"QueryContextAttributes failed: %x\", status);"
    },
    {
        "line": 27,
        "fullcodeline": "result = MU_FAILURE;"
    },
    {
        "line": 32,
        "fullcodeline": "SecBuffer security_buffers[4];"
    },
    {
        "line": 34,
        "fullcodeline": "size_t needed_buffer = safe_add_size_t(sizes.cbHeader, size);"
    },
    {
        "line": 35,
        "fullcodeline": "needed_buffer = safe_add_size_t(needed_buffer, sizes.cbTrailer);"
    },
    {
        "line": 36,
        "fullcodeline": "if (needed_buffer == SIZE_MAX ||"
    },
    {
        "line": 37,
        "fullcodeline": "(out_buffer = (unsigned char*)malloc(needed_buffer)) == NULL)"
    },
    {
        "line": 39,
        "fullcodeline": "LogError(\"malloc failed, size:%zu\", needed_buffer);"
    },
    {
        "line": 40,
        "fullcodeline": "result = MU_FAILURE;"
    },
    {
        "line": 44,
        "fullcodeline": "(void)memcpy(out_buffer + sizes.cbHeader, buffer, size);"
    },
    {
        "line": 46,
        "fullcodeline": "security_buffers[0].BufferType = SECBUFFER_STREAM_HEADER;"
    },
    {
        "line": 47,
        "fullcodeline": "security_buffers[0].cbBuffer = sizes.cbHeader;"
    },
    {
        "line": 48,
        "fullcodeline": "security_buffers[0].pvBuffer = out_buffer;"
    },
    {
        "line": 49,
        "fullcodeline": "security_buffers[1].BufferType = SECBUFFER_DATA;"
    },
    {
        "line": 50,
        "fullcodeline": "security_buffers[1].cbBuffer = (unsigned long)size;"
    },
    {
        "line": 51,
        "fullcodeline": "security_buffers[1].pvBuffer = out_buffer + sizes.cbHeader;"
    },
    {
        "line": 52,
        "fullcodeline": "security_buffers[2].BufferType = SECBUFFER_STREAM_TRAILER;"
    },
    {
        "line": 53,
        "fullcodeline": "security_buffers[2].cbBuffer = sizes.cbTrailer;"
    },
    {
        "line": 54,
        "fullcodeline": "security_buffers[2].pvBuffer = out_buffer + sizes.cbHeader + size;"
    },
    {
        "line": 55,
        "fullcodeline": "security_buffers[3].cbBuffer = 0;"
    },
    {
        "line": 56,
        "fullcodeline": "security_buffers[3].BufferType = SECBUFFER_EMPTY;"
    },
    {
        "line": 57,
        "fullcodeline": "security_buffers[3].pvBuffer = 0;"
    },
    {
        "line": 59,
        "fullcodeline": "security_buffers_desc.cBuffers = sizeof(security_buffers) / sizeof(security_buffers[0]);"
    },
    {
        "line": 60,
        "fullcodeline": "security_buffers_desc.pBuffers = security_buffers;"
    },
    {
        "line": 61,
        "fullcodeline": "security_buffers_desc.ulVersion = SECBUFFER_VERSION;"
    },
    {
        "line": 63,
        "fullcodeline": "status = EncryptMessage(&tls_io_instance->security_context, 0, &security_buffers_desc, 0);"
    },
    {
        "line": 82,
        "fullcodeline": "free(out_buffer);"
    },
    {
        "line": 64,
        "fullcodeline": "if (FAILED(status))"
    },
    {
        "line": 66,
        "fullcodeline": "LogError(\"EncryptMessage failed: %x\", status);"
    },
    {
        "line": 67,
        "fullcodeline": "result = MU_FAILURE;"
    },
    {
        "line": 71,
        "fullcodeline": "if (xio_send(tls_io_instance->socket_io, out_buffer, (size_t)security_buffers[0].cbBuffer + (size_t)security_buffers[1].cbBuffer + (size_t)security_buffers[2].cbBuffer, on_send_complete, callback_context) != 0)"
    },
    {
        "line": 73,
        "fullcodeline": "LogError(\"xio_send failed\");"
    },
    {
        "line": 74,
        "fullcodeline": "result = MU_FAILURE;"
    },
    {
        "line": 78,
        "fullcodeline": "result = 0;"
    }
]