[
    {
        "line": 3,
        "fullcodeline": "int ret = -1;"
    },
    {
        "line": 4,
        "fullcodeline": "int cert_valid = 0;"
    },
    {
        "line": 5,
        "fullcodeline": "unsigned char digest[SHA256LEN];"
    },
    {
        "line": 8,
        "fullcodeline": "char digest_str[SHA256STRLEN], *subject, *issuer;"
    },
    {
        "line": 12,
        "fullcodeline": "char common_name[FIELD_SIZE + 1];"
    },
    {
        "line": 14,
        "fullcodeline": "SSL_set_verify(tunnel->ssl_handle, SSL_VERIFY_PEER, NULL);"
    },
    {
        "line": 16,
        "fullcodeline": "X509 *cert = SSL_get_peer_certificate(tunnel->ssl_handle);"
    },
    {
        "line": 22,
        "fullcodeline": "subj = X509_get_subject_name(cert);"
    },
    {
        "line": 46,
        "fullcodeline": "log_debug(\"Gateway certificate validation failed.\\n\");"
    },
    {
        "line": 57,
        "fullcodeline": "digest_str[SHA256STRLEN - 1] = '\\0';"
    },
    {
        "line": 69,
        "fullcodeline": "subject = X509_NAME_oneline(subj, NULL, 0);"
    },
    {
        "line": 70,
        "fullcodeline": "issuer = X509_NAME_oneline(X509_get_issuer_name(cert), NULL, 0);"
    },
    {
        "line": 72,
        "fullcodeline": "log_error(\"Gateway certificate validation failed, and the certificate digest in not in the local whitelist. If you trust it, rerun with:\\n\");"
    },
    {
        "line": 73,
        "fullcodeline": "log_error(\"    --trusted-cert %s\\n\", digest_str);"
    },
    {
        "line": 74,
        "fullcodeline": "log_error(\"or add this line to your config file:\\n\");"
    },
    {
        "line": 75,
        "fullcodeline": "log_error(\"    trusted-cert = %s\\n\", digest_str);"
    },
    {
        "line": 76,
        "fullcodeline": "log_error(\"Gateway certificate:\\n\");"
    },
    {
        "line": 77,
        "fullcodeline": "log_error(\"    subject:\\n\");"
    },
    {
        "line": 81,
        "fullcodeline": "log_error(\"    issuer:\\n\");"
    },
    {
        "line": 85,
        "fullcodeline": "log_error(\"    sha256 digest:\\n\");"
    },
    {
        "line": 86,
        "fullcodeline": "log_error(\"        %s\\n\", digest_str);"
    },
    {
        "line": 89,
        "fullcodeline": "X509_free(cert);"
    },
    {
        "line": 17,
        "fullcodeline": "if (cert == NULL) {"
    },
    {
        "line": 31,
        "fullcodeline": "if (subj"
    },
    {
        "line": 40,
        "fullcodeline": "if (cert_valid"
    },
    {
        "line": 49,
        "fullcodeline": "if (X509_digest(cert, EVP_sha256(), digest, &len) <= 0"
    },
    {
        "line": 55,
        "fullcodeline": "for (i = 0; i < SHA256LEN; i++)"
    },
    {
        "line": 56,
        "fullcodeline": "sprintf(&digest_str[2 * i], \"%02x\", digest[i]);"
    },
    {
        "line": 59,
        "fullcodeline": "for (elem = tunnel->config->cert_whitelist; elem != NULL;"
    },
    {
        "line": 60,
        "fullcodeline": "elem = elem->next)"
    },
    {
        "line": 63,
        "fullcodeline": "if (elem != NULL) { // break before end of loop"
    },
    {
        "line": 78,
        "fullcodeline": "for (line = strtok(subject, \"/\"); line != NULL;"
    },
    {
        "line": 79,
        "fullcodeline": "line = strtok(NULL, \"/\"))"
    },
    {
        "line": 80,
        "fullcodeline": "log_error(\"        %s\\n\", line);"
    },
    {
        "line": 82,
        "fullcodeline": "for (line = strtok(issuer, \"/\"); line != NULL;"
    },
    {
        "line": 83,
        "fullcodeline": "line = strtok(NULL, \"/\"))"
    },
    {
        "line": 84,
        "fullcodeline": "log_error(\"        %s\\n\", line);"
    },
    {
        "line": 18,
        "fullcodeline": "log_error(\"Unable to get gateway certificate.\\n\");"
    },
    {
        "line": 34,
        "fullcodeline": "&& strncasecmp(common_name, tunnel->config->gateway_host,"
    },
    {
        "line": 36,
        "fullcodeline": "cert_valid = 1;"
    },
    {
        "line": 41,
        "fullcodeline": "&& SSL_get_verify_result(tunnel->ssl_handle) == X509_V_OK) {"
    },
    {
        "line": 42,
        "fullcodeline": "log_debug(\"Gateway certificate validation succeeded.\\n\");"
    },
    {
        "line": 43,
        "fullcodeline": "ret = 0;"
    },
    {
        "line": 50,
        "fullcodeline": "|| len != SHA256LEN) {"
    },
    {
        "line": 51,
        "fullcodeline": "log_error(\"Could not compute certificate sha256 digest.\\n\");"
    },
    {
        "line": 61,
        "fullcodeline": "if (memcmp(digest_str, elem->data, SHA256STRLEN - 1) == 0)"
    },
    {
        "line": 64,
        "fullcodeline": "log_debug(\"Gateway certificate digest found in white list.\\n\");"
    },
    {
        "line": 65,
        "fullcodeline": "ret = 0;"
    },
    {
        "line": 32,
        "fullcodeline": "&& X509_NAME_get_text_by_NID(subj, NID_commonName, common_name,"
    }
]