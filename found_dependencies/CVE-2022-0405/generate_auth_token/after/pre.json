[
    {
        "line": 2,
        "fullcodeline": "warning = False"
    },
    {
        "line": 3,
        "fullcodeline": "host_list = request.host.rsplit(':')"
    },
    {
        "line": 12,
        "fullcodeline": "auth_token = ub.session.query(ub.RemoteAuthToken).filter("
    },
    {
        "line": 26,
        "fullcodeline": "books = calibre_db.session.query(db.Books).join(db.Data).all()"
    },
    {
        "line": 4,
        "fullcodeline": "if len(host_list) == 1:"
    },
    {
        "line": 8,
        "fullcodeline": "if host.startswith('127.') or host.lower() == 'localhost' or host.startswith('[::ffff:7f') or host == \"[::1]\":"
    },
    {
        "line": 16,
        "fullcodeline": "if not auth_token:"
    },
    {
        "line": 28,
        "fullcodeline": "for book in books:"
    },
    {
        "line": 33,
        "fullcodeline": "return render_title_template("
    },
    {
        "line": 5,
        "fullcodeline": "host = ':'.join(host_list)"
    },
    {
        "line": 7,
        "fullcodeline": "host = ':'.join(host_list[0:-1])"
    },
    {
        "line": 9,
        "fullcodeline": "warning = _('Please access Calibre-Web from non localhost to get valid api_endpoint for kobo device')"
    },
    {
        "line": 17,
        "fullcodeline": "auth_token = ub.RemoteAuthToken()"
    },
    {
        "line": 18,
        "fullcodeline": "auth_token.user_id = user_id"
    },
    {
        "line": 19,
        "fullcodeline": "auth_token.expiration = datetime.max"
    },
    {
        "line": 20,
        "fullcodeline": "auth_token.auth_token = (hexlify(urandom(16))).decode(\"utf-8\")"
    },
    {
        "line": 21,
        "fullcodeline": "auth_token.token_type = 1"
    },
    {
        "line": 24,
        "fullcodeline": "ub.session_commit()"
    },
    {
        "line": 35,
        "fullcodeline": "title=_(u\"Kobo Setup\"),"
    },
    {
        "line": 23,
        "fullcodeline": "ub.session.add(auth_token)"
    },
    {
        "line": 29,
        "fullcodeline": "formats = [data.format for data in book.data]"
    },
    {
        "line": 30,
        "fullcodeline": "if not 'KEPUB' in formats and config.config_kepubifypath and 'EPUB' in formats:"
    },
    {
        "line": 14,
        "fullcodeline": ").filter(ub.RemoteAuthToken.token_type==1).first()"
    },
    {
        "line": 31,
        "fullcodeline": "helper.convert_book_format(book.id, config.config_calibre_dir, 'EPUB', 'KEPUB', current_user.name)"
    },
    {
        "line": 13,
        "fullcodeline": "ub.RemoteAuthToken.user_id == user_id"
    }
]