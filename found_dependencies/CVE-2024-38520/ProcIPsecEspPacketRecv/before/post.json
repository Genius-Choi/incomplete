[
    {
        "line": 11,
        "fullcodeline": "bool update_status = false;"
    },
    {
        "line": 18,
        "fullcodeline": "UCHAR calced_hash[IKE_MAX_HASH_SIZE];"
    },
    {
        "line": 19,
        "fullcodeline": "bool is_tunnel_mode = false;"
    },
    {
        "line": 26,
        "fullcodeline": "src = (UCHAR *)p->Data;"
    },
    {
        "line": 27,
        "fullcodeline": "src_size = p->Size;"
    },
    {
        "line": 47,
        "fullcodeline": "spi = READ_UINT(src + 0);"
    },
    {
        "line": 58,
        "fullcodeline": "seq = READ_UINT(src + sizeof(UINT));"
    },
    {
        "line": 61,
        "fullcodeline": "ipsec_sa = SearchClientToServerIPsecSaBySpi(ike, spi);"
    },
    {
        "line": 97,
        "fullcodeline": "is_tunnel_mode = IsIPsecSaTunnelMode(ipsec_sa);"
    },
    {
        "line": 99,
        "fullcodeline": "c = ipsec_sa->IkeClient;"
    },
    {
        "line": 106,
        "fullcodeline": "hash_size = IKE_ESP_HASH_SIZE;"
    },
    {
        "line": 113,
        "fullcodeline": "iv = src + sizeof(UINT) * 2;"
    },
    {
        "line": 116,
        "fullcodeline": "hash = src + src_size - hash_size;"
    },
    {
        "line": 119,
        "fullcodeline": "IkeHMac(ipsec_sa->TransformSetting.Hash, calced_hash, ipsec_sa->HashKey,"
    },
    {
        "line": 129,
        "fullcodeline": "encrypted_payload_data = src + sizeof(UINT) * 2 + block_size;"
    },
    {
        "line": 130,
        "fullcodeline": "size_of_payload_data = src_size - hash_size - block_size - sizeof(UINT) * 2;"
    },
    {
        "line": 138,
        "fullcodeline": "cp.Key = ipsec_sa->CryptoKey;"
    },
    {
        "line": 139,
        "fullcodeline": "Copy(&cp.Iv, iv, block_size);"
    },
    {
        "line": 141,
        "fullcodeline": "dec = IkeDecrypt(encrypted_payload_data, size_of_payload_data, &cp);"
    },
    {
        "line": 21,
        "fullcodeline": "if (ike == NULL || p == NULL)"
    },
    {
        "line": 29,
        "fullcodeline": "if (p->DestPort == IPSEC_PORT_IPSEC_ESP_RAW)"
    },
    {
        "line": 42,
        "fullcodeline": "if (src_size < sizeof(UINT))"
    },
    {
        "line": 48,
        "fullcodeline": "if (spi == 0)"
    },
    {
        "line": 54,
        "fullcodeline": "if (src_size < (sizeof(UINT) * 2))"
    },
    {
        "line": 62,
        "fullcodeline": "if (ipsec_sa == NULL)"
    },
    {
        "line": 100,
        "fullcodeline": "if (c == NULL)"
    },
    {
        "line": 109,
        "fullcodeline": "if (src_size < (sizeof(UINT) * 2 + block_size + hash_size + block_size))"
    },
    {
        "line": 120,
        "fullcodeline": "ipsec_sa->TransformSetting.Hash->HashSize, src, src_size - hash_size);"
    },
    {
        "line": 122,
        "fullcodeline": "if (Cmp(calced_hash, hash, hash_size) != 0)"
    },
    {
        "line": 131,
        "fullcodeline": "if (size_of_payload_data == 0 || (size_of_payload_data % block_size) != 0)"
    },
    {
        "line": 142,
        "fullcodeline": "if (dec != NULL)"
    },
    {
        "line": 65,
        "fullcodeline": "UINT64 init_cookie = Rand64();"
    },
    {
        "line": 66,
        "fullcodeline": "UINT64 resp_cookie = 0;"
    },
    {
        "line": 67,
        "fullcodeline": "IKE_CLIENT *c = NULL;"
    },
    {
        "line": 71,
        "fullcodeline": "Copy(&t.ClientIP, &p->SrcIP, sizeof(IP));"
    },
    {
        "line": 72,
        "fullcodeline": "t.ClientPort = p->SrcPort;"
    },
    {
        "line": 73,
        "fullcodeline": "Copy(&t.ServerIP, &p->DstIP, sizeof(IP));"
    },
    {
        "line": 74,
        "fullcodeline": "t.ServerPort = p->DestPort;"
    },
    {
        "line": 75,
        "fullcodeline": "t.CurrentIkeSa = NULL;"
    },
    {
        "line": 82,
        "fullcodeline": "c = Search(ike->ClientList, &t);"
    },
    {
        "line": 90,
        "fullcodeline": "SendInformationalExchangePacketEx(ike, (c == NULL ? &t : c), IkeNewNoticeErrorInvalidSpiPayload(spi), false,"
    },
    {
        "line": 93,
        "fullcodeline": "SendDeleteIPsecSaPacket(ike, (c == NULL ? &t : c), spi);"
    },
    {
        "line": 144,
        "fullcodeline": "UCHAR *dec_data = dec->Buf;"
    },
    {
        "line": 145,
        "fullcodeline": "UINT dec_size = dec->Size;"
    },
    {
        "line": 146,
        "fullcodeline": "UCHAR size_of_padding = dec_data[dec_size - 2];"
    },
    {
        "line": 147,
        "fullcodeline": "UCHAR next_header = dec_data[dec_size - 1];"
    },
    {
        "line": 291,
        "fullcodeline": "FreeBuf(dec);"
    },
    {
        "line": 296,
        "fullcodeline": "bool start_qm = false;"
    },
    {
        "line": 298,
        "fullcodeline": "c->CurrentIpSecSaRecv = ipsec_sa;"
    },
    {
        "line": 316,
        "fullcodeline": "c->LastCommTick = ike->Now;"
    },
    {
        "line": 317,
        "fullcodeline": "ipsec_sa->LastCommTick = ike->Now;"
    },
    {
        "line": 323,
        "fullcodeline": "SetIkeClientEndpoint(ike, c, &p->SrcIP, p->SrcPort, &p->DstIP, p->DestPort);"
    },
    {
        "line": 31,
        "fullcodeline": "if (IsIP4(&p->DstIP))"
    },
    {
        "line": 77,
        "fullcodeline": "if (p->DestPort == IPSEC_PORT_IPSEC_ESP_RAW)"
    },
    {
        "line": 84,
        "fullcodeline": "if (c != NULL && c->CurrentIkeSa != NULL)"
    },
    {
        "line": 148,
        "fullcodeline": "if ((dec_size - 2) >= size_of_padding)"
    },
    {
        "line": 299,
        "fullcodeline": "if (ipsec_sa->PairIPsecSa != NULL)"
    },
    {
        "line": 318,
        "fullcodeline": "if (ipsec_sa->PairIPsecSa != NULL)"
    },
    {
        "line": 325,
        "fullcodeline": "if (seq >= 0xf0000000)"
    },
    {
        "line": 331,
        "fullcodeline": "if (ipsec_sa->TransformSetting.LifeKilobytes != 0)"
    },
    {
        "line": 34,
        "fullcodeline": "UINT ip_header_size = GetIpHeaderSize(src, src_size);"
    },
    {
        "line": 36,
        "fullcodeline": "src += ip_header_size;"
    },
    {
        "line": 37,
        "fullcodeline": "src_size -= ip_header_size;"
    },
    {
        "line": 79,
        "fullcodeline": "t.ClientPort = t.ServerPort = IPSEC_PORT_IPSEC_ISAKMP;"
    },
    {
        "line": 150,
        "fullcodeline": "UINT orig_size = dec_size - 2 - size_of_padding;"
    },
    {
        "line": 152,
        "fullcodeline": "ipsec_sa->TotalSize += dec_size;"
    },
    {
        "line": 288,
        "fullcodeline": "update_status = true;"
    },
    {
        "line": 301,
        "fullcodeline": "c->CurrentIpSecSaSend = ipsec_sa->PairIPsecSa;"
    },
    {
        "line": 320,
        "fullcodeline": "ipsec_sa->PairIPsecSa->LastCommTick = ike->Now;"
    },
    {
        "line": 328,
        "fullcodeline": "start_qm = true;"
    },
    {
        "line": 333,
        "fullcodeline": "UINT64 hard_size = (UINT64)ipsec_sa->TransformSetting.LifeKilobytes * (UINT64)1000;"
    },
    {
        "line": 334,
        "fullcodeline": "UINT64 soft_size = hard_size * (UINT64)2 / (UINT64)3;"
    },
    {
        "line": 303,
        "fullcodeline": "if (p->DestPort == IPSEC_PORT_IPSEC_ESP_UDP)"
    },
    {
        "line": 336,
        "fullcodeline": "if (ipsec_sa->TotalSize >= soft_size)"
    },
    {
        "line": 345,
        "fullcodeline": "if (ipsec_sa->StartQM_FlagSet == false)"
    },
    {
        "line": 305,
        "fullcodeline": "IPSECSA *send_sa = c->CurrentIpSecSaSend;"
    },
    {
        "line": 339,
        "fullcodeline": "start_qm = true;"
    },
    {
        "line": 347,
        "fullcodeline": "c->StartQuickModeAsSoon = true;"
    },
    {
        "line": 348,
        "fullcodeline": "ipsec_sa->StartQM_FlagSet = true;"
    },
    {
        "line": 157,
        "fullcodeline": "if (next_header == IKE_PROTOCOL_ID_IPV4 || next_header == IKE_PROTOCOL_ID_IPV6)"
    },
    {
        "line": 306,
        "fullcodeline": "if (send_sa->TransformSetting.CapsuleMode == IKE_P2_CAPSULE_TUNNEL)"
    },
    {
        "line": 160,
        "fullcodeline": "BUF *b = NewBuf();"
    },
    {
        "line": 161,
        "fullcodeline": "static UCHAR src_mac_dummy[6] = {0, 0, 0, 0, 0, 0, };"
    },
    {
        "line": 162,
        "fullcodeline": "static UCHAR dst_mac_dummy[6] = {0, 0, 0, 0, 0, 0, };"
    },
    {
        "line": 163,
        "fullcodeline": "USHORT tpid = Endian16(next_header == IKE_PROTOCOL_ID_IPV4 ? MAC_PROTO_IPV4 : MAC_PROTO_IPV6);"
    },
    {
        "line": 166,
        "fullcodeline": "WriteBuf(b, src_mac_dummy, sizeof(src_mac_dummy));"
    },
    {
        "line": 167,
        "fullcodeline": "WriteBuf(b, dst_mac_dummy, sizeof(dst_mac_dummy));"
    },
    {
        "line": 168,
        "fullcodeline": "WriteBuf(b, &tpid, sizeof(tpid));"
    },
    {
        "line": 170,
        "fullcodeline": "WriteBuf(b, dec_data, dec_size);"
    },
    {
        "line": 173,
        "fullcodeline": "pkt = ParsePacket(b->Buf, b->Size);"
    },
    {
        "line": 256,
        "fullcodeline": "FreeBuf(b);"
    },
    {
        "line": 262,
        "fullcodeline": "if (next_header == IP_PROTO_UDP)"
    },
    {
        "line": 308,
        "fullcodeline": "send_sa->TransformSetting.CapsuleMode = IKE_P2_CAPSULE_NAT_TUNNEL_1;"
    },
    {
        "line": 179,
        "fullcodeline": "if (pkt == NULL)"
    },
    {
        "line": 182,
        "fullcodeline": "dec_data = NULL;"
    },
    {
        "line": 183,
        "fullcodeline": "dec_size = 0;"
    },
    {
        "line": 310,
        "fullcodeline": "else if (send_sa->TransformSetting.CapsuleMode == IKE_P2_CAPSULE_TRANSPORT)"
    },
    {
        "line": 253,
        "fullcodeline": "FreePacket(pkt);"
    },
    {
        "line": 267,
        "fullcodeline": "ProcIPsecUdpPacketRecv(ike, c, dec_data, dec_size);"
    },
    {
        "line": 270,
        "fullcodeline": "else if (next_header == IPSEC_IP_PROTO_ETHERIP)"
    },
    {
        "line": 312,
        "fullcodeline": "send_sa->TransformSetting.CapsuleMode = IKE_P2_CAPSULE_NAT_TRANSPORT_1;"
    },
    {
        "line": 192,
        "fullcodeline": "UINTToIP(&c->TunnelModeServerIP, pkt->L3.IPv4Header->DstIP);"
    },
    {
        "line": 193,
        "fullcodeline": "UINTToIP(&c->TunnelModeClientIP, pkt->L3.IPv4Header->SrcIP);"
    },
    {
        "line": 223,
        "fullcodeline": "SetIP6(&c->TunnelModeServerIP, pkt->IPv6HeaderPacketInfo.IPv6Header->DestAddress.Value);"
    },
    {
        "line": 224,
        "fullcodeline": "SetIP6(&c->TunnelModeClientIP, pkt->IPv6HeaderPacketInfo.IPv6Header->SrcAddress.Value);"
    },
    {
        "line": 195,
        "fullcodeline": "if (IPV4_GET_OFFSET(pkt->L3.IPv4Header) == 0)"
    },
    {
        "line": 226,
        "fullcodeline": "if (pkt->IPv6HeaderPacketInfo.IsFragment == false)"
    },
    {
        "line": 275,
        "fullcodeline": "ProcIPsecEtherIPPacketRecv(ike, c, dec_data, dec_size, false);"
    },
    {
        "line": 278,
        "fullcodeline": "else if (next_header == IPSEC_IP_PROTO_L2TPV3)"
    },
    {
        "line": 197,
        "fullcodeline": "if ((IPV4_GET_FLAGS(pkt->L3.IPv4Header) & 0x01) == 0)"
    },
    {
        "line": 228,
        "fullcodeline": "if (pkt->IPv6HeaderPacketInfo.FragmentHeader == NULL || (IPV6_GET_FLAGS(pkt->IPv6HeaderPacketInfo.FragmentHeader) & IPV6_FRAGMENT_HEADER_FLAG_MORE_FRAGMENTS) == 0)"
    },
    {
        "line": 283,
        "fullcodeline": "ProcL2TPv3PacketRecv(ike, c, dec_data, dec_size, false);"
    },
    {
        "line": 199,
        "fullcodeline": "if (pkt->L3.IPv4Header->Protocol == IPSEC_IP_PROTO_ETHERIP)"
    },
    {
        "line": 230,
        "fullcodeline": "if (pkt->IPv6HeaderPacketInfo.Protocol == IPSEC_IP_PROTO_ETHERIP)"
    },
    {
        "line": 205,
        "fullcodeline": "ProcIPsecEtherIPPacketRecv(ike, c, pkt->IPv4PayloadData, pkt->IPv4PayloadSize, true);"
    },
    {
        "line": 208,
        "fullcodeline": "else if (pkt->L3.IPv4Header->Protocol == IPSEC_IP_PROTO_L2TPV3)"
    },
    {
        "line": 236,
        "fullcodeline": "ProcIPsecEtherIPPacketRecv(ike, c, pkt->IPv6HeaderPacketInfo.Payload, pkt->IPv6HeaderPacketInfo.PayloadSize, true);"
    },
    {
        "line": 239,
        "fullcodeline": "else if (pkt->IPv6HeaderPacketInfo.Protocol == IPSEC_IP_PROTO_L2TPV3)"
    },
    {
        "line": 214,
        "fullcodeline": "ProcL2TPv3PacketRecv(ike, c, pkt->IPv4PayloadData, pkt->IPv4PayloadSize, true);"
    },
    {
        "line": 245,
        "fullcodeline": "ProcL2TPv3PacketRecv(ike, c, pkt->IPv6HeaderPacketInfo.Payload, pkt->IPv6HeaderPacketInfo.PayloadSize, true);"
    }
]