[
    {
        "line": 19,
        "fullcodeline": "struct _u_endpoint * endpoint_list = ((struct _u_instance *)cls)->endpoint_list, ** current_endpoint_list = NULL, * current_endpoint = NULL;"
    },
    {
        "line": 20,
        "fullcodeline": "struct connection_info_struct * con_info = * con_cls;"
    },
    {
        "line": 21,
        "fullcodeline": "int mhd_ret = MHD_NO, callback_ret = U_OK, i, close_loop = 0, inner_error = U_OK, mhd_response_flag;"
    },
    {
        "line": 24,
        "fullcodeline": "int upgrade_protocol = 0;"
    },
    {
        "line": 25,
        "fullcodeline": "char * protocol = NULL, * extension = NULL, ** extension_list = NULL;"
    },
    {
        "line": 34,
        "fullcodeline": "gnutls_certificate_status_t client_cert_status = 0;"
    },
    {
        "line": 37,
        "fullcodeline": "char * content_type, * auth_realm = NULL;"
    },
    {
        "line": 38,
        "fullcodeline": "struct _u_response * response = NULL;"
    },
    {
        "line": 41,
        "fullcodeline": "void * response_buffer = NULL;"
    },
    {
        "line": 42,
        "fullcodeline": "size_t response_buffer_len = 0;"
    },
    {
        "line": 45,
        "fullcodeline": "struct MHD_Response * mhd_response = NULL;"
    },
    {
        "line": 47,
        "fullcodeline": "UNUSED(url);"
    },
    {
        "line": 51,
        "fullcodeline": "if (con_info == NULL) {"
    },
    {
        "line": 56,
        "fullcodeline": "if (con_info->u_instance == NULL) {"
    },
    {
        "line": 52,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error con_info is NULL\");"
    },
    {
        "line": 57,
        "fullcodeline": "con_info->u_instance = (struct _u_instance *)cls;"
    },
    {
        "line": 62,
        "fullcodeline": "ci = MHD_get_connection_info (connection, MHD_CONNECTION_INFO_GNUTLS_SESSION);"
    },
    {
        "line": 81,
        "fullcodeline": "con_info->callback_first_iteration = 0;"
    },
    {
        "line": 82,
        "fullcodeline": "so_client = MHD_get_connection_info (connection, MHD_CONNECTION_INFO_CLIENT_ADDRESS)->client_addr;"
    },
    {
        "line": 84,
        "fullcodeline": "con_info->max_post_param_size = ((struct _u_instance *)cls)->max_post_param_size;"
    },
    {
        "line": 85,
        "fullcodeline": "con_info->request->http_protocol = o_strdup(version);"
    },
    {
        "line": 86,
        "fullcodeline": "con_info->request->http_verb = o_strdup(method);"
    },
    {
        "line": 87,
        "fullcodeline": "con_info->request->client_address = o_malloc(sizeof(struct sockaddr));"
    },
    {
        "line": 92,
        "fullcodeline": "memcpy(con_info->request->client_address, so_client, sizeof(struct sockaddr));"
    },
    {
        "line": 102,
        "fullcodeline": "content_type = (char*)u_map_get_case(con_info->request->map_header, ULFIUS_HTTP_HEADER_CONTENT);"
    },
    {
        "line": 63,
        "fullcodeline": "if (ci != NULL && ci->tls_session != NULL) {"
    },
    {
        "line": 88,
        "fullcodeline": "if (con_info->request->client_address == NULL || con_info->request->http_verb == NULL) {"
    },
    {
        "line": 94,
        "fullcodeline": "MHD_get_connection_values (connection, MHD_HEADER_KIND, ulfius_fill_map_check_utf8, con_info->request->map_header);"
    },
    {
        "line": 95,
        "fullcodeline": "MHD_get_connection_values (connection, MHD_GET_ARGUMENT_KIND, ulfius_fill_map_check_utf8, &con_info->map_url_initial);"
    },
    {
        "line": 96,
        "fullcodeline": "MHD_get_connection_values (connection, MHD_COOKIE_KIND, ulfius_fill_map_check_utf8, con_info->request->map_cookie);"
    },
    {
        "line": 105,
        "fullcodeline": "if (content_type != NULL &&"
    },
    {
        "line": 106,
        "fullcodeline": "(0 == o_strncmp(MHD_HTTP_POST_ENCODING_FORM_URLENCODED, content_type, o_strlen(MHD_HTTP_POST_ENCODING_FORM_URLENCODED)) ||"
    },
    {
        "line": 108,
        "fullcodeline": "con_info->has_post_processor = 1;"
    },
    {
        "line": 109,
        "fullcodeline": "con_info->post_processor = MHD_create_post_processor (connection, ULFIUS_POSTBUFFERSIZE, mhd_iterate_post_data, (void *) con_info);"
    },
    {
        "line": 118,
        "fullcodeline": "} else if (*upload_data_size != 0) {"
    },
    {
        "line": 98,
        "fullcodeline": "MHD_get_connection_values (connection, MHD_HEADER_KIND, ulfius_fill_map, con_info->request->map_header);"
    },
    {
        "line": 99,
        "fullcodeline": "MHD_get_connection_values (connection, MHD_GET_ARGUMENT_KIND, ulfius_fill_map, &con_info->map_url_initial);"
    },
    {
        "line": 100,
        "fullcodeline": "MHD_get_connection_values (connection, MHD_COOKIE_KIND, ulfius_fill_map, con_info->request->map_cookie);"
    },
    {
        "line": 107,
        "fullcodeline": "0 == o_strncmp(MHD_HTTP_POST_ENCODING_MULTIPART_FORMDATA, content_type, o_strlen(MHD_HTTP_POST_ENCODING_MULTIPART_FORMDATA)))) {"
    },
    {
        "line": 110,
        "fullcodeline": "if (NULL == con_info->post_processor) {"
    },
    {
        "line": 119,
        "fullcodeline": "size_t body_len = con_info->request->binary_body_length + *upload_data_size, upload_data_size_current = *upload_data_size;"
    },
    {
        "line": 126,
        "fullcodeline": "if (body_len >= con_info->request->binary_body_length) {"
    },
    {
        "line": 148,
        "fullcodeline": "current_endpoint_list = ulfius_endpoint_match(method, con_info->request->url_path, endpoint_list);"
    },
    {
        "line": 170,
        "fullcodeline": "mhd_response_flag = MHD_RESPMEM_MUST_FREE;"
    },
    {
        "line": 121,
        "fullcodeline": "if (((struct _u_instance *)cls)->max_post_body_size > 0 && con_info->request->binary_body_length + *upload_data_size > ((struct _u_instance *)cls)->max_post_body_size) {"
    },
    {
        "line": 122,
        "fullcodeline": "body_len = ((struct _u_instance *)cls)->max_post_body_size;"
    },
    {
        "line": 123,
        "fullcodeline": "upload_data_size_current = ((struct _u_instance *)cls)->max_post_body_size - con_info->request->binary_body_length;"
    },
    {
        "line": 127,
        "fullcodeline": "con_info->request->binary_body = o_realloc(con_info->request->binary_body, body_len);"
    },
    {
        "line": 151,
        "fullcodeline": "if ((current_endpoint_list == NULL || current_endpoint_list[0] == NULL) && ((struct _u_instance *)cls)->default_endpoint != NULL && ((struct _u_instance *)cls)->default_endpoint->callback_function != NULL) {"
    },
    {
        "line": 172,
        "fullcodeline": "if (current_endpoint_list[0] != NULL) {"
    },
    {
        "line": 604,
        "fullcodeline": "if (mhd_response_flag == MHD_RESPMEM_MUST_COPY) {"
    },
    {
        "line": 610,
        "fullcodeline": "for (i=0; current_endpoint_list[i] != NULL; i++) {"
    },
    {
        "line": 65,
        "fullcodeline": "if (((ret_cert = gnutls_certificate_verify_peers2(ci->tls_session, &client_cert_status)) != 0 && ret_cert != GNUTLS_E_NO_CERTIFICATE_FOUND) || client_cert_status != 0) {"
    },
    {
        "line": 66,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error gnutls_certificate_verify_peers2\");"
    },
    {
        "line": 128,
        "fullcodeline": "if (con_info->request->binary_body == NULL) {"
    },
    {
        "line": 152,
        "fullcodeline": "current_endpoint_list = o_realloc(current_endpoint_list, 2*sizeof(struct _u_endpoint *));"
    },
    {
        "line": 173,
        "fullcodeline": "response = o_malloc(sizeof(struct _u_response));"
    },
    {
        "line": 611,
        "fullcodeline": "ulfius_clean_endpoint(current_endpoint_list[i]);"
    },
    {
        "line": 612,
        "fullcodeline": "o_free(current_endpoint_list[i]);"
    },
    {
        "line": 153,
        "fullcodeline": "if (current_endpoint_list != NULL) {"
    },
    {
        "line": 174,
        "fullcodeline": "if (response == NULL) {"
    },
    {
        "line": 592,
        "fullcodeline": "response_buffer = o_strdup(ULFIUS_HTTP_NOT_FOUND_BODY);"
    },
    {
        "line": 132,
        "fullcodeline": "memcpy((char*)con_info->request->binary_body + con_info->request->binary_body_length, upload_data, upload_data_size_current);"
    },
    {
        "line": 135,
        "fullcodeline": "const char * content_type = u_map_get_case(con_info->request->map_header, ULFIUS_HTTP_HEADER_CONTENT);"
    },
    {
        "line": 161,
        "fullcodeline": "current_endpoint_list[1] = NULL;"
    },
    {
        "line": 176,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 593,
        "fullcodeline": "if (response_buffer == NULL) {"
    },
    {
        "line": 68,
        "fullcodeline": "pcert = gnutls_certificate_get_peers(ci->tls_session, &listsize);"
    },
    {
        "line": 154,
        "fullcodeline": "if ((current_endpoint_list[0] = o_malloc(sizeof(struct _u_endpoint))) != NULL) {"
    },
    {
        "line": 163,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error allocating memory for current_endpoint_list of default endpoint\");"
    },
    {
        "line": 595,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 136,
        "fullcodeline": "if (0 == o_strncmp(MHD_HTTP_POST_ENCODING_FORM_URLENCODED, content_type, o_strlen(MHD_HTTP_POST_ENCODING_FORM_URLENCODED)) ||"
    },
    {
        "line": 137,
        "fullcodeline": "0 == o_strncmp(MHD_HTTP_POST_ENCODING_MULTIPART_FORMDATA, content_type, o_strlen(MHD_HTTP_POST_ENCODING_MULTIPART_FORMDATA))) {"
    },
    {
        "line": 177,
        "fullcodeline": "} else if (ulfius_init_response(response) != U_OK) {"
    },
    {
        "line": 597,
        "fullcodeline": "response_buffer_len = o_strlen(ULFIUS_HTTP_NOT_FOUND_BODY);"
    },
    {
        "line": 598,
        "fullcodeline": "mhd_response = MHD_CREATE_RESPONSE_FROM_BUFFER_PIMPED (response_buffer_len, response_buffer, mhd_response_flag );"
    },
    {
        "line": 599,
        "fullcodeline": "mhd_ret = MHD_queue_response (connection, MHD_HTTP_NOT_FOUND, mhd_response);"
    },
    {
        "line": 69,
        "fullcodeline": "if ((pcert == NULL) || (listsize == 0)) {"
    },
    {
        "line": 70,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Failed to retrieve client certificate chain\");"
    },
    {
        "line": 155,
        "fullcodeline": "if (ulfius_copy_endpoint(current_endpoint_list[0], ((struct _u_instance *)cls)->default_endpoint) != U_OK) {"
    },
    {
        "line": 159,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error allocating memory for current_endpoint_list[0] of default endpoint\");"
    },
    {
        "line": 180,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 156,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error ulfius_copy_endpoint for current_endpoint_list[0]\");"
    },
    {
        "line": 189,
        "fullcodeline": "con_info->request->auth_basic_user = MHD_basic_auth_get_username_password(connection, &con_info->request->auth_basic_password);"
    },
    {
        "line": 71,
        "fullcodeline": "} else if (gnutls_x509_crt_init(&(con_info->request->client_cert))) {"
    },
    {
        "line": 191,
        "fullcodeline": "for (i=0; current_endpoint_list[i] != NULL && !close_loop; i++) {"
    },
    {
        "line": 568,
        "fullcodeline": "if (mhd_response != NULL) {"
    },
    {
        "line": 72,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Failed to initialize client certificate\");"
    },
    {
        "line": 183,
        "fullcodeline": "if (((struct _u_instance *)cls)->default_headers != NULL && u_map_count(((struct _u_instance *)cls)->default_headers) > 0) {"
    },
    {
        "line": 185,
        "fullcodeline": "response->map_header = u_map_copy(((struct _u_instance *)cls)->default_headers);"
    },
    {
        "line": 192,
        "fullcodeline": "current_endpoint = current_endpoint_list[i];"
    },
    {
        "line": 193,
        "fullcodeline": "u_map_empty(con_info->request->map_url);"
    },
    {
        "line": 194,
        "fullcodeline": "u_map_copy_into(con_info->request->map_url, &con_info->map_url_initial);"
    },
    {
        "line": 201,
        "fullcodeline": "callback_ret = current_endpoint->callback_function(con_info->request, response, current_endpoint->user_data);"
    },
    {
        "line": 484,
        "fullcodeline": "if (!con_info->request->callback_position && ((struct _u_instance *)cls)->default_endpoint != NULL && ((struct _u_instance *)cls)->default_endpoint->callback_function != NULL && mhd_response == NULL) {"
    },
    {
        "line": 195,
        "fullcodeline": "if (ulfius_parse_url(con_info->request->url_path, current_endpoint, con_info->request->map_url, con_info->u_instance->check_utf8) != U_OK) {"
    },
    {
        "line": 202,
        "fullcodeline": "if (callback_ret != U_CALLBACK_IGNORE) {"
    },
    {
        "line": 208,
        "fullcodeline": "if (response->stream_callback != NULL) {"
    },
    {
        "line": 485,
        "fullcodeline": "callback_ret = ((struct _u_instance *)cls)->default_endpoint->callback_function(con_info->request, response, ((struct _u_instance *)cls)->default_endpoint->user_data);"
    },
    {
        "line": 73,
        "fullcodeline": "} else if (gnutls_x509_crt_import(con_info->request->client_cert, &pcert[0], GNUTLS_X509_FMT_DER)) {"
    },
    {
        "line": 196,
        "fullcodeline": "o_free(response);"
    },
    {
        "line": 197,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error parsing url: \", con_info->request->url_path);"
    },
    {
        "line": 198,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 203,
        "fullcodeline": "con_info->request->callback_position++;"
    },
    {
        "line": 205,
        "fullcodeline": "if (response->timeout > 0 && MHD_set_connection_option(connection, MHD_CONNECTION_OPTION_TIMEOUT, response->timeout) !=  MHD_YES) {"
    },
    {
        "line": 206,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error setting connection response timeout value\");"
    },
    {
        "line": 211,
        "fullcodeline": "mhd_response = MHD_create_response_from_callback(response->stream_size, response->stream_block_size, response->stream_callback, response->stream_user_data, response->stream_callback_free);"
    },
    {
        "line": 219,
        "fullcodeline": "close_loop = 1;"
    },
    {
        "line": 527,
        "fullcodeline": "response->status = MHD_HTTP_INTERNAL_SERVER_ERROR;"
    },
    {
        "line": 528,
        "fullcodeline": "response_buffer = o_strdup(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 569,
        "fullcodeline": "if (auth_realm != NULL && inner_error == U_CALLBACK_UNAUTHORIZED) {"
    },
    {
        "line": 570,
        "fullcodeline": "mhd_ret = MHD_queue_basic_auth_fail_response (connection, auth_realm, mhd_response);"
    },
    {
        "line": 584,
        "fullcodeline": "if (response->free_shared_data != NULL && response->shared_data != NULL) {"
    },
    {
        "line": 585,
        "fullcodeline": "response->free_shared_data(response->shared_data);"
    },
    {
        "line": 74,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Failed to import client certificate\");"
    },
    {
        "line": 75,
        "fullcodeline": "gnutls_x509_crt_deinit(con_info->request->client_cert);"
    },
    {
        "line": 212,
        "fullcodeline": "if (mhd_response == NULL) {"
    },
    {
        "line": 519,
        "fullcodeline": "if (response->auth_realm != NULL) {"
    },
    {
        "line": 529,
        "fullcodeline": "if (response_buffer == NULL) {"
    },
    {
        "line": 213,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error MHD_create_response_from_callback\");"
    },
    {
        "line": 214,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 490,
        "fullcodeline": "if (ulfius_get_body_from_response(response, &response_buffer, &response_buffer_len) == U_OK) {"
    },
    {
        "line": 491,
        "fullcodeline": "mhd_response = MHD_CREATE_RESPONSE_FROM_BUFFER_PIMPED (response_buffer_len, response_buffer, mhd_response_flag );"
    },
    {
        "line": 520,
        "fullcodeline": "auth_realm = response->auth_realm;"
    },
    {
        "line": 531,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 540,
        "fullcodeline": "if (ulfius_get_body_from_response(response, &response_buffer, &response_buffer_len) == U_OK) {"
    },
    {
        "line": 542,
        "fullcodeline": "mhd_response = MHD_CREATE_RESPONSE_FROM_BUFFER_PIMPED (response_buffer_len, response_buffer, mhd_response_flag );"
    },
    {
        "line": 221,
        "fullcodeline": "} else if (((struct _websocket_handle *)response->websocket_handle)->websocket_manager_callback != NULL ||"
    },
    {
        "line": 222,
        "fullcodeline": "((struct _websocket_handle *)response->websocket_handle)->websocket_incoming_message_callback != NULL) {"
    },
    {
        "line": 223,
        "fullcodeline": "struct _websocket * websocket = o_malloc(sizeof(struct _websocket));"
    },
    {
        "line": 386,
        "fullcodeline": "close_loop = 1;"
    },
    {
        "line": 508,
        "fullcodeline": "response_buffer = o_strdup(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 533,
        "fullcodeline": "response_buffer_len = o_strlen(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 534,
        "fullcodeline": "mhd_response = MHD_CREATE_RESPONSE_FROM_BUFFER_PIMPED (response_buffer_len, response_buffer, mhd_response_flag );"
    },
    {
        "line": 543,
        "fullcodeline": "if (mhd_response == NULL) {"
    },
    {
        "line": 552,
        "fullcodeline": "response->status = MHD_HTTP_INTERNAL_SERVER_ERROR;"
    },
    {
        "line": 553,
        "fullcodeline": "response_buffer = o_strdup(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 572,
        "fullcodeline": "mhd_ret = MHD_queue_response (connection, MHD_HTTP_UNAUTHORIZED, mhd_response);"
    },
    {
        "line": 215,
        "fullcodeline": "} else if (ulfius_set_response_header(mhd_response, response->map_header) == -1 || ulfius_set_response_cookie(mhd_response, response) == -1) {"
    },
    {
        "line": 492,
        "fullcodeline": "if (ulfius_set_response_header(mhd_response, response->map_header) == -1 || ulfius_set_response_cookie(mhd_response, response) == -1) {"
    },
    {
        "line": 493,
        "fullcodeline": "inner_error = U_ERROR_PARAMS;"
    },
    {
        "line": 494,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error setting headers or cookies\");"
    },
    {
        "line": 495,
        "fullcodeline": "response->status = MHD_HTTP_INTERNAL_SERVER_ERROR;"
    },
    {
        "line": 496,
        "fullcodeline": "response->binary_body = o_strdup(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 497,
        "fullcodeline": "response->binary_body_length = o_strlen(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 509,
        "fullcodeline": "if (response_buffer == NULL) {"
    },
    {
        "line": 521,
        "fullcodeline": "} else if (((struct _u_instance *)cls)->default_auth_realm != NULL) {"
    },
    {
        "line": 545,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 554,
        "fullcodeline": "if (response_buffer == NULL) {"
    },
    {
        "line": 216,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error setting headers or cookies\");"
    },
    {
        "line": 217,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 225,
        "fullcodeline": "if (websocket != NULL && ulfius_init_websocket(websocket) == U_OK) {"
    },
    {
        "line": 498,
        "fullcodeline": "if (response->binary_body == NULL) {"
    },
    {
        "line": 504,
        "fullcodeline": "inner_error = U_CALLBACK_UNAUTHORIZED;"
    },
    {
        "line": 510,
        "fullcodeline": "inner_error = U_ERROR_MEMORY;"
    },
    {
        "line": 512,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 522,
        "fullcodeline": "auth_realm = ((struct _u_instance *)cls)->default_auth_realm;"
    },
    {
        "line": 556,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 375,
        "fullcodeline": "response->status = MHD_HTTP_INTERNAL_SERVER_ERROR;"
    },
    {
        "line": 376,
        "fullcodeline": "response_buffer = o_strdup(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 388,
        "fullcodeline": "if (((struct _websocket_handle *)response->websocket_handle)->websocket_onclose_callback != NULL) {"
    },
    {
        "line": 395,
        "fullcodeline": "if ((callback_ret == U_CALLBACK_CONTINUE || callback_ret == U_CALLBACK_IGNORE) && current_endpoint_list[i+1] == NULL) {"
    },
    {
        "line": 397,
        "fullcodeline": "callback_ret = U_CALLBACK_COMPLETE;"
    },
    {
        "line": 405,
        "fullcodeline": "close_loop = 1;"
    },
    {
        "line": 430,
        "fullcodeline": "close_loop = 1;"
    },
    {
        "line": 469,
        "fullcodeline": "close_loop = 1;"
    },
    {
        "line": 470,
        "fullcodeline": "response->status = MHD_HTTP_INTERNAL_SERVER_ERROR;"
    },
    {
        "line": 471,
        "fullcodeline": "response_buffer = o_strdup(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 499,
        "fullcodeline": "inner_error = U_ERROR_MEMORY;"
    },
    {
        "line": 501,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 514,
        "fullcodeline": "response_buffer_len = o_strlen(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 515,
        "fullcodeline": "mhd_response = MHD_CREATE_RESPONSE_FROM_BUFFER_PIMPED (response_buffer_len, response_buffer, mhd_response_flag );"
    },
    {
        "line": 516,
        "fullcodeline": "inner_error = U_CALLBACK_UNAUTHORIZED;"
    },
    {
        "line": 558,
        "fullcodeline": "response_buffer_len = o_strlen(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 559,
        "fullcodeline": "mhd_response = MHD_CREATE_RESPONSE_FROM_BUFFER_PIMPED (response_buffer_len, response_buffer, mhd_response_flag );"
    },
    {
        "line": 575,
        "fullcodeline": "mhd_ret = MHD_queue_response (connection,"
    },
    {
        "line": 229,
        "fullcodeline": "if (NULL != o_strcasestr(u_map_get_case(con_info->request->map_header, \"upgrade\"), U_WEBSOCKET_UPGRADE_VALUE) &&"
    },
    {
        "line": 234,
        "fullcodeline": "0 == o_strcmp(con_info->request->http_verb, \"GET\")) {"
    },
    {
        "line": 235,
        "fullcodeline": "int ret_protocol = U_ERROR, ret_extensions = U_OK;"
    },
    {
        "line": 358,
        "fullcodeline": "o_free(protocol);"
    },
    {
        "line": 359,
        "fullcodeline": "o_free(extension);"
    },
    {
        "line": 377,
        "fullcodeline": "if (response_buffer == NULL) {"
    },
    {
        "line": 389,
        "fullcodeline": "((struct _websocket_handle *)response->websocket_handle)->websocket_onclose_callback(con_info->request, websocket->websocket_manager!=NULL?websocket->websocket_manager:NULL, ((struct _websocket_handle *)response->websocket_handle)->websocket_onclose_user_data);"
    },
    {
        "line": 406,
        "fullcodeline": "if (ulfius_get_body_from_response(response, &response_buffer, &response_buffer_len) == U_OK) {"
    },
    {
        "line": 432,
        "fullcodeline": "if (ulfius_get_body_from_response(response, &response_buffer, &response_buffer_len) == U_OK) {"
    },
    {
        "line": 461,
        "fullcodeline": "if (response->auth_realm != NULL) {"
    },
    {
        "line": 472,
        "fullcodeline": "if (response_buffer == NULL) {"
    },
    {
        "line": 546,
        "fullcodeline": "} else if (ulfius_set_response_header(mhd_response, response->map_header) == -1 || ulfius_set_response_cookie(mhd_response, response) == -1) {"
    },
    {
        "line": 548,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 580,
        "fullcodeline": "mhd_ret = MHD_queue_response (connection, response->status, mhd_response);"
    },
    {
        "line": 233,
        "fullcodeline": "0 == o_strcmp(u_map_get_case(con_info->request->map_header, \"Sec-WebSocket-Version\"), \"13\") &&"
    },
    {
        "line": 361,
        "fullcodeline": "response_buffer = msprintf(\"%s%s%s%s%s%s\","
    },
    {
        "line": 368,
        "fullcodeline": "response->status = MHD_HTTP_BAD_REQUEST;"
    },
    {
        "line": 369,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_DEBUG, \"Ulfius - Error websocket connection: %s\", response_buffer);"
    },
    {
        "line": 370,
        "fullcodeline": "mhd_response = MHD_CREATE_RESPONSE_FROM_BUFFER_PIMPED (o_strlen(response_buffer), response_buffer, mhd_response_flag );"
    },
    {
        "line": 378,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error allocating memory for response_buffer\");"
    },
    {
        "line": 379,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 408,
        "fullcodeline": "mhd_response = MHD_CREATE_RESPONSE_FROM_BUFFER_PIMPED (response_buffer_len, response_buffer, mhd_response_flag );"
    },
    {
        "line": 433,
        "fullcodeline": "mhd_response = MHD_CREATE_RESPONSE_FROM_BUFFER_PIMPED (response_buffer_len, response_buffer, mhd_response_flag );"
    },
    {
        "line": 462,
        "fullcodeline": "auth_realm = response->auth_realm;"
    },
    {
        "line": 473,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error allocating memory for response_buffer\");"
    },
    {
        "line": 474,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 232,
        "fullcodeline": "0 == o_strcmp(con_info->request->http_protocol, \"HTTP/1.1\") &&"
    },
    {
        "line": 237,
        "fullcodeline": "if (u_map_has_key(con_info->request->map_header, \"Sec-WebSocket-Extensions\") && (extension_len = pointer_list_size(((struct _websocket_handle *)response->websocket_handle)->websocket_extension_list))) {"
    },
    {
        "line": 277,
        "fullcodeline": "free_string_array(extension_list);"
    },
    {
        "line": 281,
        "fullcodeline": "if (ret_extensions == U_OK &&"
    },
    {
        "line": 282,
        "fullcodeline": "(ret_protocol = ulfius_check_first_match(u_map_get_case(con_info->request->map_header, \"Sec-WebSocket-Protocol\"), ((struct _websocket_handle *)response->websocket_handle)->websocket_protocol, \",\", &protocol)) == U_OK) {"
    },
    {
        "line": 283,
        "fullcodeline": "char websocket_accept[32] = {0};"
    },
    {
        "line": 381,
        "fullcodeline": "response_buffer_len = o_strlen(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 382,
        "fullcodeline": "mhd_response = MHD_CREATE_RESPONSE_FROM_BUFFER_PIMPED (response_buffer_len, response_buffer, mhd_response_flag );"
    },
    {
        "line": 409,
        "fullcodeline": "if (mhd_response == NULL) {"
    },
    {
        "line": 418,
        "fullcodeline": "response->status = MHD_HTTP_INTERNAL_SERVER_ERROR;"
    },
    {
        "line": 419,
        "fullcodeline": "response_buffer = o_strdup(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 434,
        "fullcodeline": "if (ulfius_set_response_header(mhd_response, response->map_header) == -1 || ulfius_set_response_cookie(mhd_response, response) == -1) {"
    },
    {
        "line": 450,
        "fullcodeline": "response_buffer = o_strdup(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 476,
        "fullcodeline": "response_buffer_len = o_strlen(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 477,
        "fullcodeline": "mhd_response = MHD_CREATE_RESPONSE_FROM_BUFFER_PIMPED (response_buffer_len, response_buffer, mhd_response_flag );"
    },
    {
        "line": 231,
        "fullcodeline": "NULL != o_strcasestr(u_map_get_case(con_info->request->map_header, \"Connection\"), \"Upgrade\") &&"
    },
    {
        "line": 238,
        "fullcodeline": "if (split_string(u_map_get_case(con_info->request->map_header, \"Sec-WebSocket-Extensions\"), \",\", &extension_list)) {"
    },
    {
        "line": 279,
        "fullcodeline": "ret_extensions = ulfius_check_list_match(u_map_get_case(con_info->request->map_header, \"Sec-WebSocket-Extensions\"), ((struct _websocket_handle *)response->websocket_handle)->websocket_extensions, \",\", &extension);"
    },
    {
        "line": 284,
        "fullcodeline": "if (ulfius_generate_handshake_answer(u_map_get_case(con_info->request->map_header, \"Sec-WebSocket-Key\"), websocket_accept)) {"
    },
    {
        "line": 352,
        "fullcodeline": "response->status = MHD_HTTP_BAD_REQUEST;"
    },
    {
        "line": 353,
        "fullcodeline": "response_buffer = msprintf(\"%s%s\", (ret_protocol!=U_OK?\"Error validating protocol\\n\":\"\"), (ret_extensions!=U_OK?\"Error validating extensions\":\"\"));"
    },
    {
        "line": 354,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_DEBUG, \"Ulfius - Error websocket connection: %s\", response_buffer);"
    },
    {
        "line": 355,
        "fullcodeline": "mhd_response = MHD_CREATE_RESPONSE_FROM_BUFFER_PIMPED (o_strlen(response_buffer), response_buffer, mhd_response_flag );"
    },
    {
        "line": 410,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error MHD_create_response_from_buffer\");"
    },
    {
        "line": 411,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 420,
        "fullcodeline": "if (response_buffer == NULL) {"
    },
    {
        "line": 435,
        "fullcodeline": "inner_error = U_ERROR_PARAMS;"
    },
    {
        "line": 436,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error setting headers or cookies\");"
    },
    {
        "line": 437,
        "fullcodeline": "response->status = MHD_HTTP_INTERNAL_SERVER_ERROR;"
    },
    {
        "line": 438,
        "fullcodeline": "response->binary_body = o_strdup(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 439,
        "fullcodeline": "response->binary_body_length = o_strlen(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 451,
        "fullcodeline": "if (response_buffer == NULL) {"
    },
    {
        "line": 463,
        "fullcodeline": "} else if (((struct _u_instance *)cls)->default_auth_realm != NULL) {"
    },
    {
        "line": 230,
        "fullcodeline": "NULL != u_map_get_case(con_info->request->map_header, \"Sec-WebSocket-Key\") &&"
    },
    {
        "line": 285,
        "fullcodeline": "websocket->request = ulfius_duplicate_request(con_info->request);"
    },
    {
        "line": 362,
        "fullcodeline": "o_strcasestr(u_map_get_case(con_info->request->map_header, \"upgrade\"), U_WEBSOCKET_UPGRADE_VALUE)==NULL?\"No Upgrade websocket header\\n\":\"\","
    },
    {
        "line": 363,
        "fullcodeline": "o_strcasestr(u_map_get_case(con_info->request->map_header, \"Connection\"), \"Upgrade\")==NULL?\"No Connection Upgrade header\\n\":\"\","
    },
    {
        "line": 364,
        "fullcodeline": "u_map_get_case(con_info->request->map_header, \"Sec-WebSocket-Key\")==NULL?\"No Sec-WebSocket-Key header\\n\":\"\","
    },
    {
        "line": 421,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error allocating memory for response_buffer\");"
    },
    {
        "line": 422,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 440,
        "fullcodeline": "if (response->binary_body == NULL) {"
    },
    {
        "line": 446,
        "fullcodeline": "inner_error = U_CALLBACK_UNAUTHORIZED;"
    },
    {
        "line": 452,
        "fullcodeline": "inner_error = U_ERROR_MEMORY;"
    },
    {
        "line": 453,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error allocating memory for response_buffer\");"
    },
    {
        "line": 454,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 464,
        "fullcodeline": "auth_realm = ((struct _u_instance *)cls)->default_auth_realm;"
    },
    {
        "line": 239,
        "fullcodeline": "for (x=0; extension_list[x]!=NULL; x++) {"
    },
    {
        "line": 275,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error split_string Sec-WebSocket-Extensions\");"
    },
    {
        "line": 286,
        "fullcodeline": "if (websocket->request != NULL) {"
    },
    {
        "line": 340,
        "fullcodeline": "response->status = MHD_HTTP_INTERNAL_SERVER_ERROR;"
    },
    {
        "line": 341,
        "fullcodeline": "response_buffer = o_strdup(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 365,
        "fullcodeline": "o_strcmp(con_info->request->http_protocol, \"HTTP/1.1\")!=0?\"Wrong HTTP Protocol\\n\":\"\","
    },
    {
        "line": 366,
        "fullcodeline": "o_strcmp(u_map_get_case(con_info->request->map_header, \"Sec-WebSocket-Version\"), \"13\")!=0?\"Wrong websocket version\\n\":\"\","
    },
    {
        "line": 367,
        "fullcodeline": "o_strcmp(con_info->request->http_verb, \"GET\")!=0?\"Method is not GET\\n\":\"\");"
    },
    {
        "line": 412,
        "fullcodeline": "} else if (ulfius_set_response_header(mhd_response, response->map_header) == -1 || ulfius_set_response_cookie(mhd_response, response) == -1) {"
    },
    {
        "line": 424,
        "fullcodeline": "response_buffer_len = o_strlen(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 425,
        "fullcodeline": "mhd_response = MHD_CREATE_RESPONSE_FROM_BUFFER_PIMPED (response_buffer_len, response_buffer, mhd_response_flag );"
    },
    {
        "line": 441,
        "fullcodeline": "inner_error = U_ERROR_MEMORY;"
    },
    {
        "line": 442,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error allocating memory for response->binary_body\");"
    },
    {
        "line": 443,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 456,
        "fullcodeline": "response_buffer_len = o_strlen(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 457,
        "fullcodeline": "mhd_response = MHD_CREATE_RESPONSE_FROM_BUFFER_PIMPED (response_buffer_len, response_buffer, mhd_response_flag );"
    },
    {
        "line": 458,
        "fullcodeline": "inner_error = U_CALLBACK_UNAUTHORIZED;"
    },
    {
        "line": 287,
        "fullcodeline": "websocket->instance = (struct _u_instance *)cls;"
    },
    {
        "line": 288,
        "fullcodeline": "websocket->websocket_manager_callback = ((struct _websocket_handle *)response->websocket_handle)->websocket_manager_callback;"
    },
    {
        "line": 289,
        "fullcodeline": "websocket->websocket_manager_user_data = ((struct _websocket_handle *)response->websocket_handle)->websocket_manager_user_data;"
    },
    {
        "line": 290,
        "fullcodeline": "websocket->websocket_incoming_message_callback = ((struct _websocket_handle *)response->websocket_handle)->websocket_incoming_message_callback;"
    },
    {
        "line": 291,
        "fullcodeline": "websocket->websocket_incoming_user_data = ((struct _websocket_handle *)response->websocket_handle)->websocket_incoming_user_data;"
    },
    {
        "line": 292,
        "fullcodeline": "websocket->websocket_onclose_callback = ((struct _websocket_handle *)response->websocket_handle)->websocket_onclose_callback;"
    },
    {
        "line": 293,
        "fullcodeline": "websocket->websocket_onclose_user_data = ((struct _websocket_handle *)response->websocket_handle)->websocket_onclose_user_data;"
    },
    {
        "line": 294,
        "fullcodeline": "websocket->websocket_manager->rsv_expected = ((struct _websocket_handle *)response->websocket_handle)->rsv_expected;"
    },
    {
        "line": 295,
        "fullcodeline": "websocket->websocket_manager->websocket_extension_list = ((struct _websocket_handle *)response->websocket_handle)->websocket_extension_list;"
    },
    {
        "line": 296,
        "fullcodeline": "((struct _websocket_handle *)response->websocket_handle)->websocket_extension_list = NULL;"
    },
    {
        "line": 297,
        "fullcodeline": "mhd_response = MHD_create_response_for_upgrade(ulfius_start_websocket_cb, websocket);"
    },
    {
        "line": 342,
        "fullcodeline": "if (response_buffer == NULL) {"
    },
    {
        "line": 413,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error setting headers or cookies\");"
    },
    {
        "line": 414,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 240,
        "fullcodeline": "for (y=0; y<extension_len; y++) {"
    },
    {
        "line": 298,
        "fullcodeline": "if (mhd_response == NULL) {"
    },
    {
        "line": 327,
        "fullcodeline": "response->status = MHD_HTTP_INTERNAL_SERVER_ERROR;"
    },
    {
        "line": 328,
        "fullcodeline": "response_buffer = o_strdup(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 343,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error allocating memory for response_buffer\");"
    },
    {
        "line": 344,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 241,
        "fullcodeline": "struct _websocket_extension * ws_ext = (struct _websocket_extension *)pointer_list_get_at(((struct _websocket_handle *)response->websocket_handle)->websocket_extension_list, y);"
    },
    {
        "line": 299,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error MHD_create_response_for_upgrade\");"
    },
    {
        "line": 300,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 329,
        "fullcodeline": "if (response_buffer == NULL) {"
    },
    {
        "line": 346,
        "fullcodeline": "response_buffer_len = o_strlen(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 347,
        "fullcodeline": "mhd_response = MHD_CREATE_RESPONSE_FROM_BUFFER_PIMPED (response_buffer_len, response_buffer, mhd_response_flag );"
    },
    {
        "line": 302,
        "fullcodeline": "MHD_add_response_header (mhd_response,"
    },
    {
        "line": 305,
        "fullcodeline": "MHD_add_response_header (mhd_response,"
    },
    {
        "line": 308,
        "fullcodeline": "MHD_add_response_header (mhd_response,"
    },
    {
        "line": 330,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error allocating memory for websocket->request\");"
    },
    {
        "line": 331,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 242,
        "fullcodeline": "if (ws_ext != NULL && !ws_ext->enabled) {"
    },
    {
        "line": 311,
        "fullcodeline": "if (o_strlen(extension)) {"
    },
    {
        "line": 316,
        "fullcodeline": "if (ulfius_set_response_header(mhd_response, response->map_header) == -1 || ulfius_set_response_cookie(mhd_response, response) == -1) {"
    },
    {
        "line": 333,
        "fullcodeline": "response_buffer_len = o_strlen(ULFIUS_HTTP_ERROR_BODY);"
    },
    {
        "line": 334,
        "fullcodeline": "mhd_response = MHD_CREATE_RESPONSE_FROM_BUFFER_PIMPED (response_buffer_len, response_buffer, mhd_response_flag );"
    },
    {
        "line": 243,
        "fullcodeline": "if (ws_ext->websocket_extension_server_match != NULL) {"
    },
    {
        "line": 312,
        "fullcodeline": "MHD_add_response_header (mhd_response,"
    },
    {
        "line": 317,
        "fullcodeline": "y_log_message(Y_LOG_LEVEL_ERROR, \"Ulfius - Error setting headers or cookies\");"
    },
    {
        "line": 318,
        "fullcodeline": "mhd_ret = MHD_NO;"
    },
    {
        "line": 321,
        "fullcodeline": "ulfius_instance_add_websocket_active((struct _u_instance *)cls, websocket);"
    },
    {
        "line": 244,
        "fullcodeline": "if (ws_ext->websocket_extension_server_match(trimwhitespace(extension_list[x]), (const char **)extension_list, &ws_ext->extension_client, ws_ext->websocket_extension_server_match_user_data, &ws_ext->context) == U_OK) {"
    },
    {
        "line": 257,
        "fullcodeline": "if (0 == o_strcmp(extension_list[x], ws_ext->extension_server)) {"
    },
    {
        "line": 245,
        "fullcodeline": "if (!(ws_ext->rsv & ((struct _websocket_handle *)response->websocket_handle)->rsv_expected)) {"
    },
    {
        "line": 246,
        "fullcodeline": "((struct _websocket_handle *)response->websocket_handle)->rsv_expected |= ws_ext->rsv;"
    },
    {
        "line": 247,
        "fullcodeline": "ws_ext->enabled = 1;"
    },
    {
        "line": 248,
        "fullcodeline": "if (extension != NULL) {"
    },
    {
        "line": 258,
        "fullcodeline": "if (!(ws_ext->rsv & ((struct _websocket_handle *)response->websocket_handle)->rsv_expected)) {"
    },
    {
        "line": 259,
        "fullcodeline": "ws_ext->extension_client = o_strdup(extension_list[x]);"
    },
    {
        "line": 260,
        "fullcodeline": "((struct _websocket_handle *)response->websocket_handle)->rsv_expected |= ws_ext->rsv;"
    },
    {
        "line": 261,
        "fullcodeline": "ws_ext->enabled = 1;"
    },
    {
        "line": 249,
        "fullcodeline": "extension = mstrcatf(extension, \", %s\", ws_ext->extension_client);"
    },
    {
        "line": 262,
        "fullcodeline": "if (extension != NULL) {"
    },
    {
        "line": 251,
        "fullcodeline": "extension = o_strdup(ws_ext->extension_client);"
    },
    {
        "line": 263,
        "fullcodeline": "extension = mstrcatf(extension, \", %s\", ws_ext->extension_client);"
    },
    {
        "line": 265,
        "fullcodeline": "extension = o_strdup(ws_ext->extension_client);"
    }
]