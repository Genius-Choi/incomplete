[
    {
        "line": 5,
        "fullcodeline": "token = str(uuid.uuid4())"
    },
    {
        "line": 6,
        "fullcodeline": "port = get_unused_port()"
    },
    {
        "line": 8,
        "fullcodeline": "root_dir = tmp_path_factory.mktemp(\"root_dir\")"
    },
    {
        "line": 9,
        "fullcodeline": "home = tmp_path_factory.mktemp(\"home\")"
    },
    {
        "line": 10,
        "fullcodeline": "server_conf = home / \"etc/jupyter/jupyter_config.json\""
    },
    {
        "line": 13,
        "fullcodeline": "extensions = {\"jupyter_lsp\": True, \"jupyterlab\": False, \"nbclassic\": False}"
    },
    {
        "line": 14,
        "fullcodeline": "app = {\"jpserver_extensions\": extensions, \"token\": token}"
    },
    {
        "line": 15,
        "fullcodeline": "config_data = {\"ServerApp\": app, \"IdentityProvider\": {\"token\": token}}"
    },
    {
        "line": 17,
        "fullcodeline": "server_conf.write_text(json.dumps(config_data), encoding=\"utf-8\")"
    },
    {
        "line": 18,
        "fullcodeline": "args = [\"jupyter-server\", f\"--port={port}\", \"--no-browser\"]"
    },
    {
        "line": 19,
        "fullcodeline": "env = dict(os.environ)"
    },
    {
        "line": 20,
        "fullcodeline": "env.update("
    },
    {
        "line": 25,
        "fullcodeline": "proc = subprocess.Popen(args, cwd=str(root_dir), env=env, stdin=subprocess.PIPE)"
    },
    {
        "line": 26,
        "fullcodeline": "url = f\"http://{LOCALHOST}:{port}\""
    },
    {
        "line": 27,
        "fullcodeline": "retries = 20"
    },
    {
        "line": 38,
        "fullcodeline": "proc.terminate()"
    },
    {
        "line": 39,
        "fullcodeline": "proc.communicate(b\"y\\n\")"
    },
    {
        "line": 40,
        "fullcodeline": "proc.wait()"
    },
    {
        "line": 41,
        "fullcodeline": "assert proc.returncode is not None, \"jupyter-server probably still running\""
    },
    {
        "line": 12,
        "fullcodeline": "server_conf.parent.mkdir(parents=True)"
    },
    {
        "line": 21,
        "fullcodeline": "HOME=str(home),"
    },
    {
        "line": 22,
        "fullcodeline": "USERPROFILE=str(home),"
    },
    {
        "line": 23,
        "fullcodeline": "JUPYTER_CONFIG_DIR=str(server_conf.parent),"
    },
    {
        "line": 29,
        "fullcodeline": "time.sleep(1)"
    },
    {
        "line": 31,
        "fullcodeline": "urlopen(f\"{url}/favicon.ico\")"
    }
]