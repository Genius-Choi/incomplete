[
    {
        "line": 10,
        "fullcodeline": "cookies = await app.login_user('nandy')"
    },
    {
        "line": 13,
        "fullcodeline": "group = orm.Group.find(app.db, name=\"visitors\")"
    },
    {
        "line": 25,
        "fullcodeline": "spawner = user.spawners[server_name]"
    },
    {
        "line": 26,
        "fullcodeline": "url = url_path_join(public_url(app, user), server_name)"
    },
    {
        "line": 28,
        "fullcodeline": "s = AsyncSession()"
    },
    {
        "line": 31,
        "fullcodeline": "r = await s.get(url)"
    },
    {
        "line": 32,
        "fullcodeline": "r.raise_for_status()"
    },
    {
        "line": 33,
        "fullcodeline": "assert '/hub/login' in r.url"
    },
    {
        "line": 36,
        "fullcodeline": "api_url = url_path_join(url, \"api/status\")"
    },
    {
        "line": 37,
        "fullcodeline": "r = await s.get(api_url, allow_redirects=False)"
    },
    {
        "line": 38,
        "fullcodeline": "assert r.status_code == 403"
    },
    {
        "line": 41,
        "fullcodeline": "r = await s.get(url, cookies=cookies)"
    },
    {
        "line": 42,
        "fullcodeline": "r.raise_for_status()"
    },
    {
        "line": 43,
        "fullcodeline": "assert ("
    },
    {
        "line": 52,
        "fullcodeline": "assert r.status_code == 200"
    },
    {
        "line": 55,
        "fullcodeline": "r = await s.get(url_path_join(url, 'logout'))"
    },
    {
        "line": 56,
        "fullcodeline": "assert len(r.cookies) == 0"
    },
    {
        "line": 59,
        "fullcodeline": "access_scopes = [s.replace(\"$user\", user.name) for s in access_scopes]"
    },
    {
        "line": 60,
        "fullcodeline": "access_scopes = ["
    },
    {
        "line": 63,
        "fullcodeline": "access_scopes = [s.replace(\"$group\", f\"{group.name}\") for s in access_scopes]"
    },
    {
        "line": 64,
        "fullcodeline": "other_user = create_user_with_scopes(*access_scopes, name=\"burgess\")"
    },
    {
        "line": 66,
        "fullcodeline": "cookies = await app.login_user('burgess')"
    },
    {
        "line": 67,
        "fullcodeline": "s = AsyncSession()"
    },
    {
        "line": 68,
        "fullcodeline": "s.cookies = cookies"
    },
    {
        "line": 69,
        "fullcodeline": "r = await s.get(url)"
    },
    {
        "line": 70,
        "fullcodeline": "assert urlparse(r.url).path.endswith('/oauth2/authorize')"
    },
    {
        "line": 75,
        "fullcodeline": "r.raise_for_status()"
    },
    {
        "line": 77,
        "fullcodeline": "r = await s.post(r.url, data={'scopes': ['identify'], '_xsrf': s.cookies['_xsrf']})"
    },
    {
        "line": 78,
        "fullcodeline": "final_url = urlparse(r.url).path.rstrip('/')"
    },
    {
        "line": 79,
        "fullcodeline": "final_path = url_path_join("
    },
    {
        "line": 82,
        "fullcodeline": "assert final_url.endswith(final_path)"
    },
    {
        "line": 83,
        "fullcodeline": "r.raise_for_status()"
    },
    {
        "line": 86,
        "fullcodeline": "other_user.roles = []"
    },
    {
        "line": 92,
        "fullcodeline": "r = await s.get(r.url, allow_redirects=False)"
    },
    {
        "line": 93,
        "fullcodeline": "assert r.status_code == 403"
    },
    {
        "line": 94,
        "fullcodeline": "assert 'burgess' in r.text"
    },
    {
        "line": 95,
        "fullcodeline": "await user.stop(server_name)"
    },
    {
        "line": 14,
        "fullcodeline": "if group is None:"
    },
    {
        "line": 18,
        "fullcodeline": "if group not in user.groups:"
    },
    {
        "line": 22,
        "fullcodeline": "if server_name not in user.spawners or not user.spawners[server_name].active:"
    },
    {
        "line": 71,
        "fullcodeline": "if not expect_success:"
    },
    {
        "line": 87,
        "fullcodeline": "app.db.commit()"
    },
    {
        "line": 90,
        "fullcodeline": "s.cookies.pop('jupyterhub-session-id')"
    },
    {
        "line": 15,
        "fullcodeline": "group = orm.Group(name=\"visitors\")"
    },
    {
        "line": 23,
        "fullcodeline": "await user.spawn(server_name)"
    },
    {
        "line": 44,
        "fullcodeline": "urlparse(r.url)"
    },
    {
        "line": 73,
        "fullcodeline": "assert r.status_code == 403"
    },
    {
        "line": 80,
        "fullcodeline": "'/user/', user.name, spawner.name, spawner.default_url or \"/tree\""
    },
    {
        "line": 16,
        "fullcodeline": "app.db.add(group)"
    },
    {
        "line": 17,
        "fullcodeline": "app.db.commit()"
    },
    {
        "line": 19,
        "fullcodeline": "user.groups.append(group)"
    },
    {
        "line": 20,
        "fullcodeline": "app.db.commit()"
    },
    {
        "line": 24,
        "fullcodeline": "await app.proxy.add_user(user, server_name)"
    },
    {
        "line": 47,
        "fullcodeline": "url_path_join("
    },
    {
        "line": 48,
        "fullcodeline": "f'/user/{user.name}', spawner.name, spawner.default_url or \"/tree\""
    },
    {
        "line": 61,
        "fullcodeline": "s.replace(\"$server\", f\"{user.name}/{server_name}\") for s in access_scopes"
    }
]