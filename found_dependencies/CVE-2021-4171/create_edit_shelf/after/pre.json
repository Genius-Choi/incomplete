[
    {
        "line": 2,
        "fullcodeline": "sync_only_selected_shelves = current_user.kobo_only_shelves_sync"
    },
    {
        "line": 4,
        "fullcodeline": "if request.method == \"POST\":"
    },
    {
        "line": 38,
        "fullcodeline": "return render_title_template('shelf_edit.html',"
    },
    {
        "line": 5,
        "fullcodeline": "to_save = request.form.to_dict()"
    },
    {
        "line": 9,
        "fullcodeline": "is_public = 1 if to_save.get(\"is_public\") else 0"
    },
    {
        "line": 12,
        "fullcodeline": "shelf_title = to_save.get(\"title\", \"\")"
    },
    {
        "line": 6,
        "fullcodeline": "if not current_user.role_edit_shelfs() and to_save.get(\"is_public\") == \"on\":"
    },
    {
        "line": 13,
        "fullcodeline": "if check_shelf_is_unique(shelf, shelf_title, is_public, shelf_id):"
    },
    {
        "line": 7,
        "fullcodeline": "flash(_(u\"Sorry you are not allowed to create a public shelf\"), category=\"error\")"
    },
    {
        "line": 11,
        "fullcodeline": "shelf.kobo_sync = True if to_save.get(\"kobo_sync\") else False"
    },
    {
        "line": 14,
        "fullcodeline": "shelf.name = shelf_title"
    },
    {
        "line": 15,
        "fullcodeline": "shelf.is_public = is_public"
    },
    {
        "line": 8,
        "fullcodeline": "return redirect(url_for('web.index'))"
    },
    {
        "line": 17,
        "fullcodeline": "shelf.user_id = int(current_user.id)"
    },
    {
        "line": 19,
        "fullcodeline": "shelf_action = \"created\""
    },
    {
        "line": 20,
        "fullcodeline": "flash_text = _(u\"Shelf %(title)s created\", title=shelf_title)"
    },
    {
        "line": 22,
        "fullcodeline": "shelf_action = \"changed\""
    },
    {
        "line": 23,
        "fullcodeline": "flash_text = _(u\"Shelf %(title)s changed\", title=shelf_title)"
    },
    {
        "line": 26,
        "fullcodeline": "log.info(u\"Shelf {} {}\".format(shelf_title, shelf_action))"
    },
    {
        "line": 18,
        "fullcodeline": "ub.session.add(shelf)"
    },
    {
        "line": 25,
        "fullcodeline": "ub.session.commit()"
    },
    {
        "line": 28,
        "fullcodeline": "return redirect(url_for('shelf.show_shelf', shelf_id=shelf.id))"
    },
    {
        "line": 31,
        "fullcodeline": "log.debug_or_exception(ex)"
    },
    {
        "line": 30,
        "fullcodeline": "ub.session.rollback()"
    },
    {
        "line": 33,
        "fullcodeline": "flash(_(\"Settings DB is not Writeable\"), category=\"error\")"
    },
    {
        "line": 35,
        "fullcodeline": "ub.session.rollback()"
    },
    {
        "line": 37,
        "fullcodeline": "flash(_(u\"There was an error\"), category=\"error\")"
    }
]