[
    {
        "line": 8,
        "fullcodeline": "ensure_environment_directory(environment_file_directory)"
    },
    {
        "line": 9,
        "fullcodeline": "env_file = os.path.join(environment_file_directory, f\"{unit_name}.env\")"
    },
    {
        "line": 10,
        "fullcodeline": "env_lines = []"
    },
    {
        "line": 14,
        "fullcodeline": "env_lines.append(\"\")  # trailing newline"
    },
    {
        "line": 11,
        "fullcodeline": "for key, value in sorted(environment_variables.items()):"
    },
    {
        "line": 15,
        "fullcodeline": "with open(env_file, mode=\"w\") as f:"
    },
    {
        "line": 12,
        "fullcodeline": "assert env_pat.match(key), f\"{key} not a valid environment variable\""
    },
    {
        "line": 13,
        "fullcodeline": "env_lines.append(f\"{key}={shlex.quote(value)}\")"
    },
    {
        "line": 17,
        "fullcodeline": "os.fchmod(f.fileno(), 0o400)"
    },
    {
        "line": 18,
        "fullcodeline": "f.write(\"\\n\".join(env_lines))"
    }
]