[
    {
        "line": 4,
        "fullcodeline": "struct user_namespace *user_ns = mnt_user_ns(path->mnt);"
    },
    {
        "line": 5,
        "fullcodeline": "struct smb_ntsd *pntsd = NULL;"
    },
    {
        "line": 8,
        "fullcodeline": "int rc = 0, pntsd_size, acl_size, aces_size, pdacl_size, dacl_offset;"
    },
    {
        "line": 10,
        "fullcodeline": "int granted = le32_to_cpu(*pdaccess & ~FILE_MAXIMAL_ACCESS_LE);"
    },
    {
        "line": 12,
        "fullcodeline": "int i, found = 0;"
    },
    {
        "line": 13,
        "fullcodeline": "unsigned int access_bits = 0;"
    },
    {
        "line": 14,
        "fullcodeline": "struct smb_ace *others_ace = NULL;"
    },
    {
        "line": 16,
        "fullcodeline": "unsigned int sid_type = SIDOWNER;"
    },
    {
        "line": 19,
        "fullcodeline": "ksmbd_debug(SMB, \"check permission using windows acl\\n\");"
    },
    {
        "line": 20,
        "fullcodeline": "pntsd_size = ksmbd_vfs_get_sd_xattr(conn, user_ns,"
    },
    {
        "line": 25,
        "fullcodeline": "dacl_offset = le32_to_cpu(pntsd->dacloffset);"
    },
    {
        "line": 30,
        "fullcodeline": "pdacl = (struct smb_acl *)((char *)pntsd + le32_to_cpu(pntsd->dacloffset));"
    },
    {
        "line": 31,
        "fullcodeline": "acl_size = pntsd_size - dacl_offset;"
    },
    {
        "line": 32,
        "fullcodeline": "pdacl_size = le16_to_cpu(pdacl->size);"
    },
    {
        "line": 69,
        "fullcodeline": "id_to_sid(uid, sid_type, &sid);"
    },
    {
        "line": 71,
        "fullcodeline": "ace = (struct smb_ace *)((char *)pdacl + sizeof(struct smb_acl));"
    },
    {
        "line": 72,
        "fullcodeline": "aces_size = acl_size - sizeof(struct smb_acl);"
    },
    {
        "line": 161,
        "fullcodeline": "*pdaccess = cpu_to_le32(granted);"
    },
    {
        "line": 163,
        "fullcodeline": "kfree(pntsd);"
    },
    {
        "line": 22,
        "fullcodeline": "if (pntsd_size <= 0 || !pntsd)"
    },
    {
        "line": 26,
        "fullcodeline": "if (!dacl_offset ||"
    },
    {
        "line": 34,
        "fullcodeline": "if (pdacl_size > acl_size || pdacl_size < sizeof(struct smb_acl))"
    },
    {
        "line": 37,
        "fullcodeline": "if (!pdacl->num_aces) {"
    },
    {
        "line": 46,
        "fullcodeline": "if (*pdaccess & FILE_MAXIMAL_ACCESS_LE) {"
    },
    {
        "line": 67,
        "fullcodeline": "if (!uid)"
    },
    {
        "line": 73,
        "fullcodeline": "for (i = 0; i < le32_to_cpu(pdacl->num_aces); i++) {"
    },
    {
        "line": 92,
        "fullcodeline": "if (*pdaccess & FILE_MAXIMAL_ACCESS_LE && found) {"
    },
    {
        "line": 102,
        "fullcodeline": "if (IS_ENABLED(CONFIG_FS_POSIX_ACL)) {"
    },
    {
        "line": 132,
        "fullcodeline": "if (!found) {"
    },
    {
        "line": 153,
        "fullcodeline": "if (granted &"
    },
    {
        "line": 27,
        "fullcodeline": "(dacl_offset + sizeof(struct smb_acl) > pntsd_size))"
    },
    {
        "line": 47,
        "fullcodeline": "granted = READ_CONTROL | WRITE_DAC | FILE_READ_ATTRIBUTES |"
    },
    {
        "line": 50,
        "fullcodeline": "ace = (struct smb_ace *)((char *)pdacl + sizeof(struct smb_acl));"
    },
    {
        "line": 51,
        "fullcodeline": "aces_size = acl_size - sizeof(struct smb_acl);"
    },
    {
        "line": 68,
        "fullcodeline": "sid_type = SIDUNIX_USER;"
    },
    {
        "line": 76,
        "fullcodeline": "ace_size = le16_to_cpu(ace->size);"
    },
    {
        "line": 79,
        "fullcodeline": "aces_size -= ace_size;"
    },
    {
        "line": 89,
        "fullcodeline": "ace = (struct smb_ace *)((char *)ace + le16_to_cpu(ace->size));"
    },
    {
        "line": 93,
        "fullcodeline": "granted = READ_CONTROL | WRITE_DAC | FILE_READ_ATTRIBUTES |"
    },
    {
        "line": 96,
        "fullcodeline": "granted |= le32_to_cpu(ace->access_req);"
    },
    {
        "line": 103,
        "fullcodeline": "posix_acls = get_acl(d_inode(path->dentry), ACL_TYPE_ACCESS);"
    },
    {
        "line": 144,
        "fullcodeline": "access_bits = le32_to_cpu(ace->access_req);"
    },
    {
        "line": 148,
        "fullcodeline": "access_bits = le32_to_cpu(~ace->access_req);"
    },
    {
        "line": 154,
        "fullcodeline": "~(access_bits | FILE_READ_ATTRIBUTES | READ_CONTROL | WRITE_DAC | DELETE)) {"
    },
    {
        "line": 155,
        "fullcodeline": "ksmbd_debug(SMB, \"Access denied with winACL, granted : %x, access_req : %x\\n\","
    },
    {
        "line": 157,
        "fullcodeline": "rc = -EACCES;"
    },
    {
        "line": 38,
        "fullcodeline": "if (!(pdacl_size - sizeof(struct smb_acl)) &&"
    },
    {
        "line": 52,
        "fullcodeline": "for (i = 0; i < le32_to_cpu(pdacl->num_aces); i++) {"
    },
    {
        "line": 63,
        "fullcodeline": "if (!pdacl->num_aces)"
    },
    {
        "line": 77,
        "fullcodeline": "if (ace_size > aces_size)"
    },
    {
        "line": 81,
        "fullcodeline": "if (!compare_sids(&sid, &ace->sid) ||"
    },
    {
        "line": 86,
        "fullcodeline": "if (!compare_sids(&sid_everyone, &ace->sid))"
    },
    {
        "line": 98,
        "fullcodeline": "if (!pdacl->num_aces)"
    },
    {
        "line": 104,
        "fullcodeline": "if (posix_acls && !found) {"
    },
    {
        "line": 156,
        "fullcodeline": "granted, le32_to_cpu(ace->access_req));"
    },
    {
        "line": 39,
        "fullcodeline": "*pdaccess & ~(FILE_READ_CONTROL_LE | FILE_WRITE_DAC_LE)) {"
    },
    {
        "line": 40,
        "fullcodeline": "rc = -EACCES;"
    },
    {
        "line": 55,
        "fullcodeline": "ace_size = le16_to_cpu(ace->size);"
    },
    {
        "line": 58,
        "fullcodeline": "aces_size -= ace_size;"
    },
    {
        "line": 59,
        "fullcodeline": "granted |= le32_to_cpu(ace->access_req);"
    },
    {
        "line": 60,
        "fullcodeline": "ace = (struct smb_ace *)((char *)ace + le16_to_cpu(ace->size));"
    },
    {
        "line": 64,
        "fullcodeline": "granted = GENERIC_ALL_FLAGS;"
    },
    {
        "line": 82,
        "fullcodeline": "!compare_sids(&sid_unix_NFS_mode, &ace->sid)) {"
    },
    {
        "line": 83,
        "fullcodeline": "found = 1;"
    },
    {
        "line": 87,
        "fullcodeline": "others_ace = ace;"
    },
    {
        "line": 99,
        "fullcodeline": "granted = GENERIC_ALL_FLAGS;"
    },
    {
        "line": 105,
        "fullcodeline": "unsigned int id = -1;"
    },
    {
        "line": 107,
        "fullcodeline": "pa_entry = posix_acls->a_entries;"
    },
    {
        "line": 129,
        "fullcodeline": "posix_acl_release(posix_acls);"
    },
    {
        "line": 134,
        "fullcodeline": "ace = others_ace;"
    },
    {
        "line": 56,
        "fullcodeline": "if (ace_size > aces_size)"
    },
    {
        "line": 108,
        "fullcodeline": "for (i = 0; i < posix_acls->a_count; i++, pa_entry++) {"
    },
    {
        "line": 136,
        "fullcodeline": "ksmbd_debug(SMB, \"Can't find corresponding sid\\n\");"
    },
    {
        "line": 137,
        "fullcodeline": "rc = -EACCES;"
    },
    {
        "line": 109,
        "fullcodeline": "if (pa_entry->e_tag == ACL_USER)"
    },
    {
        "line": 116,
        "fullcodeline": "if (id == uid) {"
    },
    {
        "line": 110,
        "fullcodeline": "id = posix_acl_uid_translate(user_ns, pa_entry);"
    },
    {
        "line": 117,
        "fullcodeline": "mode_to_access_flags(pa_entry->e_perm,"
    },
    {
        "line": 123,
        "fullcodeline": "posix_acl_release(posix_acls);"
    },
    {
        "line": 120,
        "fullcodeline": "if (!access_bits)"
    },
    {
        "line": 111,
        "fullcodeline": "else if (pa_entry->e_tag == ACL_GROUP)"
    },
    {
        "line": 121,
        "fullcodeline": "access_bits ="
    },
    {
        "line": 112,
        "fullcodeline": "id = posix_acl_gid_translate(user_ns, pa_entry);"
    }
]