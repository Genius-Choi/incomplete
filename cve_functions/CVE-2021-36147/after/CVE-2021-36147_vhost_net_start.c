vhost_net_start(struct vhost_net *vhost_net)
{
	int rc;

	if (vhost_net->vhost_started) {
		WPRINTF(("vhost net already started\n"));
		return 0;
	}

	rc = vhost_dev_start(&vhost_net->vdev);
	if (rc < 0) {
		WPRINTF(("vhost_dev_start failed\n"));
		goto fail;
	}

	/* if the backend is the TAP */
	if (vhost_net->tapfd > 0) {
		rc = vhost_net_set_backend(&vhost_net->vdev,
			vhost_net->tapfd);
		if (rc < 0) {
			WPRINTF(("vhost_net_set_backend failed\n"));
			goto fail_set_backend;
		}
	}

	vhost_net->vhost_started = true;
	return 0;

fail_set_backend:
	vhost_dev_stop(&vhost_net->vdev);
fail:
	return -1;
}
