static void register_session_tickets(void (*cb)(void *), void *arg)
{
    pthread_rwlock_wrlock(&session_tickets.rwlock);
    (*cb)(arg);
    assert(session_tickets.tickets.size != 0);
    pthread_rwlock_unlock(&session_tickets.rwlock);
    __sync_add_and_fetch(&session_tickets.generation, 1);
    if (session_tickets.barrier != NULL) {
        h2o_barrier_wait(session_tickets.barrier);
        session_tickets.barrier = NULL;
    }
}
