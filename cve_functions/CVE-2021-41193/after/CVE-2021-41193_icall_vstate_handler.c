static void icall_vstate_handler(struct icall *icall, const char *userid,
				 const char *clientid, enum icall_vstate state,
				 void *arg)
{
	struct wcall *wcall = arg;
	struct calling_instance *inst = wcall ? wcall->inst : NULL;
	char userid_anon[ANON_ID_LEN];
	char convid_anon[ANON_ID_LEN];

	(void)clientid;

	if (!wcall) {
		warning("wcall(%p): vstateh wcall is NULL, "
			"ignoring props\n", wcall);
		return;
	}
	
	if (!WCALL_VALID(wcall)) {
		warning("wcall(%p): icall_vstate_handler: invalid wcall "
			"inst=%p\n", wcall, inst);
		return;
	}

	if (!icall) {
		warning("wcall(%p): vstateh icall is NULL, "
			"ignoring props\n", wcall);
		return;
	}

	int wstate = WCALL_VIDEO_STATE_STOPPED;
	switch (state) {
	case ICALL_VIDEO_STATE_STARTED:
		wstate = WCALL_VIDEO_STATE_STARTED;
		break;
	case ICALL_VIDEO_STATE_SCREENSHARE:
		wstate = WCALL_VIDEO_STATE_SCREENSHARE;
		break;
	case ICALL_VIDEO_STATE_PAUSED:
		wstate = WCALL_VIDEO_STATE_PAUSED;
		break;
	case ICALL_VIDEO_STATE_BAD_CONN:
		wstate = WCALL_VIDEO_STATE_BAD_CONN;
		break;
	case ICALL_VIDEO_STATE_STOPPED:
	default:
		wstate = WCALL_VIDEO_STATE_STOPPED;
		break;
	}
	info(APITAG "wcall(%p): vstateh(%p) icall=%p conv=%s "
	     "user=%s state=%d\n",
	     wcall, inst->vstateh, icall, anon_id(convid_anon, wcall->convid),
	     anon_id(userid_anon, userid), wstate);

	if (inst->vstateh) {
		uint64_t now = tmr_jiffies();
		inst->vstateh(wcall->convid, userid, clientid,
			      wstate, inst->arg);
		info(APITAG "wcall(%p): vstateh took %llu ms\n",
		     wcall, tmr_jiffies() - now);
	}
	if (wcall->conv_type != WCALL_CONV_TYPE_CONFERENCE
	    && inst->group.json.chgh) {
		call_group_change_json(inst, wcall);
	}
}
