static int generate_or_gather_answer(struct ecall *ecall, struct econn *econn)
{
	int err;

	if (ecall->sdp.offer) {
		err = IFLOW_CALLE(ecall->flow, handle_offer,
			ecall->sdp.offer);
		if (err) {
			warning("ecall(%p): handle_offer error (%m)\n",
				ecall, err);
			return EBADMSG;
		}
		ecall->sdp.offer = mem_deref(ecall->sdp.offer);
	}

	if (IFLOW_CALLE(ecall->flow, is_gathered)) {
		return generate_answer(ecall, econn);
	}
	else {
		if (ecall->sdp.async == ASYNC_NONE) {
			ecall->sdp.async = ASYNC_ANSWER;
			gather_all(ecall, false);
			ecall->econn_pending = econn;
		}
	}

	return 0;
}
