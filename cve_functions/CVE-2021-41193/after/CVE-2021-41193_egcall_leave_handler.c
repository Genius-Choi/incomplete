static void egcall_leave_handler(struct icall* icall, int reason, uint32_t msg_time, void *arg)
{
	struct wcall *wcall = arg;
	struct calling_instance *inst = wcall ? wcall->inst : NULL;

	if (!WCALL_VALID(wcall)) {
		warning("wcall(%p): egcall_leave_handler: invalid wcall "
			"inst=%p\n", wcall, inst);
		return;
	}

	set_state(wcall, WCALL_STATE_INCOMING);
	if (inst->closeh) {
		int wreason = WCALL_REASON_NORMAL;

		switch (reason) {
		case ICALL_REASON_STILL_ONGOING:
			wreason = WCALL_REASON_STILL_ONGOING;
			break;
		case ICALL_REASON_ANSWERED_ELSEWHERE:
			wreason = WCALL_REASON_ANSWERED_ELSEWHERE;
			break;
		case ICALL_REASON_REJECTED:
			wreason = WCALL_REASON_REJECTED;
			break;
		case ICALL_REASON_OUTDATED_CLIENT:
			wreason = WCALL_REASON_OUTDATED_CLIENT;
			break;
		case ICALL_REASON_TIMEOUT:
			wreason = WCALL_REASON_TIMEOUT;
			break;
		case ICALL_REASON_NOONE_JOINED:
			wreason = WCALL_REASON_NOONE_JOINED;
			break;
		case ICALL_REASON_EVERYONE_LEFT:
			wreason = WCALL_REASON_EVERYONE_LEFT;
			break;
		default:
			wreason = WCALL_REASON_NORMAL;
			break;
		}
		uint64_t now = tmr_jiffies();
		info(APITAG "wcall(%p): egcall_leave_handler: closeh(%p) "
		     "group=yes state=%s reason=%s\n",
		     wcall, inst->closeh, wcall_state_name(wcall->state),
		     wcall_reason_name(reason));

		inst->closeh(wreason, wcall->convid, msg_time,
			     inst->userid, inst->clientid, inst->arg);
		info(APITAG "wcall(%p): egcall_leave_handler: closeh took %llu ms\n",
		     wcall, tmr_jiffies() - now);
	}
	wcall->disable_audio = true;
	if (!wcall_has_calls() && inst->mm) {
		mediamgr_set_call_state(inst->mm,
					MEDIAMGR_STATE_NORMAL);
	}
}
