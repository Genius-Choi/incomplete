static int generate_answer(struct ecall *ecall, struct econn *econn)
{
	size_t sdp_len = SDP_MAX_LEN;
	char *sdp = NULL;
	int err;

	if (!econn) {
		warning("ecall: generate_answer: no pending econn\n");
		err = EPROTO;
		goto out;
	}

	sdp = mem_zalloc(sdp_len, NULL);
	if (!sdp)
		return ENOMEM;

	err = IFLOW_CALLE(ecall->flow, generate_answer, sdp, sdp_len);
	if (err) {
		warning("ecall: generate answer failed (%m)\n", err);
		goto out;
	}

	if (ecall->update) {
		ecall->num_retries++;
		err = econn_update_resp(econn, sdp, ecall->props_local);
	}
	else {
		err = econn_answer(econn, sdp, ecall->props_local);
	}
	if (err)
		goto out;

	if (!ecall->established) {
		tmr_start(&ecall->connection_tmr, TIMEOUT_CONNECTION,
			  connection_timeout_handler, ecall);
	}
 out:
	mem_deref(sdp);
	return err;
}
