int ecall_update_mute_state(const struct ecall *ecall)
{
	const char *muted_string;
	bool muted;
	int err = 0;
	
	if (!ecall) {
		return EINVAL;
	}

	muted = msystem_get_muted();

	muted_string = muted ? "true" : "false";
	err = econn_props_update(ecall->props_local, "muted", muted_string);
	if (err) {
		warning("ecall(%p): econn_props_update(muted)",
			" failed (%m)\n", ecall, err);
		return err;
	}

	/* sync the properties to the remote peer */
	if (!ecall->devpair
	    && !ecall->update
	    && econn_can_send_propsync(ecall->econn)) {
		info("ecall(%p): update_mute_state: setting props "
			"muted:%s\n",
			ecall, muted_string);

		err = econn_send_propsync(ecall->econn, false,
					  ecall->props_local);
		if (err) {
			warning("ecall: update_mute_state: econn_send_propsync"
				" failed (%m)\n",
				err);
			goto out;
		}
	}

out:
	return err;
}
