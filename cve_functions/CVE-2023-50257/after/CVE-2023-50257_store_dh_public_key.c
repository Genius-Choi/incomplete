bool store_dh_public_key(EVP_PKEY* dhkey, std::vector<uint8_t>& buffer)
{
    bool returnedValue = false;
    DH* dh = EVP_PKEY_get1_DH(dhkey);

    if(dh != nullptr)
    {
        const BIGNUM* p = dh->p;
        const BIGNUM* g = dh->g;
        const BIGNUM* pub_key = dh->pub_key;
        int len = BN_serialized_size(p);
        len += BN_serialized_size(g);
        len += BN_serialized_size(pub_key);
        buffer.resize(len);
        unsigned char* pointer = buffer.data();
        if((pointer = BN_serialize(p, buffer.data(), pointer)) != nullptr)
        {
            if((pointer = BN_serialize(g, buffer.data(), pointer)) != nullptr)
            {
                if((pointer = BN_serialize(pub_key, buffer.data(), pointer)) != nullptr)
                {
                    returnedValue =  true;
                }
                else
                    logError(AUTHENTICATION, "Cannot serialize public key");
            }
            else
                logError(AUTHENTICATION, "Cannot serialize g");
        }
        else
            logError(AUTHENTICATION, "Cannot serialize p");

        DH_free(dh);
    }
    else
        logError(AUTHENTICATION, "OpenSSL library doesn't retrieve DH");

    return returnedValue;
}
