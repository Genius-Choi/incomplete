RTPSParticipantImpl::~RTPSParticipantImpl()
{
    // Safely abort threads.
    for (auto& block : m_receiverResourcelist)
    {
        block.resourceAlive = false;
        block.Receiver.Abort();
        block.m_thread->join();
        delete block.m_thread;
    }

    while(m_userReaderList.size()>0)
        RTPSDomain::removeRTPSReader(*m_userReaderList.begin());

    while(m_userWriterList.size()>0)
        RTPSDomain::removeRTPSWriter(*m_userWriterList.begin());

    // Destruct message receivers
    for (auto& block : m_receiverResourcelist)
        delete block.mp_receiver;

    m_receiverResourcelist.clear();
    delete(this->mp_builtinProtocols);
    delete(this->mp_ResourceSemaphore);
    delete(this->mp_userParticipant);
    m_senderResource.clear();

    delete(this->mp_event_thr);

    delete(this->mp_mutex);
}
