unsigned char* BN_serialize(const BIGNUM* bn, const unsigned char* orig_pointer, unsigned char* current_pointer)
{
    assert(bn);
    assert(orig_pointer);
    assert(current_pointer);

    size_t align = alignment(current_pointer - orig_pointer, 4);
    unsigned char* pointer = current_pointer + align;
    uint32_t len = (uint32_t)BN_num_bytes(bn);

    if(DEFAULT_ENDIAN == BIGEND)
    {
        pointer[0] = ((char*)&len)[0];
        pointer[1] = ((char*)&len)[1];
        pointer[2] = ((char*)&len)[2];
        pointer[3] = ((char*)&len)[3];
    }
    else
    {
        pointer[0] = ((char*)&len)[3];
        pointer[1] = ((char*)&len)[2];
        pointer[2] = ((char*)&len)[1];
        pointer[3] = ((char*)&len)[0];
    }

    pointer += 4;

    if(BN_bn2bin(bn, pointer) == len)
        return pointer + len;

    return nullptr;
}
