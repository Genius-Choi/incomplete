bool verify_certificate(X509_STORE* store, X509* cert, const bool there_are_crls)
{
    assert(store);
    assert(cert);

    bool returnedValue = false;

    X509_STORE_CTX ctx;

    unsigned long flags = there_are_crls ? X509_V_FLAG_CRL_CHECK : 0;
    X509_STORE_CTX_init(&ctx, store, cert, NULL);
    X509_STORE_CTX_set_flags(&ctx, flags | X509_V_FLAG_X509_STRICT |
            X509_V_FLAG_CHECK_SS_SIGNATURE | X509_V_FLAG_POLICY_CHECK);

    if(X509_verify_cert(&ctx) > 0 && X509_STORE_CTX_get_error(&ctx) == X509_V_OK)
        returnedValue = true;
    else
        logWarning(AUTHENTICATION, "Invalidation error of certificate  (" << X509_STORE_CTX_get_error(&ctx) << ")");

    X509_STORE_CTX_cleanup(&ctx);

    return returnedValue;
}
