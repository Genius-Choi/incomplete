GetMessage(int fd, uint8_t* data, int dataSz)
{
	int count = 0;
	int bytesRemaining = dataSz;
	int offset = 0;

	while (bytesRemaining > 0)
	{
		count = read(fd, &data[offset], bytesRemaining);
		if (-1 == count)
		{
			if ((EINTR == errno) || (EAGAIN == errno))
			{
				continue;
			}

			WPRINTF(("Failed to read!"));
			return errno;
		}

		if (0 == count)
		{
			WPRINTF(("Success to read, but the content is empty!"));
			return ENOTCONN;
		}

		bytesRemaining -= count;
		offset += count;
	}
	return 0;
}
