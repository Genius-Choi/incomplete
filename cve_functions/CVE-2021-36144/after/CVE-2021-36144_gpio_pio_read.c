gpio_pio_read(struct virtio_gpio *gpio, int n)
{
	struct gpio_line *line;
	uint32_t reg = 0;

	if (n >= gpio->nvline) {
		WPRINTF(("pio read is invalid, n %d, nvline %d\n",
				n, gpio->nvline));
		return 0xFFFFFFFF;
	}

	line = gpio->vlines[n];
	reg = line->value;
	reg |= ((line->dir << PIO_GPIO_DIR_OFFSET) & PIO_GPIO_DIR_MASK);
	reg |= ((line->config << PIO_GPIO_CONFIG_OFFSET) &
		PIO_GPIO_CONFIG_MASK);
	if (line->irq->fd > 0)
		reg |= 1 << PIO_GPIO_MODE_OFFSET;

	DPRINTF(("pio read n %d, reg 0x%X\n", n, reg));
	return reg;
}
