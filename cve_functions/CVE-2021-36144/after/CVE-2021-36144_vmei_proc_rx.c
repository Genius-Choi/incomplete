vmei_proc_rx(struct virtio_mei *vmei, struct virtio_vq_info *vq)
{
	struct vmei_me_client *me;
	struct vmei_host_client *e, *hclient = NULL;

	/*  Find a client with data */
	pthread_mutex_lock(&vmei->list_mutex);
	LIST_FOREACH(me, &vmei->active_clients, list) {
		pthread_mutex_lock(&me->list_mutex);
		LIST_FOREACH(e, &me->connections, list) {
			if (e->recv_offset - e->recv_handled > 0) {
				if (e->recv_creds) {
					hclient = vmei_host_client_get(e);
					pthread_mutex_unlock(&me->list_mutex);
					goto found;
				}
			}
		}
		pthread_mutex_unlock(&me->list_mutex);
	}
found:
	pthread_mutex_unlock(&vmei->list_mutex);

	/* no client has data to be processed */
	if (!hclient) {
		DPRINTF("RX: No client with data\n");
		return false;
	}

	vmei_proc_vclient_rx(hclient, vq);
	pthread_mutex_lock(&vmei->tx_mutex);
	if (vmei_host_ready_send_buffers(hclient))
		pthread_cond_signal(&vmei->tx_cond);
	pthread_mutex_unlock(&vmei->tx_mutex);
	vmei_host_client_put(hclient);

	return true;
}
