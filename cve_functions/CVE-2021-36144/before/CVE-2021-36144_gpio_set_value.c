gpio_set_value(struct virtio_gpio *gpio, unsigned int offset,
		unsigned int value)
{
	struct gpio_line *line;
	struct gpiohandle_data data;
	int rc;

	line = gpio->vlines[offset];
	if (line->busy || line->fd < 0) {
		WPRINTF(("failed to set gpio%d value, busy:%d, fd:%d\n",
				offset, line->busy, line->fd));
		return -1;
	}

	memset(&data, 0, sizeof(data));
	data.values[0] = value;
	rc = ioctl(line->fd, GPIOHANDLE_SET_LINE_VALUES_IOCTL, &data);
	if (rc < 0) {
		WPRINTF(("ioctl GPIOHANDLE_SET_LINE_VALUES_IOCTL error %s\n",
				strerror(errno)));
		return -1;
	}
	line->value = value;
	return 0;
}
