send_and_receive(int fd, struct coreu_msg *msg)
{
	uint32_t msg_size = sizeof(struct coreu_msg);
	int ret;

	ret = send(fd, (void *)msg, msg_size, 0);
	if (ret < 0) {
		WPRINTF(("send error\n"));
		return ret;
	}

	ret = recv(fd, (void *)msg, msg_size, 0);
	if (ret < 0) {
		WPRINTF(("recv error\n"));
		return ret;
	}

	if (ret < msg_size) {
		WPRINTF(("received part of the data, %d instead of %d\n",
			ret,
			msg_size));
		return ret;
	}

	return 0;
}
