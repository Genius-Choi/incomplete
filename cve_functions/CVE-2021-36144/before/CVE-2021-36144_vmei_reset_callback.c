vmei_reset_callback(int fd, enum ev_type type, void *param)
{
	struct virtio_mei *vmei = param;
	char buf[MEI_DEV_STATE_LEN] = {0};
	int sz;

	if (vmei->status != VMEI_STS_READY)
		return;

	lseek(fd, 0, SEEK_SET);
	sz = read(fd, buf, 12);
	/*
	 * edge mevent is hit immediately after add
	 * as the file is not empty, this has to be ignored
	 */
	if (vmei->dev_state_first) {
		vmei->dev_state_first = false;
		return;
	}

	if (sz != 7 || memcmp(buf, "ENABLED", 7))
		return;

	DPRINTF("Reset state callback\n");

	vmei_virtual_fw_reset(vmei);
	virtio_config_changed(&vmei->base);
	vmei_free_me_clients(vmei);
	vmei_start(vmei, true);
}
