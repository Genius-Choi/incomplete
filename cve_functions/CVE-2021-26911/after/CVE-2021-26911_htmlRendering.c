String * IMAPSession::htmlRendering(IMAPMessage * message, String * folder, ErrorCode * pError)
{
    HTMLRendererIMAPDataCallback * dataCallback = new HTMLRendererIMAPDataCallback(this, message->uid());
    String * htmlString = HTMLRenderer::htmlForIMAPMessage(folder,
                                                           message,
                                                           dataCallback,
                                                           NULL);
    * pError = dataCallback->error();
    
    MC_SAFE_RELEASE(dataCallback);

    if (* pError != ErrorNone) {
        return NULL;
    }
    
    return htmlString;
}
