void IMAPSession::selectIfNeeded(String * folder, ErrorCode * pError)
{
    loginIfNeeded(pError);
    if (* pError != ErrorNone)
        return;
    
    if (folder == NULL) {
        * pError = ErrorMissingFolder;
        return;
    }
    
    if (mNeedsReselect) {
        mNeedsReselect = false;
        select(folder, pError);
    }
    else if (mState == STATE_SELECTED) {
        MCAssert(mCurrentFolder != NULL);
        if (mCurrentFolder->caseInsensitiveCompare(folder) != 0) {
            select(folder, pError);
        }
    }
    else if (mState == STATE_LOGGEDIN) {
        select(folder, pError);
    }
    else {
        * pError = ErrorNone;
    }
}
