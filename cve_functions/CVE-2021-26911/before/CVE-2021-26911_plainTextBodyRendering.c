String * IMAPSession::plainTextBodyRendering(IMAPMessage * message, String * folder, bool stripWhitespace, ErrorCode * pError)
{
    MCAssert(folder != NULL);
    String * htmlBodyString = htmlBodyRendering(message, folder, pError);
    
    if (* pError != ErrorNone) {
        return NULL;
    }
    
    String * plainTextBodyString = htmlBodyString->flattenHTML();
    if (stripWhitespace) {
        return plainTextBodyString->stripWhitespace();
    }
    
    return plainTextBodyString;
}
