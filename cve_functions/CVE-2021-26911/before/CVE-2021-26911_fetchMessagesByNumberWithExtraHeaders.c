Array * IMAPSession::fetchMessagesByNumberWithExtraHeaders(String * folder, IMAPMessagesRequestKind requestKind,
                                                           IndexSet * numbers, IMAPProgressCallback * progressCallback,
                                                           Array * extraHeaders, ErrorCode * pError)
{
    struct mailimap_set * imapset = setFromIndexSet(numbers);
    IMAPSyncResult * syncResult = fetchMessages(folder, requestKind, false, imapset, NULL, numbers, 0, NULL,
                                                progressCallback, extraHeaders, pError);
    if (syncResult == NULL) {
        mailimap_set_free(imapset);
        return NULL;
    }
    Array * result = syncResult->modifiedOrAddedMessages();
    result->retain()->autorelease();
    mailimap_set_free(imapset);
    return result;
}
