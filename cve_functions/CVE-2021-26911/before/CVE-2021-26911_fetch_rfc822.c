static int fetch_rfc822(mailimap * session, bool identifier_is_uid,
                        uint32_t identifier, char ** result, size_t * result_len)
{
    struct mailimap_section * section;
    struct mailimap_fetch_att * fetch_att;
    struct mailimap_fetch_type * fetch_type;
    
    section = mailimap_section_new(NULL);
    fetch_att = mailimap_fetch_att_new_body_peek_section(section);
    fetch_type = mailimap_fetch_type_new_fetch_att(fetch_att);
    int r = fetch_imap(session, identifier_is_uid, identifier,
                       fetch_type, result, result_len);
    mailimap_fetch_type_free(fetch_type);
    
    return r;
    
#if 0
    int r;
    clist * fetch_list;
    struct mailimap_section * section;
    struct mailimap_fetch_att * fetch_att;
    struct mailimap_fetch_type * fetch_type;
    struct mailimap_set * set;
    struct mailimap_msg_att * msg_att;
    struct mailimap_msg_att_item * item;
    int res;
    clistiter * cur;
    
    section = mailimap_section_new(NULL);
    fetch_att = mailimap_fetch_att_new_body_peek_section(section);
    fetch_type = mailimap_fetch_type_new_fetch_att(fetch_att);
    
    set = mailimap_set_new_single(identifier);
    
    if (identifier_is_uid) {
        r = mailimap_uid_fetch(session, set, fetch_type, &fetch_list);
    }
    else {
        r = mailimap_fetch(session, set, fetch_type, &fetch_list);
    }
    
    mailimap_set_free(set);
    mailimap_fetch_type_free(fetch_type);
    
    if (r != MAILIMAP_NO_ERROR) {
        res = r;
        goto err;
    }
    
    if (clist_isempty(fetch_list)) {
        res = MAILIMAP_ERROR_FETCH;
        goto free;
    }
    
    msg_att = (struct mailimap_msg_att *) clist_begin(fetch_list)->data;
    
    for(cur = clist_begin(msg_att->att_list) ; cur != NULL ; cur = clist_next(cur)) {
        item = (struct mailimap_msg_att_item *) clist_content(cur);
        
        if (item->att_type != MAILIMAP_MSG_ATT_ITEM_STATIC) {
            continue;
        }
        if (item->att_data.att_static->att_type != MAILIMAP_MSG_ATT_BODY_SECTION) {
            continue;
        }
        
        * result = item->att_data.att_static->att_data.att_body_section->sec_body_part;
        item->att_data.att_static->att_data.att_body_section->sec_body_part = NULL;
        mailimap_fetch_list_free(fetch_list);
        
        return MAILIMAP_NO_ERROR;
    }
    
    res = MAILIMAP_ERROR_FETCH;
    
free:
    mailimap_fetch_list_free(fetch_list);
err:
    return res;
#endif
}
