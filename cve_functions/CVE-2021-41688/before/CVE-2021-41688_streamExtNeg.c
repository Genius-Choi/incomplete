streamExtNeg(SOPClassExtendedNegotiationSubItem* extNeg, unsigned char *b, unsigned long *len)
{

    if (extNeg == NULL)
        return EC_Normal;

    extNeg->itemType = 0x56;
    // recompute the length fields
    extNeg->sopClassUIDLength = OFstatic_cast(unsigned short, extNeg->sopClassUID.length());
    extNeg->itemLength = 2 + extNeg->sopClassUIDLength + extNeg->serviceClassAppInfoLength;

    *b++ = extNeg->itemType;
    *b++ = extNeg->reserved1;
    COPY_SHORT_BIG(extNeg->itemLength, b);
    b += 2;

    COPY_SHORT_BIG(extNeg->sopClassUIDLength, b);
    b += 2;

    (void) memcpy(b, extNeg->sopClassUID.c_str(), extNeg->sopClassUIDLength);
    b += extNeg->sopClassUIDLength;

    (void) memcpy(b, extNeg->serviceClassAppInfo, extNeg->serviceClassAppInfoLength);
    b += extNeg->serviceClassAppInfoLength;

    *len = 4 + extNeg->itemLength;

    return EC_Normal;
}
