OperationStatus shiftImpl(
    ShiftOpIs shiftOp,
    MutableBigIntRef dst,
    ImmutableBigIntRef lhs,
    ImmutableBigIntRef rhs) {
  auto [shiftAmnt, actualShiftOp, numDigits] =
      getShiftAmountSignAndResultSize(shiftOp, lhs, rhs);
  auto op = (actualShiftOp == ShiftOpIs::Right) ? signedRightShiftAdapter
                                                : llvh::APInt::tcShiftLeft;

  if (dst.numDigits < numDigits) {
    return OperationStatus::DEST_TOO_SMALL;
  }

  auto res = initNonCanonicalWithReadOnlyBigInt(dst, lhs);
  if (LLVM_UNLIKELY(res != OperationStatus::RETURNED)) {
    return res;
  }

  (*op)(dst.digits, dst.numDigits, shiftAmnt);

  ensureCanonicalResult(dst);
  return OperationStatus::RETURNED;
}
