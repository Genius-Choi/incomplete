copyn_str(const uint8_t *src, uint32_t *pos, int *str_len, int limit)
{
	*str_len      = 0;
	uint8_t *dest = NULL;

	if (!src || !pos || limit < 2) {
		*str_len = 0;
		return NULL;
	}

	NNI_GET16(src + (*pos), *str_len);

	*pos = (*pos) + 2;
	if (*str_len > (limit-2)) {
		//buffer overflow
		*str_len = -1;
	}
	if (*str_len > 0) {
		if ((dest = nng_alloc(*str_len + 1)) == NULL || (src + (*pos) == NULL)) {
			*str_len = 0;
			return NULL;
		}
		memcpy(dest, src + (*pos), *str_len);
		dest[*str_len] = '\0';
		*pos           = (*pos) + (*str_len);
	}
	return dest;
}
