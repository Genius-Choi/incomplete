static GF_Err gf_filter_pid_negociate_property_full(GF_FilterPid *pid, u32 prop_4cc, const char *prop_name, char *dyn_name, const GF_PropertyValue *value)
{
	GF_FilterPidInst *pidi = (GF_FilterPidInst *) pid;
	if (!prop_4cc) return GF_BAD_PARAM;

	if (PID_IS_OUTPUT(pid)) {
		GF_LOG(GF_LOG_ERROR, GF_LOG_FILTER, ("Attempt to negociate property on output PID in filter %s - ignoring\n", pid->filter->name));
		return GF_BAD_PARAM;
	}
	pid = pid->pid;
	if (!pid->caps_negociate) {
		assert(!pid->caps_negociate_pidi_list);
		pid->caps_negociate = gf_props_new(pid->filter);
		pid->caps_negociate_pidi_list = gf_list_new();
		pid->caps_negociate_direct = GF_TRUE;
		gf_list_add(pid->caps_negociate_pidi_list, pidi);
		//we start a new caps negotiation step, reset any blacklist on pid
		if (pid->adapters_blacklist) {
			gf_list_del(pid->adapters_blacklist);
			pid->adapters_blacklist = NULL;
		}
		safe_int_inc(&pid->filter->nb_caps_renegociate);
	}
	else {
		const GF_PropertyValue *p;
		//new PID instance asking for cap negociation
		if (gf_list_find(pid->caps_negociate_pidi_list, pidi)<0) {
			gf_list_add(pid->caps_negociate_pidi_list, pidi);
		}

		//check if same property to list
		p = gf_props_get_property(pid->caps_negociate, prop_4cc, prop_name);
		if (p) {
			if (gf_props_equal(p, value))
				return GF_OK;
			//not the same value, disable direct caps negociate
			pid->caps_negociate_direct = GF_FALSE;
		}
	}
#ifndef GPAC_DISABLE_LOG
	if (gf_log_tool_level_on(GF_LOG_FILTER, GF_LOG_INFO)) {
		char p_dump[GF_PROP_DUMP_ARG_SIZE];
		GF_LOG(GF_LOG_INFO, GF_LOG_FILTER, ("PID %s negociate property %s to %s\n",
			pid->filter->name, 	prop_name ? prop_name : gf_props_4cc_get_name(prop_4cc),
			gf_props_dump(prop_4cc, value, p_dump, GF_PROP_DUMP_DATA_NONE)
		));
	}
#endif

	//pid is end of stream or pid instance has packet pendings, we will need a new chain to adapt these packets formats
	if (pid->has_seen_eos || gf_fq_count(pidi->packets)) {
		gf_fs_post_task(pid->filter->session, gf_filter_renegociate_output_task, pid->filter, NULL, "filter renegociate", NULL);
	}
	return gf_props_set_property(pid->caps_negociate, prop_4cc, prop_name, dyn_name, value);
}
