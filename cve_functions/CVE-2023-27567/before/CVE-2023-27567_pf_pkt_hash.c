pf_pkt_hash(sa_family_t af, uint8_t proto,
    const struct pf_addr *src, const struct pf_addr *dst,
    uint16_t sport, uint16_t dport)
{
	uint32_t hash;

	hash = src->addr32[0] ^ dst->addr32[0];
#ifdef INET6
	if (af == AF_INET6) {
		hash ^= src->addr32[1] ^ dst->addr32[1];
		hash ^= src->addr32[2] ^ dst->addr32[2];
		hash ^= src->addr32[3] ^ dst->addr32[3];
	}
#endif

	switch (proto) {
	case IPPROTO_TCP:
	case IPPROTO_UDP:
		hash ^= sport ^ dport;
		break;
	}

	return stoeplitz_n32(hash);
}
