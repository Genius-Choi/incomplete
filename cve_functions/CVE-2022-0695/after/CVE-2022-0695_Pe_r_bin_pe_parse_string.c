static String* Pe_r_bin_pe_parse_string(RBinPEObj* pe, PE_DWord* curAddr) {
	String* string = calloc (1, sizeof (*string));
	PE_DWord begAddr = *curAddr;
	int len_value = 0;
	int i = 0;
	if (!string) {
		pe_printf ("Warning: calloc (String)\n");
		return NULL;
	}
	if (begAddr > pe->size || begAddr + sizeof (string->wLength) > pe->size) {
		free_String (string);
		return NULL;
	}
	if ((string->wLength = r_buf_read_le16_at (pe->b, *curAddr)) == UT16_MAX) {
		pe_printf ("Warning: read (String wLength)\n");
		goto out_error;
	}
	*curAddr += sizeof (string->wLength);
	if (*curAddr > pe->size || *curAddr + sizeof (string->wValueLength) > pe->size) {
		goto out_error;
	}
	if ((string->wValueLength = r_buf_read_le16_at (pe->b, *curAddr)) == UT16_MAX) {
		pe_printf ("Warning: read (String wValueLength)\n");
		goto out_error;
	}
	*curAddr += sizeof (string->wValueLength);

	if (*curAddr > pe->size || *curAddr + sizeof (string->wType) > pe->size) {
		goto out_error;
	}
	if ((string->wType = r_buf_read_le16_at (pe->b, *curAddr)) == UT16_MAX) {
		pe_printf ("Warning: read (String wType)\n");
		goto out_error;
	}
	*curAddr += sizeof (string->wType);
	if (string->wType != 0 && string->wType != 1) {
		pe_printf ("Warning: check (String wType)\n");
		goto out_error;
	}

	for (i = 0; *curAddr < begAddr + string->wLength; i++, *curAddr += sizeof (ut16)) {
		ut16 utf16_char;
		ut16 *tmpKey;
		if (*curAddr > pe->size || *curAddr + sizeof (ut16) > pe->size) {
			goto out_error;
		}
		if (r_buf_read_at (pe->b, *curAddr, (ut8*) &utf16_char, sizeof (ut16)) != sizeof (ut16)) {
			pe_printf ("Warning: check (String szKey)\n");
			goto out_error;
		}
		tmpKey = (ut16*) realloc (string->szKey, (i + 1) * sizeof (ut16));
		if (!tmpKey) {
			pe_printf ("Warning: realloc (String szKey)\n");
			goto out_error;
		}
		string->szKey = tmpKey;
		string->szKey[i] = utf16_char;
		string->wKeyLen += sizeof (ut16);
		if (!utf16_char) {
			*curAddr += sizeof (ut16);
			break;
		}
	}
	align32 (*curAddr);
	len_value = R_MIN (string->wValueLength * 2, string->wLength - (*curAddr - begAddr));
	string->wValueLength = len_value;
	if (len_value < 0) {
		len_value = 0;
	}
	string->Value = (ut16*) calloc (len_value + 1, 1);
	if (!string->Value) {
		pe_printf ("Warning: malloc (String Value)\n");
		goto out_error;
	}
	if (*curAddr > pe->size || *curAddr + len_value > pe->size) {
		goto out_error;
	}
	if (r_buf_read_at (pe->b, *curAddr, (ut8*) string->Value, len_value) != len_value) {
		pe_printf ("Warning: read (String Value)\n");
		goto out_error;
	}
	*curAddr += len_value;
	return string;
out_error:
	free_String (string);
	return NULL;
}
