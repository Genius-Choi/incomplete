int ds_route_param_get(struct sip_msg *msg, pv_param_t *ip,
		pv_value_t *res, void *params, void *extra)
{
	pv_value_t tv;
	ds_dest_p entry = (ds_dest_p)params;
	
	if(ip->pvn.type==PV_NAME_INTSTR) {
		if (ip->pvn.u.isname.type != 0) {
			tv.rs =  ip->pvn.u.isname.name.s;
			tv.flags = PV_VAL_STR;
		} else {
			tv.ri = ip->pvn.u.isname.name.n;
			tv.flags = PV_VAL_INT|PV_TYPE_INT;
		}
	} else {
		/* pvar -> it might be another $param variable! */
		if(pv_get_spec_value(msg, (pv_spec_p)(ip->pvn.u.dname), &tv)!=0) {
			LM_ERR("cannot get spec value\n");
			return -1;
		}

		if(tv.flags&PV_VAL_NULL || tv.flags&PV_VAL_EMPTY) {
			LM_ERR("null or empty name\n");
			return -1;
		}
	}

	res->flags = PV_VAL_STR;
	/* search for the param we want top add, based on index */
	if (tv.flags & PV_VAL_INT) {
		if (tv.ri == 1) {
			res->rs.s = entry->dst_uri.s; 
			res->rs.len = entry->dst_uri.len;
		} else if (tv.ri == 2) {
			if (entry->attrs.s) {
				res->rs.s = entry->attrs.s; 
				res->rs.len = entry->attrs.len;
			} else
				return pv_get_null(msg, ip, res);
		} else if (tv.ri == 3) {
			if (entry->script_attrs.s) {
				res->rs.s = entry->script_attrs.s; 
				res->rs.len = entry->script_attrs.len;
			} else
				return pv_get_null(msg, ip, res);
		} else
			return pv_get_null(msg, ip, res);
	} else {
		if (tv.rs.len == 7 && 
		memcmp(tv.rs.s,"dst_uri",7) == 0) {
			res->rs.s = entry->dst_uri.s; 
			res->rs.len = entry->dst_uri.len;
		} else if (tv.rs.len == 5 && 
		memcmp(tv.rs.s,"attrs",5) == 0) {
			res->rs.s = entry->attrs.s; 
			res->rs.len = entry->attrs.len;
		} else if (tv.rs.len == 12 && 
		memcmp(tv.rs.s,"script_attrs",12) == 0) {
			res->rs.s = entry->script_attrs.s; 
			res->rs.len = entry->script_attrs.len;
		} else 
			return pv_get_null(msg, ip, res);
	}

	return 0;
}
