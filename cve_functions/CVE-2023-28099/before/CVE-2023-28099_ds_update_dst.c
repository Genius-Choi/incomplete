int ds_update_dst(struct sip_msg *msg, str *uri, struct socket_info *sock,
																	int mode)
{
	uri_type utype;
	int typelen;
	str s;

	switch(mode)
	{
		case 1:
			utype = str2uri_type(uri->s);
			if (utype == ERROR_URI_T) {
				LM_ERR("Unknown uri type\n");
				return -1;
			}
			typelen = uri_typestrlen(utype);
			s.s = uri->s + typelen + 1;
			s.len = uri->len - typelen - 1;

			if (rewrite_ruri(msg, &s, 0, RW_RURI_HOSTPORT) < 0) {
				LM_ERR("error while setting host\n");
				return -1;
			}

			break;
		default:
			if (set_dst_uri(msg, uri) < 0) {
				LM_ERR("error while setting dst uri\n");
				return -1;
			}
		break;
	}
	if (sock)
		msg->force_send_socket = sock;
	return 0;
}
