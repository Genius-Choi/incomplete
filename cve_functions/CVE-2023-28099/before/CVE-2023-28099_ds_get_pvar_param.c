ds_pvar_param_p ds_get_pvar_param(int id, str uri)
{
	str str_id, name;	
	str_id.s = int2str(id, &str_id.len);
	int len = ds_pattern_prefix.len + ds_pattern_infix.len + ds_pattern_suffix.len 
				+ uri.len + str_id.len;

	char buf[len]; /* XXX: check if this works for all compilers */
	ds_pvar_param_p param;

	if (ds_pattern_one>DS_PATTERN_NONE) {
		name.len = 0;
		name.s = buf;
		memcpy(buf, ds_pattern_prefix.s, ds_pattern_prefix.len);
		name.len = ds_pattern_prefix.len;
		if (ds_pattern_one==DS_PATTERN_ID) {
			memcpy(name.s + name.len, str_id.s, str_id.len);
			name.len += str_id.len;
		} else if (ds_pattern_one==DS_PATTERN_URI) {
			memcpy(name.s + name.len, uri.s, uri.len);
			name.len += uri.len;
		}
		memcpy(name.s + name.len, ds_pattern_infix.s, ds_pattern_infix.len);
		name.len += ds_pattern_infix.len;
		if (ds_pattern_two==DS_PATTERN_ID) {
			memcpy(name.s + name.len, str_id.s, str_id.len);
			name.len += str_id.len;
		} else if (ds_pattern_two==DS_PATTERN_URI) {
			memcpy(name.s + name.len, uri.s, uri.len);
			name.len += uri.len;
		}
		memcpy(name.s + name.len, ds_pattern_suffix.s, ds_pattern_suffix.len);
		name.len += ds_pattern_suffix.len;
	}

	param = shm_malloc(sizeof(ds_pvar_param_t));
	if (!param) {
		LM_ERR("no more shm memory\n");
		return NULL;
	}

	if (!pv_parse_spec(ds_pattern_one>DS_PATTERN_NONE ? &name : &ds_pattern_prefix,
	&param->pvar)) {
		LM_ERR("cannot parse pattern spec\n");
		shm_free(param);
		return NULL;
	}

	return param;
}
