void lcdSetCallbacks_ArrayBuffer(JsGraphics *gfx) {
  JsVar *buf = jsvObjectGetChild(gfx->graphicsVar, "buffer", 0);
#ifndef SAVE_ON_FLASH
  size_t len = 0;
  char *dataPtr = jsvGetDataPointer(buf, &len);
#endif
  jsvUnLock(buf);
#ifndef SAVE_ON_FLASH
  if (dataPtr && len>=graphicsGetMemoryRequired(gfx)) {
    // nice fast mode
    gfx->backendData = dataPtr;
    gfx->setPixel = lcdSetPixel_ArrayBuffer_flat;
    gfx->getPixel = lcdGetPixel_ArrayBuffer_flat;
    gfx->fillRect = lcdFillRect_ArrayBuffer_flat;
#else
  if (false) {
#endif
  } else if (jsvIsArrayBuffer(buf)) {
    /* NOTE: This is nasty as 'buf' is not locked. HOWEVER we know that
     gfx->graphicsVar IS locked, so 'buf' isn't going anywhere */
    gfx->backendData = buf;
    gfx->setPixel = lcdSetPixel_ArrayBuffer;
    gfx->getPixel = lcdGetPixel_ArrayBuffer;
    gfx->fillRect = lcdFillRect_ArrayBuffer;
  }
}
