static int send_error(struct MHD_Connection *connection, int error)
{
	struct MHD_Response *response = NULL;

	/* cannot automate since cannot translate automagically between error number and MHD's status codes
	 * -- and cannot rely on MHD_HTTP_ values to provide an upper bound for an array
	 */
	const char *page_200 = "<br>OK<br>";
	const char *page_400 = "<html><head><title>Error 400</title></head><body><h1>Error 400 - Bad Request</h1></body></html>";
	const char *page_403 = "<html><head><title>Error 403</title></head><body><h1>Error 403 - Forbidden - Access Denied to this Client!</h1></body></html>";
	const char *page_404 = "<html><head><title>Error 404</title></head><body><h1>Error 404 - Not Found</h1></body></html>";
	const char *page_500 = "<html><head><title>Error 500</title></head><body><h1>Error 500 - Internal Server Error: Oh No!</h1></body></html>";
	const char *page_501 = "<html><head><title>Error 501</title></head><body><h1>Error 501 - Not Implemented</h1></body></html>";
	const char *page_503 = "<html><head><title>Error 503</title></head><body><h1>Error 503 - Service Unavailable. This may be a temporary condition."
		"</h1></body></html>";
	char *page_511;
	char *cmd;
	const char *mimetype = lookup_mimetype("foo.html");
	char ip[INET6_ADDRSTRLEN+1];

	int ret = MHD_NO;
	s_config *config = config_get_config();

	switch (error) {
	case 200:
		response = MHD_create_response_from_buffer(strlen(page_200), (char *)page_200, MHD_RESPMEM_MUST_COPY);
		MHD_add_response_header(response, "Content-Type", mimetype);
		ret = MHD_queue_response(connection, error, response);
		break;

	case 400:
		response = MHD_create_response_from_buffer(strlen(page_400), (char *)page_400, MHD_RESPMEM_MUST_COPY);
		MHD_add_response_header(response, "Content-Type", mimetype);
		ret = MHD_queue_response(connection, MHD_HTTP_BAD_REQUEST, response);
		break;

	case 403:
		response = MHD_create_response_from_buffer(strlen(page_403), (char *)page_403, MHD_RESPMEM_MUST_COPY);
		MHD_add_response_header(response, "Content-Type", mimetype);
		ret = MHD_queue_response(connection, MHD_HTTP_FORBIDDEN, response);
		break;

	case 404:
		response = MHD_create_response_from_buffer(strlen(page_404), (char *)page_404, MHD_RESPMEM_MUST_COPY);
		MHD_add_response_header(response, "Content-Type", mimetype);
		ret = MHD_queue_response(connection, MHD_HTTP_NOT_FOUND, response);
		break;

	case 500:
		response = MHD_create_response_from_buffer(strlen(page_500), (char *)page_500, MHD_RESPMEM_MUST_COPY);
		MHD_add_response_header(response, "Content-Type", mimetype);
		ret = MHD_queue_response(connection, MHD_HTTP_INTERNAL_SERVER_ERROR, response);
		break;

	case 501:
		response = MHD_create_response_from_buffer(strlen(page_501), (char *)page_501, MHD_RESPMEM_MUST_COPY);
		MHD_add_response_header(response, "Content-Type", mimetype);
		ret = MHD_queue_response(connection, MHD_HTTP_NOT_IMPLEMENTED, response);
		break;
	case 503:
		debug(LOG_INFO, "503: [%s] ", (char *)page_503);
		response = MHD_create_response_from_buffer(strlen(page_503), (char *)page_503, MHD_RESPMEM_MUST_COPY);
		MHD_add_response_header(response, "Content-Type", mimetype);
		ret = MHD_queue_response(connection, MHD_HTTP_SERVICE_UNAVAILABLE, response);
		break;
	case 511:
		get_client_ip(ip, connection);

		page_511 = safe_calloc(HTMLMAXSIZE);

		if (!page_511) {
			ret = send_error(connection, 503);
			free(page_511);
			break;
		}

		cmd = safe_calloc(SMALL_BUF);
		safe_asprintf(&cmd, "%s err511 '%s'", config->status_path, ip);

		if (execute_ret_url_encoded(page_511, HTMLMAXSIZE - 1, cmd) == 0) {
			debug(LOG_INFO, "Network Authentication Required - page_511 html generated for [%s]", ip);
		} else {
			debug(LOG_WARNING, "Script: %s - failed to execute", config->status_path);
			ret = send_error(connection, 503);
			free(cmd);
			free(page_511);
			return ret;
		}

		free(cmd);

		response = MHD_create_response_from_buffer(strlen(page_511), (char *)page_511, MHD_RESPMEM_MUST_FREE);

		if (response) {
			MHD_add_response_header(response, "Content-Type", mimetype);
			MHD_add_response_header(response, MHD_HTTP_HEADER_CONNECTION, "close");
			ret = MHD_queue_response(connection, MHD_HTTP_NETWORK_AUTHENTICATION_REQUIRED, response);

			if (ret == MHD_NO) {
				debug(LOG_ERR, "send_error 511: Error queueing response");
			} else {
				debug(LOG_DEBUG, "send_error 511: Response is Queued");
			}

			break;
		}

		debug(LOG_ERR, "send_error 511: Error queueing response");
		break;
	}

	if (response)
		MHD_destroy_response(response);
	return ret;
}
