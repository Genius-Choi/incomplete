static INLINE UINT32 ExtractRunLength(UINT32 code, const BYTE* pbOrderHdr, const BYTE* pbEnd,
                                      UINT32* advance)
{
	UINT32 runLength = 0;
	UINT32 ladvance = 1;

	WINPR_ASSERT(pbOrderHdr);
	WINPR_ASSERT(pbEnd);
	WINPR_ASSERT(advance);

	*advance = 0;
	if (!buffer_within_range(pbOrderHdr, 0, pbEnd))
		return 0;

	switch (code)
	{
		case REGULAR_FGBG_IMAGE:
			runLength = ExtractRunLengthRegularFgBg(pbOrderHdr, pbEnd, &ladvance);
			break;

		case LITE_SET_FG_FGBG_IMAGE:
			runLength = ExtractRunLengthLiteFgBg(pbOrderHdr, pbEnd, &ladvance);
			break;

		case REGULAR_BG_RUN:
		case REGULAR_FG_RUN:
		case REGULAR_COLOR_RUN:
		case REGULAR_COLOR_IMAGE:
			runLength = ExtractRunLengthRegular(pbOrderHdr, pbEnd, &ladvance);
			break;

		case LITE_SET_FG_FG_RUN:
		case LITE_DITHERED_RUN:
			runLength = ExtractRunLengthLite(pbOrderHdr, pbEnd, &ladvance);
			break;

		case MEGA_MEGA_BG_RUN:
		case MEGA_MEGA_FG_RUN:
		case MEGA_MEGA_SET_FG_RUN:
		case MEGA_MEGA_DITHERED_RUN:
		case MEGA_MEGA_COLOR_RUN:
		case MEGA_MEGA_FGBG_IMAGE:
		case MEGA_MEGA_SET_FGBG_IMAGE:
		case MEGA_MEGA_COLOR_IMAGE:
			runLength = ExtractRunLengthMegaMega(pbOrderHdr, pbEnd, &ladvance);
			break;

		default:
			runLength = 0;
			ladvance = 0;
			break;
	}

	*advance = ladvance;
	return runLength;
}
