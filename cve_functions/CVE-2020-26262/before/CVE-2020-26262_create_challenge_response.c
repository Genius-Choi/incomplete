static int create_challenge_response(ts_ur_super_session *ss, stun_tid *tid, int *resp_constructed,
				int *err_code, 	const uint8_t **reason,
				ioa_network_buffer_handle nbh,
				uint16_t method)
{
	size_t len = ioa_network_buffer_get_size(nbh);
	stun_init_error_response_str(method, ioa_network_buffer_data(nbh), &len, *err_code, *reason, tid);
	*resp_constructed = 1;
	stun_attr_add_str(ioa_network_buffer_data(nbh), &len, STUN_ATTRIBUTE_NONCE,
					ss->nonce, (int)(NONCE_MAX_SIZE-1));
	char *realm = ss->realm_options.name;
	stun_attr_add_str(ioa_network_buffer_data(nbh), &len, STUN_ATTRIBUTE_REALM,
					(uint8_t*)realm, (int)(strlen((char*)(realm))));

	if(ss->server) {
		turn_turnserver* server = (turn_turnserver*)ss->server;
		if(server->oauth) {
			const char *server_name = server->oauth_server_name;
			if(!(server_name && server_name[0])) {
				server_name = realm;
			}
			stun_attr_add_str(ioa_network_buffer_data(nbh), &len,
    			STUN_ATTRIBUTE_THIRD_PARTY_AUTHORIZATION,
    			(const uint8_t*)(server_name),
    			strlen(server_name));
		}
    }

	ioa_network_buffer_set_size(nbh,len);
	return 0;
}
