verify_server_checksum(krb5_context context, const krb5_pac pac,
                       const krb5_keyblock *server)
{
    krb5_error_code ret;
    krb5_data copy;             /* PAC with zeroed checksums */

    ret = krb5int_copy_data_contents(context, &pac->data, &copy);
    if (ret)
        return ret;

    /* Zero out both checksum buffers */
    ret = zero_signature(context, pac, KRB5_PAC_SERVER_CHECKSUM, &copy);
    if (ret)
        goto cleanup;
    ret = zero_signature(context, pac, KRB5_PAC_PRIVSVR_CHECKSUM, &copy);
    if (ret)
        goto cleanup;

    ret = verify_checksum(context, pac, KRB5_PAC_SERVER_CHECKSUM, server,
                          KRB5_KEYUSAGE_APP_DATA_CKSUM, &copy);

cleanup:
    free(copy.data);
    return ret;
}
