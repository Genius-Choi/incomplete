delete_search_result_set( Slapi_PBlock *pb, back_search_result_set **sr )
{
    int rc = 0, filt_errs = 0;
    if ( NULL == sr || NULL == *sr )
    {
        return;
    }
    if (pb) {
        if (op_is_pagedresults(pb->pb_op)) {
            /* If the op is pagedresults, let the module clean up sr. */
            return;
        }
        pagedresults_set_search_result_pb(pb, NULL, 0);
        slapi_pblock_set(pb, SLAPI_SEARCH_RESULT_SET, NULL);
    }
    if ( NULL != (*sr)->sr_candidates )
    {
        idl_free( &((*sr)->sr_candidates) );
    }
    rc = slapi_filter_apply((*sr)->sr_norm_filter, ldbm_search_free_compiled_filter,
                            NULL, &filt_errs);
    if (rc != SLAPI_FILTER_SCAN_NOMORE) {
        LDAPDebug2Args(LDAP_DEBUG_ANY,
                       "ERROR: could not free the pre-compiled regexes in the search filter - error %d %d\n",
                       rc, filt_errs);
    }
    slapi_filter_free((*sr)->sr_norm_filter, 1);
    memset( *sr, 0, sizeof( back_search_result_set ) );
    slapi_ch_free( (void**)sr );
    return;
}
