static int ifdownup(const char *dev, int up, int checkonly) {
	int fd, ret = -1;
	if((fd = socket(AF_INET, SOCK_DGRAM, 0)) < 0) return -1;
	struct ifreq ifr = {0};
	strcpy(ifr.ifr_name, dev);
	if(ioctl(fd, SIOCGIFFLAGS, &ifr) <0) goto done;
	int isup = ifr.ifr_flags & IFF_UP;
	if((up && isup) || (!up && !isup)) ret = 2;
	else if (checkonly) ret = 0;
	else {
		if(up) ifr.ifr_flags |= IFF_UP;
		else   ifr.ifr_flags &= ~(IFF_UP);
		ret = (ioctl(fd, SIOCSIFFLAGS, &ifr) >= 0);
	}
	done:
	close(fd);
	return ret;
}
