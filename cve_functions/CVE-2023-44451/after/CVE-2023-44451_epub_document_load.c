epub_document_load (EvDocument* document,
                    const char* uri,
                    GError**    error)
{
	EpubDocument *epub_document = EPUB_DOCUMENT(document);
	GError *err = NULL;

	if ( check_mime_type (uri, &err) == FALSE )
	{
		/*Error would've been set by the function*/
		g_propagate_error(error,err);
		return FALSE;
	}

	extract_epub_from_container (uri,epub_document,&err);

	if ( err )
	{
		g_propagate_error( error,err );
		return FALSE;
	}

	/*FIXME : can this be different, ever?*/
	GString *containerpath = g_string_new(epub_document->tmp_archive_dir);
	g_string_append_printf(containerpath,"/META-INF/container.xml");
	gchar *containeruri = g_filename_to_uri(containerpath->str,NULL,&err);
	g_string_free (containerpath, TRUE);

	if ( err )
	{
		g_propagate_error(error,err);
		return FALSE;
	}

	gchar *contentOpfUri = get_uri_to_content (containeruri,&err,epub_document);
	g_free (containeruri);

	if ( contentOpfUri == NULL )
	{
		g_propagate_error(error,err);
		return FALSE;
	}

	epub_document->docTitle = epub_document_set_document_title(contentOpfUri);
	epub_document->index = setup_document_index(epub_document,contentOpfUri);

	epub_document->contentList = setup_document_content_list (contentOpfUri,&err,epub_document->documentdir);

    if (epub_document->index != NULL && epub_document->contentList != NULL)
	    epub_document_set_index_pages(epub_document->index, epub_document->contentList);

    epub_document_add_mathJax(contentOpfUri,epub_document->documentdir);
	g_free (contentOpfUri);

	if ( epub_document->contentList == NULL )
	{
		g_propagate_error(error,err);
		return FALSE;
	}

	return TRUE;
}
