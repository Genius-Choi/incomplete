epub_document_add_mathJax(gchar* containeruri,gchar* documentdir)
{
	gchar *containerfilename= g_filename_from_uri(containeruri,NULL,NULL);
	GString *mathjaxdir = g_string_new(MATHJAX_DIRECTORY);

	gchar *mathjaxref = g_filename_to_uri(mathjaxdir->str,NULL,NULL);
	gchar *nodedata = g_strdup_printf("%s/MathJax.js?config=TeX-AMS-MML_SVG",mathjaxref);

	open_xml_document(containerfilename);
	set_xml_root_node(NULL);
	xmlNodePtr manifest = xml_get_pointer_to_node((xmlChar*)"manifest",NULL,NULL);

	xmlNodePtr item = manifest->xmlChildrenNode;

	while (item != NULL) {
		if (xmlStrcmp(item->name,(xmlChar*)"item")) {
			item = item->next;
			continue;
		}

		xmlChar *mathml = xml_get_data_from_node(item,XML_ATTRIBUTE, (xmlChar*)"properties");

		if (mathml != NULL &&
		    !xmlStrcmp(mathml, (xmlChar*)"mathml") ) {
			gchar *href = (gchar*)xml_get_data_from_node(item, XML_ATTRIBUTE, (xmlChar*)"href");
			gchar *filename = g_strdup_printf("%s/%s",documentdir,href);

			add_mathjax_script_node_to_file(filename,nodedata);
			g_free(href);
			g_free(filename);
		}
		g_free(mathml);
		item = item->next;
	}
	xml_free_doc();
	g_free(mathjaxref);
	g_free(containerfilename);
	g_free(nodedata);
	g_string_free(mathjaxdir,TRUE);
}
