fu_plugin_runner_startup(FuPlugin *self, FuProgress *progress, GError **error)
{
	FuPluginPrivate *priv = GET_PRIVATE(self);
	FuPluginVfuncs *vfuncs = fu_plugin_get_vfuncs(self);
	g_autofree gchar *config_filename = fu_plugin_get_config_filename(self);
	g_autoptr(GError) error_local = NULL;
	g_autoptr(GFile) file = g_file_new_for_path(config_filename);

	g_return_val_if_fail(FU_IS_PLUGIN(self), FALSE);

	/* progress */
	fu_progress_set_name(progress, fu_plugin_get_name(self));

	/* be helpful for unit tests */
	fu_plugin_runner_init(self);

	/* not enabled */
	if (fu_plugin_has_flag(self, FWUPD_PLUGIN_FLAG_DISABLED))
		return TRUE;

	/* optional */
	if (vfuncs->startup == NULL)
		return TRUE;
	g_debug("startup(%s)", fu_plugin_get_name(self));
	if (!vfuncs->startup(self, progress, &error_local)) {
		if (error_local == NULL) {
			g_critical("unset plugin error in startup(%s)", fu_plugin_get_name(self));
			g_set_error_literal(&error_local,
					    FWUPD_ERROR,
					    FWUPD_ERROR_INTERNAL,
					    "unspecified error");
		}
		g_propagate_prefixed_error(error,
					   g_steal_pointer(&error_local),
					   "failed to startup using %s: ",
					   fu_plugin_get_name(self));
		return FALSE;
	}

	/* create a monitor on the config file */
	priv->config_monitor = g_file_monitor_file(file, G_FILE_MONITOR_NONE, NULL, error);
	if (priv->config_monitor == NULL)
		return FALSE;
	g_signal_connect(G_FILE_MONITOR(priv->config_monitor),
			 "changed",
			 G_CALLBACK(fu_plugin_config_monitor_changed_cb),
			 self);

	/* success */
	return TRUE;
}
