static int decode_bgp_mup_nlri_variable_prefix(proto_tree *tree, tvbuff_t *tvb, gint offset, packet_info *pinfo, guint16 afi) {

    int reader_offset = offset;
    guint32 total_length = 0;

    int         byte_length;
    ws_in4_addr ipv4_prefix;
    address     ipv4_prefix_addr;
    ws_in6_addr ipv6_prefix;
    address     ipv6_prefix_addr;
    gchar       *prefix_str;
    guint8      prefix_length;

    prefix_length = tvb_get_guint8(tvb, reader_offset);
    proto_tree_add_item(tree, hf_bgp_mup_nlri_prefixlen, tvb, reader_offset, 1, ENC_BIG_ENDIAN);
    reader_offset++;

    switch (afi) {
    case AFNUM_INET:
        byte_length = tvb_get_ipv4_addr_with_prefix_len(tvb, reader_offset, &ipv4_prefix, prefix_length);
        if (byte_length == -1) {
            proto_tree_add_expert_format(tree, pinfo, &ei_bgp_prefix_length_invalid, tvb, reader_offset, -1,
                                         "IPv4 prefix has an invalid length: %d bits", prefix_length);
            return -1;
        }
        set_address(&ipv4_prefix_addr, AT_IPv4, 4, &ipv4_prefix);
        prefix_str = address_to_str(pinfo->pool, &ipv4_prefix_addr);
        proto_tree_add_ipv4_format_value(tree, hf_bgp_mup_nlri_ip_prefix, tvb, reader_offset, byte_length,
                                         ipv4_prefix, "%s/%d", prefix_str, prefix_length);
        reader_offset += byte_length;
        break;

    case AFNUM_INET6:
        byte_length = tvb_get_ipv6_addr_with_prefix_len(tvb, reader_offset, &ipv6_prefix, prefix_length);
        if (byte_length == -1) {
            proto_tree_add_expert_format(tree, pinfo, &ei_bgp_prefix_length_invalid, tvb, reader_offset, -1,
                                         "IPv6 prefix has an invalid length: %d bits", prefix_length);
            return -1;
        }
        set_address(&ipv6_prefix_addr, AT_IPv6, 16, ipv6_prefix.bytes);
        prefix_str = address_to_str(pinfo->pool, &ipv6_prefix_addr);
        proto_tree_add_ipv6_format_value(tree, hf_bgp_mup_nlri_ipv6_prefix, tvb, reader_offset, byte_length,
                                         &ipv6_prefix, "%s/%d", prefix_str, prefix_length);
        reader_offset += byte_length;
        break;
    }
    total_length = reader_offset - offset;
    return total_length;
}
