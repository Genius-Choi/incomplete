f_sign_place(typval_T *argvars, typval_T *rettv)
{
    int		sign_id;
    char_u	*group = NULL;
    char_u	*sign_name;
    buf_T	*buf;
    dict_T	*dict;
    dictitem_T	*di;
    linenr_T	lnum = 0;
    int		prio = SIGN_DEF_PRIO;
    int		notanum = FALSE;

    rettv->vval.v_number = -1;

    // Sign identifer
    sign_id = (int)tv_get_number_chk(&argvars[0], &notanum);
    if (notanum)
	return;
    if (sign_id < 0)
    {
	emsg(_(e_invarg));
	return;
    }

    // Sign group
    group = tv_get_string_chk(&argvars[1]);
    if (group == NULL)
	return;
    if (group[0] == '\0')
	group = NULL;			// global sign group
    else
    {
	group = vim_strsave(group);
	if (group == NULL)
	    return;
    }

    // Sign name
    sign_name = tv_get_string_chk(&argvars[2]);
    if (sign_name == NULL)
	goto cleanup;

    // Buffer to place the sign
    buf = get_buf_arg(&argvars[3]);
    if (buf == NULL)
	goto cleanup;

    if (argvars[4].v_type != VAR_UNKNOWN)
    {
	if (argvars[4].v_type != VAR_DICT ||
				((dict = argvars[4].vval.v_dict) == NULL))
	{
	    emsg(_(e_dictreq));
	    goto cleanup;
	}

	// Line number where the sign is to be placed
	if ((di = dict_find(dict, (char_u *)"lnum", -1)) != NULL)
	{
	    (void)tv_get_number_chk(&di->di_tv, &notanum);
	    if (notanum)
		goto cleanup;
	    lnum = tv_get_lnum(&di->di_tv);
	}
	if ((di = dict_find(dict, (char_u *)"priority", -1)) != NULL)
	{
	    // Sign priority
	    prio = (int)tv_get_number_chk(&di->di_tv, &notanum);
	    if (notanum)
		goto cleanup;
	}
    }

    if (sign_place(&sign_id, group, sign_name, buf, lnum, prio) == OK)
	rettv->vval.v_number = sign_id;

cleanup:
    vim_free(group);
}
