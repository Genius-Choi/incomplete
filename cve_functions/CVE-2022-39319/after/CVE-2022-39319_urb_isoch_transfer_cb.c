static void urb_isoch_transfer_cb(IUDEVICE* pdev, URBDRC_CHANNEL_CALLBACK* callback, wStream* out,
                                  UINT32 InterfaceId, BOOL noAck, UINT32 MessageId,
                                  UINT32 RequestId, UINT32 NumberOfPackets, UINT32 status,
                                  UINT32 StartFrame, UINT32 ErrorCount, UINT32 OutputBufferSize)
{
	if (!noAck)
	{
		UINT32 packetSize = (status == 0) ? NumberOfPackets * 12 : 0;
		Stream_SetPosition(out, 0);
		/* fill the send data */
		Stream_Write_UINT32(out, InterfaceId); /** interface */
		Stream_Write_UINT32(out, MessageId);   /** message id */

		if (OutputBufferSize == 0)
			Stream_Write_UINT32(out, URB_COMPLETION_NO_DATA); /** function id */
		else
			Stream_Write_UINT32(out, URB_COMPLETION); /** function id */

		Stream_Write_UINT32(out, RequestId);       /** RequestId */
		Stream_Write_UINT32(out, 20 + packetSize); /** CbTsUrbResult */
		/** TsUrbResult TS_URB_RESULT_HEADER */
		Stream_Write_UINT16(out, 20 + packetSize); /** Size */
		Stream_Write_UINT16(out, 0);               /* Padding */
		Stream_Write_UINT32(out, status);          /** UsbdStatus */
		Stream_Write_UINT32(out, StartFrame);      /** StartFrame */

		if (status == 0)
		{
			/** NumberOfPackets */
			Stream_Write_UINT32(out, NumberOfPackets);
			Stream_Write_UINT32(out, ErrorCount); /** ErrorCount */
			Stream_Seek(out, packetSize);
		}
		else
		{
			Stream_Write_UINT32(out, 0);          /** NumberOfPackets */
			Stream_Write_UINT32(out, ErrorCount); /** ErrorCount */
		}

		Stream_Write_UINT32(out, 0);                /** HResult */
		Stream_Write_UINT32(out, OutputBufferSize); /** OutputBufferSize */
		Stream_Seek(out, OutputBufferSize);

		stream_write_and_free(callback->plugin, callback->channel, out);
	}
}
