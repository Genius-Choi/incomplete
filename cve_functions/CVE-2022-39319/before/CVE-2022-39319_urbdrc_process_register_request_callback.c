static UINT urbdrc_process_register_request_callback(IUDEVICE* pdev,
                                                     URBDRC_CHANNEL_CALLBACK* callback, wStream* s,
                                                     IUDEVMAN* udevman)
{
	UINT32 NumRequestCompletion = 0;
	UINT32 RequestCompletion = 0;
	URBDRC_PLUGIN* urbdrc;

	if (!callback || !s || !udevman || !pdev)
		return ERROR_INVALID_PARAMETER;

	urbdrc = (URBDRC_PLUGIN*)callback->plugin;

	if (!urbdrc)
		return ERROR_INVALID_PARAMETER;

	WLog_Print(urbdrc->log, WLOG_DEBUG, "urbdrc_process_register_request_callback");

	if (Stream_GetRemainingLength(s) >= 8)
	{
		Stream_Read_UINT32(s, NumRequestCompletion); /** must be 1 */
		/** RequestCompletion:
		 *   unique Request Completion interface for the client to use */
		Stream_Read_UINT32(s, RequestCompletion);
		pdev->set_ReqCompletion(pdev, RequestCompletion);
	}
	else if (Stream_GetRemainingLength(s) >= 4) /** Unregister the device */
	{
		Stream_Read_UINT32(s, RequestCompletion);

		if (pdev->get_ReqCompletion(pdev) == RequestCompletion)
			pdev->setChannelClosed(pdev);
	}
	else
		return ERROR_INVALID_DATA;

	return ERROR_SUCCESS;
}
