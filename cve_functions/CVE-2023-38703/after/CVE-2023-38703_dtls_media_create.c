static pj_status_t dtls_media_create( pjmedia_transport *tp,
                                      pj_pool_t *sdp_pool,
                                      unsigned options,
                                      const pjmedia_sdp_session *sdp_remote,
                                      unsigned media_index)
{
    dtls_srtp *ds = (dtls_srtp*) tp;
    pj_status_t status = PJ_SUCCESS;

#if DTLS_DEBUG
    PJ_LOG(2,(ds->base.name, "dtls_media_create()"));
#endif

    PJ_UNUSED_ARG(sdp_pool);
    PJ_UNUSED_ARG(options);

    if (ds->srtp->offerer_side) {
        /* As offerer: do nothing. */
    } else {
        /* As answerer:
         *    Check for DTLS-SRTP support in remote SDP. Detect remote
         *    support of DTLS-SRTP by inspecting remote SDP offer for
         *    SDP a=fingerprint attribute. And currently we only support
         *    RTP/AVP transports.
         */
        pjmedia_sdp_media *m_rem = sdp_remote->media[media_index];
        pjmedia_sdp_attr *attr_fp;
        pj_uint32_t rem_proto = 0;

        /* Find SDP a=fingerprint line. */
        attr_fp = pjmedia_sdp_media_find_attr(m_rem, &ID_FINGERPRINT, NULL);
        if (!attr_fp)
            attr_fp = pjmedia_sdp_attr_find(sdp_remote->attr_count,
                                            sdp_remote->attr, &ID_FINGERPRINT,
                                            NULL);

        /* Get media transport proto */
        rem_proto = pjmedia_sdp_transport_get_proto(&m_rem->desc.transport);
        if (!PJMEDIA_TP_PROTO_HAS_FLAG(rem_proto, PJMEDIA_TP_PROTO_RTP_AVP) ||
            !attr_fp)
        {
            /* Remote doesn't signal DTLS-SRTP */
            status = PJMEDIA_SRTP_ESDPINTRANSPORT;
            goto on_return;
        }

        /* Check for a=fingerprint in remote SDP. */
        switch (ds->srtp->setting.use) {
            case PJMEDIA_SRTP_DISABLED:
                status = PJMEDIA_SRTP_ESDPINTRANSPORT;
                goto on_return;
                break;
            case PJMEDIA_SRTP_OPTIONAL:
                break;
            case PJMEDIA_SRTP_MANDATORY:
                break;
        }
    }

    /* Set remote cert fingerprint verification status to PJ_EPENDING */
    ds->rem_fprint_status = PJ_EPENDING;

on_return:
#if DTLS_DEBUG
    if (status != PJ_SUCCESS) {
        pj_perror(4, ds->base.name, status, "dtls_media_create() failed");
    }
#endif
    return status;
}
