static pj_status_t start_srtp(transport_srtp *srtp)
{
    /* Make sure we have the SRTP policies */
    if (srtp_crypto_empty(&srtp->srtp_ctx.tx_policy_neg) ||
        srtp_crypto_empty(&srtp->srtp_ctx.rx_policy_neg))
    {
        srtp->bypass_srtp = PJ_TRUE;
        srtp->peer_use = PJMEDIA_SRTP_DISABLED;
        if (srtp->session_inited) {
            pjmedia_transport_srtp_stop(&srtp->base);
        }

        PJ_LOG(4, (srtp->pool->obj_name, "SRTP not active"));
        return PJ_SUCCESS;
    }

    /* Got policy_local & policy_remote, let's initalize the SRTP */

    /* Ticket #1075: media_start() is called whenever media description
     * gets updated, e.g: call hold, however we should restart SRTP only
     * when the SRTP policy settings are updated.
     */
    if (srtp_crypto_cmp(&srtp->srtp_ctx.tx_policy_neg,
                        &srtp->srtp_ctx.tx_policy) ||
        srtp_crypto_cmp(&srtp->srtp_ctx.rx_policy_neg,
                        &srtp->srtp_ctx.rx_policy))
    {
        pj_status_t status;
        status = pjmedia_transport_srtp_start(&srtp->base,
                                              &srtp->srtp_ctx.tx_policy_neg,
                                              &srtp->srtp_ctx.rx_policy_neg);
        if (status != PJ_SUCCESS)
            return status;

        /* Reset probation counts */
        srtp->probation_cnt = PROBATION_CNT_INIT;

        PJ_LOG(4, (srtp->pool->obj_name,
                   "SRTP started, keying=%s, crypto=%s",
                   ((int)srtp->keying[0]->type==PJMEDIA_SRTP_KEYING_SDES?
                    "SDES":"DTLS-SRTP"),
                   srtp->srtp_ctx.tx_policy.name.ptr));
    }

    srtp->bypass_srtp = PJ_FALSE;

    return PJ_SUCCESS;
}
