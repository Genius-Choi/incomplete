void Http2FloodMitigationTest::setNetworkConnectionBufferSize() {
  // nghttp2 library has its own internal mitigation for outbound control frames. The mitigation is
  // triggered when there are more than 10000 PING or SETTINGS frames with ACK flag in the nghttp2
  // internal outbound queue. It is possible to trigger this mitigation in nghttp2 before triggering
  // Envoy's own flood mitigation. This can happen when a buffer larger enough to contain over 10K
  // PING or SETTINGS frames is dispatched to the nghttp2 library. To prevent this from happening
  // the network connection receive buffer needs to be smaller than 90Kb (which is 10K SETTINGS
  // frames). Set it to the arbitrarily chosen value of 32K.
  config_helper_.addConfigModifier([](envoy::config::bootstrap::v2::Bootstrap& bootstrap) -> void {
    RELEASE_ASSERT(bootstrap.mutable_static_resources()->listeners_size() >= 1, "");
    auto* listener = bootstrap.mutable_static_resources()->mutable_listeners(0);
    listener->mutable_per_connection_buffer_limit_bytes()->set_value(32 * 1024);
  });
}
