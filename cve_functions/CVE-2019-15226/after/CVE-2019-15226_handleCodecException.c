void ConnectionManagerImpl::handleCodecException(const char* error) {
  ENVOY_CONN_LOG(debug, "dispatch error: {}", read_callbacks_->connection(), error);

  // In the protocol error case, we need to reset all streams now. The connection might stick around
  // long enough for a pending stream to come back and try to encode.
  resetAllStreams();

  // HTTP/1.1 codec has already sent a 400 response if possible. HTTP/2 codec has already sent
  // GOAWAY.
  read_callbacks_->connection().close(Network::ConnectionCloseType::FlushWriteAndDelay);
}
