int IniSection::setMyValue (const YCPPath &p, const YCPValue&in, int what, int depth)
{
    // assert (depth == p->length ()); //not, it can have a .comment suffix
    string k = ip->changeCase (p->component_str (depth));
    pair <IniEntryIdxIterator, IniEntryIdxIterator> r =
	ivalues.equal_range (k);
    IniEntryIdxIterator xi = r.first, xe = r.second;

    // make sure we have a list of values
    YCPList props;
    if (ip->repeatNames ())
    {
	props = as_list (in, "section with repeat_names");
	if (props.isNull())
	    return -1;
    }
    else
    {
	props->add (in);
    }
    int pi = 0, pe = props->size ();

    // Go simultaneously through the found values
    // and the list of parameters, while _either_ lasts
    // Fewer values-> add them, more values-> delete them
    while (pi != pe || xi != xe)
    {
	// watch out for validity of iterators!

	if (pi == pe)
	{
	    // deleting a value
	    delValue1 (xi++);
	    // no ++pi
	}
	else
	{
	    YCPValue prop = props->value (pi);
	    IniIterator ei;
	    if (xi == xe)
	    {
		///need to add a value ...
		y2debug ("Adding value %s = %s",
			 p->toString ().c_str (), prop->toString().c_str ());
		if (what)
		{
		    y2error ("You must add value before changing comment/type. %s",
			     p->toString ().c_str ());
		    return -1;
		}
		// prepare it to have its property set
		// create it
		IniEntry e;
		// need to set its name
		e.setName (k);

		// insert and index
		container.push_back (IniContainerElement (e));
		ivalues.insert (IniEntryIndex::value_type (k, --container.end ()));
		ei = --container.end ();
	    }
	    else
	    {
		ei = xi->second;
	    }

	    // set a value's property
	    IniEntry & e = ei->e ();
	    switch (what)
	    {
		case 0:
		    e.setValue (to_string (prop));
		    break;
		case 1: {
		    YCPString s = as_string (prop, "comment");
		    if (s.isNull())
			return -1;
		    e.setComment (s->value());
		    break;
		}
		default: {
		    YCPInteger i = as_integer (prop, "value_type");
		    if (i.isNull())
			return -1;
		    e.setReadBy (i->value());
		    break;
		}
	    }

	    if (xi != xe)
	    {
		++xi;
	    }
	    ++pi;
	}
	// iterators have been advanced already
    }
    dirty = true;
    return 0;
}
