epub_document_get_info(EvDocument *document)
{
    EpubDocument *epub_document = EPUB_DOCUMENT(document);
    GError *error = NULL ;
    gchar* infofile ;
    xmlNodePtr metanode ;
    GString* buffer ;

    GString* containerpath = g_string_new(epub_document->tmp_archive_dir);
    g_string_append_printf(containerpath,"/META-INF/container.xml");
    gchar* containeruri = g_filename_to_uri(containerpath->str,NULL,&error);
    g_string_free (containerpath, TRUE);
    if ( error )
    {
        return NULL ;
    }

    gchar* uri = get_uri_to_content (containeruri,&error,epub_document);
    g_free (containeruri);
    if ( error )
    {
        return NULL ;
    }

    EvDocumentInfo* epubinfo = g_new0 (EvDocumentInfo, 1);

    epubinfo->fields_mask = EV_DOCUMENT_INFO_TITLE |
                EV_DOCUMENT_INFO_FORMAT |
                EV_DOCUMENT_INFO_AUTHOR |
                EV_DOCUMENT_INFO_SUBJECT |
                EV_DOCUMENT_INFO_KEYWORDS |
                EV_DOCUMENT_INFO_LAYOUT |
                EV_DOCUMENT_INFO_CREATOR |
                EV_DOCUMENT_INFO_LINEARIZED |
                EV_DOCUMENT_INFO_PERMISSIONS |
                EV_DOCUMENT_INFO_N_PAGES ;

    infofile = g_filename_from_uri(uri,NULL,&error);
    g_free (uri);
    if ( error )
    {
        return epubinfo;
    }

    open_xml_document(infofile);
    g_free (infofile);

    set_xml_root_node((xmlChar*)"package");

    metanode = xml_get_pointer_to_node((xmlChar*)"title",NULL,NULL);
    if ( metanode == NULL )
        epubinfo->title = NULL ;
    else
        epubinfo->title = (char*)xml_get_data_from_node(metanode,XML_KEYWORD,NULL);

    metanode = xml_get_pointer_to_node((xmlChar*)"creator",NULL,NULL);
    if ( metanode == NULL )
        epubinfo->author = g_strdup("unknown");
    else
        epubinfo->author = (char*)xml_get_data_from_node(metanode,XML_KEYWORD,NULL);

    metanode = xml_get_pointer_to_node((xmlChar*)"subject",NULL,NULL);
    if ( metanode == NULL )
        epubinfo->subject = g_strdup("unknown");
    else
        epubinfo->subject = (char*)xml_get_data_from_node(metanode,XML_KEYWORD,NULL);

    buffer = g_string_new((gchar*)xml_get_data_from_node (xmlroot,XML_ATTRIBUTE,(xmlChar*)"version"));
    g_string_prepend(buffer,"epub ");
    epubinfo->format = g_string_free(buffer,FALSE);

    /*FIXME: Add more of these as you write the corresponding modules*/

    epubinfo->layout = EV_DOCUMENT_LAYOUT_SINGLE_PAGE;

    metanode = xml_get_pointer_to_node((xmlChar*)"publisher",NULL,NULL);
    if ( metanode == NULL )
        epubinfo->creator = g_strdup("unknown");
    else
        epubinfo->creator = (char*)xml_get_data_from_node(metanode,XML_KEYWORD,NULL);

    /* number of pages */
    epubinfo->n_pages = epub_document_get_n_pages(document);

    /*Copying*/
    epubinfo->permissions = EV_DOCUMENT_PERMISSIONS_OK_TO_COPY;
    /*TODO : Add a function to get date*/

    if (xmldocument)
        xml_free_doc();
    return epubinfo ;
}
