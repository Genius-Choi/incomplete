xrdp_mm_create(struct xrdp_wm *owner)
{
    struct xrdp_mm *self;

    self = (struct xrdp_mm *)g_malloc(sizeof(struct xrdp_mm), 1);
    self->wm = owner;
    self->login_names = list_create();
    self->login_names->auto_free = 1;
    self->login_values = list_create();
    self->login_values->auto_free = 1;

    self->uid = -1; /* Never good to default UIDs to 0 */

    LOG_DEVEL(LOG_LEVEL_INFO, "xrdp_mm_create: bpp %d mcs_connection_type %d "
              "jpeg_codec_id %d v3_codec_id %d rfx_codec_id %d "
              "h264_codec_id %d",
              self->wm->client_info->bpp,
              self->wm->client_info->mcs_connection_type,
              self->wm->client_info->jpeg_codec_id,
              self->wm->client_info->v3_codec_id,
              self->wm->client_info->rfx_codec_id,
              self->wm->client_info->h264_codec_id);

    if ((self->wm->client_info->gfx == 0) &&
            ((self->wm->client_info->h264_codec_id != 0) ||
             (self->wm->client_info->jpeg_codec_id != 0) ||
             (self->wm->client_info->rfx_codec_id != 0)))
    {
        self->encoder = xrdp_encoder_create(self);
    }

    return self;
}
