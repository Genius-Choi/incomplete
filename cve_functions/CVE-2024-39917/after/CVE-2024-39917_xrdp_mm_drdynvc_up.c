xrdp_mm_drdynvc_up(struct xrdp_mm *self)
{
    struct display_control_monitor_layout_data *ignore_marker;
    const char *enable_dynamic_resize;
    int error = 0;

    LOG_DEVEL(LOG_LEVEL_TRACE, "xrdp_mm_drdynvc_up:");

    error = egfx_initialize(self);
    if (error != 0)
    {
        return error;
    }

    enable_dynamic_resize = xrdp_mm_get_value(self, "enable_dynamic_resizing");
    /*
     * User can disable dynamic resizing if necessary
     */
    if (enable_dynamic_resize != NULL && enable_dynamic_resize[0] != '\0' &&
            !g_text2bool(enable_dynamic_resize))
    {
        LOG(LOG_LEVEL_INFO, "User has disabled dynamic resizing.");
        return error;
    }
    error = dynamic_monitor_initialize(self);
    if (error != 0)
    {
        LOG(LOG_LEVEL_INFO, "Dynamic monitor initialize failed."
            " Client likely does not support it.");
        return error;
    }
    ignore_marker = (struct display_control_monitor_layout_data *)
                    g_malloc(sizeof(struct display_control_monitor_layout_data),
                             1);
    list_add_item(self->resize_queue, (tintptr)ignore_marker);
    return error;
}
