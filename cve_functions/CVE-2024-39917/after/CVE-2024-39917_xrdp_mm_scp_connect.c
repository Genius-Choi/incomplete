xrdp_mm_scp_connect(struct xrdp_mm *self)
{
    char port[128];
    char port_description[128];
    struct trans *t;

    xrdp_mm_get_sesman_port(port, sizeof(port));
    scp_port_to_display_string(port,
                               port_description, sizeof(port_description));

    xrdp_wm_log_msg(self->wm, LOG_LEVEL_DEBUG,
                    "connecting to sesman on %s", port_description);
    t = scp_connect(port, "xrdp", g_is_term);
    if (t != NULL)
    {
        /* fully connected */
        t->trans_data_in = xrdp_mm_scp_data_in;
        t->callback_data = self;

        xrdp_wm_log_msg(self->wm, LOG_LEVEL_INFO, "sesman connect ok");
    }
    else
    {
        xrdp_wm_log_msg(self->wm, LOG_LEVEL_ERROR,
                        "Error connecting to sesman on %s", port_description);
        trans_delete(t);
        t = NULL;
    }
    return t;
}
