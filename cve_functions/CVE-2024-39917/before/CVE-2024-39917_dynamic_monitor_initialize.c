dynamic_monitor_initialize(struct xrdp_mm *self)
{
    struct xrdp_drdynvc_procs d_procs;
    int flags;
    int error;
    char buf[1024];
    int pid;

    LOG_DEVEL(LOG_LEVEL_TRACE, "dynamic_monitor_initialize:");

    g_memset(&d_procs, 0, sizeof(d_procs));
    d_procs.open_response = dynamic_monitor_open_response;
    d_procs.close_response = dynamic_monitor_close_response;
    d_procs.data_first = dynamic_monitor_data_first;
    d_procs.data = dynamic_monitor_data;
    flags = 0;
    error = libxrdp_drdynvc_open(self->wm->session,
                                 "Microsoft::Windows::RDS::DisplayControl",
                                 flags, &d_procs,
                                 &(self->dynamic_monitor_chanid));
    if (error != 0)
    {
        LOG(LOG_LEVEL_ERROR, "dynamic_monitor_initialize: "
            "libxrdp_drdynvc_open failed %d", error);
        return error;
    }

    // Initialize xrdp_mm specific variables.
    self->resize_queue = list_create();
    self->resize_queue->auto_free = 1;
    pid = g_getpid();
    /* setup wait objects for signaling */
    g_snprintf(buf, sizeof(buf), "xrdp_%8.8x_resize_ready", pid);
    self->resize_ready = g_create_wait_obj(buf);
    self->resize_data = NULL;

    return error;
}
