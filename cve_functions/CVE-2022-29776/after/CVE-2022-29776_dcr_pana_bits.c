unsigned DCR_CLASS dcr_pana_bits (DCRAW* p,int nbits)
{
  static uchar buf[0x4000];
  static int vbits;
  int byte;

  if (!nbits) return vbits=0;
  if (!vbits) {
    dcr_fread(p->obj_, buf+p->load_flags, 1, 0x4000-p->load_flags);
    dcr_fread(p->obj_, buf, 1, p->load_flags);
  }
  vbits = (vbits - nbits) & 0x1ffff;
  byte = vbits >> 3 ^ 0x3ff0;
  return (buf[byte] | buf[byte+1] << 8) >> (vbits & 7) & ~(-1 << nbits);
}
