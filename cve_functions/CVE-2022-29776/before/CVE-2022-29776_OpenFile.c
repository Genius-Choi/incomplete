    bool CFileBinary::OpenFile(const std::wstring& sFileName, bool bRewrite)
    {
#if defined(_WIN32) || defined(_WIN32_WCE) || defined(_WIN64)
        if ( 0 != _wfopen_s(&m_pFile, sFileName.c_str(), bRewrite ? L"rb+" : L"rb"))
            return false;
#else
        BYTE* pUtf8 = NULL;
        LONG lLen = 0;
        CUtf8Converter::GetUtf8StringFromUnicode(sFileName.c_str(), sFileName.length(), pUtf8, lLen, false);
        m_pFile = fopen((char*)pUtf8, bRewrite ? "rb+" : "rb");

        delete [] pUtf8;
#endif
        if (NULL == m_pFile)
            return false;

        fseek(m_pFile, 0, SEEK_END);
        m_lFileSize = ftell(m_pFile);
        fseek(m_pFile, 0, SEEK_SET);

        m_lFilePosition = 0;

        if (0 < sFileName.length())
        {
            if (((wchar_t)'/') == sFileName.c_str()[sFileName.length() - 1])
                m_lFileSize = 0x7FFFFFFF;
        }

        unsigned int err = 0x7FFFFFFF;
        unsigned int cur = (unsigned int)m_lFileSize;
        if (err == cur)
        {
            CloseFile();
            return false;
        }

        return true;
    }
