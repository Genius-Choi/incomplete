OJPEGVSetField(TIFF* tif, ttag_t tag, va_list ap)
{
	static const char module[]="OJPEGVSetField";
	OJPEGState* sp=(OJPEGState*)tif->tif_data;
	uint32 ma;
	uint32* mb;
	uint32 n;
	switch(tag)
	{
		case TIFFTAG_JPEGIFOFFSET:
			sp->jpeg_interchange_format=(toff_t)va_arg(ap,uint32);  
			break;
		case TIFFTAG_JPEGIFBYTECOUNT:
			sp->jpeg_interchange_format_length=(toff_t)va_arg(ap,uint32);  
			break;
		case TIFFTAG_YCBCRSUBSAMPLING:
			sp->subsampling_tag=1;
			sp->subsampling_hor=(uint8)va_arg(ap,int);
			sp->subsampling_ver=(uint8)va_arg(ap,int);
			tif->tif_dir.td_ycbcrsubsampling[0]=sp->subsampling_hor;
			tif->tif_dir.td_ycbcrsubsampling[1]=sp->subsampling_ver;
			break;
		case TIFFTAG_JPEGQTABLES:
			ma=va_arg(ap,uint32);
			if (ma!=0)
			{
				if (ma>3)
				{
					TIFFErrorExt(tif->tif_clientdata,module,"JpegQTables tag has incorrect count");
					return(0);
				}
				sp->qtable_offset_count=(uint8)ma;
				mb=va_arg(ap,uint32*);
				for (n=0; n<ma; n++)
					sp->qtable_offset[n]=(toff_t)mb[n];
			}
			break;
		case TIFFTAG_JPEGDCTABLES:
			ma=va_arg(ap,uint32);
			if (ma!=0)
			{
				if (ma>3)
				{
					TIFFErrorExt(tif->tif_clientdata,module,"JpegDcTables tag has incorrect count");
					return(0);
				}
				sp->dctable_offset_count=(uint8)ma;
				mb=va_arg(ap,uint32*);
				for (n=0; n<ma; n++)
					sp->dctable_offset[n]=(toff_t)mb[n];
			}
			break;
		case TIFFTAG_JPEGACTABLES:
			ma=va_arg(ap,uint32);
			if (ma!=0)
			{
				if (ma>3)
				{
					TIFFErrorExt(tif->tif_clientdata,module,"JpegAcTables tag has incorrect count");
					return(0);
				}
				sp->actable_offset_count=(uint8)ma;
				mb=va_arg(ap,uint32*);
				for (n=0; n<ma; n++)
					sp->actable_offset[n]=(toff_t)mb[n];
			}
			break;
		case TIFFTAG_JPEGPROC:
			sp->jpeg_proc=(uint8)va_arg(ap,uint32);
			break;
		case TIFFTAG_JPEGRESTARTINTERVAL:
			sp->restart_interval=(uint16)va_arg(ap,uint32);
			break;
		default:
			return (*sp->vsetparent)(tif,tag,ap);
	}
	TIFFSetFieldBit(tif,_TIFFFieldWithTag(tif,tag)->field_bit);
	tif->tif_flags|=TIFF_DIRTYDIRECT;
	return(1);
}
