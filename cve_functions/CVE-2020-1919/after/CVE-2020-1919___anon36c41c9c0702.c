    [&](StringBuffer& ret, const char* src, const char* /*end*/) {
      switch (*src) {
        case '.':
        case '\\':
        case '+':
        case '*':
        case '?':
        case '[':
        case ']':
        case '^':
        case '$':
        case '(':
        case ')':
          ret.append('\\');
        /* fall through */
        default:
          ret.append(*src);
      }
    });
