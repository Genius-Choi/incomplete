client_list_add_client(const char mac[], const char ip[])
{
	t_client *client;

	int rc = -1;
	char *libcmd;
	char *msg;

	if (!check_mac_format(mac)) {
		// Inappropriate format in IP address
		debug(LOG_NOTICE, "Illegal MAC format [%s]", mac);
		return NULL;
	}

	if (!check_ip_format(ip)) {
		// Inappropriate format in IP address
		debug(LOG_NOTICE, "Illegal IP format [%s]", ip);
		return NULL;
	}

	// check if client ip was allocated by dhcp
	libcmd = safe_calloc(SMALL_BUF);
	safe_snprintf(libcmd, SMALL_BUF, "/usr/lib/opennds/libopennds.sh dhcpcheck \"%s\"", ip);
	msg = safe_calloc(SMALL_BUF);
	rc = execute_ret_url_encoded(msg, SMALL_BUF, libcmd);
	free(libcmd);
	free(msg);

	if (rc > 0) {
		// IP address is not in the dhcp database
		debug(LOG_NOTICE, "IP not allocated by dhcp [%s]", ip);
		return NULL;
	}

	client = client_list_find(mac, ip);

	if (!client) {
		// add the client
		client = _client_list_append(mac, ip);
	} else {
		debug(LOG_INFO, "Client %s %s token %s already on client list", ip, mac, client->token);
	}

	return client;
}
