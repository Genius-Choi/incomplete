static INLINE BOOL NCrushFetchBits(const BYTE** SrcPtr, const BYTE** SrcEnd, INT32* nbits,
                                   UINT32* bits)
{
	WINPR_ASSERT(SrcPtr);
	WINPR_ASSERT(SrcEnd);
	WINPR_ASSERT(nbits);
	WINPR_ASSERT(bits);

	if (*nbits < 16)
	{
		if ((*SrcPtr + 1) >= *SrcEnd)
		{
			if (*SrcPtr >= *SrcEnd)
			{
				if (*nbits < 0)
					return FALSE;
			}
			else
			{
				*bits += *(*SrcPtr)++ << *nbits;
				*nbits += 8;
			}
		}
		else
		{
			UINT16 tmp = *(*SrcPtr)++;
			tmp |= (*(*SrcPtr)++) << 8;
			*bits += tmp << *nbits;
			*nbits += 16;
		}
	}

	return TRUE;
}
