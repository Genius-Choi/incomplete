static void test_bug11754979()
{
  MYSQL* conn;
  DBUG_ENTER("test_bug11754979");

  myheader("test_bug11754979");
  DIE_UNLESS((conn= mysql_client_init(NULL)));
  DIE_UNLESS(mysql_real_connect(conn, opt_host, opt_user,
             opt_password, opt_db ? opt_db:"test", opt_port,
             opt_unix_socket,  CLIENT_FOUND_ROWS));
  myquery(mysql_query(conn, "DROP TABLE IF EXISTS t1"));
  myquery(mysql_query(conn, "CREATE TABLE t1(id INT, label CHAR(1), PRIMARY KEY(id))"));
  myquery(mysql_query(conn, "INSERT INTO t1(id, label) VALUES (1, 'a')"));
  myquery(mysql_query(conn, "INSERT INTO t1(id, label) VALUES (1, 'a') "
                            "ON DUPLICATE KEY UPDATE id = 4"));
  DIE_UNLESS(mysql_affected_rows(conn) == 2);
  myquery(mysql_query(conn, "DROP TABLE t1"));
  mysql_close(conn);

  DBUG_VOID_RETURN;
}
