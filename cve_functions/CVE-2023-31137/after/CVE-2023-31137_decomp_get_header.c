int decomp_get_header(js_string *compressed, js_string *uncompressed) {
    int qdcount, ancount, nscount, arcount, total;

    /* Sanity checks */
    if(js_has_sanity(compressed) == JS_ERROR) {
        return JS_ERROR;
        }
    if(js_has_sanity(uncompressed) == JS_ERROR) {
        return JS_ERROR;
        }
    if(compressed->unit_count < 12) {
        return JS_ERROR;
        }
    if(uncompressed->unit_count != 0) {
        return JS_ERROR;
        }

    /* Get the number of questions */
    qdcount = js_readuint16(compressed,4);
    if(qdcount < 0 || qdcount > 1)
        return JS_ERROR;

    /* Get the number of answers */
    ancount = js_readuint16(compressed,6);
    if(ancount < 0 || ancount > 65535)
        return JS_ERROR;
    nscount = js_readuint16(compressed,8);
    if(nscount < 0 || nscount > 65535)
        return JS_ERROR;
    arcount = js_readuint16(compressed,10);
    if(arcount < 0 || arcount > 65535)
        return JS_ERROR;

    total = ancount + nscount + arcount;

    /* Copy the data over */
    if(decomp_append_bytes(compressed,uncompressed,0,12) != JS_SUCCESS)
        return JS_ERROR;

    /* Yes, some zone servers do this */
    if(qdcount == 0 && total >= 1)
        return -2 - total;

    /* And return the number of answers */
    if(qdcount == 0)
        return -2;

    return total;

    }
