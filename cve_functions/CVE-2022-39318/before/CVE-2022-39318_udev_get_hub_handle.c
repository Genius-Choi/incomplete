static int udev_get_hub_handle(URBDRC_PLUGIN* urbdrc, libusb_context* ctx, UDEVICE* pdev,
                               UINT16 bus_number, UINT16 dev_number)
{
	int error;
	ssize_t i, total_device;
	LIBUSB_DEVICE** libusb_list;
	LIBUSB_DEVICE_HANDLE* handle;
	total_device = libusb_get_device_list(ctx, &libusb_list);

	/* Look for device hub. */
	error = -1;

	for (i = 0; i < total_device; i++)
	{
		LIBUSB_DEVICE* dev = libusb_list[i];

		if ((bus_number != libusb_get_bus_number(dev)) ||
		    (1 != libusb_get_device_address(dev))) /* Root hub allways first on bus. */
			continue;

		WLog_Print(urbdrc->log, WLOG_DEBUG, "  Open hub: %" PRIu16 "", bus_number);
		error = libusb_open(dev, &handle);

		if (!log_libusb_result(urbdrc->log, WLOG_ERROR, "libusb_open", error))
			pdev->hub_handle = handle;

		break;
	}

	libusb_free_device_list(libusb_list, 1);

	if (error < 0)
		return -1;

	return 0;
}
