int parse_sip_msg_uri(struct sip_msg* msg)
{
	char* tmp;
	int tmp_len;
	if (msg->parsed_uri_ok) return 1;

	if (msg->new_uri.s){
		tmp=msg->new_uri.s;
		tmp_len=msg->new_uri.len;
	}else{
		tmp=msg->first_line.u.request.uri.s;
		tmp_len=msg->first_line.u.request.uri.len;
	}
	if (parse_uri(tmp, tmp_len, &msg->parsed_uri)<0){
		LM_ERR("bad uri <%.*s>\n", tmp_len, tmp);
		msg->parsed_uri_ok=0;
		set_err_info(OSER_EC_PARSER, OSER_EL_MEDIUM, "error parsing r-uri");
		set_err_reply(400, "bad r-uri");
		return -1;
	}
	msg->parsed_uri_ok=1;
	return 0;
}
