static uint16_t av_always_inline dng_process_color16(uint16_t value,
                                                     const uint16_t *lut,
                                                     uint16_t black_level,
                                                     float scale_factor) {
    float value_norm;

    // Lookup table lookup
    if (lut)
        value = lut[value];

    // Black level subtraction
    value = av_clip_uint16_c((unsigned)value - black_level);

    // Color scaling
    value_norm = (float)value * scale_factor;

    value = av_clip_uint16_c(value_norm * 65535);

    return value;
}
