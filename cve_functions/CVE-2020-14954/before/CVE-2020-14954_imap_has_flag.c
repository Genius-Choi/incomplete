bool imap_has_flag(struct ListHead *flag_list, const char *flag)
{
  if (STAILQ_EMPTY(flag_list))
    return false;

  const size_t flaglen = mutt_str_strlen(flag);
  struct ListNode *np = NULL;
  STAILQ_FOREACH(np, flag_list, entries)
  {
    const size_t nplen = strlen(np->data);
    if ((flaglen >= nplen) && ((flag[nplen] == '\0') || (flag[nplen] == ' ')) &&
        (mutt_str_strncasecmp(np->data, flag, nplen) == 0))
    {
      return true;
    }

    if (mutt_str_strcmp(np->data, "\\*") == 0)
      return true;
  }

  return false;
}
