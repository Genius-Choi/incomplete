init_filter (cherokee_validator_ldap_t       *ldap,
	     cherokee_validator_ldap_props_t *props,
	     cherokee_connection_t           *conn)
{
	if (cherokee_buffer_is_empty (&props->filter)) {
		TRACE (ENTRIES, "Empty filter: %s\n", "Ignoring it");
		return ret_ok;
	}

	cherokee_buffer_ensure_size (&ldap->filter, props->filter.len + conn->validator->user.len);
	cherokee_buffer_add_buffer (&ldap->filter, &props->filter);
	cherokee_buffer_replace_string (&ldap->filter, "${user}", 7, conn->validator->user.buf, conn->validator->user.len);

	TRACE (ENTRIES, "filter %s\n", ldap->filter.buf);
	return ret_ok;
}
