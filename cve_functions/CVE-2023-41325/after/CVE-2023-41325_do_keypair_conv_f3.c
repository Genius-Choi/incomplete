static enum caam_status do_keypair_conv_f3(struct caam_rsa_keypair *outkey,
					   const struct rsa_keypair *inkey)
{
	enum caam_status retstatus = CAAM_FAILURE;
	size_t size_p = 0;
	size_t size_q = 0;
	size_t size_dp = 0;
	size_t size_dq = 0;
	size_t size_qp = 0;

	size_p = outkey->p.length;
	size_q = outkey->q.length;
	size_dp = crypto_bignum_num_bytes(inkey->dp);
	size_dq = crypto_bignum_num_bytes(inkey->dq);
	size_qp = crypto_bignum_num_bytes(inkey->qp);

	/* Check that dp, dq and qp size not exceed p and q size */
	if (size_dp > size_p || size_dq > size_q || size_qp > size_p)
		return CAAM_FAILURE;

	/*
	 * If one of the parameters dp, dq or qp are not filled,
	 * returns immediately. This is not an error.
	 */
	if (!size_dp || !size_dq || !size_qp)
		return CAAM_NO_ERROR;

	/*
	 * CAAM is assuming that:
	 *    - dp and dq are same size as p
	 *    - dq same size as q
	 *
	 * Because calculation of dp, dq and qp can be less
	 * than above assumption, force the dp, dq and qp
	 * buffer size.
	 */
	/* Allocate one buffer for the 3 fields */
	retstatus =
		caam_calloc_align_buf(&outkey->dp, size_p + size_q + size_p);
	if (retstatus != CAAM_NO_ERROR)
		return CAAM_OUT_MEMORY;

	/* Field dp */
	outkey->dp.length = size_p;

	/*
	 * Ensure buffer is copied starting with 0's
	 * if size_dp != size_p
	 */
	crypto_bignum_bn2bin(inkey->dp, outkey->dp.data + size_p - size_dp);

	/* Field dq */
	outkey->dq.data = outkey->dp.data + size_p;
	outkey->dq.length = size_q;
	outkey->dq.paddr = outkey->dp.paddr + size_p;

	/*
	 * Ensure buffer is copied starting with 0's
	 * if size_dq != size_q
	 */
	crypto_bignum_bn2bin(inkey->dq, outkey->dq.data + size_q - size_dq);

	/* Field qp */
	outkey->qp.data = outkey->dq.data + size_q;
	outkey->qp.length = size_p;
	outkey->qp.paddr = outkey->dq.paddr + size_q;

	/*
	 * Ensure buffer is copied starting with 0's
	 * if size_qp != size_p
	 */
	crypto_bignum_bn2bin(inkey->qp, outkey->qp.data + size_p - size_qp);

	/* Push fields value to the physical memory */
	cache_operation(TEE_CACHECLEAN, outkey->dp.data,
			outkey->dp.length + outkey->dq.length +
				outkey->qp.length);

	outkey->format = RSA_PRIVATE_KEY_FORMAT_3;

	return CAAM_NO_ERROR;
}
