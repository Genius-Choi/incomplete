WebUIFactoryFunction GetWebUIFactoryFunction(WebUI* web_ui,
                                             Profile* profile,
                                             const GURL& url) {
  // This will get called a lot to check all URLs, so do a quick check of other
  // schemes to filter out most URLs.
  //
  // This has a narrow scoper scope than content::HasWebUIScheme(url) which also
  // allows both `chrome-untrusted` and `chrome-devtools`.
  if (!url.SchemeIs(content::kBraveUIScheme) &&
      !url.SchemeIs(content::kChromeUIScheme)) {
    return nullptr;
  }

  if (url.host_piece() == kAdblockHost ||
      url.host_piece() == kAdblockInternalsHost ||
      url.host_piece() == kWebcompatReporterHost ||
      (url.host_piece() == kSkusInternalsHost &&
       base::FeatureList::IsEnabled(skus::features::kSkusFeature)) ||
#if BUILDFLAG(ENABLE_IPFS_INTERNALS_WEBUI)
      (url.host_piece() == kIPFSWebUIHost &&
       ipfs::IpfsServiceFactory::IsIpfsEnabled(profile)) ||
#endif  // BUILDFLAG(ENABLE_IPFS_INTERNALS_WEBUI)
#if BUILDFLAG(IS_ANDROID)
      (url.is_valid() && url.host_piece() == kWalletPageHost &&
       (url.path() == kWalletSwapPagePath ||
        url.path() == kWalletSendPagePath || url.path() == kWalletBuyPagePath ||
        url.path() == kWalletDepositPagePath)) ||
#else
      (base::FeatureList::IsEnabled(
           brave_news::features::kBraveNewsFeedUpdate) &&
       url.host_piece() == kBraveNewsInternalsHost) ||
      ((url.host_piece() == kWalletPanelHost ||
        url.host_piece() == kWalletPageHost) &&
       brave_wallet::IsAllowedForContext(profile)) ||
      url.host_piece() == kBraveRewardsPanelHost ||
      url.host_piece() == kBraveTipPanelHost ||
      url.host_piece() == kSpeedreaderPanelHost ||
      // On Android New Tab is a native page implemented in Java, so no need in
      // WebUI.
      url.host_piece() == chrome::kChromeUINewTabHost ||
      url.host_piece() == chrome::kChromeUISettingsHost ||
      ((url.host_piece() == kWelcomeHost ||
        url.host_piece() == chrome::kChromeUIWelcomeURL) &&
       !profile->IsGuestSession()) ||
      url.host_piece() == kShieldsPanelHost ||
      (url.host_piece() == kCookieListOptInHost &&
       base::FeatureList::IsEnabled(
           brave_shields::features::kBraveAdblockCookieListOptIn)) ||
#endif  // BUILDFLAG(IS_ANDROID)
#if BUILDFLAG(ENABLE_TOR)
      url.host_piece() == kTorInternalsHost ||
#endif
      url.host_piece() == kRewardsPageHost ||
      url.host_piece() == kRewardsInternalsHost) {
    return &NewWebUI;
  }

  return nullptr;
}
