static nghttp2_ssize session_recv(nghttp2_session *session, uint8_t *buf,
                                  size_t len) {
  nghttp2_ssize rv;

  if (session->callbacks.recv_callback2) {
    rv = session->callbacks.recv_callback2(session, buf, len, 0,
                                           session->user_data);
  } else {
    rv = (nghttp2_ssize)session->callbacks.recv_callback(session, buf, len, 0,
                                                         session->user_data);
  }
  if (rv > 0) {
    if ((size_t)rv > len) {
      return NGHTTP2_ERR_CALLBACK_FAILURE;
    }
  } else if (rv < 0 && rv != NGHTTP2_ERR_WOULDBLOCK && rv != NGHTTP2_ERR_EOF) {
    return NGHTTP2_ERR_CALLBACK_FAILURE;
  }
  return rv;
}
