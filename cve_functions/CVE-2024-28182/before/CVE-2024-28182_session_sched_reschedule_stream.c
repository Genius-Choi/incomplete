static void session_sched_reschedule_stream(nghttp2_session *session,
                                            nghttp2_stream *stream) {
  nghttp2_pq *pq;
  uint32_t urgency = nghttp2_extpri_uint8_urgency(stream->extpri);
  int inc = nghttp2_extpri_uint8_inc(stream->extpri);
  uint64_t penalty = (uint64_t)stream->last_writelen;
  int rv;

  (void)rv;

  assert(urgency < NGHTTP2_EXTPRI_URGENCY_LEVELS);

  pq = &session->sched[urgency].ob_data;

  if (!inc || nghttp2_pq_size(pq) == 1) {
    return;
  }

  nghttp2_pq_remove(pq, &stream->pq_entry);

  stream->cycle += penalty;

  rv = nghttp2_pq_push(pq, &stream->pq_entry);

  assert(0 == rv);
}
