static int dump_bytes_to_stdout(struct exfat2img *ei,
				off_t start, off_t end_excl, bool fill_zero)
{
	struct exfat *exfat = ei->exfat;
	size_t len;
	ssize_t ret;

	if (start != ei->stdout_offset) {
		exfat_err("try to skip for stdout at %llu, expected: %llu\n",
			  (unsigned long long)start,
			  (unsigned long long)ei->stdout_offset);
		return -EINVAL;
	}

	while (start < end_excl) {
		len = (size_t)MIN(end_excl - start, exfat->clus_size);
		if (!fill_zero) {
			ret = exfat_read(exfat->blk_dev->dev_fd,
					 ei->dump_bdesc[0].buffer,
					 len, start);
			if (ret != (ssize_t)len) {
				exfat_err("failed to read %llu bytes at %llu\n",
					  (unsigned long long)len,
					  (unsigned long long)start);
				return -EIO;
			}

			ret = write(ei->out_fd, ei->dump_bdesc[0].buffer, len);
			if (ret != (ssize_t)len) {
				exfat_err("failed to write %llu bytes at %llu\n",
					  (unsigned long long)len,
					  (unsigned long long)start);
				return -EIO;
			}
		} else {
			ret = write(ei->out_fd, exfat->zero_cluster, len);
			if (ret != (ssize_t)len) {
				exfat_err("failed to write %llu bytes at %llu\n",
					  (unsigned long long)len,
					  (unsigned long long)start);
				return -EIO;
			}
		}

		start += len;
		ei->stdout_offset += len;
		exfat_stat.written_bytes += len;
	}
	return 0;
}
