::google::api_manager::protocol::Protocol NgxEspRequest::GetFrontendProtocol() {
  ngx_esp_request_ctx_t *ctx = ngx_http_esp_get_module_ctx(r_);
  if (ctx->grpc_pass_through) {
    return ::google::api_manager::protocol::GRPC;
  }
  if (r_ && r_->connection) {
#if (NGX_SSL)
    if (r_->connection->ssl) {
      return ::google::api_manager::protocol::HTTPS;
    }
#endif
    return ::google::api_manager::protocol::HTTP;
  } else {
    return ::google::api_manager::protocol::UNKNOWN;
  }
}
