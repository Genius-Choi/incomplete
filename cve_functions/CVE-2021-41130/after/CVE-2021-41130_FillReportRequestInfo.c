void RequestContext::FillReportRequestInfo(
    Response *response, service_control::ReportRequestInfo *info) {
  FillOperationInfo(info);
  FillLocation(info);
  FillComputePlatform(info);

  info->url = request_->GetUnparsedRequestPath();
  info->method = GetRequestHTTPMethodWithOverride();

  info->frontend_protocol = request_->GetFrontendProtocol();
  info->backend_protocol = request_->GetBackendProtocol();
  info->check_response_info = check_response_info_;

  info->auth_issuer = auth_issuer_;
  info->auth_audience = auth_audience_;

  if (!info->is_final_report) {
    // Make sure we send delta metrics for intermediate reports.
    info->request_bytes = request_->GetGrpcRequestBytes() - last_request_bytes_;
    info->response_bytes =
        request_->GetGrpcResponseBytes() - last_response_bytes_;
    last_request_bytes_ += info->request_bytes;
    last_response_bytes_ += info->response_bytes;
  } else {
    info->request_size = response->GetRequestSize();
    info->response_size = response->GetResponseSize();
    info->request_bytes = info->request_size - last_request_bytes_;
    if (info->request_bytes < 0) {
      info->request_bytes = 0;
    }
    info->response_bytes = info->response_size - last_response_bytes_;
    if (info->response_bytes < 0) {
      info->response_bytes = 0;
    }

    info->streaming_request_message_counts =
        request_->GetGrpcRequestMessageCounts();
    info->streaming_response_message_counts =
        request_->GetGrpcResponseMessageCounts();

    info->streaming_durations =
        std::chrono::duration_cast<std::chrono::microseconds>(
            std::chrono::system_clock::now() - start_time_)
            .count();

    info->status = response->GetResponseStatus();
    info->response_code = info->status.HttpCode();

    // Must be after response_code and method are assigned.
    FillLogMessage(info);

    FillHttpHeaders(response, info);
    FillJwtPayloads(info);
    bool is_streaming = false;
    if (method() &&
        (method()->request_streaming() || method()->response_streaming())) {
      is_streaming = true;
    }
    if (!is_streaming) {
      response->GetLatencyInfo(&info->latency);
    }
  }
}
