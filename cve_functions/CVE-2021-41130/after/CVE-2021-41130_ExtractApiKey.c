void RequestContext::ExtractApiKey() {
  bool api_key_defined = false;
  auto url_queries = method()->api_key_url_query_parameters();
  if (url_queries) {
    api_key_defined = true;
    for (const auto &url_query : *url_queries) {
      if (request_->FindQuery(url_query, &api_key_)) {
        api_key_from_query_ = true;
        return;
      }
    }
  }

  auto headers = method()->api_key_http_headers();
  if (headers) {
    api_key_defined = true;
    for (const auto &header : *headers) {
      if (request_->FindHeader(header, &api_key_)) {
        return;
      }
    }
  }

  if (!api_key_defined) {
    // If api_key is not specified for a method,
    // check "key" first, if not, check "api_key" in query parameter.
    if (request_->FindQuery(kDefaultApiKeyQueryName1, &api_key_)) {
      api_key_from_query_ = true;
      return;
    }

    if (request_->FindQuery(kDefaultApiKeyQueryName2, &api_key_)) {
      api_key_from_query_ = true;
      return;
    }
    request_->FindHeader(kDefaultApiKeyHeaderName, &api_key_);
  }
}
