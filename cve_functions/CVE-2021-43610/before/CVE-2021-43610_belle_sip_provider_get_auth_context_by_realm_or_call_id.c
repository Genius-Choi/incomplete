static belle_sip_list_t* belle_sip_provider_get_auth_context_by_realm_or_call_id(belle_sip_provider_t *p,belle_sip_header_call_id_t* call_id,belle_sip_uri_t *from_uri,const char* realm) {
	belle_sip_list_t* auth_context_lst=NULL;
	belle_sip_list_t* result=NULL;
	authorization_context_t* auth_context;

	for (auth_context_lst=p->auth_contexts;auth_context_lst!=NULL;auth_context_lst=auth_context_lst->next) {
		auth_context=(authorization_context_t*)auth_context_lst->data;
		if (belle_sip_header_call_id_equals(auth_context->callid,call_id) ) {
			result=belle_sip_list_append(result,auth_context_lst->data);
		}
	}

	/* According to the RFC3261 22.3, if the outbound proxy realm is set, we could reuse its nonce value:
	 * "If a UA receives a Proxy-Authenticate header field value in a 401/407
	 * response to a request with a particular Call-ID, it should
	 * incorporate credentials for that realm in all subsequent requests
	 * that contain the same Call-ID.  These credentials MUST NOT be cached
	 * across dialogs; however, if a UA is configured with the realm of its
	 * local outbound proxy, when one exists, then the UA MAY cache
	 * credentials for that realm across dialogs."
	*/
	if (result == NULL){
		const char * from_user=from_uri?belle_sip_uri_get_user(from_uri):NULL;

		belle_sip_debug("belle_sip_provider_auth: no auth context registered with [call_id=%s], looking for realm..."
			, call_id?belle_sip_header_call_id_get_call_id(call_id):"(null)");

		for (auth_context_lst=p->auth_contexts;auth_context_lst!=NULL;auth_context_lst=auth_context_lst->next) {
			auth_context=(authorization_context_t*)auth_context_lst->data;

			belle_sip_debug("belle_sip_provider_auth: \t[realm=%s] [user_id=%s] [call_id=%s]",
				auth_context->realm?auth_context->realm:"(null)",
				auth_context->user_id?auth_context->user_id:"(null)",
				auth_context->callid?belle_sip_header_call_id_get_call_id(auth_context->callid):"(null)"
			);
			/* We also verify that user matches in case of multi-account to avoid use nonce from another account. For a
			 * single user, from_uri user id and realm user id COULD be different but we assume here that this is not the case
			 * in order to avoid adding another field in auth_context struct.
			**/
			if ((realm && strcmp(auth_context->realm,realm)==0)
				&& (from_user && auth_context->user_id && strcmp(auth_context->user_id,from_user)==0)) {

				result=belle_sip_list_append(result,auth_context_lst->data);
				belle_sip_debug("belle_sip_provider_auth: found a MATCHING realm auth context!");
			}
		}
	}
	return result;
}
