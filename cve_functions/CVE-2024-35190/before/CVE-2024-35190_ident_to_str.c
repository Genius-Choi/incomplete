static int ident_to_str(const void *obj, const intptr_t *args, char **buf)
{
	const struct ast_sip_endpoint *endpoint = obj;
	int methods;
	int idx;
	int buf_used = 0;
	int buf_size = MAX_OBJECT_FIELD;

	methods = AST_VECTOR_SIZE(&endpoint->ident_method_order);
	if (!methods) {
		return 0;
	}

	*buf = ast_malloc(buf_size);
	if (!*buf) {
		return -1;
	}

	for (idx = 0; idx < methods; ++idx) {
		enum ast_sip_endpoint_identifier_type method;
		const char *method_str;

		method = AST_VECTOR_GET(&endpoint->ident_method_order, idx);
		method_str = sip_endpoint_identifier_type2str(method);

		/* Should never have an "<unknown>" method string */
		ast_assert(strcmp(method_str, "<unknown>"));
		if (!strcmp(method_str, "<unknown>")) {
			continue;
		}

		buf_used += snprintf(*buf + buf_used, buf_size - buf_used, "%s%s",
			method_str, idx < methods - 1 ? "," : "");
		if (buf_size <= buf_used) {
			/* Need more room than available, truncating. */
			*(*buf + (buf_size - 1)) = '\0';
			ast_log(LOG_WARNING, "Truncated identify_by string: %s\n", *buf);
			break;
		}
	}

	return 0;
}
