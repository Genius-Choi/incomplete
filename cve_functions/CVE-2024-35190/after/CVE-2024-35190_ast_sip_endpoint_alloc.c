void *ast_sip_endpoint_alloc(const char *name)
{
	struct ast_sip_endpoint *endpoint = ast_sorcery_generic_alloc(sizeof(*endpoint), endpoint_destructor);
	if (!endpoint) {
		return NULL;
	}
	if (ast_string_field_init(endpoint, 64)) {
		ao2_cleanup(endpoint);
		return NULL;
	}

	if (ast_string_field_init_extended(endpoint, geoloc_incoming_call_profile) ||
		ast_string_field_init_extended(endpoint, geoloc_outgoing_call_profile)) {
		ao2_cleanup(endpoint);
		return NULL;
	}
	if (ast_string_field_init_extended(endpoint, overlap_context)) {
		ao2_cleanup(endpoint);
		return NULL;
	}

	if (!(endpoint->media.codecs = ast_format_cap_alloc(AST_FORMAT_CAP_FLAG_DEFAULT))) {
		ao2_cleanup(endpoint);
		return NULL;
	}
	if (init_subscription_configuration(&endpoint->subscription)) {
		ao2_cleanup(endpoint);
		return NULL;
	}
	if (init_info_configuration(&endpoint->info)) {
		ao2_cleanup(endpoint);
		return NULL;
	}
	if (init_media_configuration(&endpoint->media)) {
		ao2_cleanup(endpoint);
		return NULL;
	}

	ast_party_id_init(&endpoint->id.self);
	endpoint->id.self.tag = ast_strdup("");

	if (AST_VECTOR_INIT(&endpoint->ident_method_order, 1)) {
		return NULL;
	}

	return endpoint;
}
