String resolve_parse_ini_filename(const String& filename) {
  // Try cleaning up the path. Use file_exists to avoid a warning
  // that get_contents generates
  String resolved = File::TranslatePath(filename);
  if (!resolved.empty() && HHVM_FN(file_exists)(resolved)) {
    return resolved;
  }

  if (FileUtil::isAbsolutePath(filename.data())) {
    return null_string;
  }

  // Still no go, and not an absolute path, try to resolve based
  // on containing file name.
  auto const cfd = String::attach(g_context->getContainingFileName());
  if (!cfd.empty()) {
    int npos = cfd.rfind('/');
    if (npos >= 0) {
      resolved = cfd.substr(0, npos + 1) + filename;
      if (!resolved.empty() && HHVM_FN(file_exists)(resolved)) {
        return resolved;
      }
    }
  }

  // Next, see if include path was set in the ini settings.
  auto const& includePaths = RID().getIncludePaths();

  for (auto const& path : includePaths) {
    resolved = path + FileUtil::getDirSeparator() + filename;
    if (HHVM_FN(file_exists)(resolved)) {
      return resolved;
    }
  }

  return null_string;
}
