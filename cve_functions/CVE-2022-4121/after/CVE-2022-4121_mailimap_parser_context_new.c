mailimap_parser_context_new(mailimap * session)
{
  struct mailimap_parser_context * ctx;

  ctx = malloc(sizeof(* ctx));
  if (ctx == NULL)
    goto err;

  ctx->is_rambler_workaround_enabled = mailimap_is_rambler_workaround_enabled(session);
  ctx->is_qip_workaround_enabled = mailimap_is_qip_workaround_enabled(session);

  ctx->msg_body_handler = session->imap_msg_body_handler;
  ctx->msg_body_handler_context = session->imap_msg_body_handler_context;
  ctx->msg_body_parse_in_progress = false;
  ctx->msg_body_section = NULL;
  ctx->msg_body_att_type = 0;

  return ctx;

err:
  return NULL;
}
