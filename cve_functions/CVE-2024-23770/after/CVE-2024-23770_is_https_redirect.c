static int is_https_redirect(struct connection *conn) {
    char *proto = NULL;

    if (forward_to_https == 0)
        return 0; /* --forward-https was never used */

    proto = parse_field(conn, "X-Forwarded-Proto: ");
    if (proto == NULL || strcasecmp(proto, "https") == 0) {
        free(proto);
        return 0;
    }

    free(proto);
    return 1;
}
