static void default_reply(struct connection *conn,
        const int errcode, const char *errname, const char *format, ...) {
    char *reason, date[DATE_LEN];
    va_list va;

    va_start(va, format);
    xvasprintf(&reason, format, va);
    va_end(va);

    /* Only really need to calculate the date once. */
    rfc1123_date(date, now);

    conn->reply_length = xasprintf(&(conn->reply),
     "<html><head><title>%d %s</title></head><body>\n"
     "<h1>%s</h1>\n" /* errname */
     "%s\n" /* reason */
     "<hr>\n"
     "%s" /* generated on */
     "</body></html>\n",
     errcode, errname, errname, reason, generated_on(date));
    free(reason);

    const char auth_header[] =
        "WWW-Authenticate: Basic realm=\"User Visible Realm\"\r\n";

    conn->header_length = xasprintf(&(conn->header),
     "HTTP/1.1 %d %s\r\n"
     "Date: %s\r\n"
     "%s" /* server */
     "Accept-Ranges: bytes\r\n"
     "%s" /* keep-alive */
     "%s" /* custom headers */
     "Content-Length: %llu\r\n"
     "Content-Type: text/html; charset=UTF-8\r\n"
     "%s"
     "\r\n",
     errcode, errname, date, server_hdr, keep_alive(conn),
     custom_hdrs, llu(conn->reply_length),
     (auth_key != NULL ? auth_header : ""));

    conn->reply_type = REPLY_GENERATED;
    conn->http_code = errcode;

    /* Reset reply_start in case the request set a range. */
    conn->reply_start = 0;
}
