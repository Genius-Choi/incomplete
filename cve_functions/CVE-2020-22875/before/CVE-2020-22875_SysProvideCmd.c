static Jsi_RC SysProvideCmd(Jsi_Interp *interp, Jsi_Value *args, Jsi_Value *_this,
    Jsi_Value **ret, Jsi_Func *funcPtr)
{
    Jsi_Number n = 1;
    const char *name = NULL, *cp;
    Jsi_Value *vname = Jsi_ValueArrayIndex(interp, args, 0);
    Jsi_RC rc = JSI_OK;
    Jsi_DString dStr;
    Jsi_DSInit(&dStr);
    Jsi_Func *f = NULL;
    if (!vname) {
        name = jsi_GetCurFile(interp);
        if (!name)
            return JSI_ERROR;
        if ((cp = strrchr(name, '/')))
            name = cp+1;
        if ((cp = strrchr(name, '.')))
            Jsi_DSAppendLen(&dStr, name, (cp-name));
        else
            Jsi_DSAppend(&dStr, name, NULL);
        name = Jsi_DSValue(&dStr);
    } else if (Jsi_ValueIsString(interp, vname)) {
        name = Jsi_ValueString(interp, vname, NULL);
        if (!Jsi_StrIsAlnum(name))
            name = NULL;
    } else if (Jsi_ValueIsFunction(interp, vname)) {
        f = vname->d.obj->d.fobj->func;
        name = f->name;
    }
    if (!name) 
        rc = Jsi_LogError("invalid or missing package name");
    else {
        Jsi_Value *v = Jsi_ValueArrayIndex(interp, args, 1);
        if (v && jsi_GetVerFromVal(interp, v, &n, 1) != JSI_OK)
            return JSI_ERROR;
        if (rc == JSI_OK) {
            Jsi_PkgOpts po = {};
            po.info = Jsi_ValueArrayIndex(interp, args, 2);
            rc = Jsi_PkgProvideEx(interp, name, n, NULL, &po);
        }
    }
    Jsi_DSFree(&dStr);
    if (rc == JSI_OK && f)
        f->pkg = jsi_PkgGet(interp, name);
    return rc;
}
