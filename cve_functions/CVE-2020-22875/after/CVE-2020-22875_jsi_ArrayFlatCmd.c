static Jsi_RC jsi_ArrayFlatCmd(Jsi_Interp *interp, Jsi_Value *args, Jsi_Value *_this,Jsi_Value **ret, Jsi_Func *funcPtr) {
    if (_this->vt != JSI_VT_OBJECT || !Jsi_ObjIsArray(interp, _this->d.obj))
        return Jsi_LogError("expected array object");

    Jsi_Number ndepth = 1;
    Jsi_Obj *nobj;
    Jsi_Value *depth = Jsi_ValueArrayIndex(interp, args, 0);
    if (depth && Jsi_GetNumberFromValue(interp,depth, &ndepth) != JSI_OK)
        return JSI_ERROR;
    
    if (ndepth < 0 || ndepth>1000)
        return Jsi_LogError("bad depth: %d", (int)ndepth);

    nobj = Jsi_ObjNewType(interp, JSI_OT_ARRAY);
    Jsi_ValueMakeArrayObject(interp, ret, nobj );
    if (ndepth>0)
        return jsi_ArrayFlatSub(interp, nobj, _this, ndepth);
    return JSI_OK;
}
