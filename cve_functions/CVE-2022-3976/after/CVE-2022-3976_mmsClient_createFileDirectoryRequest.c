mmsClient_createFileDirectoryRequest(uint32_t invokeId, ByteBuffer* request, const char* fileSpecification, const char* continueAfter)
{
    uint32_t invokeIdSize = BerEncoder_UInt32determineEncodedSize(invokeId);

    uint32_t confirmedRequestPduSize = 1 + 2 + 1  + invokeIdSize;

    uint32_t parameterSize = 0;

    if (fileSpecification)
        parameterSize += encodeFileSpecification(0xa0, fileSpecification, NULL, 0);

    if (continueAfter)
        parameterSize += encodeFileSpecification(0xa1, continueAfter, NULL, 0);

    confirmedRequestPduSize += BerEncoder_determineLengthSize(parameterSize) + parameterSize;

    int bufPos = 0;
    uint8_t* buffer = request->buffer;

    bufPos = BerEncoder_encodeTL(0xa0, confirmedRequestPduSize, buffer, bufPos);
    bufPos = BerEncoder_encodeTL(0x02, invokeIdSize, buffer, bufPos);
    bufPos = BerEncoder_encodeUInt32(invokeId, buffer, bufPos);

    /* Encode FileRead tag (context | structured ) [77 = 4dh] */
    buffer[bufPos++] = 0xbf;
    buffer[bufPos++] = 0x4d;
    bufPos = BerEncoder_encodeLength(parameterSize, buffer, bufPos);

    if (fileSpecification)
        bufPos = encodeFileSpecification(0xa0, fileSpecification, buffer, bufPos);

    if (continueAfter)
        bufPos = encodeFileSpecification(0xa1, continueAfter, buffer, bufPos);

    request->size = bufPos;
}
