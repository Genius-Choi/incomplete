mmsMsg_parseFileReadResponse(uint8_t* buffer, int bufPos, int maxBufPos, uint32_t invokeId, int frsmId, bool* moreFollows, MmsConnection_FileReadHandler handler, void* handlerParameter)
{
    int length;
    uint8_t* data = NULL;
    int dataLen = 0;


    uint8_t tag = buffer[bufPos++];


    if (tag != 0xbf) {
        if (DEBUG_MMS_CLIENT)
            printf("MMS_CLIENT/SERVER: mmsClient_parseFileReadResponse: unknown tag %02x\n", tag);
        return false;
    }

    tag = buffer[bufPos++];

    *moreFollows = true;

    if (tag != 0x49) {
        if (DEBUG_MMS_CLIENT)
            printf("MMS_CLIENT/SERVER: mmsClient_parseFileReadResponse: unknown tag %02x\n", tag);
        return false;
    }

    bufPos = BerDecoder_decodeLength(buffer, &length, bufPos, maxBufPos);
    if (bufPos < 0)
        return false;

    int endPos = bufPos + length;

    while (bufPos < endPos) {
        tag = buffer[bufPos++];

        bufPos = BerDecoder_decodeLength(buffer, &length, bufPos, maxBufPos);
        if (bufPos < 0)
            return false;

        switch (tag) {
        case 0x80: /* fileData */
            data = buffer + bufPos;
            dataLen = length;

            bufPos += length;
            break;

        case 0x81: /* moreFollows */
            *moreFollows = BerDecoder_decodeBoolean(buffer, bufPos);
            bufPos += length;
            break;

        case 0x00: /* indefinite length end tag -> ignore */
            break;

        default:
            bufPos += length;
            if (DEBUG_MMS_CLIENT)
                printf("MMS_CLIENT/SERVER: mmsClient_parseFileReadResponse: message contains unknown tag %02x!\n", tag);

            return false;
        }
    }

    handler(invokeId, handlerParameter, MMS_ERROR_NONE, frsmId, data, dataLen, *moreFollows);

    return true;
}
