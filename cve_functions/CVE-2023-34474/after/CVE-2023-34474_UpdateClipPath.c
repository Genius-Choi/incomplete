static void UpdateClipPath(unsigned char *blob,size_t length,
  const size_t old_columns,const size_t old_rows,
  const RectangleInfo *new_geometry)
{
  ssize_t
    i;

  ssize_t
    knot_count,
    selector;

  knot_count=0;
  while (length != 0)
  {
    selector=(ssize_t) ReadProfileMSBShort(&blob,&length);
    switch (selector)
    {
      case 0:
      case 3:
      {
        if (knot_count != 0)
          {
            blob+=24;
            length-=MagickMin(24,(ssize_t) length);
            break;
          }
        /*
          Expected subpath length record.
        */
        knot_count=(ssize_t) ReadProfileMSBShort(&blob,&length);
        blob+=22;
        length-=MagickMin(22,(ssize_t) length);
        break;
      }
      case 1:
      case 2:
      case 4:
      case 5:
      {
        if (knot_count == 0)
          {
            /*
              Unexpected subpath knot.
            */
            blob+=24;
            length-=MagickMin(24,(ssize_t) length);
            break;
          }
        /*
          Add sub-path knot
        */
        for (i=0; i < 3; i++)
        {
          double
            x,
            y;

          signed int
            xx,
            yy;

          y=(double) ReadProfileMSBLong(&blob,&length);
          y=y*old_rows/4096.0/4096.0;
          y-=new_geometry->y;
          yy=(signed int) ((y*4096*4096)/new_geometry->height);
          WriteProfileLong(MSBEndian,(size_t) yy,blob-4);
          x=(double) ReadProfileMSBLong(&blob,&length);
          x=x*old_columns/4096.0/4096.0;
          x-=new_geometry->x;
          xx=(signed int) ((x*4096*4096)/new_geometry->width);
          WriteProfileLong(MSBEndian,(size_t) xx,blob-4);
        }
        knot_count--;
        break;
      }
      case 6:
      case 7:
      case 8:
      default:
      {
        blob+=24;
        length-=MagickMin(24,(ssize_t) length);
        break;
      }
    }
  }
}
