static int count_spn_components(struct ldb_val val)
{
	/*
	 * a 3 part servicePrincipalName has two slashes, like
	 * ldap/example.com/DomainDNSZones.example.com.
	 *
	 * In krb5_parse_name_flags() we don't count "\/" as a slash (i.e.
	 * escaped by a backslash), but this is not the behaviour of Windows
	 * on setting a servicePrincipalName -- slashes are counted regardless
	 * of backslashes.
	 *
	 * Accordingly, here we ignore backslashes. This will reject
	 * multi-slash SPNs that krb5_parse_name_flags() would accept, and
	 * allow ones in the form "a\/b" that it won't parse.
	 */
	size_t i;
	int slashes = 0;
	for (i = 0; i < val.length; i++) {
		char c = val.data[i];
		if (c == '/') {
			slashes++;
			if (slashes == 3) {
				/* at this point we don't care */
				return 4;
			}
		}
	}
	return slashes + 1;
}
