void Filter::onDestroy() {
  // Reset any in-flight upstream requests.
  resetAll();

  // Unregister from shadow stream notifications and cancel active streams.
  for (auto* shadow_stream : shadow_streams_) {
    shadow_stream->removeDestructorCallback();
    shadow_stream->removeWatermarkCallbacks();
    shadow_stream->cancel();
  }

  cleanup();
}
