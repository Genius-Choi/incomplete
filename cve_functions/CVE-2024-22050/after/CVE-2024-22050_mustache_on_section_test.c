static int32_t mustache_on_section_test(mustache_section_s *section,
                                        const char *name, uint32_t name_len,
                                        uint8_t callable) {
  VALUE o = fiobj_mustache_find_obj(section, name, name_len);
  if (o == Qnil || o == Qfalse) {
    return 0;
  }
  if (RB_TYPE_P(o, T_ARRAY)) {
    return RARRAY_LEN(o);
  }
  if (callable && rb_respond_to(o, call_func_id)) {
    size_t len;
    const char *txt = mustache_section_text(section, &len);
    VALUE str = Qnil;
    if (txt && len) {
      str = rb_str_new(txt, len);
    }
    o = IodineCaller.call2(o, call_func_id, 1, &str);
    if (!RB_TYPE_P(o, T_STRING))
      o = rb_funcall2(o, to_s_func_id, 0, NULL);
    if (RB_TYPE_P(o, T_STRING) && RSTRING_LEN(o))
      mustache_write_text(section, RSTRING_PTR(o), RSTRING_LEN(o), 0);
    return 0;
  }
  return 1;
}
