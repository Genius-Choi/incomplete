FIO_FUNC void fio_uuid_link_test(void) {
  fprintf(stderr, "=== Testing fio_uuid_link\n");
  uintptr_t called = 0;
  uintptr_t removed = 0;
  intptr_t uuid = fio_socket(NULL, "8765", 1);
  FIO_ASSERT(uuid != -1, "fio_uuid_link_test failed to create a socket!");
  fio_uuid_link(uuid, &called, fio_uuid_link_test_on_close);
  FIO_ASSERT(called == 0,
             "fio_uuid_link failed - on_close callback called too soon!");
  fio_uuid_link(uuid, &removed, fio_uuid_link_test_on_close);
  fio_uuid_unlink(uuid, &removed);
  fio_close(uuid);
  fio_defer_perform();
  FIO_ASSERT(called, "fio_uuid_link failed - on_close callback wasn't called!");
  FIO_ASSERT(called, "fio_uuid_unlink failed - on_close callback was called "
                     "(wasn't removed)!");
  fprintf(stderr, "* passed.\n");
}
