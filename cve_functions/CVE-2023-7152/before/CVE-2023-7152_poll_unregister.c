STATIC mp_obj_t poll_unregister(mp_obj_t self_in, mp_obj_t obj_in) {
    mp_obj_poll_t *self = MP_OBJ_TO_PTR(self_in);
    mp_map_elem_t *elem = mp_map_lookup(&self->poll_set.map, mp_obj_id(obj_in), MP_MAP_LOOKUP_REMOVE_IF_FOUND);

    #if MICROPY_PY_SELECT_POSIX_OPTIMISATIONS
    if (elem != NULL) {
        poll_obj_t *poll_obj = (poll_obj_t *)MP_OBJ_TO_PTR(elem->value);
        if (poll_obj->pollfd != NULL) {
            poll_obj->pollfd->fd = -1;
            --self->poll_set.used;
        }
        elem->value = MP_OBJ_NULL;
    }
    #else
    (void)elem;
    #endif

    // TODO raise KeyError if obj didn't exist in map
    return mp_const_none;
}
