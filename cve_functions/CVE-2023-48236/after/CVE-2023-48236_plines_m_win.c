plines_m_win(win_T *wp, linenr_T first, linenr_T last, int limit_winheight)
{
    int		count = 0;

    while (first <= last)
    {
#ifdef FEAT_FOLDING
	int	x;

	// Check if there are any really folded lines, but also included lines
	// that are maybe folded.
	x = foldedCount(wp, first, NULL);
	if (x > 0)
	{
	    ++count;	    // count 1 for "+-- folded" line
	    first += x;
	}
	else
#endif
	{
#ifdef FEAT_DIFF
	    if (first == wp->w_topline)
		count += plines_win_nofill(wp, first, limit_winheight)
							       + wp->w_topfill;
	    else
#endif
		count += plines_win(wp, first, limit_winheight);
	    ++first;
	}
    }
    return (count);
}
