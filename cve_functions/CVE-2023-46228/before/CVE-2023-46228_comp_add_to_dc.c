bool comp_add_to_dc(zckCtx *zck, zckComp *comp, const char *src,
                    size_t src_size) {
    VALIDATE_BOOL(zck);
    ALLOCD_BOOL(zck, comp);
    ALLOCD_BOOL(zck, src);

    /* Get rid of any already read data and allocate space for new data */
    char *temp = zmalloc(comp->dc_data_size - comp->dc_data_loc + src_size);
    if (!temp) {
        zck_log(ZCK_LOG_ERROR, "OOM in %s", __func__);
        return false;
    }
    if(comp->dc_data_loc != 0)
        zck_log(ZCK_LOG_DEBUG, "Freeing %llu bytes from decompressed buffer",
                (long long unsigned) comp->dc_data_loc);
    zck_log(ZCK_LOG_DEBUG, "Adding %llu bytes to decompressed buffer",
            (long long unsigned) src_size);
    memcpy(temp, comp->dc_data + comp->dc_data_loc,
           comp->dc_data_size - comp->dc_data_loc);
    free(comp->dc_data);
    comp->dc_data_size -= comp->dc_data_loc;
    comp->dc_data_loc = 0;
    comp->dc_data = temp;

    /* Copy new uncompressed data into comp */
    memcpy(comp->dc_data + comp->dc_data_size, src, src_size);
    comp->dc_data_size += src_size;
    return true;
}
