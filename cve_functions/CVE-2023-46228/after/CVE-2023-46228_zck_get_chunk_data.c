ssize_t ZCK_PUBLIC_API zck_get_chunk_data(zckChunk *idx, char *dst,
                                  size_t dst_size) {
    zckCtx *zck = NULL;
    if(idx && idx->zck) {
        VALIDATE_INT(idx->zck);
        zck = idx->zck;
    }
    ALLOCD_INT(zck, idx);
    ALLOCD_INT(zck, dst);

    /* Make sure chunk size is valid */
    if(zck_get_chunk_size(idx) < 0)
        return -1;
    /* If the chunk is empty, we're done */
    if(zck_get_chunk_size(idx) == 0)
        return 0;
    /* Make sure requested chunk has a beginning */
    if(zck_get_chunk_start(idx) < 0)
        return -1;

    /* Read dictionary if needed */
    zckChunk *dict = zck_get_first_chunk(zck);
    if(dict == NULL)
        return -1;
    if(zck_get_chunk_size(dict) > 0 && zck->comp.dict == NULL) {
        if(zck_get_chunk_start(dict) < 0)
            return -1;
        if(!seek_data(zck, zck_get_chunk_start(dict), SEEK_SET))
            return -1;
        if(!comp_reset(zck))
            return -1;
        if(!comp_init(zck))
            return -1;
        if(!import_dict(zck))
            return -1;
    }

    /* Seek to beginning of requested chunk */
    if(!comp_reset_comp_data(zck))
        return -1;
    if(!comp_reset(zck))
        return -1;
    if(!comp_init(zck))
        return -1;
    if(!seek_data(zck, zck_get_chunk_start(idx), SEEK_SET))
        return -1;
    zck->comp.data_idx = idx;
    return comp_read(zck, dst, dst_size, 1);
}
