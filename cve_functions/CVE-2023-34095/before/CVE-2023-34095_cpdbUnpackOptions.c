void cpdbUnpackOptions(int num_options,
                       GVariant *opts_var,
                       int num_media,
                       GVariant *media_var,
                       cpdb_options_t *options)
{
    cpdb_option_t *opt;
    cpdb_media_t *media;
    char buf[CPDB_BSIZE];
    int i, j, num, width, length, l, r, t, b;
    GVariantIter *iter, *sub_iter;
    char *str, *name, *def, *group;
    
    options->count = num_options;
    g_variant_get(opts_var, "a(sssia(s))", &iter);
    for (i = 0; i < num_options; i++)
    {
        opt = g_new0(cpdb_option_t, 1);
        g_variant_iter_loop(iter, "(sssia(s))",
                            &name, &group, &def, &num, &sub_iter);

        logdebug("name=%s;\n", name);
        opt->option_name = cpdbGetStringCopy(name);
        logdebug("group=%s;\n", group);
        opt->group_name = cpdbGetStringCopy(group);
        logdebug("default=%s;\n", def);
        opt->default_value = cpdbGetStringCopy(def);
        logdebug("num_choices=%d;\n", num);
        opt->num_supported = num;
        logdebug("choices:\n");
        opt->supported_values = cpdbNewCStringArray(num);
        for (j = 0; j < num; j++)
        {
            g_variant_iter_loop(sub_iter, "(s)", &str);
            logdebug("  %s;\n", str);
            opt->supported_values[j] = cpdbGetStringCopy(str);
        }
        g_hash_table_insert(options->table, cpdbGetStringCopy(opt->option_name), opt);
    }
    
    options->media_count = num_media;
    g_variant_get(media_var, "a(siiia(iiii))", &iter);
    for (i = 0; i < num_media; i++)
    {
		media = g_new0(cpdb_media_t, 1);
		g_variant_iter_loop(iter, "(siiia(iiii))",
							&name, &width, &length, &num, &sub_iter);
        
        logdebug("name=%s;\n", name);
		media->name = cpdbGetStringCopy(name);
        logdebug("width=%d;\n", width);
		media->width = width;
        logdebug("length=%d;\n", length);
		media->length = length;
        logdebug("num_margins=%d;\n", num);
		media->num_margins = num;
		media->margins = g_new0(cpdb_margin_t, num);
		for (j = 0; j < num; j++)
		{
			g_variant_iter_loop(sub_iter, "(iiii)", &l, &r, &t, &b);
            logdebug("    %d,%d,%d,%d;\n", l, r, t, b);
			media->margins[j].left = l;
            media->margins[j].right = r;
            media->margins[j].top = t; 
            media->margins[j].bottom = b;
		}
		g_hash_table_insert(options->media, cpdbGetStringCopy(media->name), media);
	}
    
}
