prepenv(const struct rule *rule, const struct passwd *mypw,
    const struct passwd *targpw)
{
	struct env *env;

	env = createenv(rule, mypw, targpw);
	if (rule->envlist)
		fillenv(env, rule->envlist);

	return flattenenv(env);
}
