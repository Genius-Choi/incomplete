static ogg_int64_t op_get_granulepos(const OggOpusFile *_of,
 ogg_int64_t _pcm_offset,int *_li){
  const OggOpusLink *links;
  ogg_int64_t        duration;
  ogg_int64_t        pcm_start;
  opus_int32         pre_skip;
  int                nlinks;
  int                li_lo;
  int                li_hi;
  OP_ASSERT(_pcm_offset>=0);
  nlinks=_of->nlinks;
  links=_of->links;
  li_lo=0;
  li_hi=nlinks;
  do{
    int li;
    li=li_lo+(li_hi-li_lo>>1);
    if(links[li].pcm_file_offset<=_pcm_offset)li_lo=li;
    else li_hi=li;
  }
  while(li_hi-li_lo>1);
  _pcm_offset-=links[li_lo].pcm_file_offset;
  pcm_start=links[li_lo].pcm_start;
  pre_skip=links[li_lo].head.pre_skip;
  OP_ALWAYS_TRUE(!op_granpos_diff(&duration,links[li_lo].pcm_end,pcm_start));
  duration-=pre_skip;
  if(_pcm_offset>=duration)return -1;
  _pcm_offset+=pre_skip;
  if(OP_UNLIKELY(pcm_start>OP_INT64_MAX-_pcm_offset)){
    /*Adding this amount to the granule position would overflow the positive
       half of its 64-bit range.
      Since signed overflow is undefined in C, do it in a way the compiler
       isn't allowed to screw up.*/
    _pcm_offset-=OP_INT64_MAX-pcm_start+1;
    pcm_start=OP_INT64_MIN;
  }
  pcm_start+=_pcm_offset;
  *_li=li_lo;
  return pcm_start;
}
