R_API const char *r_str_firstbut_escape(const char *s, char ch, const char *but) {
	int idx, _b = 0;
	ut8 *b = (ut8*)&_b;
	const char *isbut, *p;
	const int bsz = sizeof (_b) * 8;
	if (!but) {
		return strchr (s, ch);
	}
	if (strlen (but) >= bsz) {
		R_LOG_ERROR ("r_str_firstbut: but string too long");
		return NULL;
	}
	for (p = s; *p; p++) {
		if (*p == '\\') {
			p++;
			if (*p == ch || strchr(but, *p)) {
				if (!*p) {
					break;
				}
				continue;
			} else if (!*p) {
				break;
			}
		}
		isbut = strchr (but, *p);
		if (isbut) {
			idx = (int)(size_t)(isbut - but);
			_b = R_BIT_TOGGLE (b, idx);
			if (_b && (_b & (_b - 1))) {
				_b = R_BIT_TOGGLE (b, idx); // cancel a but char if a but is already toggle
			}
			continue;
		}
		if (*p == ch && !_b) {
			return p;
		}
	}
	return NULL;
}
