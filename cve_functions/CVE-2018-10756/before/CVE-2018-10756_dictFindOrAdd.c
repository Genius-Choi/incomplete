static tr_variant* dictFindOrAdd(tr_variant* dict, tr_quark const key, int type)
{
    tr_variant* child;

    /* see if it already exists, and if so, try to reuse it */
    if ((child = tr_variantDictFind(dict, key)) != NULL)
    {
        if (!tr_variantIsType(child, type))
        {
            tr_variantDictRemove(dict, key);
            child = NULL;
        }
        else if (child->type == TR_VARIANT_TYPE_STR)
        {
            tr_variant_string_clear(&child->val.s);
        }
    }

    /* if it doesn't exist, create it */
    if (child == NULL)
    {
        child = tr_variantDictAdd(dict, key);
    }

    return child;
}
