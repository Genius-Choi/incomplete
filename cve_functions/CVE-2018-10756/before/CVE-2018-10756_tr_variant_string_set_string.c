static void tr_variant_string_set_string(struct tr_variant_string* str, char const* bytes, size_t len)
{
    tr_variant_string_clear(str);

    if (bytes == NULL)
    {
        len = 0;
    }
    else if (len == TR_BAD_SIZE)
    {
        len = strlen(bytes);
    }

    if (len < sizeof(str->str.buf))
    {
        str->type = TR_STRING_TYPE_BUF;
        memcpy(str->str.buf, bytes, len);
        str->str.buf[len] = '\0';
        str->len = len;
    }
    else
    {
        char* tmp = tr_new(char, len + 1);
        memcpy(tmp, bytes, len);
        tmp[len] = '\0';
        str->type = TR_STRING_TYPE_HEAP;
        str->str.str = tmp;
        str->len = len;
    }
}
