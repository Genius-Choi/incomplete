flatpak_dir_get_default_locale_languages (FlatpakDir *self)
{
  g_auto(GStrv) extra_languages = NULL;
  const GPtrArray *langs;
  int i;

  extra_languages = flatpak_dir_get_config_strv (self, "xa.extra-languages");
  for (i = 0; extra_languages != NULL && extra_languages[i] != NULL; i++)
    {
      /* Strip the locale, modifier or codeset, if present. */
      gchar *match = strpbrk (extra_languages[i], "._@");
      if (match != NULL)
        *match = '\0';
    }

  if (flatpak_dir_is_user (self))
    {
      g_auto(GStrv) locale_langs = flatpak_get_current_locale_langs ();
      g_auto(GStrv) merged = NULL;

      langs = flatpak_get_user_locales ();
      merged = flatpak_strv_merge (extra_languages, (char **) langs->pdata);

      return sort_strv (flatpak_strv_merge (merged, locale_langs));
    }

  /* Then get the system default locales */
  langs = flatpak_get_system_locales ();

  return sort_strv (flatpak_strv_merge (extra_languages, (char **) langs->pdata));
}
