parse_datestr(CBORDecoderObject *self, PyObject *str)
{
    const char* buf;
    Py_ssize_t size;
    PyObject *ret = NULL;
    unsigned long int Y, m, d;

    buf = PyUnicode_AsUTF8AndSize(str, &size);
    if (
            size < 10 || buf[4] != '-' || buf[7] != '-')
    {
        PyErr_Format(
            _CBOR2_CBORDecodeValueError, "invalid date string %R", str);
        return NULL;
    }
    if (buf) {
        Y = strtoul(buf, NULL, 10);
        m = strtoul(buf + 5, NULL, 10);
        d = strtoul(buf + 8, NULL, 10);
        ret = PyDate_FromDate(Y, m, d);
    }
    return ret;
}
