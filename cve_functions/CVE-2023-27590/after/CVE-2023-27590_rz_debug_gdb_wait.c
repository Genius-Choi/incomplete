static RzDebugReasonType rz_debug_gdb_wait(RzDebug *dbg, int pid) {
	RzDebugGdbCtx *ctx = dbg->plugin_data;
	check_connection(dbg);
	if (!ctx->desc) {
		return RZ_DEBUG_REASON_UNKNOWN;
	}
	if (!ctx->desc->stop_reason.is_valid) {
		if (gdbr_stop_reason(ctx->desc) < 0) {
			dbg->reason.type = RZ_DEBUG_REASON_UNKNOWN;
			return RZ_DEBUG_REASON_UNKNOWN;
		}
	}
	if (ctx->desc->stop_reason.thread.present) {
		dbg->reason.tid = ctx->desc->stop_reason.thread.tid;
		dbg->pid = ctx->desc->stop_reason.thread.pid;
		dbg->tid = ctx->desc->stop_reason.thread.tid;
		if (dbg->pid != ctx->desc->pid || dbg->tid != ctx->desc->tid) {
			// eprintf ("= attach %d %d\n", dbg->pid, dbg->tid);
			gdbr_select(ctx->desc, dbg->pid, dbg->tid);
		}
	}
	dbg->reason.signum = ctx->desc->stop_reason.signum;
	dbg->reason.type = ctx->desc->stop_reason.reason;
	return ctx->desc->stop_reason.reason;
}
