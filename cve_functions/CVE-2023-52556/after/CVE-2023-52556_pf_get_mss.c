pf_get_mss(struct pf_pdesc *pd)
{
	int		 olen;
	u_int8_t	 opts[MAX_TCPOPTLEN], *opt;
	u_int16_t	 mss = tcp_mssdflt;

	olen = (pd->hdr.tcp.th_off << 2) - sizeof(struct tcphdr);
	if (olen < TCPOLEN_MAXSEG || !pf_pull_hdr(pd->m,
	    pd->off + sizeof(struct tcphdr), opts, olen, NULL, pd->af))
		return (0);

	opt = opts;
	while ((opt = pf_find_tcpopt(opt, opts, olen,
		    TCPOPT_MAXSEG, TCPOLEN_MAXSEG)) != NULL) {
			memcpy(&mss, (opt + 2), 2);
			mss = ntohs(mss);

			opt += opt[1];
	}
	return (mss);
}
