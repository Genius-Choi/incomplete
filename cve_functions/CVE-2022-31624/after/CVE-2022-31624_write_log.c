static int write_log(const char *message, size_t len, int take_lock)
{
  int result= 0;
  if (take_lock)
    flogger_mutex_lock(&lock_operations);

  if (output_type == OUTPUT_FILE)
  {
    if (logfile &&
        (is_active= (logger_write(logfile, message, len) == (int) len)))
      goto exit;
    ++log_write_failures;
    result= 1;
  }
  else if (output_type == OUTPUT_SYSLOG)
  {
    syslog(syslog_facility_codes[syslog_facility] |
           syslog_priority_codes[syslog_priority],
           "%s %.*s", syslog_info, (int) len, message);
  }
exit:
  if (take_lock)
    flogger_mutex_unlock(&lock_operations);
  return result;
}
