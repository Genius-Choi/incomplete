static void update_mode(MYSQL_THD thd  __attribute__((unused)),
              struct st_mysql_sys_var *var  __attribute__((unused)),
              void *var_ptr  __attribute__((unused)), const void *save)
{
  unsigned int new_mode= *(unsigned int *) save;
  if (mode_readonly || new_mode == mode)
    return;

  ADD_ATOMIC(internal_stop_logging, 1);
  if (!maria_55_started || !debug_server_started)
    flogger_mutex_lock(&lock_operations);
  mark_always_logged(thd);
  error_header();
  fprintf(stderr, "Logging mode was changed from %d to %d.\n", mode, new_mode);
  mode= new_mode;
  if (!maria_55_started || !debug_server_started)
    flogger_mutex_unlock(&lock_operations);
  ADD_ATOMIC(internal_stop_logging, -1);
}
