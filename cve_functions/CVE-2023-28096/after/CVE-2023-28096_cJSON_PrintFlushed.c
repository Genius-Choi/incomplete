int cJSON_PrintFlushed(cJSON *item, char *buf, const int len, const int fmt, flush_fn *func, void *param)
{
    printbuffer p;
	int ret;

    if (len < 0)
    {
        return false;
    }

	memset(&p, 0, sizeof(p));
    p.buffer = (unsigned char*)buf;
    p.length = (size_t)len;
    p.offset = 0;
    p.noalloc = true;
    p.flush = func;
    p.flush_p = param;
    ret = (print_value(item, 0, fmt, &p) != NULL);
	if (!ret || !p.offset)
		return ret;
		/* flush everything in the end */
	return (p.flush)(p.buffer, p.offset + 1/* last } */, p.flush_p) > 0;
}
