extern "C" HRESULT CacheGetPerMachineRootCompletedPath(
    __in BURN_CACHE* pCache,
    __out_z LPWSTR* psczCurrentRootCompletedPath,
    __out_z LPWSTR* psczDefaultRootCompletedPath
    )
{
    HRESULT hr = S_OK;

    *psczCurrentRootCompletedPath = NULL;
    *psczDefaultRootCompletedPath = NULL;

    hr = SecurePerMachineCacheRoot(pCache);
    ExitOnFailure(hr, "Failed to secure per-machine cache root.");

    hr = GetRootPath(pCache, TRUE, TRUE, psczCurrentRootCompletedPath);
    ExitOnFailure(hr, "Failed to get per-machine cache root.");

    if (S_FALSE == hr)
    {
        hr = GetRootPath(pCache, TRUE, FALSE, psczDefaultRootCompletedPath);
        ExitOnFailure(hr, "Failed to get default per-machine cache root.");

        hr = S_FALSE;
    }

LExit:
    return hr;
}
