static HRESULT AppendEscapedArgumentToCommandLine(
    __in_z LPCWSTR wzEscapedArgument,
    __deref_inout_z LPWSTR* psczCommandLine,
    __deref_inout_z_opt LPWSTR* psczObfuscatedCommandLine
    )
{
    HRESULT hr = S_OK;

    // If there is already data in the command line,
    // append a space before appending the argument.
    if (*psczCommandLine && **psczCommandLine)
    {
        hr = StrAllocConcatSecure(psczCommandLine, L" ", 0);
        ExitOnFailure(hr, "Failed to append space to command line with existing data.");
    }

    hr = StrAllocConcatSecure(psczCommandLine, wzEscapedArgument, 0);
    ExitOnFailure(hr, "Failed to append escaped command line argument.");

    if (psczObfuscatedCommandLine)
    {
        if (*psczObfuscatedCommandLine && **psczObfuscatedCommandLine)
        {
            hr = StrAllocConcat(psczObfuscatedCommandLine, L" ", 0);
            ExitOnFailure(hr, "Failed to append space to obfuscated command line with existing data.");
        }

        hr = StrAllocConcat(psczObfuscatedCommandLine, wzEscapedArgument, 0);
        ExitOnFailure(hr, "Failed to append escaped argument to obfuscated command line.");
    }

LExit:
    return hr;
}
