agoo_ws_req_close(agooCon c) {
    if (NULL != c->up && agoo_server.ctx_nil_value != c->up->ctx && c->up->on_close) {
	agooReq	req = agoo_req_create(0);

	req->up = c->up;
	req->method = AGOO_ON_CLOSE;
	req->hook = agoo_hook_create(AGOO_NONE, NULL, c->up->ctx, PUSH_HOOK, &agoo_server.eval_queue);
	atomic_fetch_add(&c->up->ref_cnt, 1);
	agoo_queue_push(&agoo_server.eval_queue, (void*)req);
    }
}
