con_ssl_setup(agooCon c) {
#ifdef HAVE_OPENSSL_SSL_H
    if (NULL == (c->ssl = SSL_new(agoo_server.ssl_ctx))) {
	con_ssl_error(c, "new SSL", 0, __FILE__, __LINE__);
    }
    if (!SSL_set_fd(c->ssl, c->sock)) {
	con_ssl_error(c, "SSL set fd", 0, __FILE__, __LINE__);
    }
    if (!SSL_accept(c->ssl)) {
	con_ssl_error(c, "SSL accept", 0, __FILE__, __LINE__);
    }
#else
    agoo_log_cat(&agoo_error_cat, "SSL not included in the build.");
    c->dead = true;
#endif
}
