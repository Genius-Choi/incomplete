runOnCallerIfComplete(
    folly::Executor* executor,
    SemiFuture<T> future,
    F&& func) {
  if (future.isReady()) {
    return func(std::move(future).get());
  } else {
    return std::move(future)
        .via(executor)
        .thenValueInline(std::forward<F>(func))
        .semi();
  }
}
