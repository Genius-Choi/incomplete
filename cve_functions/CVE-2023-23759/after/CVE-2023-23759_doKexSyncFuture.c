static SemiFuture<Optional<AsyncKeyExchange::DoKexResult>> doKexSyncFuture(
    KeyExchange* kex,
    std::unique_ptr<folly::IOBuf> clientShare) {
  AsyncKeyExchange::DoKexResult res;
  kex->generateKeyPair();
  res.sharedSecret = kex->generateSharedSecret(clientShare->coalesce());
  res.ourKeyShare = kex->getKeyShare();
  return folly::makeSemiFuture(Optional(std::move(res)));
  // Everything completed and clientShare can be safely freed now.
}
