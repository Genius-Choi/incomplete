        [&state](SemiFuture<Actions>& futureActions) -> AsyncActions {
          if (futureActions.isReady()) {
            // any exception thrown by get will be caught below
            return std::move(futureActions).get();
          }
          return std::move(futureActions)
              .deferError([&state](folly::exception_wrapper ew) {
                auto ex = ew.get_exception<FizzException>();
                if (ex) {
                  return detail::handleError(
                      state, ReportError(std::move(ew)), ex->getAlert());
                }
                return detail::handleError(
                    state,
                    ReportError(std::move(ew)),
                    AlertDescription::unexpected_message);
              });
        },
