write_vxlan_parameters(const NetplanNetDefinition* def, GString* s)
{
    g_assert(def->vxlan);
    GString* params = NULL;

    params = g_string_sized_new(200);

    if (def->tunnel.remote_ip) {
        if (is_multicast_address(def->tunnel.remote_ip))
            g_string_append_printf(params, "\nGroup=%s", def->tunnel.remote_ip);
        else
            g_string_append_printf(params, "\nRemote=%s", def->tunnel.remote_ip);
    }
    if (def->tunnel.local_ip)
        g_string_append_printf(params, "\nLocal=%s", def->tunnel.local_ip);
    if (def->vxlan->tos)
        g_string_append_printf(params, "\nTOS=%d", def->vxlan->tos);
    if (def->tunnel_ttl)
        g_string_append_printf(params, "\nTTL=%d", def->tunnel_ttl);
    if (def->vxlan->mac_learning != NETPLAN_TRISTATE_UNSET)
        g_string_append_printf(params, "\nMacLearning=%s", def->vxlan->mac_learning ? "true" : "false");
    if (def->vxlan->ageing)
        g_string_append_printf(params, "\nFDBAgeingSec=%d", def->vxlan->ageing);
    if (def->vxlan->limit)
        g_string_append_printf(params, "\nMaximumFDBEntries=%d", def->vxlan->limit);
    if (def->vxlan->arp_proxy != NETPLAN_TRISTATE_UNSET)
        g_string_append_printf(params, "\nReduceARPProxy=%s", def->vxlan->arp_proxy ? "true" : "false");
    if (def->vxlan->notifications) {
        if (def->vxlan->notifications & NETPLAN_VXLAN_NOTIFICATION_L2_MISS)
            g_string_append(params, "\nL2MissNotification=true");
        if (def->vxlan->notifications & NETPLAN_VXLAN_NOTIFICATION_L3_MISS)
            g_string_append(params, "\nL3MissNotification=true");
    }
    if (def->vxlan->short_circuit != NETPLAN_TRISTATE_UNSET)
        g_string_append_printf(params, "\nRouteShortCircuit=%s", def->vxlan->short_circuit ? "true" : "false");
    if (def->vxlan->checksums) {
        if (def->vxlan->checksums & NETPLAN_VXLAN_CHECKSUM_UDP)
            g_string_append(params, "\nUDPChecksum=true");
        if (def->vxlan->checksums & NETPLAN_VXLAN_CHECKSUM_ZERO_UDP6_TX)
            g_string_append(params, "\nUDP6ZeroChecksumTx=true");
        if (def->vxlan->checksums & NETPLAN_VXLAN_CHECKSUM_ZERO_UDP6_RX)
            g_string_append(params, "\nUDP6ZeroChecksumRx=true");
        if (def->vxlan->checksums & NETPLAN_VXLAN_CHECKSUM_REMOTE_TX)
            g_string_append(params, "\nRemoteChecksumTx=true");
        if (def->vxlan->checksums & NETPLAN_VXLAN_CHECKSUM_REMOTE_RX)
            g_string_append(params, "\nRemoteChecksumRx=true");
    }
    if (def->vxlan->extensions) {
        if (def->vxlan->extensions & NETPLAN_VXLAN_EXTENSION_GROUP_POLICY)
            g_string_append(params, "\nGroupPolicyExtension=true");
        if (def->vxlan->extensions & NETPLAN_VXLAN_EXTENSION_GENERIC_PROTOCOL)
            g_string_append(params, "\nGenericProtocolExtension=true");
    }
    if (def->tunnel.port)
        g_string_append_printf(params, "\nDestinationPort=%d", def->tunnel.port);
    if (def->vxlan->source_port_min && def->vxlan->source_port_max)
        g_string_append_printf(params, "\nPortRange=%u-%u",
                               def->vxlan->source_port_min,
                               def->vxlan->source_port_max);
    if (def->vxlan->flow_label != G_MAXUINT)
        g_string_append_printf(params, "\nFlowLabel=%d", def->vxlan->flow_label);
    if (def->vxlan->do_not_fragment != NETPLAN_TRISTATE_UNSET)
        g_string_append_printf(params, "\nIPDoNotFragment=%s", def->vxlan->do_not_fragment ? "true" : "false");
    if (!def->vxlan->link)
        g_string_append(params, "\nIndependent=true");

    if (params->len)
        g_string_append_printf(s, "%s\n", params->str);

    g_string_free(params, TRUE);
}
