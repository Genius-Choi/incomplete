runas_getgroups(const struct sudoers_context *ctx)
{
    const struct passwd *pw;
    debug_decl(runas_getgroups, SUDOERS_DEBUG_MATCH);

    if (def_preserve_groups) {
	sudo_gidlist_addref(ctx->user.gid_list);
	debug_return_ptr(ctx->user.gid_list);
    }

    /* Only use results from a group db query, not the front end. */
    pw = ctx->runas.pw ? ctx->runas.pw : ctx->user.pw;
    debug_return_ptr(sudo_get_gidlist(pw, ENTRY_TYPE_QUERIED));
}
