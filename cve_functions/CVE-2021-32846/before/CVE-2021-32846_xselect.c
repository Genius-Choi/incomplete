static int xselect(const char *ctx,
		   int nfds, fd_set *readfds, fd_set *writefds,
		   fd_set *errorfds, struct timeval *timeout)
{
	int rc = select(nfds, readfds, writefds, errorfds, timeout);
	if (rc >= 0) return rc;

	/*
	 * http://pubs.opengroup.org/onlinepubs/009695399/functions/select.html
	 * lists EINTR, EBADF and EINVAL. EINTR is recoverable and should be
	 * retried.
	 */
	if (errno == EINTR) return -1;
	/*
	 * OSX select(2) man page lists EAGAIN in addition to the above.
	 * EAGAIN should be retried.
	*/
	if (errno == EAGAIN) return -1;

	fprintf(stderr, "%s: select() failed %d: %s\n",
		ctx, errno, strerror(errno));
	abort();
}
