void FS_Shutdown( qboolean closemfp ) {
	searchpath_t	*p, *next;
	int	i;

#if defined(_WIN32)
	// Delete temporary files
	fs_temporaryFileWriteIdx = 0;
	for ( size_t i = 0; i < ARRAY_LEN(fs_temporaryFileNames); i++ )
	{
		if (fs_temporaryFileNames[i][0] != '\0')
		{
			if ( !DeleteFile(fs_temporaryFileNames[i]) )
			{
				DWORD error = GetLastError();
				Com_DPrintf("FS_Shutdown: failed to delete '%s'. "
							"Win32 error code: 0x08x",
							fs_temporaryFileNames[i],
							error);
			}

			fs_temporaryFileNames[i][0] = '\0';
		}
	}
#endif

	for(i = 0; i < MAX_FILE_HANDLES; i++) {
		if (fsh[i].fileSize) {
			FS_FCloseFile(i);
		}
	}

	// free everything
	for ( p = fs_searchpaths ; p ; p = next ) {
		next = p->next;

		if ( p->pack ) {
			FS_FreePak( p->pack );
		}
		if ( p->dir ) {
			Z_Free( p->dir );
		}
		Z_Free( p );
	}

	// any FS_ calls will now be an error until reinitialized
	fs_searchpaths = NULL;

	Cmd_RemoveCommand( "path" );
	Cmd_RemoveCommand( "dir" );
	Cmd_RemoveCommand( "fdir" );
	Cmd_RemoveCommand( "touchFile" );
	Cmd_RemoveCommand( "which" );

#ifdef FS_MISSING
	if (closemfp) {
		fclose(missingFiles);
	}
#endif
}
