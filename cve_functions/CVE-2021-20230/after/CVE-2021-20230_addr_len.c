socklen_t addr_len(const SOCKADDR_UNION *addr) {
    switch(addr->sa.sa_family) {
    case AF_UNSPEC: /* 0 */
        return 0;
    case AF_INET: /* 2 (almost universally) */
        return sizeof(struct sockaddr_in);
#ifdef USE_IPv6
    case AF_INET6:
        return sizeof(struct sockaddr_in6);
#endif
#ifdef HAVE_STRUCT_SOCKADDR_UN
    case AF_UNIX:
        return sizeof(struct sockaddr_un);
#endif
    }
    s_log(LOG_ERR, "INTERNAL ERROR: Unknown sa_family: %d",
        addr->sa.sa_family);
    return sizeof(SOCKADDR_UNION);
}
