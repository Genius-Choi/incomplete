static void bundle_ssrc(enum bundle_type type, struct conf_member *cm,
			struct bundle *bundle,
			struct sdp_session *sess, struct sdp_media *sdpm)
{
	struct sdp_media *newm;
	const char *mtype;
	uint32_t ssrc;
	uint32_t mid;
	bool disabled = false;
	int lport;
	int err;

	switch (type) {
	case BUNDLE_TYPE_AUDIO:
		ssrc = cm->ssrca;
		mtype = sdp_media_audio;
		if (cm->mida == 0) {
			cm->mida = g_mid;
			g_mid++;
		}
		mid = cm->mida;
		break;

	case BUNDLE_TYPE_VIDEO:
		ssrc = cm->ssrcv;
		mtype = sdp_media_video;
		if (cm->midv == 0) {
			cm->midv = g_mid;
			g_mid++;
		}
		mid = cm->midv;
		break;

	default:
		warning("bundle_ssrc: unknown bundle type\n");
		return;
	}

	disabled = ssrc == 0 || !cm->active;
	lport = 9; //disabled ? 0 : 9;
	err = sdp_media_add(&newm, sess, mtype, lport,
			    sdp_media_proto(sdpm));
	if (err) {
		warning("bundle_ssrc: video add failed: %m\n", err);
		return;
	}
	
	sdp_media_set_disabled(newm, false);
	sdp_media_set_laddr(newm, sdp_media_raddr(sdpm));
	sdp_media_set_lport(newm, lport);
	sdp_media_set_lattr(newm, false, "mid", "%u", mid);
	if (!disabled) {
		sdp_media_set_lattr(newm, false, "ssrc", "%u cname:%s",
				    ssrc, cm->cname);
		sdp_media_set_lattr(newm, false, "ssrc", "%u msid:%s %s",
				    ssrc, cm->msid, cm->label);
		sdp_media_set_lattr(newm, false, "ssrc", "%u mslabel:%s",
				    ssrc, cm->msid);
		sdp_media_set_lattr(newm, false, "ssrc", "%u label:%s",
				    ssrc, cm->label);
	}

	sdp_media_format_apply(sdpm, false, NULL, -1, NULL,
			       -1, -1, fmt_handler, newm);

	sdp_media_rattr_apply(sdpm, NULL,
			      media_rattr_handler, newm);

	sdp_media_set_ldir(newm, disabled ? SDP_INACTIVE : SDP_SENDONLY);
	sdp_media_set_lbandwidth(newm, SDP_BANDWIDTH_AS,
				 sdp_media_rbandwidth(sdpm, SDP_BANDWIDTH_AS));

	mbuf_printf(bundle->mb, " %u", mid);
}
