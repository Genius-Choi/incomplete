mg_stat(const struct mg_connection *conn,
        const char *path,
        struct mg_file_stat *filep)
{
	struct stat st;
	if (!filep) {
		return 0;
	}
	memset(filep, 0, sizeof(*filep));

	if (conn && is_file_in_memory(conn, path)) {

		/* Quick fix (for 1.9.x): */
		/* mg_stat must fill all fields, also for files in memory */
		struct mg_file tmp_file = STRUCT_FILE_INITIALIZER;
		open_file_in_memory(conn, path, &tmp_file, MG_FOPEN_MODE_NONE);
		filep->size = tmp_file.stat.size;
		filep->last_modified = time(NULL);
		filep->location = 2;
		/* TODO: remove legacy "files in memory" feature */

		return 1;
	}

	if (0 == stat(path, &st)) {
		filep->size = (uint64_t)(st.st_size);
		filep->last_modified = st.st_mtime;
		filep->is_directory = S_ISDIR(st.st_mode);
		return 1;
	}

	return 0;
}
