int encode_pb(const void *source_ptr, const pb_field_t *fields,  uint8_t *buffer, uint32_t len )
{
    pb_ostream_t os = pb_ostream_from_buffer(buffer, len);

    if (!pb_encode(&os, fields, source_ptr))
        return 0;

    return os.bytes_written;
}
