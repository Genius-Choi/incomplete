static void mbedtls_init(TLS_IO_INSTANCE *tls_io_instance)
{
    const char* pers = "azure_iot_client";
    if (tls_io_instance->tls_status != TLS_STATE_INITIALIZED)
    {
        if (tls_io_instance->tls_status == TLS_STATE_CLOSING)
        {
            // The underlying connection has been closed, so here un-initialize first
            mbedtls_uninit(tls_io_instance);
        }
        // mbedTLS initialize...
        mbedtls_x509_crt_init(&tls_io_instance->trusted_certificates_parsed);
        mbedtls_x509_crt_init(&tls_io_instance->owncert);
        mbedtls_pk_init(&tls_io_instance->pKey);

        mbedtls_entropy_init(&tls_io_instance->entropy);
        // Add a weak entropy source here,avoid some platform doesn't have strong / hardware entropy
        mbedtls_entropy_add_source(&tls_io_instance->entropy, tlsio_entropy_poll, NULL, MBEDTLS_ENTROPY_MAX_GATHER, MBEDTLS_ENTROPY_SOURCE_WEAK);

        mbedtls_ctr_drbg_init(&tls_io_instance->ctr_drbg);
        mbedtls_ctr_drbg_seed(&tls_io_instance->ctr_drbg, mbedtls_entropy_func, &tls_io_instance->entropy, (const unsigned char *)pers, strlen(pers));

        mbedtls_ssl_config_init(&tls_io_instance->config);
        mbedtls_ssl_config_defaults(&tls_io_instance->config, MBEDTLS_SSL_IS_CLIENT, MBEDTLS_SSL_TRANSPORT_STREAM, MBEDTLS_SSL_PRESET_DEFAULT);
        mbedtls_ssl_conf_rng(&tls_io_instance->config, mbedtls_ctr_drbg_random, &tls_io_instance->ctr_drbg);
        mbedtls_ssl_conf_authmode(&tls_io_instance->config, MBEDTLS_SSL_VERIFY_REQUIRED);
        mbedtls_ssl_conf_min_version(&tls_io_instance->config, MBEDTLS_SSL_MAJOR_VERSION_3, MBEDTLS_SSL_MINOR_VERSION_3); // v1.2

        mbedtls_ssl_init(&tls_io_instance->ssl);
        mbedtls_ssl_set_bio(&tls_io_instance->ssl, tls_io_instance, on_io_send, on_io_recv, NULL);
        mbedtls_ssl_set_hostname(&tls_io_instance->ssl, tls_io_instance->hostname);

        mbedtls_ssl_session_init(&tls_io_instance->ssn);

        mbedtls_ssl_set_session(&tls_io_instance->ssl, &tls_io_instance->ssn);
        mbedtls_ssl_setup(&tls_io_instance->ssl, &tls_io_instance->config);

        tls_io_instance->tls_status = TLS_STATE_INITIALIZED;
    }
}
