static Bool mpeg2ps_seek_frame (mpeg2ps_t *ps,
				mpeg2ps_stream_t *sptr,
				u64 search_msec_timestamp)
{
  u64 dts;
  mpeg2ps_record_pes_t *rec;
  u64 msec_ts;
  u8 *buffer;
  u32 buflen;

  check_fd_for_stream(ps, sptr);
  clear_stream_buffer(sptr);

  if (search_msec_timestamp <= 1000) { // first second, start from begin...
    file_seek_to(sptr->m_fd, sptr->first_pes_loc);
    return GF_TRUE;
  }
  dts = search_msec_timestamp * 90; // 1000 timescale to 90000 timescale
  dts += ps->first_dts;

  /*
   * see if the recorded data has anything close
   */
  rec = search_for_ts(sptr, dts);
  if (rec != NULL) {
    // see if it is close
    // if we're plus or minus a second, seek to that.
    if (rec->dts + 90000 >= dts && rec->dts <= dts + 90000) {
      file_seek_to(sptr->m_fd, rec->location);
      return GF_TRUE;
    }
    // at this point, rec is > a distance.  If within 5 or so seconds,

    if (rec->dts + (5 * 90000) < dts) {
      // more than 5 seconds away - skip and search
      if (rec->next_rec == NULL) {
		  mpeg2ps_binary_seek(ps, sptr, dts,
			    rec->dts, rec->location,
			    sptr->end_dts, sptr->end_dts_loc);
      } else {
		  mpeg2ps_binary_seek(ps, sptr, dts,
			    rec->dts, rec->location,
			    rec->next_rec->dts, rec->next_rec->location);
      }
    }
    // otherwise, frame by frame search...
  } else {
    // we weren't able to find anything from the recording
    mpeg2ps_binary_seek(ps, sptr, dts,
			sptr->start_dts, sptr->first_pes_loc,
			sptr->end_dts, sptr->end_dts_loc);
  }
  /*
   * Now, the fun part - read frames until we're just past the time
   */
  clear_stream_buffer(sptr); // clear out any data, so we can read it
  do {
    if (mpeg2ps_stream_read_frame(sptr, &buffer, &buflen, GF_FALSE) == GF_FALSE)
      return GF_FALSE;

    msec_ts = stream_convert_frame_ts_to_msec(sptr, TS_MSEC,
					      ps->first_dts, NULL);

    if (msec_ts < search_msec_timestamp) {
      // only advance the frame if we're not greater than the timestamp
      advance_frame(sptr);
    }
  } while (msec_ts < search_msec_timestamp);

  return GF_TRUE;
}
