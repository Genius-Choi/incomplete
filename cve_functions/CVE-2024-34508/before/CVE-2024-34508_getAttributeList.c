getAttributeList(DcmDataset *obj, DcmTagKey t, Uint16 **lst, int *listCount)
{
    DcmElement *elem;
    DcmStack stack;
    OFCondition ec = EC_Normal;
    Uint16 *aList = NULL;
    Uint32 nBytes = 0;

    ec = obj->search(t, stack);
    elem = (DcmElement*)stack.top();
    if (ec == EC_Normal && elem != NULL) {
        nBytes = elem->getLength();
        *listCount = (int)(nBytes / sizeof(Uint16));
        if (*listCount > 0) {
            *lst = (Uint16*)malloc((size_t)(nBytes + 1));
            ec = elem->getUint16Array(aList);
            memcpy(*lst, aList, (size_t)nBytes);
        } else {
            *lst = NULL;
        }
    }

    return (ec == EC_Normal)?(EC_Normal):(DIMSE_PARSEFAILED);
}
