buildCStoreRSP(T_DIMSE_C_StoreRSP * e, DcmDataset * obj)
{
    OFCondition cond = buildCommonRSP(obj, DIMSE_C_STORE_RSP,
        e->MessageIDBeingRespondedTo,
        OFstatic_cast(Uint16, e->DataSetType), e->DimseStatus); RET(cond);

    /* build optional items */
    if (e->opts & O_STORE_AFFECTEDSOPCLASSUID) {
        cond = addString(obj, DCM_AffectedSOPClassUID,
            e->AffectedSOPClassUID, OFFalse); RET(cond);
    }
    if (e->opts & O_STORE_AFFECTEDSOPINSTANCEUID)
    {
        char instanceuid[DIC_UI_LEN + 10];
        OFStandard::strlcpy(instanceuid, e->AffectedSOPInstanceUID, DIC_UI_LEN + 10);
        if ((e->opts & O_STORE_PEER_REQUIRES_EXACT_UID_COPY) &&
            (e->opts & O_STORE_RSP_BLANK_PADDING))
        {
            // restore illegal space padding.
            OFStandard::strlcat(instanceuid, " ", DIC_UI_LEN + 10);
        }
        cond = addString(obj, DCM_AffectedSOPInstanceUID, instanceuid, OFTrue); RET(cond);
    }
    return cond;
}
