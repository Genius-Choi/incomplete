bool AdminRequestHandler::handleDumpCacheRequest(const std::string &cmd,
                                                 Transport *transport) {
  if (cmd == "dump-apc") {
    if (!apcExtension::Enable) {
      transport->sendString("No APC\n");
      return true;
    }
    string keyOnlyParam = transport->getParam("keyonly");
    bool keyOnly = false;
    if (keyOnlyParam == "true" || keyOnlyParam == "1") {
      keyOnly = true;
    }
    apc_dump("/tmp/apc_dump", keyOnly, false);
    transport->sendString("Done");
    return true;
  }
  if (cmd == "dump-apc-prefix") {
    if (!apcExtension::Enable) {
      transport->sendString("No APC\n");
      return true;
    }
    auto const prefix = transport->getParam("prefix");
    if (prefix.empty()) {
      transport->sendString("No prefix provided\n");
      return true;
    }
    auto const countStr = transport->getParam("count");

    uint32_t count = 1;
    try {
      count = countStr.empty() ? count : folly::to<uint32_t>(countStr);
    } catch (...) {
      // use default if invalid count
    }
    apc_dump_prefix("/tmp/apc_dump_prefix", prefix, count);
    transport->sendString("Done");
    return true;
  }
  if (cmd == "dump-apc-info") {
    if (!apcExtension::Enable) {
      transport->sendString("No APC\n");
      return true;
    }
    transport->sendString(APCStats::getAPCStats().getStatsInfo());
    return true;
  }
  if (cmd == "dump-apc-meta") {
    if (!apcExtension::Enable) {
      transport->sendString("No APC\n");
      return true;
    }
    apc_dump("/tmp/apc_dump_meta", false, true);
    transport->sendString("Done");
    return true;
  }
  return false;
}
