void AdminRequestHandler::teardownRequest(Transport* transport) noexcept {
  SCOPE_EXIT {
    auto const cmd = transport->getCommand();

    if (strncmp(cmd.c_str(), "dump-apc", 8) == 0) {
      hphp_context_exit();
      hphp_session_exit();
    } else {
      hphp_memory_cleanup();
    }
  };
  GetAccessLog().log(transport, nullptr);
  WarnIfNotOK(transport);
}
