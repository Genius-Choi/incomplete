static int dtls_bio_filter_new(BIO *bio) {
	/* Create a filter state struct */
	dtls_bio_filter *filter;
	switch_memory_pool_t *pool;

	switch_core_new_memory_pool(&pool);
	filter = switch_core_alloc(pool, sizeof(*filter));
	filter->pool = pool;

	filter->packets = NULL;
	switch_mutex_init(&filter->mutex, SWITCH_MUTEX_NESTED, filter->pool);
 
	/* Set the BIO as initialized */
#if OPENSSL_VERSION_NUMBER < 0x10100000L
	bio->init = 1;
	bio->ptr = filter;
	bio->flags = 0;
#else
	BIO_set_init(bio, 1);
	BIO_set_data(bio, filter);
	BIO_clear_flags(bio, ~0);
#endif
	
	return 1;
}
