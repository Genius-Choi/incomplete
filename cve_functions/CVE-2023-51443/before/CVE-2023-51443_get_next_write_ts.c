static uint8_t get_next_write_ts(switch_rtp_t *rtp_session, uint32_t timestamp)
{
	uint8_t m = 0, changed = 0;

	if (!(rtp_session->rtp_bugs & RTP_BUG_SEND_LINEAR_TIMESTAMPS)) {
		if (timestamp) {
			rtp_session->ts = (uint32_t) timestamp;
			changed++;
		} else if (switch_rtp_test_flag(rtp_session, SWITCH_RTP_FLAG_USE_TIMER)) {
			switch_core_timer_next(&rtp_session->write_timer);
			rtp_session->ts = rtp_session->write_timer.samplecount;
			changed++;
		}
	}

	if (!changed) {
		rtp_session->ts = rtp_session->last_write_ts + rtp_session->samples_per_interval;
	} else {
		/* Send marker bit if timestamp is lower/same as before (resetted/new timer) */
		if (abs((int32_t)(rtp_session->ts - rtp_session->last_write_ts)) > rtp_session->samples_per_interval 
			&& !(rtp_session->rtp_bugs & RTP_BUG_NEVER_SEND_MARKER)) {
			m++;
		}
	}

	return m;
}
