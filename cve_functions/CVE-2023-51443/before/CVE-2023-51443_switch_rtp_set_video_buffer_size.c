SWITCH_DECLARE(switch_status_t) switch_rtp_set_video_buffer_size(switch_rtp_t *rtp_session, uint32_t frames, uint32_t max_frames)
{
	if (!switch_rtp_ready(rtp_session)) {
		return SWITCH_STATUS_FALSE;
	}

	if (!max_frames) {
		max_frames = rtp_session->last_max_vb_frames;
	}

	if (!max_frames || frames >= max_frames) {
		max_frames = frames * 10;
	}

	rtp_session->last_max_vb_frames = max_frames;

	if (!rtp_session->vb) {
		switch_jb_create(&rtp_session->vb, rtp_session->flags[SWITCH_RTP_FLAG_TEXT] ? SJB_TEXT : SJB_VIDEO, frames, max_frames, rtp_session->pool);
		switch_jb_set_session(rtp_session->vb, rtp_session->session);
	} else {
		switch_jb_set_frames(rtp_session->vb, frames, max_frames);
	}

	//switch_rtp_flush(rtp_session);
	switch_core_session_request_video_refresh(rtp_session->session);

	switch_log_printf(SWITCH_CHANNEL_SESSION_LOG(rtp_session->session), SWITCH_LOG_DEBUG1, "Setting video buffer %u Frames.\n", frames);

	return SWITCH_STATUS_SUCCESS;
}
