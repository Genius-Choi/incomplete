struct mg_connection *mg_connect_ws_opt(
    struct mg_mgr *mgr, MG_CB(mg_event_handler_t ev_handler, void *user_data),
    struct mg_connect_opts opts, const char *url, const char *protocol,
    const char *extra_headers) {
  char *user = NULL, *pass = NULL, *addr = NULL;
  const char *path = NULL;
  struct mg_connection *nc =
      mg_connect_http_base(mgr, MG_CB(ev_handler, user_data), opts, "ws://",
                           "wss://", url, &path, &user, &pass, &addr);

  if (nc != NULL) {
    mg_send_websocket_handshake3(nc, path, addr, protocol, extra_headers, user,
                                 pass);
  }

  MG_FREE(addr);
  MG_FREE(user);
  MG_FREE(pass);
  return nc;
}
