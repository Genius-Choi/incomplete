streamDataPDUHead(DUL_DATAPDU * pdu, unsigned char *buf,
      unsigned long maxLength, unsigned long *rtnLen)
{
    unsigned long l;

#ifdef PDV_TEST
    if (maxLength < 18)
    {
      return makeDcmnetCondition(DULC_CODINGERROR, OF_error, "Coding Error in DUL routine: buffer too short in streamDataPDUHead");
    }

#else
    if (maxLength < 12)
    {
      return makeDcmnetCondition(DULC_CODINGERROR, OF_error, "Coding Error in DUL routine: buffer too short in streamDataPDUHead");
    }

#endif

    /* write PDU type field information to buffer */
    *buf++ = pdu->type;
    /* append PDU reserved field information to buffer */
    *buf++ = pdu->rsv1;
    /* append PDU length field information to buffer */
    l = pdu->length;
#ifdef PDV_TEST
    l += 6;
#endif

    COPY_LONG_BIG(l, buf);
    buf += 4;

#ifdef PDV_TEST
    l = 2;      /* Insert a false, 0-length PDV (2 byte hdr) */
    COPY_LONG_BIG(l, buf);
    buf += 4;
    *buf++ = pdu->presentationDataValue.presentationContextID;
    *buf++ = pdu->presentationDataValue.messageControlHeader & (~0x2);
#endif

    /* append PDV length field information to buffer */
    COPY_LONG_BIG(pdu->presentationDataValue.length, buf);
    buf += 4;
    /* append PDV presentation context ID field information to buffer */
    *buf++ = pdu->presentationDataValue.presentationContextID;
    /* append PDV message control header field information to buffer */
    *buf++ = pdu->presentationDataValue.messageControlHeader;

    /* set rtnLen (actual length of constructed PDU) */
    *rtnLen = 12;
#ifdef PDV_TEST
    *rtnLen = 18;
#endif

    return EC_Normal;
}
