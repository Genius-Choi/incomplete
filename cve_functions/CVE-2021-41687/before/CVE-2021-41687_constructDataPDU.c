constructDataPDU(void *buf, unsigned long length, DUL_DATAPDV type,
                 DUL_PRESENTATIONCONTEXTID presentationContextID,
                 OFBool last, DUL_DATAPDU * pdu)
{
    unsigned char u;

    pdu->type = DUL_TYPEDATA;
    pdu->rsv1 = 0;
    pdu->length = length + 6;

    pdu->presentationDataValue.length = 2 + length;
    u = 0;
    switch (type) {
    case DUL_DATASETPDV:
        break;
    case DUL_COMMANDPDV:
        u |= 1;
        break;
    default:
        break;
    }
    if (last)
        u |= 2;

    pdu->presentationDataValue.presentationContextID = presentationContextID;
    pdu->presentationDataValue.messageControlHeader = u;
    pdu->presentationDataValue.data = buf;
    return EC_Normal;
}
