static int cjwt_parse_payload( cjwt_t *p_cjwt, char *p_payload )
{
    int ret, sz_payload;
    size_t pl_desize;
    size_t out_size = 0;
    uint8_t *decoded_pl;

    if( !p_cjwt || !p_payload ) {
        return EINVAL;
    }

    sz_payload = strlen( ( char * )p_payload );
    pl_desize = b64url_get_decoded_buffer_size( sz_payload );
    cjwt_info( "----------------- payload ------------------- \n" );
    cjwt_info( "Payload Size = %d , Decoded size = %d\n", sz_payload, ( int )pl_desize );
    decoded_pl = malloc( pl_desize + 1 );

    if( !decoded_pl ) {
        return ENOMEM;
    }

    memset( decoded_pl, 0, ( pl_desize + 1 ) );
    //decode payload
    out_size = b64url_decode( ( uint8_t * )p_payload, sz_payload, decoded_pl );
    cjwt_info( "Bytes = %d\n", ( int )out_size );

    if( !out_size ) {
        ret = EINVAL;
        goto end;
    }

    decoded_pl[out_size] = '\0';
    cjwt_info( "Raw data  = %*s\n", ( int )out_size, decoded_pl );
    ret = cjwt_update_payload( p_cjwt, ( char* )decoded_pl );
end:
    free( decoded_pl );
    return ret;
}
