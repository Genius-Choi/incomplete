ssize_t read_file( const char *fname, char *buf, size_t buflen )
{
    ssize_t nbytes = 0;
    int fd = open_input_file( fname );

    if( fd < 0 ) {
        return fd;
    }

    nbytes = read( fd, buf, buflen );

    if( nbytes < 0 ) {
        printf( "Read file %s error\n", fname );
        close( fd );
        return nbytes;
    }

    close( fd );
    return nbytes;
}
