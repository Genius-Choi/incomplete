bool canOutOfMemoryKillUnitTests()
{
    // test if out of memory conditions will kill the unit test process
    // which prevents tests completing

#if defined(_WIN32)
    // on Windows 32/64 allocations close to size of VM address space always fail gracefully
    bool canTerminateProcess = false;
#elif defined( __APPLE__ )
    // on macOS/iOS allocations close to size of VM address space fail gracefully
    // unless Address Sanitizer (ASAN) is enabled
#if __has_feature(address_sanitizer)
    // ASAN terminates the process if alloc fails - and using allocator_may_return_null=1
    // to continue after an allocation doesn't work in C++ because new returns null which is
    // forbidden by the C++ spec and terminates process when 'this' is dereferenced in constructor
    // see https://github.com/google/sanitizers/issues/295
    bool canTerminateProcess = true;
#else
    // if alloc fails following message is logged
    // *** mach_vm_map failed (error code=3)
    // *** error: can't allocate region
    // *** set a breakpoint in malloc_error_break to debug
    bool canTerminateProcess = false;
#endif
#elif defined( __linux__ )
    // TODO do big allocs succeed then trigger OOM-killer fiasco??
    bool canTerminateProcess = false;
#else
    // other systems - assume big allocs faily gracefully and throw bad_alloc
    bool canTerminateProcess = false;
#endif
    return canTerminateProcess;
}
