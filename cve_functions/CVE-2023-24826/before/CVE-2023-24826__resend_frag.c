static int _resend_frag(clist_node_t *node, void *fbuf_ptr)
{
    _frag_desc_t *frag_desc = (_frag_desc_t *)node;
    gnrc_sixlowpan_frag_fb_t *fbuf = fbuf_ptr;
    gnrc_pktsnip_t *frag, *pkt = fbuf->pkt;
    sixlowpan_sfr_rfrag_t *hdr;
    uint8_t *data;
    uint16_t frag_size = _frag_size(frag_desc), cur_frag_size;

    frag = _build_frag_pkt(pkt->data, (uint8_t)fbuf->tag, false,
                           frag_size, 0);
    if (frag == NULL) {
        DEBUG("6lo sfr: error allocating fragment to resend\n");
        return 1;
    }
    hdr = frag->next->data;
    /* is last fragment in window */
    if ((!gnrc_sixlowpan_frag_sfr_congure_snd_in_cwnd(fbuf) ||
         (fbuf->offset >= fbuf->datagram_size)) &&
        (clist_node_t *)frag_desc == clist_rpeek(&fbuf->sfr.window)) {
        frag_desc->ar_seq_fs |= (SIXLOWPAN_SFR_ACK_REQ << 8U);
        _sched_arq_timeout(fbuf, fbuf->sfr.arq_timeout);
    }
    hdr->ar_seq_fs = byteorder_htons(frag_desc->ar_seq_fs);
    if (frag_desc->offset > 0) {
        sixlowpan_sfr_rfrag_set_offset(hdr, frag_desc->offset);
    }
    else {
        sixlowpan_sfr_rfrag_set_offset(hdr, fbuf->datagram_size);
    }

    data = (uint8_t *)(hdr + 1);
    pkt = pkt->next;    /* don't copy netif header */
    cur_frag_size = _find_offset_and_copy_rest(data, &pkt, frag_size,
                                               frag_desc->offset);
    /* copy remaining packet snips */
    _copy_pkt_to_frag(data, pkt, frag_size, cur_frag_size);
    DEBUG("6lo sfr: resending fragment (retry: %u, tag: %u, X: %i, seq: %u, "
          "frag_size: %u, %s: %u)\n", frag_desc->super.resends,
          hdr->base.tag, sixlowpan_sfr_rfrag_ack_req(hdr),
          sixlowpan_sfr_rfrag_get_seq(hdr),
          sixlowpan_sfr_rfrag_get_frag_size(hdr),
          (sixlowpan_sfr_rfrag_get_seq(hdr)) ? "offset" : "datagram_size",
          sixlowpan_sfr_rfrag_get_offset(hdr));
    if (_send_frame(frag, fbuf, NULL, 0)) {
        frag_desc->super.send_time = _last_frame_sent / US_PER_MS;
        return 0;
    }
    else {
        return 1;
    }
}
