struct pico_frame *pico_ipv4_alloc(struct pico_stack *S, struct pico_protocol *self, struct pico_device *dev, uint16_t size)
{
    struct pico_frame *f = NULL;
    IGNORE_PARAMETER(self);

    f = pico_proto_ethernet.alloc(S, &pico_proto_ethernet, dev, (uint16_t)(size + PICO_SIZE_IP4HDR));
    /* TODO: In 6LoWPAN topic branch update to make use of dev->ll_mode */

    if (!f)
        return NULL;

    f->net_len = PICO_SIZE_IP4HDR;
    f->transport_hdr = f->net_hdr + PICO_SIZE_IP4HDR;
    f->transport_len = (uint16_t)size;

    /* Datalink size is accounted for in pico_datalink_send (link layer) */
    f->len =  (uint32_t)(size + PICO_SIZE_IP4HDR);

    return f;
}
