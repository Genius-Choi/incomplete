struct pico_device *pico_ipv4_source_dev_find(struct pico_stack *S, const struct pico_ip4 *dst)
{
    struct pico_device *dev = NULL;
    struct pico_ipv4_route *rt;

    if (!dst) {
        pico_err = PICO_ERR_EINVAL;
        return NULL;
    }

    rt = route_find(S, dst);
    if (rt && rt->link) {
        dev = rt->link->dev;
    } else {
        pico_err = PICO_ERR_EHOSTUNREACH;
    }

    return dev;
}
