struct pico_ip4 *pico_ipv4_source_find(struct pico_stack *S, const struct pico_ip4 *dst)
{
    struct pico_ip4 *myself = NULL;
    struct pico_ipv4_route *rt;
#ifdef PICO_SUPPORT_AODV
    union pico_address node_address;
    node_address.ip4.addr = dst->addr;
    if (dst->addr && pico_ipv4_is_unicast(dst->addr))
        pico_aodv_lookup(S, &node_address);

#endif

    if (!dst) {
        pico_err = PICO_ERR_EINVAL;
        return NULL;
    }

    rt = route_find(S, dst);
    if (rt && rt->link) {
        myself = &rt->link->address;
    } else {
        pico_err = PICO_ERR_EHOSTUNREACH;
    }

    return myself;
}
