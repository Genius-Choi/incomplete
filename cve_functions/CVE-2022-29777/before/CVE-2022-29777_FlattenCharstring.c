    Type1Charstring CFontFileType1::FlattenCharstring(Type1Charstring& oCharstring, int nBias)
    {
        Type1Charstring oNew;
        oNew.nLSB   = oCharstring.nLSB;
        oNew.nWidth = oCharstring.nWidth;

        for ( int nIndex = 0; nIndex < oCharstring.arrCharstring.GetSize(); nIndex++ )
        {
            Type1CharstringItem oItem = oCharstring.arrCharstring[nIndex];
            int nValue = oItem.nValue;
            if ( oItem.bCommand )
            {
                if ( nValue == c_nType1sub )
                {
                    oNew.arrCharstring.Add( Type1CharstringItem( 12, true ) );
                    oNew.arrCharstring.Add( Type1CharstringItem( 11, true ) );
                }
                else if ( nValue == c_nType1div )
                {
                    oNew.arrCharstring.Add( Type1CharstringItem( 12, true ) );
                    oNew.arrCharstring.Add( Type1CharstringItem( 12, true ) );
                }
                else if ( nValue == c_nType1pop )
                {
                    //oNew.arrCharstring.Add( Type1CharstringItem( 1, true ) );
                    oNew.arrCharstring.Add( Type1CharstringItem( 12, true ) );
                    oNew.arrCharstring.Add( Type1CharstringItem( 18, true ) );
                }
                else if ( nValue == c_nType1callsubr  )
                {
                    //int nTempLen = oNew.arrCharstring.GetSize();
                    //int nT1 = oNew.arrCharstring[nTempLen - 2].nValue;
                    //int nT2 = oNew.arrCharstring[nTempLen - 1].nValue;
                    //int nInd = nT1 << 8 | nT2;

                    //if ( 107 == nBias )
                    //{
                    //	if ( nInd <= 215 )
                    //	{
                    //		oNew.arrCharstring.RemoveAt( nTempLen - 1 );
                    //		oNew.arrCharstring.RemoveAt( nTempLen - 2 );

                    //		oNew.arrCharstring[nTempLen - 3].nValue = nInd - nBias + 139;
                    //		oNew.arrCharstring.Add( Type1CharstringItem( oItem.nValue, true ) );
                    //	}
                    //	else
                    //	{
                    //		oNew.arrCharstring.RemoveAt( nTempLen - 1 );

                    //		oNew.arrCharstring[nTempLen - 3].nValue = ((nInd - nBias) - 108) / 256 + 247;
                    //		oNew.arrCharstring[nTempLen - 2].nValue = ((nInd - nBias) - 108) - (oNew.arrCharstring[nTempLen - 3].nValue - 247) * 256;
                    //		oNew.arrCharstring.Add( Type1CharstringItem( oItem.nValue, true ) );
                    //	}
                    //}
                    //else
                    //{

                    //	nInd -= nBias;
                    //	oNew.arrCharstring[nTempLen - 2].nValue = nInd >> 8;
                    //	oNew.arrCharstring[nTempLen - 1].nValue = nInd & 0xFF;
                    //	oNew.arrCharstring.Add( Type1CharstringItem( oItem.nValue, true ) );
                    //}
                    oNew.arrCharstring.Add( Type1CharstringItem( oItem.nValue, true ) );
                }
                else
                    oNew.arrCharstring.Add( Type1CharstringItem( oItem.nValue, true ) );
            }
            else
            {
                // Type1 charstrings используют деления для чисел больших 32000
                if ( oItem.nValue > 32000 )
                {
                    int nDivisor = oCharstring.arrCharstring[nIndex + 1].nValue;
                    if ( 0 != nDivisor )
                        nValue /= nDivisor;
                }
                oNew.arrCharstring.Add( Type1CharstringItem( 28, true ) );
                oNew.arrCharstring.Add( Type1CharstringItem( nValue >> 8, false ) );
                oNew.arrCharstring.Add( Type1CharstringItem( nValue & 0xFF, false ) );
            }
        }

        return oNew;
    }
