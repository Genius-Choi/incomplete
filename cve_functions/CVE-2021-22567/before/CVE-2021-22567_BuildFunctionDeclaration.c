Fragment StreamingFlowGraphBuilder::BuildFunctionDeclaration(intptr_t offset) {
  TokenPosition position = ReadPosition();
  const intptr_t variable_offset = ReaderOffset() + data_program_offset_;

  // Read variable declaration.
  VariableDeclarationHelper helper(this);

  bool has_pragma = false;
  bool has_valid_annotation = false;
  helper.ReadUntilExcluding(VariableDeclarationHelper::kAnnotations);
  const intptr_t annotation_count = ReadListLength();
  for (intptr_t i = 0; i < annotation_count; ++i) {
    const intptr_t tag = PeekTag();
    if (tag != kInvalidExpression) {
      has_valid_annotation = true;
    }
    if (tag == kConstantExpression) {
      auto& instance = Instance::Handle();
      instance = constant_reader_.ReadConstantExpression();
      if (instance.clazz() == IG->object_store()->pragma_class()) {
        has_pragma = true;
      }
      continue;
    }
    SkipExpression();
  }
  helper.SetJustRead(VariableDeclarationHelper::kAnnotations);

  helper.ReadUntilExcluding(VariableDeclarationHelper::kEnd);

  Fragment instructions = DebugStepCheck(position);
  instructions += BuildFunctionNode(position, helper.name_index_,
                                    has_valid_annotation, has_pragma, offset);
  instructions += StoreLocal(position, LookupVariable(variable_offset));
  instructions += Drop();
  return instructions;
}
