static inline bool _cjose_read_json_recipient(cjose_jwe_t *jwe,
                                              cjose_header_t *protected_header,
                                              bool is_multiple,
                                              _jwe_int_recipient_t *recipient,
                                              json_t *obj,
                                              cjose_err *err)
{

    if (!json_is_object(obj))
    {
        CJOSE_ERROR(err, CJOSE_ERR_INVALID_ARG);
        return false;
    }

    if (!_cjose_jwe_import_json_part(&recipient->enc_key, true, json_object_get(obj, "encrypted_key"), err))
    {
        return false;
    };

    recipient->unprotected = json_incref(json_object_get(obj, "header"));

    // it's OK to have empty/null unprotected header
    if (recipient->unprotected && !json_is_object(recipient->unprotected))
    {
        CJOSE_ERROR(err, CJOSE_ERR_INVALID_ARG);
        return false;
    }

    return _cjose_jwe_validate_alg(protected_header, jwe->shared_hdr, is_multiple, recipient, err);
}
