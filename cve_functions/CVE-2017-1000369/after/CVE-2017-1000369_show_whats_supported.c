show_whats_supported(FILE *f)
{
  auth_info *authi;

#ifdef DB_VERSION_STRING
fprintf(f, "Berkeley DB: %s\n", DB_VERSION_STRING);
#elif defined(BTREEVERSION) && defined(HASHVERSION)
  #ifdef USE_DB
  fprintf(f, "Probably Berkeley DB version 1.8x (native mode)\n");
  #else
  fprintf(f, "Probably Berkeley DB version 1.8x (compatibility mode)\n");
  #endif
#elif defined(_DBM_RDONLY) || defined(dbm_dirfno)
fprintf(f, "Probably ndbm\n");
#elif defined(USE_TDB)
fprintf(f, "Using tdb\n");
#else
  #ifdef USE_GDBM
  fprintf(f, "Probably GDBM (native mode)\n");
  #else
  fprintf(f, "Probably GDBM (compatibility mode)\n");
  #endif
#endif

fprintf(f, "Support for:");
#ifdef SUPPORT_CRYPTEQ
  fprintf(f, " crypteq");
#endif
#if HAVE_ICONV
  fprintf(f, " iconv()");
#endif
#if HAVE_IPV6
  fprintf(f, " IPv6");
#endif
#ifdef HAVE_SETCLASSRESOURCES
  fprintf(f, " use_setclassresources");
#endif
#ifdef SUPPORT_PAM
  fprintf(f, " PAM");
#endif
#ifdef EXIM_PERL
  fprintf(f, " Perl");
#endif
#ifdef EXPAND_DLFUNC
  fprintf(f, " Expand_dlfunc");
#endif
#ifdef USE_TCP_WRAPPERS
  fprintf(f, " TCPwrappers");
#endif
#ifdef SUPPORT_TLS
  #ifdef USE_GNUTLS
  fprintf(f, " GnuTLS");
  #else
  fprintf(f, " OpenSSL");
  #endif
#endif
#ifdef SUPPORT_TRANSLATE_IP_ADDRESS
  fprintf(f, " translate_ip_address");
#endif
#ifdef SUPPORT_MOVE_FROZEN_MESSAGES
  fprintf(f, " move_frozen_messages");
#endif
#ifdef WITH_CONTENT_SCAN
  fprintf(f, " Content_Scanning");
#endif
#ifndef DISABLE_DKIM
  fprintf(f, " DKIM");
#endif
#ifndef DISABLE_DNSSEC
  fprintf(f, " DNSSEC");
#endif
#ifndef DISABLE_EVENT
  fprintf(f, " Event");
#endif
#ifdef SUPPORT_I18N
  fprintf(f, " I18N");
#endif
#ifndef DISABLE_OCSP
  fprintf(f, " OCSP");
#endif
#ifndef DISABLE_PRDR
  fprintf(f, " PRDR");
#endif
#ifdef SUPPORT_PROXY
  fprintf(f, " PROXY");
#endif
#ifdef SUPPORT_SOCKS
  fprintf(f, " SOCKS");
#endif
#ifdef TCP_FASTOPEN
  fprintf(f, " TCP_Fast_Open");
#endif
#ifdef EXPERIMENTAL_LMDB
  fprintf(f, " Experimental_LMDB");
#endif
#ifdef EXPERIMENTAL_QUEUEFILE
  fprintf(f, " Experimental_QUEUEFILE");
#endif
#ifdef EXPERIMENTAL_SPF
  fprintf(f, " Experimental_SPF");
#endif
#ifdef EXPERIMENTAL_SRS
  fprintf(f, " Experimental_SRS");
#endif
#ifdef EXPERIMENTAL_BRIGHTMAIL
  fprintf(f, " Experimental_Brightmail");
#endif
#ifdef EXPERIMENTAL_DANE
  fprintf(f, " Experimental_DANE");
#endif
#ifdef EXPERIMENTAL_DCC
  fprintf(f, " Experimental_DCC");
#endif
#ifdef EXPERIMENTAL_DMARC
  fprintf(f, " Experimental_DMARC");
#endif
#ifdef EXPERIMENTAL_DSN_INFO
  fprintf(f, " Experimental_DSN_info");
#endif
fprintf(f, "\n");

fprintf(f, "Lookups (built-in):");
#if defined(LOOKUP_LSEARCH) && LOOKUP_LSEARCH!=2
  fprintf(f, " lsearch wildlsearch nwildlsearch iplsearch");
#endif
#if defined(LOOKUP_CDB) && LOOKUP_CDB!=2
  fprintf(f, " cdb");
#endif
#if defined(LOOKUP_DBM) && LOOKUP_DBM!=2
  fprintf(f, " dbm dbmjz dbmnz");
#endif
#if defined(LOOKUP_DNSDB) && LOOKUP_DNSDB!=2
  fprintf(f, " dnsdb");
#endif
#if defined(LOOKUP_DSEARCH) && LOOKUP_DSEARCH!=2
  fprintf(f, " dsearch");
#endif
#if defined(LOOKUP_IBASE) && LOOKUP_IBASE!=2
  fprintf(f, " ibase");
#endif
#if defined(LOOKUP_LDAP) && LOOKUP_LDAP!=2
  fprintf(f, " ldap ldapdn ldapm");
#endif
#ifdef EXPERIMENTAL_LMDB
  fprintf(f, " lmdb");
#endif
#if defined(LOOKUP_MYSQL) && LOOKUP_MYSQL!=2
  fprintf(f, " mysql");
#endif
#if defined(LOOKUP_NIS) && LOOKUP_NIS!=2
  fprintf(f, " nis nis0");
#endif
#if defined(LOOKUP_NISPLUS) && LOOKUP_NISPLUS!=2
  fprintf(f, " nisplus");
#endif
#if defined(LOOKUP_ORACLE) && LOOKUP_ORACLE!=2
  fprintf(f, " oracle");
#endif
#if defined(LOOKUP_PASSWD) && LOOKUP_PASSWD!=2
  fprintf(f, " passwd");
#endif
#if defined(LOOKUP_PGSQL) && LOOKUP_PGSQL!=2
  fprintf(f, " pgsql");
#endif
#if defined(LOOKUP_REDIS) && LOOKUP_REDIS!=2
  fprintf(f, " redis");
#endif
#if defined(LOOKUP_SQLITE) && LOOKUP_SQLITE!=2
  fprintf(f, " sqlite");
#endif
#if defined(LOOKUP_TESTDB) && LOOKUP_TESTDB!=2
  fprintf(f, " testdb");
#endif
#if defined(LOOKUP_WHOSON) && LOOKUP_WHOSON!=2
  fprintf(f, " whoson");
#endif
fprintf(f, "\n");

fprintf(f, "Authenticators:");
#ifdef AUTH_CRAM_MD5
  fprintf(f, " cram_md5");
#endif
#ifdef AUTH_CYRUS_SASL
  fprintf(f, " cyrus_sasl");
#endif
#ifdef AUTH_DOVECOT
  fprintf(f, " dovecot");
#endif
#ifdef AUTH_GSASL
  fprintf(f, " gsasl");
#endif
#ifdef AUTH_HEIMDAL_GSSAPI
  fprintf(f, " heimdal_gssapi");
#endif
#ifdef AUTH_PLAINTEXT
  fprintf(f, " plaintext");
#endif
#ifdef AUTH_SPA
  fprintf(f, " spa");
#endif
#ifdef AUTH_TLS
  fprintf(f, " tls");
#endif
fprintf(f, "\n");

fprintf(f, "Routers:");
#ifdef ROUTER_ACCEPT
  fprintf(f, " accept");
#endif
#ifdef ROUTER_DNSLOOKUP
  fprintf(f, " dnslookup");
#endif
#ifdef ROUTER_IPLITERAL
  fprintf(f, " ipliteral");
#endif
#ifdef ROUTER_IPLOOKUP
  fprintf(f, " iplookup");
#endif
#ifdef ROUTER_MANUALROUTE
  fprintf(f, " manualroute");
#endif
#ifdef ROUTER_QUERYPROGRAM
  fprintf(f, " queryprogram");
#endif
#ifdef ROUTER_REDIRECT
  fprintf(f, " redirect");
#endif
fprintf(f, "\n");

fprintf(f, "Transports:");
#ifdef TRANSPORT_APPENDFILE
  fprintf(f, " appendfile");
  #ifdef SUPPORT_MAILDIR
    fprintf(f, "/maildir");
  #endif
  #ifdef SUPPORT_MAILSTORE
    fprintf(f, "/mailstore");
  #endif
  #ifdef SUPPORT_MBX
    fprintf(f, "/mbx");
  #endif
#endif
#ifdef TRANSPORT_AUTOREPLY
  fprintf(f, " autoreply");
#endif
#ifdef TRANSPORT_LMTP
  fprintf(f, " lmtp");
#endif
#ifdef TRANSPORT_PIPE
  fprintf(f, " pipe");
#endif
#ifdef EXPERIMENTAL_QUEUEFILE
  fprintf(f, " queuefile");
#endif
#ifdef TRANSPORT_SMTP
  fprintf(f, " smtp");
#endif
fprintf(f, "\n");

if (fixed_never_users[0] > 0)
  {
  int i;
  fprintf(f, "Fixed never_users: ");
  for (i = 1; i <= (int)fixed_never_users[0] - 1; i++)
    fprintf(f, "%d:", (unsigned int)fixed_never_users[i]);
  fprintf(f, "%d\n", (unsigned int)fixed_never_users[i]);
  }

fprintf(f, "Configure owner: %d:%d\n", config_uid, config_gid);

fprintf(f, "Size of off_t: " SIZE_T_FMT "\n", sizeof(off_t));

/* Everything else is details which are only worth reporting when debugging.
Perhaps the tls_version_report should move into this too. */
DEBUG(D_any) do {

  int i;

/* clang defines __GNUC__ (at least, for me) so test for it first */
#if defined(__clang__)
  fprintf(f, "Compiler: CLang [%s]\n", __clang_version__);
#elif defined(__GNUC__)
  fprintf(f, "Compiler: GCC [%s]\n",
# ifdef __VERSION__
      __VERSION__
# else
      "? unknown version ?"
# endif
      );
#else
  fprintf(f, "Compiler: <unknown>\n");
#endif

#if defined(__GLIBC__) && !defined(__UCLIBC__)
  fprintf(f, "Library version: Glibc: Compile: %d.%d\n",
	       	__GLIBC__, __GLIBC_MINOR__);
  if (__GLIBC_PREREQ(2, 1))
    fprintf(f, "                        Runtime: %s\n",
	       	gnu_get_libc_version());
#endif

#ifdef SUPPORT_TLS
  tls_version_report(f);
#endif
#ifdef SUPPORT_I18N
  utf8_version_report(f);
#endif

  for (authi = auths_available; *authi->driver_name != '\0'; ++authi)
    if (authi->version_report)
      (*authi->version_report)(f);

  /* PCRE_PRERELEASE is either defined and empty or a bare sequence of
  characters; unless it's an ancient version of PCRE in which case it
  is not defined. */
#ifndef PCRE_PRERELEASE
# define PCRE_PRERELEASE
#endif
#define QUOTE(X) #X
#define EXPAND_AND_QUOTE(X) QUOTE(X)
  fprintf(f, "Library version: PCRE: Compile: %d.%d%s\n"
             "                       Runtime: %s\n",
          PCRE_MAJOR, PCRE_MINOR,
          EXPAND_AND_QUOTE(PCRE_PRERELEASE) "",
          pcre_version());
#undef QUOTE
#undef EXPAND_AND_QUOTE

  init_lookup_list();
  for (i = 0; i < lookup_list_count; i++)
    if (lookup_list[i]->version_report)
      lookup_list[i]->version_report(f);

#ifdef WHITELIST_D_MACROS
  fprintf(f, "WHITELIST_D_MACROS: \"%s\"\n", WHITELIST_D_MACROS);
#else
  fprintf(f, "WHITELIST_D_MACROS unset\n");
#endif
#ifdef TRUSTED_CONFIG_LIST
  fprintf(f, "TRUSTED_CONFIG_LIST: \"%s\"\n", TRUSTED_CONFIG_LIST);
#else
  fprintf(f, "TRUSTED_CONFIG_LIST unset\n");
#endif

} while (0);
}
