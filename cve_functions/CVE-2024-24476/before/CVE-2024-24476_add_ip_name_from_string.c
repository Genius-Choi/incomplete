add_ip_name_from_string (const char *addr, const char *name)
{
    union {
        guint32 ip4_addr;
        ws_in6_addr ip6_addr;
    } host_addr;
    gboolean is_ipv6;
    resolved_name_t *resolved_entry;

    if (ws_inet_pton6(addr, &host_addr.ip6_addr)) {
        is_ipv6 = TRUE;
    } else if (ws_inet_pton4(addr, &host_addr.ip4_addr)) {
        is_ipv6 = FALSE;
    } else {
        return FALSE;
    }

    if (is_ipv6) {
        resolved_entry = (resolved_name_t*)wmem_map_lookup(manually_resolved_ipv6_list, &host_addr.ip6_addr);
        if (resolved_entry)
        {
            // If we found a previous matching key (IP address), then just update the value (custom hostname);
            (void) g_strlcpy(resolved_entry->name, name, MAXNAMELEN);
        }
        else
        {
            // Add a new mapping entry, if this IP address isn't already in the list.
            ws_in6_addr* addr_key = wmem_new(wmem_epan_scope(), ws_in6_addr);
            memcpy(addr_key, &host_addr.ip6_addr, sizeof(ws_in6_addr));

            resolved_entry = wmem_new(wmem_epan_scope(), resolved_name_t);
            (void) g_strlcpy(resolved_entry->name, name, MAXNAMELEN);

            wmem_map_insert(manually_resolved_ipv6_list, addr_key, resolved_entry);
        }
    } else {
        resolved_entry = (resolved_name_t*)wmem_map_lookup(manually_resolved_ipv4_list, GUINT_TO_POINTER(host_addr.ip4_addr));
        if (resolved_entry)
        {
            // If we found a previous matching key (IP address), then just update the value (custom hostname);
            (void) g_strlcpy(resolved_entry->name, name, MAXNAMELEN);
        }
        else
        {
            // Add a new mapping entry, if this IP address isn't already in the list.
            resolved_entry = wmem_new(wmem_epan_scope(), resolved_name_t);
            (void) g_strlcpy(resolved_entry->name, name, MAXNAMELEN);

            wmem_map_insert(manually_resolved_ipv4_list, GUINT_TO_POINTER(host_addr.ip4_addr), resolved_entry);
        }
    }

    return TRUE;
} /* add_ip_name_from_string */
