port_with_resolution_to_str_buf(gchar *buf, gulong buf_size, port_type proto, guint port)
{
    const gchar *port_str;

    if (!gbl_resolv_flags.transport_name || (proto == PT_NONE)) {
        /* No name resolution support, just return port string */
        return snprintf(buf, buf_size, "%u", port);
    }
    port_str = serv_name_lookup(proto, port);
    ws_assert(port_str);
    return snprintf(buf, buf_size, "%s (%u)", port_str, port);
}
