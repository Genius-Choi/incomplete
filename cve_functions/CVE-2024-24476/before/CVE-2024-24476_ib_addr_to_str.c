ib_addr_to_str(const address *addr, gchar *buf, int buf_len)
{
    char buf_ip6[WS_INET6_ADDRSTRLEN];

    if (addr->len >= 16) { /* GID is 128bits */
        ws_inet_ntop6((const ws_in6_addr *)addr->data, buf_ip6, sizeof(buf_ip6));
        snprintf(buf, buf_len, "GID: %s", buf_ip6);
    }
    else {
        /* this is a LID (16 bits) */
        snprintf(buf,buf_len,"LID: %u", *(const guint16 *)addr->data);
    }

    return (int)(strlen(buf)+1);
}
