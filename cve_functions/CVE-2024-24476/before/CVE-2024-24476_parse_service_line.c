parse_service_line (char *line)
{
    gchar *cp;
    gchar *service;
    gchar *port;
    port_type proto;
    struct cb_serv_data cb_data;
    range_t *port_rng = NULL;

    if ((cp = strchr(line, '#')))
        *cp = '\0';

    if ((cp = strtok(line, " \t")) == NULL)
        return;

    service = cp;

    if ((cp = strtok(NULL, " \t")) == NULL)
        return;

    port = cp;

    if (strtok(cp, "/") == NULL)
        return;

    if (range_convert_str(NULL, &port_rng, port, G_MAXUINT16) != CVT_NO_ERROR) {
        wmem_free (NULL, port_rng);
        return;
    }

    while ((cp = strtok(NULL, "/")) != NULL) {
        if (strcmp(cp, "tcp") == 0) {
            proto = PT_TCP;
        }
        else if (strcmp(cp, "udp") == 0) {
            proto = PT_UDP;
        }
        else if (strcmp(cp, "sctp") == 0) {
            proto = PT_SCTP;
        }
        else if (strcmp(cp, "dccp") == 0) {
            proto = PT_DCCP;
        }
        else {
            break;
        }
        cb_data.service = service;
        cb_data.proto = proto;
        range_foreach(port_rng, add_serv_port_cb, &cb_data);
    }

    wmem_free (NULL, port_rng);
} /* parse_service_line */
