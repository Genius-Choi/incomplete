  save_state() {
    pt::ptree root;

    if (fs::exists(config::nvhttp.file_state)) {
      try {
        pt::read_json(config::nvhttp.file_state, root);
      }
      catch (std::exception &e) {
        BOOST_LOG(error) << "Couldn't read "sv << config::nvhttp.file_state << ": "sv << e.what();
        return;
      }
    }

    root.erase("root"s);

    root.put("root.uniqueid", http::unique_id);
    auto &nodes = root.add_child("root.devices", pt::ptree {});
    for (auto &[_, client] : map_id_client) {
      pt::ptree node;

      node.put("uniqueid"s, client.uniqueID);

      pt::ptree cert_nodes;
      for (auto &cert : client.certs) {
        pt::ptree cert_node;
        cert_node.put_value(cert);
        cert_nodes.push_back(std::make_pair(""s, cert_node));
      }
      node.add_child("certs"s, cert_nodes);

      nodes.push_back(std::make_pair(""s, node));
    }

    try {
      pt::write_json(config::nvhttp.file_state, root);
    }
    catch (std::exception &e) {
      BOOST_LOG(error) << "Couldn't write "sv << config::nvhttp.file_state << ": "sv << e.what();
      return;
    }
  }
