static void unwrap(float *x, int N, float tol, float *mi, float *ma)
{
    const float rng = 2.f * M_PI;
    float prev_p = 0.f;
    float max = -FLT_MAX;
    float min = FLT_MAX;

    for (int i = 0; i < N; i++) {
        const float d = x[FFMIN(i + 1, N)] - x[i];
        const float p = ceilf(fabsf(d) / rng) * rng * (((d < tol) > 0.f) - ((d > -tol) > 0.f));

        x[i] += p + prev_p;
        prev_p += p;
        max = fmaxf(x[i], max);
        min = fminf(x[i], min);
    }

    *mi = min;
    *ma = max;
}
