mqtts_pipe_timer_cb(void *arg)
{
	mqtts_tcptran_pipe *p = arg;
	uint8_t             buf[2];

	if (nng_aio_result(&p->tmaio) != 0) {
		return;
	}

	if (p->pingcnt > 1) {
		mqtts_tcptran_pipe_close(p);
		return;
	}
	// send PINGREQ with tmaio itself?
	// nng_msleep(p->keepalive);
	nni_mtx_lock(&p->mtx);
	if (!p->busy && !nni_aio_busy(p->qsaio)) {
		// send pingreq
		buf[0] = 0xC0;
		buf[1] = 0x00;

		nni_iov iov;
		iov.iov_len = 2;
		iov.iov_buf = &buf;
		// send it down...
		nni_aio_set_iov(p->qsaio, 1, &iov);
		nng_stream_send(p->conn, p->qsaio);
		p->pingcnt ++;
	}
	nni_mtx_unlock(&p->mtx);
	nni_sleep_aio(p->keepalive, &p->tmaio);
}
