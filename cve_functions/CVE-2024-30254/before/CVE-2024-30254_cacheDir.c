std::filesystem::path cacheDir() {
  const auto *suffix = "c++-mesonlsp";
  auto xdgCacheHome = getenv("XDG_CACHE_HOME"); // NOLINT
  if (xdgCacheHome != nullptr && strcmp(xdgCacheHome, "") != 0) {
    auto full = std::filesystem::path{xdgCacheHome} / suffix;
    std::filesystem::create_directories(full);
    return full;
  }

#ifndef _WIN32
  std::array<char, 1024 /*NOLINT*/> homeBuffer;
  struct passwd pwd;
  auto home = getenv("HOME"); // NOLINT
  if (home == nullptr || strcmp(home, "") == 0) {
    struct passwd *result = nullptr;
    if (getpwuid_r(getuid(), &pwd, homeBuffer.data(), homeBuffer.size(),
                   &result) == 0 &&
        result != nullptr) {
      home = pwd.pw_dir;
    }
  }
#else
  char home[MAX_PATH];
  auto result = SHGetFolderPathA(NULL, CSIDL_PROFILE, NULL, 0, home);
  // TODO...
  assert(SUCCEEDED(result));
#endif

  auto full = std::filesystem::path{home} / ".cache" / suffix;
  std::filesystem::create_directories(full);
  return full;
}
