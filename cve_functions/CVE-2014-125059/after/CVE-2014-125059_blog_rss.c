void blog_rss(void) {
	struct dirent **dirlist;
	int dircount;
	
	/* construct the time,
	 * the blogpost was
	 * created */
	time_t timestamp;
	struct tm *timeinfo;
	char strtime_now[512];

	time(&timestamp);
	timeinfo = localtime(&timestamp);

	strftime(strtime_now, sizeof strtime_now, "%a, %d %b %G %T %z", timeinfo);

	
	char *script_name = getenv("SCRIPT_NAME");
	if(script_name == NULL) {
		fprintf(stderr, "Died because of missing self-awareness\n");
		exit(EXIT_FAILURE);
	}

	/* build the top part
	 * of the rss-feed */
	send_header("Content-type", "application/rss+xml");
	terminate_headers();

	printf("<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n"
	       "<rss version=\"2.0\">\n"
	       "<channel>\n"
	       "\t<title>%s</title>\n"
	       "\t<description>%s</description>\n"
	       "\t<link>" BLOG_SERVER_URL "%s</link>\n"
	       "\t<lastBuildDate>%s</lastBuildDate>\n"
	       "\t<pubDate>%s</pubDate>\n"
	       "\t<ttl>%d</ttl>\n",
	       BLOG_TITLE, BLOG_DESCRIPTION, 
	       script_name,
	       strtime_now, strtime_now,
	       BLOG_RSS_TTL);

	dircount = scandir(BLOG_DIR, &dirlist, no_dotfiles, alphasort);

	if(dircount < 0) {
		fprintf(stderr, "An error occurred while scanning %s: %s\n",
				BLOG_DIR, strerror(errno));
		exit(EXIT_FAILURE);
	}

	while(dircount--) {
		struct blogpost post;
		post = make_blogpost_from_dirent(dirlist[dircount]);
		char *last_slash_position = strrchr(post.path, '/');
		
		if(last_slash_position == NULL) {
			fprintf(stderr, "Malformed path %s in blog_rss\n", post.path);
			exit(EXIT_FAILURE);
		}

		FILE *fp = fopen(post.path, "r");
		char c;
		if(fp == NULL) {
			fprintf(stderr, "Could not open file: %s: %s\n",
					post.path, strerror(errno));
			exit(EXIT_FAILURE);
		}

		struct tm *timeinfo = localtime(&post.timestamp);
		char strtime_post[512];
		strftime(strtime_post, sizeof strtime_post, "%a, %d %b %G %T %z", timeinfo);
		
		printf("\t<item>\n"
		       "\t\t<title>%s</title>\n"
		       "\t\t<description><![CDATA[",
		       last_slash_position + 1);

		while((c = getc(fp)) != EOF) {
			printf("%c", c);
		}
		
		fclose(fp);

		printf("]]></description>\n"
		       "\t\t<link>" BLOG_SERVER_URL "%s</link>\n"
		       "\t\t<guid>" BLOG_SERVER_URL "%s</guid>\n"
		       "\t\t<pubDate>%s</pubDate>\n"
		       "\t</item>\n",
		       post.link, post.link, strtime_post);

		free_blogpost(post);
		free(dirlist[dircount]);
	}

	free(dirlist);

	printf("</channel>\n</rss>\n");
}
