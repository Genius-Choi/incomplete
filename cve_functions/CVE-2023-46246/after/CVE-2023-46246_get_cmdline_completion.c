get_cmdline_completion(void)
{
    cmdline_info_T *p;
    char_u	*buffer;

    if (cmdline_star > 0)
	return NULL;

    p = get_ccline_ptr();
    if (p == NULL || p->xpc == NULL)
	return NULL;

    set_expand_context(p->xpc);
    if (p->xpc->xp_context == EXPAND_UNSUCCESSFUL)
	return NULL;

    char_u *cmd_compl = cmdcomplete_type_to_str(p->xpc->xp_context);
    if (cmd_compl == NULL)
	return NULL;

    if (p->xpc->xp_context == EXPAND_USER_LIST || p->xpc->xp_context == EXPAND_USER_DEFINED)
    {
	buffer = alloc(STRLEN(cmd_compl) + STRLEN(p->xpc->xp_arg) + 2);
	if (buffer == NULL)
	    return NULL;
	sprintf((char *)buffer, "%s,%s", cmd_compl, p->xpc->xp_arg);
	return buffer;
    }

    return vim_strsave(cmd_compl);
}
