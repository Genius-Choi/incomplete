void StelScriptMgr::scriptEnded()
{
#ifdef ENABLE_SCRIPT_QML
	if (result.isError())
	{
		static const QMap<QJSValue::ErrorType, QString>errorMap={
			{QJSValue::GenericError, "Generic"},
			{QJSValue::RangeError, "Range"},
			{QJSValue::ReferenceError, "Reference"},
			{QJSValue::SyntaxError, "Syntax"},
			{QJSValue::TypeError, "Type"},
			{QJSValue::URIError, "URI"}};
		QString msg = QString("script error: '%1'  @ line %2: %3").arg(errorMap.value(result.errorType()), result.property("lineNumber").toString(), result.toString());
		emit scriptDebug(msg);
		qWarning() << msg;
		qWarning() << "Error name:" << result.property("name").toString() << "message" << result.property("message").toString()
			   << "fileName" << result.property("fileName").toString() << "lineNumber" << result.property("lineNumber").toString() << "stack" << result.property("stack").toString();
	}
	mutex.unlock();
#else
	if (engine->hasUncaughtException())
	{
		int outputPos = engine->uncaughtExceptionLineNumber();
		QString realPos = lookup( outputPos );
		QString msg = QString("script error: \"%1\" @ line %2").arg(engine->uncaughtException().toString(), realPos);
		emit scriptDebug(msg);
		qWarning() << msg;
	}
#endif
	GETSTELMODULE(StelMovementMgr)->setMovementSpeedFactor(1.0);
	scriptFileName = QString();
	emit runningScriptIdChanged(scriptFileName);
	emit scriptStopped();
}
