static int store_stunaddr_resolved(const struct ast_dns_query *query)
{
	const struct ast_dns_result *result = ast_dns_query_get_result(query);
	const struct ast_dns_record *record;

	for (record = ast_dns_result_get_records(result); record; record = ast_dns_record_get_next(record)) {
		const size_t data_size = ast_dns_record_get_data_size(record);
		const unsigned char *data = (unsigned char *)ast_dns_record_get_data(record);
		const int rr_type = ast_dns_record_get_rr_type(record);

		if (rr_type == ns_t_a && data_size == 4) {
			ast_rwlock_wrlock(&stunaddr_lock);
			memcpy(&stunaddr.sin_addr, data, data_size);
			stunaddr.sin_family = AF_INET;
			ast_rwlock_unlock(&stunaddr_lock);

			return 1;
		} else {
			ast_debug_stun(3, "Unrecognized rr_type '%u' or data_size '%zu' from DNS query for stunaddr '%s'\n",
										 rr_type, data_size, ast_dns_query_get_name(query));
			continue;
		}
	}
	return 0;
}
