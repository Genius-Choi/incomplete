void ep_mul_sim_dig(ep_t r, const ep_t p[], const dig_t k[], int n) {
	ep_t t;
	int max;

	ep_null(t);

	max = util_bits_dig(k[0]);
	for (int i = 1; i < n; i++) {
		max = RLC_MAX(max, util_bits_dig(k[i]));
	}

	RLC_TRY {
		ep_new(t);

		ep_set_infty(t);
		for (int i = max - 1; i >= 0; i--) {
			ep_dbl(t, t);
			for (int j = 0; j < n; j++) {
				if (k[j] & ((dig_t)1 << i)) {
					ep_add(t, t, p[j]);
				}
			}
		}

		ep_norm(r, t);
	}
	RLC_CATCH_ANY {
		RLC_THROW(ERR_CAUGHT);
	}
	RLC_FINALLY {
		ep_free(t);
	}
}
