void hevc_pred_weight_table(GF_BitStream *bs, HEVCState *hevc, HEVCSliceInfo *si, HEVC_PPS *pps, HEVC_SPS *sps, u32 num_ref_idx_l0_active, u32 num_ref_idx_l1_active)
{
	u32 i, num_ref_idx;
	Bool first_pass=GF_TRUE;
	u8 luma_weights[20], chroma_weights[20];
	u32 ChromaArrayType = sps->separate_colour_plane_flag ? 0 : sps->chroma_format_idc;

	num_ref_idx = num_ref_idx_l0_active;

	/*luma_log2_weight_denom=*/i=bs_get_ue(bs);
	if (ChromaArrayType != 0)
		/*delta_chroma_log2_weight_denom=*/i=bs_get_se(bs);

parse_weights:
	for (i=0; i<num_ref_idx; i++) {
		luma_weights[i] = gf_bs_read_int(bs, 1);
		//infered to be 0 if not present
		chroma_weights[i] = 0;
	}
	if (ChromaArrayType != 0) {
		for (i=0; i<num_ref_idx; i++) {
			chroma_weights[i] = gf_bs_read_int(bs, 1);
		}
	}
	for (i=0; i<num_ref_idx; i++) {
		if (luma_weights[i]) {
			/*delta_luma_weight_l0[ i ]=*/bs_get_se(bs);
			/*luma_offset_l0[ i ]=*/bs_get_se(bs);
		}
		if (chroma_weights[i]) {
			/*delta_chroma_weight_l0[ i ][ 0 ]=*/bs_get_se(bs);
			/*delta_chroma_offset_l0[ i ][ 0 ]=*/bs_get_se(bs);

			/*delta_chroma_weight_l0[ i ][ 1 ]=*/bs_get_se(bs);
			/*delta_chroma_offset_l0[ i ][ 1 ]=*/bs_get_se(bs);
		}
	}

	if (si->slice_type==GF_HEVC_SLICE_TYPE_B) {
		if (!first_pass) return;
		first_pass=GF_FALSE;
		num_ref_idx = num_ref_idx_l1_active;
		goto parse_weights;
	}
}
