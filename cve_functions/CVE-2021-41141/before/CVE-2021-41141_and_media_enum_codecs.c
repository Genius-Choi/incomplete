static pj_status_t and_media_enum_codecs(pjmedia_codec_factory *factory,
					 unsigned *count,
					 pjmedia_codec_info codecs[])
{
    unsigned max;
    unsigned i;

    PJ_UNUSED_ARG(factory);
    PJ_ASSERT_RETURN(codecs && *count > 0, PJ_EINVAL);

    max = *count;

    for (i = 0, *count = 0; i < PJ_ARRAY_SIZE(and_media_codec) &&
         *count < max; ++i)
    {
	unsigned enc_idx, dec_idx;
	pj_str_t *enc_name = NULL;
	unsigned num_enc = 0;
	pj_str_t *dec_name = NULL;
	unsigned num_dec = 0;

	switch (and_media_codec[i].codec_id) {

	case AND_AUD_CODEC_AMRNB:
#if PJMEDIA_HAS_AND_MEDIA_AMRNB
	    enc_name = &AMRNB_encoder[0];
	    dec_name = &AMRNB_decoder[0];
	    num_enc = PJ_ARRAY_SIZE(AMRNB_encoder);
	    num_dec = PJ_ARRAY_SIZE(AMRNB_decoder);
#endif
	    break;
	case AND_AUD_CODEC_AMRWB:
#if PJMEDIA_HAS_AND_MEDIA_AMRWB
	    enc_name = &AMRWB_encoder[0];
	    dec_name = &AMRWB_decoder[0];
	    num_enc = PJ_ARRAY_SIZE(AMRWB_encoder);
	    num_dec = PJ_ARRAY_SIZE(AMRWB_decoder);
#endif

	    break;
	default:
	    continue;
	};
	if (!enc_name || !dec_name) {
	    continue;
	}

	for (enc_idx = 0; enc_idx < num_enc ;++enc_idx, ++enc_name) {
	    if (codec_exists(enc_name)) {
		break;
	    }
	}
	if (enc_idx == num_enc)
	    continue;

	for (dec_idx = 0; dec_idx < num_dec ;++dec_idx, ++dec_name) {
	    if (codec_exists(dec_name)) {
		break;
	    }
	}
	if (dec_idx == num_dec)
	    continue;

	and_media_codec[i].encoder_name = enc_name;
	and_media_codec[i].decoder_name = dec_name;
	pj_bzero(&codecs[*count], sizeof(pjmedia_codec_info));
	codecs[*count].encoding_name = pj_str((char*)and_media_codec[i].name);
	codecs[*count].pt = and_media_codec[i].pt;
	codecs[*count].type = PJMEDIA_TYPE_AUDIO;
	codecs[*count].clock_rate = and_media_codec[i].clock_rate;
	codecs[*count].channel_cnt = and_media_codec[i].channel_count;
	and_media_codec[i].enabled = PJ_TRUE;
	PJ_LOG(4, (THIS_FILE, "Found encoder [%d]: %.*s and decoder: %.*s ",
		   *count, enc_name->slen, enc_name->ptr, dec_name->slen,
		   dec_name->ptr));
	++*count;
    }

    return PJ_SUCCESS;
}
