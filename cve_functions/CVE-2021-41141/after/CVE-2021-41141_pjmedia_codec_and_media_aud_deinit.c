PJ_DEF(pj_status_t) pjmedia_codec_and_media_aud_deinit(void)
{
    pjmedia_codec_mgr *codec_mgr;
    pj_status_t status;

    if (and_media_factory.pool == NULL) {
	/* Already deinitialized */
	return PJ_SUCCESS;
    }

    pj_mutex_lock(and_media_factory.mutex);

    /* Get the codec manager. */
    codec_mgr = pjmedia_endpt_get_codec_mgr(and_media_factory.endpt);
    if (!codec_mgr) {
	pj_pool_release(and_media_factory.pool);
	and_media_factory.pool = NULL;
	pj_mutex_unlock(and_media_factory.mutex);
	return PJ_EINVALIDOP;
    }

    /* Unregister Android MediaCodec codecs factory. */
    status = pjmedia_codec_mgr_unregister_factory(codec_mgr,
						  &and_media_factory.base);

    /* Destroy mutex. */
    pj_mutex_unlock(and_media_factory.mutex);
    pj_mutex_destroy(and_media_factory.mutex);
    and_media_factory.mutex = NULL;

    /* Destroy pool. */
    pj_pool_release(and_media_factory.pool);
    and_media_factory.pool = NULL;

    return status;
}
