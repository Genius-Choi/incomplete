static void post_session(sdp_parser_t *p, sdp_session_t *sdp)
{
  sdp_media_t *m;
#ifdef SOFIA_AUTO_CORRECT_INADDR_ANY
  sdp_connection_t const *c;
#endif

  if (!p->pr_ok)
    return;

  /* Set session back-pointer */
  for (m = sdp->sdp_media; m; m = m->m_next) {
    m->m_session = sdp;
  }

  if (p->pr_config) {
    if (sdp->sdp_version[0] != 0)
      parsing_error(p, "Incorrect version");
    return;
  }

  /* Go through all media and set mode */
  for (m = sdp->sdp_media; m; m = m->m_next) {
    if (m->m_port == 0) {
      m->m_mode = sdp_inactive;
      m->m_rejected = 1;
      continue;
    }

#ifdef SOFIA_AUTO_CORRECT_INADDR_ANY
    c = sdp_media_connections(m);


    if (p->pr_mode_0000 && sdp_connection_is_inaddr_any(c)) {
      /* Reset recvonly flag */
      m->m_mode &= ~sdp_recvonly;
    }
#endif
  }

  if (p->pr_insane)
    return;

  /* Verify that all mandatory fields are present */
  if (sdp_sanity_check(p) < 0)
    return;
}
