static void parse_media_attr(sdp_parser_t *p, char *r, sdp_media_t *m,
			     sdp_attribute_t **result)
{
  /*
   attribute-fields =    *("a=" attribute CRLF)

   attribute =           (att-field ":" att-value) / att-field

   att-field =           token

   att-value =           byte-string

   a=rtpmap:<payload type> <encoding name>/<clock rate>[/<encoding parameters>]
   a=fmtp:<payload type> <parameters>
   */
  int rtp = sdp_media_has_rtp(m);
  char *name = NULL, *value = NULL;
  int n;

  if (!(name = token(&r, ":", TOKEN, SPACE TAB))) {
    parsing_error(p,"invalid attribute name");
    return;
  }

  if (*r)
    value = r;
  else
    PARSE_CHECK_REST(p, r, "a");

  if (p->pr_mode_manual)
    ;
  else if (m->m_port == 0 || su_casematch(name, "inactive")) {
    m->m_mode = sdp_inactive;
    return;
  }
  else if (su_casematch(name, "sendonly")) {
    m->m_mode = sdp_sendonly;
    return;
  }
  else if (su_casematch(name, "recvonly")) {
    m->m_mode = sdp_recvonly;
    return;
  }
  else if (su_casematch(name, "sendrecv")) {
    m->m_mode = sdp_sendrecv;
    return;
  }

  if (rtp && su_casematch(name, "rtpmap")) {
	  if ((n = parse_rtpmap(p, r, m)) == 0 || n < -1)
		  return;
  }
  else if (rtp && su_casematch(name, "fmtp")) {
    if ((n = parse_fmtp(p, r, m)) == 0 || n < -1)
      return;
  }
  else {
    PARSE_ALLOC(p, sdp_attribute_t, a);
    *result = a;

    a->a_name  = name;
    a->a_value = value;
  }
}
