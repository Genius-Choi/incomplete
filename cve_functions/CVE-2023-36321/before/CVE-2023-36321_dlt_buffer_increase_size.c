int dlt_buffer_increase_size(DltBuffer *buf)
{
    DltBufferHead *head, *new_head;
    unsigned char *new_ptr;

    /* catch null pointer */
    if (buf == NULL) {
        dlt_vlog(LOG_WARNING, "%s: Wrong parameter: Null pointer\n", __func__);
        return DLT_RETURN_WRONG_PARAMETER;
    }

    /* check size */
    if (buf->step_size == 0)
        /* cannot increase size */
        return DLT_RETURN_ERROR;

    /* check size */
    if ((buf->size + sizeof(DltBufferHead) + buf->step_size) > buf->max_size)
        /* max size reached, do not increase */
        return DLT_RETURN_ERROR;

    /* allocate new buffer */
    new_ptr = malloc(buf->size + sizeof(DltBufferHead) + buf->step_size);

    if (new_ptr == NULL) {
        dlt_vlog(LOG_WARNING,
                 "%s: Buffer: Cannot increase size because allocate %u bytes failed\n",
                 __func__, buf->min_size);
        return DLT_RETURN_ERROR;
    }

    /* copy data */
    head = (DltBufferHead *)buf->shm;
    new_head = (DltBufferHead *)new_ptr;

    if (head->read < head->write) {
        memcpy(new_ptr + sizeof(DltBufferHead), buf->mem + head->read, (size_t)(head->write - head->read));
        new_head->read = 0;
        new_head->write = head->write - head->read;
        new_head->count = head->count;
    }
    else {
        memcpy(new_ptr + sizeof(DltBufferHead), buf->mem + head->read, buf->size - (uint32_t)(head->read));
        memcpy(new_ptr + sizeof(DltBufferHead) + buf->size - head->read, buf->mem, (size_t)head->write);
        new_head->read = 0;
        new_head->write = (int)(buf->size) + head->write - head->read;
        new_head->count = head->count;
    }

    /* free old data */
    free(buf->shm);

    /* update data */
    buf->shm = new_ptr;
    buf->mem = new_ptr + sizeof(DltBufferHead);
    buf->size += buf->step_size;

    dlt_vlog(LOG_DEBUG,
             "%s: Buffer: Size increased to %u bytes with start address %lX\n",
             __func__,
             buf->size + (int32_t)sizeof(DltBufferHead),
             (unsigned long)buf->mem);

    return DLT_RETURN_OK; /* OK */
}
