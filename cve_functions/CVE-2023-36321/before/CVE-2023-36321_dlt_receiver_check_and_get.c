int dlt_receiver_check_and_get(DltReceiver *receiver,
                               void *dest,
                               unsigned int to_get,
                               unsigned int flags)
{
    size_t min_size = (size_t)to_get;
    uint8_t *src = NULL;

    if (flags & DLT_RCV_SKIP_HEADER)
        min_size += sizeof(DltUserHeader);

    if (!receiver ||
        (receiver->bytesRcvd < (int32_t) min_size) ||
        !receiver->buf ||
        !dest)
        return DLT_RETURN_WRONG_PARAMETER;

    src = (uint8_t *)receiver->buf;

    if (flags & DLT_RCV_SKIP_HEADER)
        src += sizeof(DltUserHeader);

    memcpy(dest, src, to_get);

    if (flags & DLT_RCV_REMOVE) {
        if (dlt_receiver_remove(receiver, (int)min_size) != DLT_RETURN_OK) {
            dlt_log(LOG_WARNING, "Can't remove bytes from receiver\n");
            return DLT_RETURN_ERROR;
        }
    }

    return to_get;
}
