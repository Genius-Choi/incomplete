BOOL gcc_read_client_monitor_data(wStream* s, rdpMcs* mcs, UINT16 blockLength)
{
	UINT32 index;
	UINT32 flags;
	UINT32 monitorCount;
	UINT32 left, top, right, bottom;
	rdpSettings* settings = mcs->settings;

	if (blockLength < 8)
		return FALSE;

	Stream_Read_UINT32(s, flags);        /* flags */
	Stream_Read_UINT32(s, monitorCount); /* monitorCount */

	/* 2.2.1.3.6 Client Monitor Data -
	 * monitorCount (4 bytes): A 32-bit, unsigned integer. The number of display
	 * monitor definitions in the monitorDefArray field (the maximum allowed is 16).
	 */
	if (monitorCount > 16)
	{
		WLog_ERR(TAG, "announced monitors(%" PRIu32 ") exceed the 16 limit", monitorCount);
		return FALSE;
	}

	if (monitorCount > settings->MonitorDefArraySize)
	{
		WLog_ERR(TAG, "too many announced monitors(%" PRIu32 "), clamping to %" PRIu32 "",
		         monitorCount, settings->MonitorDefArraySize);
		monitorCount = settings->MonitorDefArraySize;
	}

	if ((UINT32)((blockLength - 8) / 20) < monitorCount)
		return FALSE;

	settings->MonitorCount = monitorCount;

	for (index = 0; index < monitorCount; index++)
	{
		Stream_Read_UINT32(s, left);   /* left */
		Stream_Read_UINT32(s, top);    /* top */
		Stream_Read_UINT32(s, right);  /* right */
		Stream_Read_UINT32(s, bottom); /* bottom */
		Stream_Read_UINT32(s, flags);  /* flags */
		settings->MonitorDefArray[index].x = left;
		settings->MonitorDefArray[index].y = top;
		settings->MonitorDefArray[index].width = right - left + 1;
		settings->MonitorDefArray[index].height = bottom - top + 1;
		settings->MonitorDefArray[index].is_primary = (flags & MONITOR_PRIMARY);
	}

	return TRUE;
}
