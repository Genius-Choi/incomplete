int HTPFileOpen(HtpState *s, HtpTxUserData *tx, const uint8_t *filename, uint16_t filename_len,
        const uint8_t *data, uint32_t data_len, uint64_t txid, uint8_t direction)
{
    int retval = 0;
    uint16_t flags = 0;
    FileContainer *files = NULL;

    SCLogDebug("data %p data_len %"PRIu32, data, data_len);

    if (direction & STREAM_TOCLIENT) {
        files = &tx->files_tc;
        flags = FileFlowFlagsToFlags(tx->tx_data.file_flags, STREAM_TOCLIENT);

        // we shall not open a new file if there is a current one
        DEBUG_VALIDATE_BUG_ON(tx->file_range != NULL);
    } else {
        files = &tx->files_ts;
        flags = FileFlowFlagsToFlags(tx->tx_data.file_flags, STREAM_TOSERVER);
    }

    if (FileOpenFileWithId(files, &htp_sbcfg, s->file_track_id++, filename, filename_len, data,
                data_len, flags) != 0) {
        retval = -1;
    } else {
        const HTPCfgDir *cfg;
        if (direction & STREAM_TOCLIENT) {
            cfg = &s->cfg->response;
        } else {
            cfg = &s->cfg->request;
        }
        FileSetInspectSizes(files->tail, cfg->inspect_window, cfg->inspect_min_size);
    }

    tx->tx_data.files_opened++;

    SCReturnInt(retval);
}
