wv_csp13_opaque_binary_tag(tvbuff_t *tvb, guint32 offset,
			   guint8 token, guint8 codepage, guint32 *length)
{
	guint32 data_len = tvb_get_guintvar(tvb, offset, length);
	char *str = NULL;

	switch (codepage)
		{
		case 0: /* Common code page */
			switch (token)
				{
				case 0x0B: /* <Code> */
				case 0x0F: /* <ContentSize> */
				case 0x1A: /* <MessageCount> */
				case 0x3C: /* <Validity> */
					str = wv_integer_from_opaque(tvb, offset + *length, data_len);
					break;
				case 0x11: /* <DateTime> */
					str = wv_datetime_from_opaque(tvb, offset + *length, data_len);
					break;
				default:
					break;
				}
			break;

		case 1: /* Access code page */
			switch (token)
				{
				case 0x1C: /* <KeepAliveTime> */
				case 0x25: /* <SearchFindings> */
				case 0x26: /* <SearchID> */
				case 0x27: /* <SearchIndex> */
				case 0x28: /* <SearchLimit> */
				case 0x32: /* <TimeToLive> */
					str = wv_integer_from_opaque(tvb, offset + *length, data_len);
					break;
				default:
					break;
				}
			break;

		case 3: /* Client capability code page */
			switch (token)
				{
				case 0x06: /* <AcceptedContentLength> */
				case 0x0C: /* <MultiTrans> */
				case 0x0D: /* <ParserSize> */
				case 0x0E: /* <ServerPollMin> */
				case 0x12: /* <TCPPort> */
				case 0x13: /* <UDPPort> */
					/* New in WV-CSP 1.3*/
				case 0x16: /* <AcceptedPullLength> */
				case 0x17: /* <AcceptedPushLength> */
				case 0x18: /* <AcceptedRichContentLength> */
				case 0x19: /* <AcceptedTextContentLength> */
				case 0x1B: /* <PlainTextCharset> MIBenum number - character set, i.e. UTF-8, windows-1251, etc. */
				case 0x1C: /* <SessionPriority> */
				case 0x1F: /* <UserSessionLimit> */
				case 0x21: /* <MultiTransPerMessage> */
				case 0x24: /* <ContentPolicyLimit> */
					str = wv_integer_from_opaque(tvb, offset + *length, data_len);
					break;
				default:
					break;
				}
			break;

		case 5: /* Presence attribute code page */
			switch (token)
				{
					/* New in WV-CSP 1.3*/
					/*		case 0x3B: */ /* <ClientContentLimit> */
				case 0x3C: /* <ClientIMPriority> */
				case 0x3D: /* <MaxPullLength> */
				case 0x3E: /* <MaxPushLength> */
					str = wv_integer_from_opaque(tvb, offset + *length, data_len);
					break;
				default:
					break;
				}
			break;

		case 6: /* Messaging code page */
			switch (token)
				{
				case 0x1A: /* <DeliveryTime> - not in 1.0 */
					/* New in WV-CSP 1.3*/
				case 0x1C: /* <AnswerOptionID> */
					str = wv_datetime_from_opaque(tvb, offset + *length, data_len);
					break;
				default:
					break;
				}
			break;

		case 9: /* Common code page (continued) */
			switch (token)
				{
				case 0x08: /* <HistoryPeriod> - 1.2 only */
				case 0x0A: /* <MaxWatcherList> - 1.2 only */
					/* New in WV-CSP 1.3*/
				case 0x25: /* <SegmentCount> */
				case 0x28: /* <SegmentReference> */
				case 0x30: /* <TryAgainTimeout> */
				case 0x3A: /* <GroupContentLimit> */
				case 0x3B: /* <MessageTotalCount> */
					str = wv_integer_from_opaque(tvb, offset + *length, data_len);
					break;
				default:
					break;
				}
			break;

		case 10:
			switch (token)
				{
					/* New in WV-CSP 1.3*/
				case 0x0C: /* <PairID> */
					str = wv_integer_from_opaque(tvb, offset + *length, data_len);
					break;
				default:
					break;
				}
			break;
		default:
			break;
		}

	if (str == NULL)
		{ /* Error, or not parsed */
			str = wmem_strdup_printf(wmem_packet_scope(), "(%d bytes of unparsed opaque data)", data_len);
		}
	*length += data_len;

	return str;
}
