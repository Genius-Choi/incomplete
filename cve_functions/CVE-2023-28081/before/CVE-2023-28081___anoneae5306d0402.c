  auto inRange = [right](double i, double len) {
    return right ? i >= 0 : i < len;
  };
