static bool inferPhiInstInst(PhiInst *P) {
  // Check if the types of all incoming values match and if they do set the
  // value of the PHI to match the incoming values.
  unsigned numEntries = P->getNumEntries();
  if (numEntries < 1)
    return false;

  llvh::SmallPtrSet<Value *, 8> visited;
  llvh::SmallPtrSet<Value *, 8> values;
  collectPHIInputs(visited, values, P);

  Type originalTy = P->getType();

  Type newTy;
  bool foundFirst = false;

  // For all possible incoming values into this phi:
  for (auto *input : values) {
    // If this is the first valid type remember it.
    if (!foundFirst) {
      newTy = input->getType();
      foundFirst = true;
      continue;
    }

    Type T = input->getType();
    newTy = Type::unionTy(T, newTy);
  }

  if (newTy.isProperSubsetOf(originalTy)) {
    P->setType(newTy);
    return true;
  } else {
    return false;
  }
}
