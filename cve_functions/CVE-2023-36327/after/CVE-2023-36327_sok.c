static int sok(void) {
	int code = RLC_ERR;
	bn_t c[2], n, r[2], x;
	ec_t g[2], y[2];
	uint8_t m[5] = { 0, 1, 2, 3, 4 };

	bn_null(n);
	bn_null(x);

	RLC_TRY {
		bn_new(n);
		bn_new(x);
		for (int i = 0; i < 2; i++) {
			bn_null(c[i]);
			bn_null(r[i]);
			ec_null(g[i]);
			ec_null(y[i]);
			bn_new(c[i]);
			bn_new(r[i]);
			ec_new(g[i]);
			ec_new(y[i]);
		}
		ec_curve_get_ord(n);

		TEST_CASE("signature of knowledge of discrete logarithm is correct") {
			bn_rand_mod(x, n);
			ec_mul_gen(y[0], x);
			TEST_ASSERT(cp_sokdl_sig(c[0], r[0], m, 5, y[0], x) == RLC_OK, end);
			TEST_ASSERT(cp_sokdl_ver(c[0], r[0], m, 5, y[0]) == 1, end);
			ec_dbl(y[0], y[0]);
			ec_norm(y[0], y[0]);
			TEST_ASSERT(cp_sokdl_ver(c[0], r[0], m, 5, y[0]) == 0, end);
		} TEST_END;

		TEST_CASE("signature of knowledge of disjunction is correct") {
			bn_rand_mod(x, n);
			do {
				ec_rand(y[0]);
				ec_mul_gen(y[1], x);
			} while (ec_cmp(y[0], y[1]) == RLC_EQ);
			TEST_ASSERT(cp_sokor_sig(c, r,  m, 5, y, NULL, x, 0) == RLC_OK, end);
			TEST_ASSERT(cp_sokor_ver(c, r,  m, 5, y, NULL) == 1, end);
			ec_dbl(y[1], y[1]);
			ec_norm(y[1], y[1]);
			TEST_ASSERT(cp_sokor_ver(c, r,  m, 5, y, NULL) == 0, end);
			do {
				ec_mul_gen(y[0], x);
				ec_rand(y[1]);
			} while (ec_cmp(y[0], y[1]) == RLC_EQ);
			TEST_ASSERT(cp_sokor_sig(c, r,  m, 5, y, NULL, x, 1) == RLC_OK, end);
			TEST_ASSERT(cp_sokor_ver(c, r,  m, 5, y, NULL) == 1, end);
			ec_dbl(y[0], y[0]);
			ec_norm(y[0], y[0]);
			TEST_ASSERT(cp_sokor_ver(c, r,  m, 5, y, NULL) == 0, end);
			do {
				ec_curve_get_gen(g[0]);
				ec_rand(g[1]);
				ec_rand(y[0]);
				ec_mul(y[1], g[1], x);
			} while (ec_cmp(y[0], y[1]) == RLC_EQ);
			TEST_ASSERT(cp_sokor_sig(c, r,  m, 5, y, g, x, 0) == RLC_OK, end);
			TEST_ASSERT(cp_sokor_ver(c, r,  m, 5, y, g) == 1, end);
			ec_dbl(y[1], y[1]);
			ec_norm(y[1], y[1]);
			TEST_ASSERT(cp_sokor_ver(c, r,  m, 5, y, g) == 0, end);
			do {
				ec_rand(g[0]);
				ec_mul(y[0], g[0], x);
				ec_curve_get_gen(g[1]);
				ec_rand(y[1]);
			} while (ec_cmp(y[0], y[1]) == RLC_EQ);
			TEST_ASSERT(cp_sokor_sig(c, r,  m, 5, y, g, x, 1) == RLC_OK, end);
			TEST_ASSERT(cp_sokor_ver(c, r,  m, 5, y, g) == 1, end);
			ec_dbl(y[0], y[0]);
			ec_norm(y[0], y[0]);
			TEST_ASSERT(cp_sokor_ver(c, r,  m, 5, y, g) == 0, end);
		} TEST_END;
	}
	RLC_CATCH_ANY {
		RLC_ERROR(end);
	}
	code = RLC_OK;

end:
	bn_free(n);
	bn_free(x);
	for (int i = 0; i < 2; i++) {
		bn_free(c[i]);
		bn_free(r[i]);
		ec_free(g[i]);
		ec_free(y[i]);
	}
	return code;
}
