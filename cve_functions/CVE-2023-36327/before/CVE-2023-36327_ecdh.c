static int ecdh(void) {
	int code = RLC_ERR;
	bn_t da, d_b;
	ec_t qa, q_b;
	uint8_t k1[RLC_MD_LEN], k2[RLC_MD_LEN];

	bn_null(da);
	bn_null(d_b);
	ec_null(qa);
	ec_null(q_b);

	RLC_TRY {
		bn_new(da);
		bn_new(d_b);
		ec_new(qa);
		ec_new(q_b);

		TEST_CASE("ecdh key agreement is correct") {
			TEST_ASSERT(cp_ecdh_gen(da, qa) == RLC_OK, end);
			TEST_ASSERT(cp_ecdh_gen(d_b, q_b) == RLC_OK, end);
			TEST_ASSERT(cp_ecdh_key(k1, RLC_MD_LEN, d_b, qa) == RLC_OK, end);
			TEST_ASSERT(cp_ecdh_key(k2, RLC_MD_LEN, da, q_b) == RLC_OK, end);
			TEST_ASSERT(memcmp(k1, k2, RLC_MD_LEN) == 0, end);
		} TEST_END;
	}
	RLC_CATCH_ANY {
		RLC_ERROR(end);
	}
	code = RLC_OK;

  end:
	bn_free(da);
	bn_free(d_b);
	ec_free(qa);
	ec_free(q_b);
	return code;
}
