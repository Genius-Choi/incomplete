static int paillier(void) {
	int code = RLC_ERR;
	bn_t a, b, c, d, s, pub;
	phpe_t prv;
	int result;

	bn_null(a);
	bn_null(b);
	bn_null(c);
	bn_null(d);
	bn_null(s);
	bn_null(pub);
	phpe_null(prv);

	RLC_TRY {
		bn_new(a);
		bn_new(b);
		bn_new(c);
		bn_new(d);
		bn_new(s);
		bn_new(pub);
		phpe_new(prv);

		result = cp_phpe_gen(pub, prv, RLC_BN_BITS / 2);

		TEST_CASE("paillier encryption/decryption is correct") {
			TEST_ASSERT(result == RLC_OK, end);
			bn_rand_mod(a, pub);
			TEST_ASSERT(cp_phpe_enc(c, a, pub) == RLC_OK, end);
			TEST_ASSERT(cp_phpe_dec(b, c, prv) == RLC_OK, end);
			TEST_ASSERT(bn_cmp(a, b) == RLC_EQ, end);
		}
		TEST_END;

		TEST_CASE("paillier encryption/decryption is homomorphic") {
			TEST_ASSERT(result == RLC_OK, end);
			bn_rand_mod(a, pub);
			bn_rand_mod(b, pub);
			TEST_ASSERT(cp_phpe_enc(c, a, pub) == RLC_OK, end);
			TEST_ASSERT(cp_phpe_enc(d, b, pub) == RLC_OK, end);
			TEST_ASSERT(cp_phpe_add(c, c, d, pub) == RLC_OK, end);
			TEST_ASSERT(cp_phpe_dec(d, c, prv) == RLC_OK, end);
			bn_add(a, a, b);
			bn_mod(a, a, pub);
			TEST_ASSERT(bn_cmp(a, d) == RLC_EQ, end);
		}
		TEST_END;

		for (int k = 1; k <= 2; k++) {
			result = cp_ghpe_gen(pub, s, RLC_BN_BITS / (2 * k));
			util_print("(s = %d) ", k);
			TEST_CASE("general paillier encryption/decryption is correct") {
				TEST_ASSERT(result == RLC_OK, end);
				bn_rand(a, RLC_POS, k * (bn_bits(pub) - 1));
				TEST_ASSERT(cp_ghpe_enc(c, a, pub, k) == RLC_OK, end);
				TEST_ASSERT(cp_ghpe_dec(b, c, pub, s, k) == RLC_OK, end);
				TEST_ASSERT(bn_cmp(a, b) == RLC_EQ, end);
			}  TEST_END;

			util_print("(s = %d) ", k);
			TEST_CASE("general paillier encryption/decryption is homomorphic") {
				TEST_ASSERT(result == RLC_OK, end);
				bn_rand(a, RLC_POS, k * (bn_bits(pub) - 1));
				bn_rand(b, RLC_POS, k * (bn_bits(pub) - 1));
				TEST_ASSERT(cp_ghpe_enc(c, a, pub, k) == RLC_OK, end);
				TEST_ASSERT(cp_ghpe_enc(d, b, pub, k) == RLC_OK, end);
				bn_mul(c, c, d);
				bn_sqr(d, pub);
				if (k == 2) {
					bn_mul(d, d, pub);
				}
				bn_mod(c, c, d);
				TEST_ASSERT(cp_ghpe_dec(c, c, pub, s, k) == RLC_OK, end);
				bn_add(a, a, b);
				bn_copy(d, pub);
				if (k == 2) {
					bn_mul(d, d, pub);
				}
				bn_mod(a, a, d);
				TEST_ASSERT(bn_cmp(a, c) == RLC_EQ, end);
			}
			TEST_END;
		}
	}
	RLC_CATCH_ANY {
		RLC_ERROR(end);
	}
	code = RLC_OK;

  end:
	bn_free(a);
	bn_free(b);
	bn_free(c);
	bn_free(d);
	bn_free(s);
	bn_free(pub);
	phpe_free(prv);
	return code;
}
