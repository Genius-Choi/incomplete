bool icProfDescToXml(std::string &xml, CIccProfileDescStruct &p, std::string blanks = "")
{
  char fix[256];
  char buf[256];
  char data[256];

  sprintf(buf, "<ProfileDesc>\n");
  xml += blanks + buf;

  sprintf(buf,   "<DeviceManufacturerSignature>%s</DeviceManufacturerSignature>\n", icFixXml(fix, icGetSigStr(data, p.m_deviceMfg)));
  xml += blanks + blanks + buf;

  sprintf(buf,  "<DeviceModelSignature>%s</DeviceModelSignature>\n", icFixXml(fix, icGetSigStr(data, p.m_deviceModel)));
  xml += blanks + blanks + buf;

  std::string szAttributes = icGetDeviceAttrName(p.m_attributes);
  //sprintf(buf, "<DeviceAttributes>\"%016lX\" technology=\"%s\">\n", p.m_attributes, icFixXml(fix, icGetSigStr(data, p.m_technology)));
  //xml += buf;
  xml += blanks + blanks + icGetDeviceAttrName(p.m_attributes);

  sprintf(buf, "<Technology>%s</Technology>\n", icFixXml(fix, icGetSigStr(data, p.m_technology)));
  xml += blanks + blanks + buf;

  CIccTag *pTag = p.m_deviceMfgDesc.GetTag();
  CIccTagXml *pExt;

  if (pTag) {

    pExt = (CIccTagXml*)(pTag->GetExtension());

    if (!pExt || !pExt->GetExtClassName() || strcmp(pExt->GetExtClassName(), "CIccTagXml"))
      return false;

    xml += blanks + blanks + "<DeviceManufacturer>\n";

    const icChar* tagSig = icGetTagSigTypeName(pTag->GetType());
    sprintf(buf, "<%s>\n", tagSig);
    xml += blanks + blanks + blanks + buf;

    if (!pExt->ToXml(xml, blanks + "        "))
      return false;

    sprintf(buf, "</%s>\n", tagSig);
    xml += blanks + blanks + blanks + buf;

    xml += blanks + blanks +"</DeviceManufacturer>\n";
  }

  pTag = p.m_deviceModelDesc.GetTag();

  if (pTag) {
    pExt = (CIccTagXml*)(pTag->GetExtension());

    if (!pExt || !pExt->GetExtClassName() || strcmp(pExt->GetExtClassName(), "CIccTagXml"))
      return false;

    xml += blanks + blanks + "<DeviceModel>\n";

    const icChar* tagSig = icGetTagSigTypeName(pTag->GetType());
    sprintf(buf, "<%s>\n", tagSig);
    xml += blanks + blanks + blanks + buf;

    if (!pExt->ToXml(xml, blanks + "        "))
      return false;

    sprintf(buf, "</%s>\n", tagSig);
    xml += blanks + blanks + blanks + buf;

    xml += blanks + "  </DeviceModel>\n";
  }

  xml += blanks + "</ProfileDesc>\n";

  return true;
}
