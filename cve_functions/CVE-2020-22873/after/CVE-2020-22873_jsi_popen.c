static FILE *jsi_popen(char **cmdv, const char *type, int *cpid)
{
#ifdef __WIN32
    return NULL;
#else
    int fd[2], pid, find = (*type != 'w' ? 1 : 0);
    if (!cmdv[0] || pipe(fd)<0)
        return NULL;
    pid = fork();
    if (pid<0) {
        close(fd[0]);
        close(fd[1]);
        return NULL;
    }

    if (pid) {
        *cpid = pid;
        close(fd[find]);
        return fdopen(fd[1-find], type);
    }
    if (fd[find] != find) {
        dup2(fd[find], find);
        close(fd[find]);
    }
    close(fd[1-find]);
    execvp(cmdv[0], cmdv);
    //execlp("sh", "sh", "-c", cmd, NULL);
    _exit(127);
#endif
}
