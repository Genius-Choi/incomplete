  void requestWithUnknownDomainTest(const std::string& typed_dns_resolver_config = "",
                                    const std::string& hostname = "doesnotexist.example.com") {
    useAccessLog("%RESPONSE_CODE_DETAILS%");
    initializeWithArgs(1024, 1024, "", typed_dns_resolver_config);
    codec_client_ = makeHttpConnection(lookupPort("http"));
    default_request_headers_.setHost(hostname);

    auto response = codec_client_->makeHeaderOnlyRequest(default_request_headers_);
    ASSERT_TRUE(response->waitForEndStream());
    EXPECT_EQ("503", response->headers().getStatusValue());
    EXPECT_THAT(waitForAccessLog(access_log_name_), HasSubstr("dns_resolution_failure"));

    response = codec_client_->makeHeaderOnlyRequest(default_request_headers_);
    ASSERT_TRUE(response->waitForEndStream());
    EXPECT_EQ("503", response->headers().getStatusValue());
    EXPECT_THAT(waitForAccessLog(access_log_name_, 1), HasSubstr("dns_resolution_failure"));
  }
