void Monitor::update_mon_metadata(int from, Metadata&& m)
{
  pending_metadata.insert(make_pair(from, std::move(m)));

  bufferlist bl;
  int err = store->get(MONITOR_STORE_PREFIX, "last_metadata", bl);
  map<int, Metadata> last_metadata;
  if (!err) {
    bufferlist::iterator iter = bl.begin();
    ::decode(last_metadata, iter);
    pending_metadata.insert(last_metadata.begin(), last_metadata.end());
  }

  MonitorDBStore::TransactionRef t = paxos->get_pending_transaction();
  bl.clear();
  ::encode(pending_metadata, bl);
  t->put(MONITOR_STORE_PREFIX, "last_metadata", bl);
  paxos->trigger_propose();
}
