int WifiPacket::decode_mgmt_frame(const u_char * ptr, size_t len, u_int16_t fc, u_int8_t hdrlen)
{
    mgmt_header_t hdr;
    u_int16_t seq_ctl;

    hdr.da    = MAC::ether2MAC(ptr + 4);
    hdr.sa    = MAC::ether2MAC(ptr + 10);
    hdr.bssid = MAC::ether2MAC(ptr + 16);

    hdr.duration = EXTRACT_LE_16BITS(ptr+2);

    seq_ctl   = pletohs(ptr + 22);

    hdr.seq   = COOK_SEQUENCE_NUMBER(seq_ctl);
    hdr.frag  = COOK_FRAGMENT_NUMBER(seq_ctl);

    cbs->Handle80211(*this, fc, hdr.sa, hdr.da, MAC::null, MAC::null, ptr, len);

    int ret = decode_mgmt_body(fc, &hdr, ptr+MGMT_HDRLEN, len-MGMT_HDRLEN);

    if (ret==0) {
	cbs->Handle80211Unknown(*this, fc, ptr, len);
	return 0;
    }

    return 0;
}
