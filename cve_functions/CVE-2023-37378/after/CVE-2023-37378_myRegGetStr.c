void NSISCALL myRegGetStr(HKEY root, const TCHAR *sub, const TCHAR *name, TCHAR *out, UINT altview)
{
  HKEY hKey;
  DWORD cb = NSIS_MAX_STRLEN*sizeof(TCHAR), rt, ec;
  REGSAM samview = altview ? GetAltViewREGSAM() : 0;
  if ((ec = RegKeyOpen(root, sub, KEY_READ|samview, &hKey)) == ERROR_SUCCESS)
  {
    ec = RegQueryValueEx(hKey, name, NULL, &rt, (LPBYTE)out, &cb);
    RegCloseKey(hKey);
    out[NSIS_MAX_STRLEN-1] = 0; // Make sure the string is terminated. This could potentially truncate a long string by 1 character!
  }
  if (ec != ERROR_SUCCESS || (rt != REG_SZ && rt != REG_EXPAND_SZ)) *out = 0; // Empty string on failure
}
