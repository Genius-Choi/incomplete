HttpStateData::decodeAndWriteReplyBody()
{
    assert(flags.chunked);
    assert(httpChunkDecoder);
    try {
        MemBuf decodedData;
        decodedData.init();
        httpChunkDecoder->setPayloadBuffer(&decodedData);
        const bool doneParsing = httpChunkDecoder->parse(inBuf);
        inBuf = httpChunkDecoder->remaining(); // sync buffers after parse
        addVirginReplyBody(decodedData.content(), decodedData.contentSize());
        if (doneParsing) {
            lastChunk = 1;
            flags.do_next_read = false;
            markParsedVirginReplyAsWhole("http parsed last-chunk");
        } else if (eof) {
            markPrematureReplyBodyEofFailure();
        }
        return true;
    }
    catch (...) {
        debugs (11, 2, "de-chunking failure: " << CurrentException);
    }
    return false;
}
