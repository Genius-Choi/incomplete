parse_doc_data(xmlTextReaderPtr reader, bool parse_hash, bool hash_req,
    struct doc_data *data)
{
	char *uri;
	unsigned char *hash;
	size_t hash_len;
	int error;

	uri = NULL;
	hash = NULL;
	hash_len = 0;

	error = parse_string(reader, RRDP_ATTR_URI, &uri);
	if (error)
		return error;

	if (!parse_hash)
		goto end;

	error = parse_hex_string(reader, hash_req, RRDP_ATTR_HASH, &hash,
	    &hash_len);
	if (error) {
		free(uri);
		return error;
	}
end:
	/* Function called just to do the validation */
	if (data == NULL) {
		free(hash);
		free(uri);
		return 0;
	}
	data->uri = uri;
	data->hash = hash;
	data->hash_len = hash_len;
	return 0;
}
