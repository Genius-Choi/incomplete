process_delta(struct delta_head *delta_head, void *arg)
{
	struct proc_upd_args *args = arg;
	struct rpki_uri *uri;
	struct doc_data *head_data;
	int error;

	head_data = &delta_head->doc_data;

	pr_val_debug("Processing delta '%s'.", delta_head->doc_data.uri);
	error = uri_create_https_str_rrdp(&uri, head_data->uri,
	    strlen(head_data->uri));
	if (error)
		return error;

	error = download_file(uri, 0, args->log_operation);
	if (error)
		goto release_uri;

	error = parse_delta(uri, delta_head, args);

	delete_from_uri(uri, NULL);
	/* Error 0 its ok */
release_uri:
	uri_refput(uri);
	return error;
}
