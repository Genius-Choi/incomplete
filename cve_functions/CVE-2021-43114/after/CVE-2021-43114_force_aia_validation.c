force_aia_validation(struct rpki_uri *caIssuers, X509 *son)
{
	X509 *parent;
	struct rfc5280_name *son_name;
	struct rfc5280_name *parent_name;
	int error;

	pr_val_debug("AIA's URI didn't matched parent URI, trying to SYNC");

	/* RSYNC is still the preferred access mechanism, force the sync */
	do {
		error = rsync_download_files(caIssuers, false, true);
		if (!error)
			break;
		if (error == EREQFAILED) {
			pr_val_info("AIA URI couldn't be downloaded, trying to search locally");
			break;
		}
		return error;
	} while (0);

	error = certificate_load(caIssuers, &parent);
	if (error)
		return error;

	error = x509_name_decode(X509_get_subject_name(parent), "subject",
	    &parent_name);
	if (error)
		goto free_parent;

	error = x509_name_decode(X509_get_issuer_name(son), "issuer",
	    &son_name);
	if (error)
		goto free_parent_name;

	if (x509_name_equals(parent_name, son_name))
		error = 0; /* Everything its ok */
	else
		error = pr_val_err("Certificate subject from AIA ('%s') isn't issuer of this certificate.",
		    uri_val_get_printable(caIssuers));

	x509_name_put(son_name);
free_parent_name:
	x509_name_put(parent_name);
free_parent:
	X509_free(parent);
	return error;
}
