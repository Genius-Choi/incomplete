int spider_db_mbase_util::append_embedding_tables(
  ha_spider *spider,
  spider_fields *fields,
  spider_string *str,
  TABLE_LIST *table_list,
  TABLE_LIST **used_table_list,
  uint *current_pos,
  TABLE_LIST **cond_table_list_ptr
) {
  int error_num;
  TABLE_LIST *embedding = table_list->embedding;
  DBUG_ENTER("spider_db_mbase_util::append_embedding_tables");
  DBUG_PRINT("info",("spider this=%p", this));
  if (embedding)
  {
    DBUG_PRINT("info",("spider embedding=%p", embedding));
    DBUG_PRINT("info",("spider embedding->outer_join=%u",
      embedding->outer_join));
    DBUG_PRINT("info",("spider embedding->on_expr=%p",
      embedding->on_expr));
    DBUG_PRINT("info",("spider embedding->join_using_fields=%p",
      embedding->join_using_fields));
    DBUG_PRINT("info",("spider embedding->table=%p",
      embedding->table));
    if ((error_num = append_embedding_tables(spider, fields, str, embedding,
      used_table_list, current_pos, cond_table_list_ptr)))
      DBUG_RETURN(error_num);
  } else {
    DBUG_PRINT("info",("spider table_list=%p", table_list));
    DBUG_PRINT("info",("spider table_list->outer_join=%u",
      table_list->outer_join));
    DBUG_PRINT("info",("spider table_list->on_expr=%p",
      table_list->on_expr));
    DBUG_PRINT("info",("spider table_list->join_using_fields=%p",
      table_list->join_using_fields));
    DBUG_PRINT("info",("spider table_list->table=%p",
      table_list->table));
    if (table_list->outer_join & JOIN_TYPE_RIGHT)
    {
      if ((error_num = append_tables_top_down_check(table_list,
        used_table_list, current_pos)))
        DBUG_RETURN(error_num);
      DBUG_ASSERT(!(*cond_table_list_ptr));
      (*cond_table_list_ptr) = table_list;
      DBUG_PRINT("info",("spider cond_table_list=%p", table_list));
    } else {
      if ((error_num = append_tables_top_down(spider, fields, str, table_list,
        used_table_list, current_pos, cond_table_list_ptr)))
        DBUG_RETURN(error_num);
    }
  }
  DBUG_RETURN(0);
}
