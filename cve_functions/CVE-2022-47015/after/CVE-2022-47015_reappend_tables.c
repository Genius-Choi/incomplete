int spider_db_mbase_util::reappend_tables(
  spider_fields *fields,
  SPIDER_LINK_IDX_CHAIN *link_idx_chain,
  spider_string *str
) {
  int error_num;
  uint32 length;
  ha_spider *spider;
  spider_mbase_share *db_share;
  spider_mbase_handler *dbton_hdl;
  SPIDER_TABLE_HOLDER *table_holder;
  SPIDER_LINK_IDX_HOLDER *link_idx_holder;
  DBUG_ENTER("spider_db_mbase_util::reappend_tables");
  DBUG_PRINT("info",("spider this=%p", this));
  length = str->length();
  fields->set_pos_to_first_table_on_link_idx_chain(link_idx_chain);
  fields->set_pos_to_first_table_holder();
  while ((table_holder = fields->get_next_table_holder()))
  {
    link_idx_holder =
      fields->get_next_table_on_link_idx_chain(link_idx_chain);
    spider = table_holder->spider;
    db_share = (spider_mbase_share *)
      spider->share->dbton_share[dbton_id];
    if (!db_share->same_db_table_name)
    {
      dbton_hdl = (spider_mbase_handler *) spider->dbton_handler[dbton_id];
      str->length(dbton_hdl->table_name_pos);
      if ((error_num = db_share->append_table_name_with_adjusting(str,
        spider->conn_link_idx[link_idx_holder->link_idx])))
      {
        DBUG_RETURN(error_num);
      }
    }
  }
  str->length(length);
  DBUG_RETURN(0);
}
