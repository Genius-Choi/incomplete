static int r_jws_set_payload_value(jws_t * jws, int force) {
  int ret = RHN_OK, zip = 0;
  unsigned char * payload_to_set = NULL;
  size_t payload_to_set_len = 0;
  struct _o_datum dat = {0, NULL};

  if (jws != NULL) {
    if (jws->payload_b64url == NULL || force) {
      if (jws->payload_len) {
        if (0 == o_strcmp("DEF", r_jws_get_header_str_value(jws, "zip"))) {
          zip = 1;
          if ((ret = _r_deflate_payload(jws->payload, jws->payload_len, &payload_to_set, &payload_to_set_len)) != RHN_OK) {
            y_log_message(Y_LOG_LEVEL_ERROR, "r_jws_set_payload_value - Error _r_deflate_payload");
          }
        } else {
          payload_to_set = jws->payload;
          payload_to_set_len = jws->payload_len;
        }
        if (ret == RHN_OK) {
          if (o_base64url_encode_alloc(payload_to_set, payload_to_set_len, &dat)) {
            o_free(jws->payload_b64url);
            jws->payload_b64url = (unsigned char *)o_strndup((const char *)dat.data, dat.size);
            o_free(dat.data);
          } else {
            y_log_message(Y_LOG_LEVEL_ERROR, "r_jws_set_payload_value - Error o_base64url_encode payload");
            ret = RHN_ERROR;
          }
        }
        if (zip) {
          o_free(payload_to_set);
        }
      } else {
        y_log_message(Y_LOG_LEVEL_ERROR, "r_jws_set_payload_value - Error empty payload");
        ret = RHN_ERROR_PARAM;
      }
    }
  } else {
    ret = RHN_ERROR_PARAM;
  }
  return ret;
}
