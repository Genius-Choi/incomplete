jws_t * r_jws_copy(jws_t * jws) {
  jws_t * jws_copy = NULL;
  if (jws != NULL) {
    if (r_jws_init(&jws_copy) == RHN_OK) {
      if (r_jws_set_payload(jws_copy, jws->payload, jws->payload_len) == RHN_OK) {
        jws_copy->header_b64url = (unsigned char *)o_strdup((const char *)jws->header_b64url);
        jws_copy->payload_b64url = (unsigned char *)o_strdup((const char *)jws->payload_b64url);
        jws_copy->signature_b64url = (unsigned char *)o_strdup((const char *)jws->signature_b64url);
        jws_copy->alg = jws->alg;
        r_jwks_free(jws_copy->jwks_privkey);
        jws_copy->jwks_privkey = r_jwks_copy(jws->jwks_privkey);
        r_jwks_free(jws_copy->jwks_pubkey);
        jws_copy->jwks_pubkey = r_jwks_copy(jws->jwks_pubkey);
        json_decref(jws_copy->j_header);
        jws_copy->j_header = json_deep_copy(jws->j_header);
        jws_copy->j_json_serialization = json_deep_copy(jws->j_json_serialization);
      } else {
        y_log_message(Y_LOG_LEVEL_ERROR, "r_jws_copy - Error allocating resources for jws_copy->payload");
        r_jws_free(jws_copy);
        jws_copy = NULL;
      }
    } else {
      y_log_message(Y_LOG_LEVEL_ERROR, "r_jws_copy - Error r_jws_init");
    }
  }
  return jws_copy;
}
