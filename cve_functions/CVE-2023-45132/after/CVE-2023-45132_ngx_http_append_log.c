ngx_http_append_log(ngx_http_request_t* r, ngx_array_t* ostr, ngx_str_t* fragment, u_int* offset)
{
  u_int        seed, sub;
  static u_int prev_seed = 0;

  /*
  ** avoid random collisions, as we % 1000 them,
  ** this is very likely to happen !
  */

  /*
  ** extra space has been reserved to append the seed.
  */
#ifndef _WIN32
  while ((seed = random() % 1000) == prev_seed)
#else  // _WIN32
  while ((seed = rand() % 1000) == prev_seed)
#endif // !_WIN32
    ;
  sub           = snprintf((char*)(fragment->data + *offset), MAX_SEED_LEN, "&seed_start=%d", seed);
  fragment->len = *offset + sub;
  fragment      = ngx_array_push(ostr);
  if (!fragment)
    return (NULL);
  fragment->data = ngx_pcalloc(r->pool, MAX_LINE_SIZE + 1);
  if (!fragment->data)
    return (NULL);
  sub       = snprintf((char*)fragment->data, MAX_SEED_LEN, "seed_end=%d", seed);
  prev_seed = seed;
  *offset   = sub;
  return (fragment);
}
