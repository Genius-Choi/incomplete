    bool isLocalSipUri( const string& requestUri ) {

        static bool initialized = false ;
        static vector< pair<string, string> > vecLocalUris ;

        DR_LOG(log_debug) << "isLocalSipUri: checking to see if this is one of mine: " << requestUri ;

        if( !initialized ) {
            initialized = true ;

            nta_agent_t* agent = theOneAndOnlyController->getAgent() ;
            tport_t *t = nta_agent_tports( agent ) ;
            for (tport_t* tport = t; tport; tport = tport_next(tport) ) {
                const tp_name_t* tpn = tport_name( tport );
                if( 0 == strcmp( tpn->tpn_host, "*") ) 
                    continue ;

                string localUri = tpn->tpn_host ;
                string localPort = NULL != tpn->tpn_port ? tpn->tpn_port : "5060" ;

                //DR_LOG(log_debug) << "isLocalSipUri: adding local address: " << localUri << ":" << localPort ;


                vecLocalUris.push_back(make_pair(localUri, localPort)) ;

                if( 0 == strcmp(tpn->tpn_host,"127.0.0.1") ) {
                    vecLocalUris.push_back(make_pair("localhost", localPort)) ;
                }
            }

            // add public ip addresses and dns names
            vector< pair<string, string> > vecIps ;
            SipTransport::getAllExternalContacts(vecIps) ;
            for(vector< pair<string, string> >::const_iterator it = vecIps.begin(); it != vecIps.end(); ++it) {
                vecLocalUris.push_back(*it) ;
            }
       }

       if( 0 == requestUri.find("tel:")) {
        DR_LOG(log_debug) << "isLocalSipUri: tel: scheme, so we are  assuming it is not local (will cause it to be carried forward in proxy request): " << requestUri ;
        return false;
       }

        su_home_t* home = theOneAndOnlyController->getHome() ;
        char *s ;
        char buf[255];
        char const *display = NULL;
        url_t url[1];
        msg_param_t const *params = NULL;
        char const *comment = NULL;
        int rc ;

        // buf gets passed into sip_name_addr_d which puts NULs in various locations so the url_t members can point to their bits
        s = strncpy( buf, requestUri.c_str(), 255 ) ;

        // first we decode the string
        rc = sip_name_addr_d(home, &s, &display, url, &params, &comment) ;
        if( rc < 0 ) {  
            // no go: if we can't decode it then we have an invalid input
            return false ;
        }

        // cleanup: free the msg_params if any were allocated        
        if( params ) {
            su_free(home, (void *) params) ;
        }

        for(vector< pair<string, string> >::const_iterator it = vecLocalUris.begin(); it != vecLocalUris.end(); ++it) {
            string host = it->first ;
            string port = it->second ;

            if (port.empty()) port = "5060";

            //DR_LOG(log_debug) << "isLocalSipUri: comparing known local address: " << host << ":" << port ;

            if ((0 == host.compare(url->url_host)) && (
                (!url->url_port && 0 == port.compare("5060")) ||
                (url->url_port && 0 == port.compare(url->url_port)))
            ) {
                return true ;
            }
        }
        return false ;
    }
