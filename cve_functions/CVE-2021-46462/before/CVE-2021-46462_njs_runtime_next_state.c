njs_runtime_next_state(njs_runtime_t *rt, njs_opts_t *opts)
{
    unsigned  next, n;

    n = 0;
    next = ((opts->async) ? (unsigned) random() : rt->current++) % rt->size;

    while (rt->states[next].state == sw_done) {
        next++;
        next = next % rt->size;

        n++;

        if (n == rt->size) {
            return NULL;
        }
    }

    return &rt->states[next];
}
