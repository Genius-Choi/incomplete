GF_Err gf_odf_ac3_cfg_write(GF_AC3Config *cfg, u8 **data, u32 *size)
{
	GF_BitStream *bs = gf_bs_new(NULL, 0, GF_BITSTREAM_WRITE);
	GF_Err e = gf_odf_ac3_cfg_write_bs(cfg, bs);

	if (cfg->is_ec3 && (cfg->atmos_ec3_ext || cfg->complexity_index_type)) {
		gf_bs_write_int(bs, 0, 7);
		gf_bs_write_int(bs, cfg->atmos_ec3_ext, 1);
		gf_bs_write_u8(bs, cfg->complexity_index_type);
	}
	gf_bs_get_content(bs, data, size);

	gf_bs_del(bs);
	return e;
}
