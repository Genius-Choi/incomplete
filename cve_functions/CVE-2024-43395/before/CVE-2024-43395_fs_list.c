static int fs_list(lua_State *L) {
    lastCFunction = __func__;
    std::string str = checkstring(L, 1);
    const std::vector<path_t> possible_paths = fixpath_multiple(get_comp(L), str);
    if (possible_paths.empty()) err(L, 1, "No such file");
    bool gotdir = false;
    std::set<std::string> entries;
    for (const path_t& path : possible_paths) {
        if (std::regex_search((*path.begin()).native(), pathregex("^\\d+:"))) {
            try {
                const FileEntry &d = get_comp(L)->virtualMounts[(unsigned)std::stoul((*path.begin()).native())]->path(path.lexically_relative(*path.begin()));
                if (d.isDir) {
                    gotdir = true;
                    for (const auto& p : d.dir) entries.insert(p.first);
                }
            } catch (...) {continue;}
        } else {
            std::error_code e;
            if (fs::is_directory(path, e)) {
                gotdir = true;
                for (const auto& dir : fs::directory_iterator(path, e)) {
                    if (dir.path().filename() == ".DS_Store" || dir.path().filename() == "desktop.ini") continue;
                    entries.insert(dir.path().filename().u8string());
                }
            }
        }
    }
    if (!gotdir) err(L, 1, "Not a directory");
    std::set<std::string> mounts = getMounts(get_comp(L), str);
    std::set<std::string> all;
    std::set_union(entries.begin(), entries.end(), mounts.begin(), mounts.end(), std::inserter(all, all.begin()));
    int i = 1;
    lua_createtable(L, all.size(), 0);
    for (const std::string& p : all) {
        lua_pushinteger(L, i++);
        lua_pushstring(L, p.c_str());
        lua_settable(L, -3);
    }
    return 1;
}
