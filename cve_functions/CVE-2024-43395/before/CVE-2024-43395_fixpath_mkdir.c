path_t fixpath_mkdir(Computer * comp, const std::string& path, bool md, std::string * mountPath) {
    if (md && fixpath_ro(comp, path)) return path_t();
    std::list<std::string> components = split_list(path, "/\\");
    while (!components.empty() && components.front().empty()) components.pop_front();
    if (components.empty()) return fixpath(comp, "", true);
    components.pop_back();
    std::list<std::string> append;
    path_t maxPath = fixpath(comp, concat(components, '/'), false, true, mountPath);
    while (maxPath.empty()) {
        append.push_front(components.back());
        components.pop_back();
        if (components.empty()) return path_t();
        maxPath = fixpath(comp, concat(components, '/'), false, true, mountPath);
    }
    if (!md) return maxPath;
    for (const std::string& s : append) maxPath /= s;
    std::error_code e;
    fs::create_directories(maxPath, e);
    if (e) return path_t();
    return fixpath(comp, path, false, true, mountPath);
}
