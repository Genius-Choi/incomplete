static std::string normalizePath(const path_t& basePath) {
    path_t cleanPath;
    for (const auto& p : basePath) {
        if (std::regex_match(p.native(), pathregex("^\\.\\.\\.+$"))) cleanPath /= ".";
        else cleanPath /= p;
    }
    cleanPath = cleanPath.lexically_normal();
    if (path_t::preferred_separator != (path_t::value_type)'/') {
        path_t::string_type str = cleanPath.native();
        std::replace(str.begin(), str.end(), path_t::preferred_separator, (path_t::value_type)'/');
        cleanPath = path_t(str);
    }
    std::string retval = cleanPath.string();
    if (retval == ".") retval = "";
    if (!retval.empty() && retval[0] == '/') retval = retval.substr(1);
    if (!retval.empty() && retval[retval.size()-1] == '/') retval = retval.substr(0, retval.size()-1);
    return retval;
}
