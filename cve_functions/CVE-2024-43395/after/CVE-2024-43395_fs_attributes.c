static int fs_attributes(lua_State *L) {
    lastCFunction = __func__;
    std::string str = checkstring(L, 1);
    const path_t path = fixpath(get_comp(L), str, true);
    if (path.empty()) err(L, 1, "No such file");
    if (std::regex_search((*path.begin()).native(), pathregex("^\\d+:"))) {
        try {
            const FileEntry &d = get_comp(L)->virtualMounts[(unsigned)std::stoul((*path.begin()).native())]->path(path.lexically_relative(*path.begin()));
            lua_createtable(L, 0, 6);
            lua_pushinteger(L, 0);
            lua_setfield(L, -2, "modification");
            lua_pushinteger(L, 0);
            lua_setfield(L, -2, "modified");
            lua_pushinteger(L, 0);
            lua_setfield(L, -2, "created");
            lua_pushinteger(L, d.isDir ? 0 : d.data.length());
            lua_setfield(L, -2, "size");
            lua_pushboolean(L, d.isDir);
            lua_setfield(L, -2, "isDir");
            lua_pushboolean(L, true);
            lua_setfield(L, -2, "isReadOnly");
        } catch (...) {
            lua_pushnil(L);
            return 1;
        }
    } else {
#ifdef _WIN32
        struct _stat st;
        if (_wstat(path.c_str(), &st) != 0) {
            lua_pushnil(L);
            return 1;
        }
#else
        struct stat st;
        if (stat(path.c_str(), &st) != 0) {
            lua_pushnil(L);
            return 1;
        }
#endif
        lua_createtable(L, 0, 6);
        lua_pushinteger(L, st_time_ms(st.st_m));
        lua_setfield(L, -2, "modification");
        lua_pushinteger(L, st_time_ms(st.st_m));
        lua_setfield(L, -2, "modified");
        lua_pushinteger(L, st_time_ms(st.st_c));
        lua_setfield(L, -2, "created");
        lua_pushinteger(L, S_ISDIR(st.st_mode) ? 0 : st.st_size);
        lua_setfield(L, -2, "size");
        lua_pushboolean(L, S_ISDIR(st.st_mode));
        lua_setfield(L, -2, "isDir");
        if (fixpath_ro(get_comp(L), str)) lua_pushboolean(L, true);
        else {
            std::error_code e;
            if (!fs::exists(path, e)) lua_pushboolean(L, false);
#ifdef WIN32
            else if (e.clear(), fs::is_directory(path, e)) {
                const path_t file = path / "a";
                const bool didexist = fs::exists(file, e);
                std::fstream fp(file, didexist ? std::ios::in : std::ios::out);
                lua_pushboolean(L, !fp.is_open());
                fp.close();
                e.clear();
                if (!didexist && fs::exists(file, e)) fs::remove(file, e);
            }
#endif
            else lua_pushboolean(L, access(path.c_str(), W_OK) != 0);
        }
        lua_setfield(L, -2, "isReadOnly");
    }
    return 1;
}
