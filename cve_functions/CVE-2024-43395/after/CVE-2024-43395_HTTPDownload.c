void HTTPDownload(const std::string& url, const std::function<void(std::istream*, Poco::Exception*, HTTPResponse*)>& callback) {
    Poco::URI uri;
    try {
        uri = Poco::URI(url);
    } catch (Poco::SyntaxException &e) {
        callback(NULL, &e, NULL);
        return;
    }
    Context::Ptr ctx = new Context(Context::CLIENT_USE, "", Context::VERIFY_RELAXED, 9, true, "ALL:!ADH:!LOW:!EXP:!MD5:@STRENGTH");
    addSystemCertificates(ctx);
#if POCO_VERSION >= 0x010A0000
    ctx->disableProtocols(Context::PROTO_TLSV1_3);
#endif
    HTTPSClientSession session(uri.getHost(), uri.getPort(), ctx);
    if (!config.http_proxy_server.empty()) session.setProxy(config.http_proxy_server, config.http_proxy_port);
    size_t pos = url.find('/', url.find(uri.getHost()));
    std::string path = urlEncode(pos != std::string::npos ? url.substr(pos) : "/");
    HTTPRequest request(HTTPRequest::HTTP_GET, path, HTTPMessage::HTTP_1_1);
    HTTPResponse response;
    session.setTimeout(Poco::Timespan(5000000));
    request.add("User-Agent", "CraftOS-PC/" CRAFTOSPC_VERSION " ComputerCraft/" CRAFTOSPC_CC_VERSION);
    try {
        session.sendRequest(request);
        std::istream& stream = session.receiveResponse(response);
        if (response.getStatus() / 100 == 3 && response.has("Location")) 
            return HTTPDownload(response.get("Location"), callback);
        callback(&stream, NULL, &response);
    } catch (Poco::Exception &e) {
        callback(NULL, &e, NULL);
    }
}
