int edit(char* name, char* date, char* data)
{
	char* ed;
	char* pt;
	char* editor;
	char* p = NULL;
	struct stat st;

	if (!isatty(STDIN_FILENO))
		return edit_stdin(name,date,data,0);

	pt = getenv("PATH");

	ed = config_read("external_editor",NULL);
	if (!ed)
		ed = getenv("EDITOR");

	/* no editor or no path, use builtin */
	if (config_read("force_builtin_editor","true") || !ed || (ed[0] != '/' && !pt))
		return edit_builtin(name,date,data);

	/* find the executable */
	if (ed[0] == '/') {
		stat(ed,&st);
		/* check it exists */
		if (S_ISREG(st.st_mode)) {
			p = ed;
			editor = strdup(ed);
		}
	}else{
		p = strtok(pt,":");
		while (p) {
			p = strtok(NULL,":");

			if (asprintf(&editor,"%s/%s",p,ed) < 0)
				continue;

			stat(editor,&st);
			/* check it exists */
			if (S_ISREG(st.st_mode))
				break;

			free(editor);
		}
	}

	/* no executable, or fails to run, use builtin */
	if (!p || edit_ext(editor,name,date,data))
		return edit_builtin(name,date,data);

	return 0;
}
