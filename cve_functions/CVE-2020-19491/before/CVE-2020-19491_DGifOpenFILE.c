CGIFFF GifFileType *CGIFFF DGifOpenFILE(void/*FILE*/ *f) {
    char Buf[GIF_STAMP_LEN+1];
    GifFileType *GifFile;
    GifFilePrivateType *Private;
    GifFile = (GifFileType *) xmalloc(sizeof(GifFileType));

    memset(GifFile, '\0', sizeof(GifFileType));

    Private = (GifFilePrivateType *) xmalloc(sizeof(GifFilePrivateType));
    GifFile->Private = (VoidPtr) Private;
    /* Private->FileHandle = FileHandle; */
    Private->File = (FILE*)f;
    Private->FileState = 0;   /* Make sure bit 0 = 0 (File open for read). */

    /* Let's see if this is a GIF file: */
    if (fread(Buf, 1, GIF_STAMP_LEN, Private->File) != GIF_STAMP_LEN) {
	_GifError = D_GIF_ERR_READ_FAILED;
	free((char *) Private);
	free((char *) GifFile);
	return NULL;
    }

    /* The GIF Version number is ignored at this time. Maybe we should do    */
    /* something more useful with it.					     */
    Buf[GIF_STAMP_LEN] = 0;
    if (strncmp(GIF_STAMP, Buf, GIF_VERSION_POS) != 0) {
	_GifError = D_GIF_ERR_NOT_GIF_FILE;
	free((char *) Private);
	free((char *) GifFile);
	return NULL;
    }

    if (DGifGetScreenDesc(GifFile) == GIF_ERROR) {
	free((char *) Private);
	free((char *) GifFile);
	return NULL;
    }

    _GifError = 0;

    return GifFile;
}
