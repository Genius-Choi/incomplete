  MaxPoolGradOp(OpKernelConstruction* ctx, int num_spatial_dims)
      : XlaOpKernel(ctx), num_spatial_dims_(num_spatial_dims) {
    if (ctx->num_inputs() == 3) {
      OP_REQUIRES_OK(ctx, ctx->GetAttr("ksize", &ksize_));
      OP_REQUIRES_OK(ctx, ctx->GetAttr("strides", &stride_));
    }
    OP_REQUIRES_OK(ctx, ctx->GetAttr("padding", &padding_));
    OP_REQUIRES(ctx, padding_ != EXPLICIT,
                errors::Unimplemented(
                    "XLA does not support maxpoolgrad with explicit padding."));
    // When determinism is enabled, the use of SelectAndScatter causes a generic
    // error to be raised. We raise a more informative error here before
    // SelectAndScatter is used.
    OP_REQUIRES(
        ctx, !tensorflow::OpDeterminismRequired(),
        errors::Unimplemented("GPU MaxPool gradient ops do not yet have a "
                              "deterministic XLA implementation."));
  }
