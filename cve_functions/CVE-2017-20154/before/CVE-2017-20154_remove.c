bool CTxMemPool::remove(const CTransaction &tx, bool fRecursive) {

    LOCK(cs);
    uint256 hash = tx.GetHash();
    if(mapTx.count(hash)) {
        if(fRecursive) {
            uint i;
            for(i = 0; i < tx.vout.size(); i++) {
                std::map<COutPoint, CInPoint>::iterator it = mapNextTx.find(COutPoint(hash, i));
                if(it != mapNextTx.end())
                  remove(*it->second.ptx, true);
            }
        }
        BOOST_FOREACH(const CTxIn &txin, tx.vin)
          mapNextTx.erase(txin.prevout);
        mapTx.erase(hash);
        nTransactionsUpdated++;
    }
    return(true);
}
