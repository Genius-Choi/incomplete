char * ulfius_url_decode(const char * str) {
  char * pstr = (char*)str, * buf = NULL, * pbuf = NULL;
  if (str != NULL) {
    buf = malloc(strlen(str) + 1);
    if (buf != NULL) {
      pbuf = buf;
      while (* pstr) {
        if (* pstr == '%') {
          if (pstr[1] && pstr[2]) {
            * pbuf++ = from_hex(pstr[1]) << 4 | from_hex(pstr[2]);
            pstr += 2;
          }
        } else if (* pstr == '+') {
          * pbuf++ = ' ';
        } else {
          * pbuf++ = * pstr;
        }
        pstr++;
      }
      * pbuf = '\0';
    } else {
      y_log_message(Y_LOG_LEVEL_ERROR, "Ulfius - Error allocating resources for buf (ulfius_url_decode)");
    }
    return buf;
  } else {
    return NULL;
  }
}
