void connect(Endpoint const& endpoint, Socket& s, Yield yield)
{
  suppressC4100(yield);
#ifdef ENABLE_TLS
  if constexpr (IsSslStreamV<Socket>) {
    connect(endpoint, s.next_layer(), yield);
    s.async_handshake(ssl::stream_base::handshake_type::client, yield);
  }
  else
#endif // ENABLE_TLS
#ifdef BUILD_TEST
      if constexpr (is_same_v<Socket, pichi::test::Stream>) {
    s.connect();
  }
  else
#endif // BUILD_TEST
    asio::async_connect(s,
                        tcp::resolver{s.get_executor()
#ifndef RESOLVER_CONSTRUCTED_FROM_EXECUTOR
                                          .context()
#endif // RESOLVER_CONSTRUCTED_FROM_EXECUTOR
                        }
                            .async_resolve(endpoint.host_, endpoint.port_, yield),
                        yield);
}
