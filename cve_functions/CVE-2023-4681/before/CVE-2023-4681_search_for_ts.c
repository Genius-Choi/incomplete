static mpeg2ps_record_pes_t *search_for_ts (mpeg2ps_stream_t *sptr,
				     u64 dts)
{
  mpeg2ps_record_pes_t *p, *q;
  u64 p_diff, q_diff;
  if (sptr->record_last == NULL) return NULL;

  if (dts > sptr->record_last->dts) return sptr->record_last;

  if (dts < sptr->record_first->dts) return NULL;
  if (dts == sptr->record_first->dts) return sptr->record_first;

  p = sptr->record_first;
  q = p->next_rec;

  while (q != NULL && q->dts > dts) {
    p = q;
    q = q->next_rec;
  }
  if (q == NULL) {
    return sptr->record_last;
  }

  p_diff = dts - p->dts;
  q_diff = q->dts - dts;

  if (p_diff < q_diff) return p;
  if (q_diff > 90000) return p;

  return q;
}
