cancel_push_promise (struct ietf_full_conn *conn, struct push_promise *promise)
{
    LSQ_DEBUG("cancel promise %"PRIu64, promise->pp_id);
    /* Remove promise from hash to prevent multiple cancellations */
    lsquic_hash_erase(conn->ifc_pub.u.ietf.promises, &promise->pp_hash_id);
    /* But let stream dtor free the promise object as sm_promise may yet
     * be used by the stream in some ways.
     */
    /* TODO: drop lsquic_stream_shutdown_internal, use something else */
    lsquic_stream_shutdown_internal(promise->pp_pushed_stream);
    if (0 != lsquic_hcso_write_cancel_push(&conn->ifc_hcso, promise->pp_id))
        ABORT_WARN("cannot write CANCEL_PUSH");
    lsquic_pp_put(promise, conn->ifc_pub.u.ietf.promises);
}
