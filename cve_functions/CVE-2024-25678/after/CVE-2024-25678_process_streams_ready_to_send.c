process_streams_ready_to_send (struct ietf_full_conn *conn)
{
    struct lsquic_stream *stream;
    union prio_iter pi;

    assert(!TAILQ_EMPTY(&conn->ifc_pub.sending_streams));

    conn->ifc_pii->pii_init(&pi, TAILQ_FIRST(&conn->ifc_pub.sending_streams),
        TAILQ_LAST(&conn->ifc_pub.sending_streams, lsquic_streams_tailq),
        (uintptr_t) &TAILQ_NEXT((lsquic_stream_t *) NULL, next_send_stream),
        &conn->ifc_pub, "send", NULL, NULL);

    for (stream = conn->ifc_pii->pii_first(&pi); stream;
                                    stream = conn->ifc_pii->pii_next(&pi))
        if (!process_stream_ready_to_send(conn, stream))
            break;

    conn->ifc_pii->pii_cleanup(&pi);
}
