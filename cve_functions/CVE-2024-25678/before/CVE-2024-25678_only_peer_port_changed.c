only_peer_port_changed (const struct network_path *old,
                                                    struct network_path *new)
{
    const struct sockaddr *old_sa, *new_sa;

    if (!lsquic_sockaddr_eq(NP_LOCAL_SA(old), NP_LOCAL_SA(new)))
        return 0;

    old_sa = NP_PEER_SA(old);
    new_sa = NP_PEER_SA(new);
    if (old_sa->sa_family == AF_INET)
        return old_sa->sa_family == new_sa->sa_family
            && ((struct sockaddr_in *) old_sa)->sin_addr.s_addr
                            == ((struct sockaddr_in *) new_sa)->sin_addr.s_addr
            && ((struct sockaddr_in *) old_sa)->sin_port
                        != /* NE! */((struct sockaddr_in *) new_sa)->sin_port;
    else
        return old_sa->sa_family == new_sa->sa_family
            && ((struct sockaddr_in6 *) old_sa)->sin6_port != /* NE! */
                                ((struct sockaddr_in6 *) new_sa)->sin6_port
            && 0 == memcmp(&((struct sockaddr_in6 *) old_sa)->sin6_addr,
                        &((struct sockaddr_in6 *) new_sa)->sin6_addr,
                        sizeof(((struct sockaddr_in6 *) new_sa)->sin6_addr));
}
