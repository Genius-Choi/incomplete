ietf_full_conn_ci_set_min_datagram_size (struct lsquic_conn *lconn,
                                                            size_t new_size)
{
    struct ietf_full_conn *conn = (struct ietf_full_conn *) lconn;
    const struct transport_params *const params =
        lconn->cn_esf.i->esfi_get_peer_transport_params(lconn->cn_enc_session);

    if (!(conn->ifc_flags & IFC_DATAGRAMS))
    {
        LSQ_WARN("datagrams are not enabled: cannot set minimum size");
        return -1;
    }

    if (new_size > USHRT_MAX)
    {
        LSQ_DEBUG("min datagram size cannot be larger than %hu",
                                                    (unsigned short) USHRT_MAX);
        return -1;
    }

    if (new_size > params->tp_numerics[TPI_MAX_DATAGRAM_FRAME_SIZE])
    {
        LSQ_DEBUG("maximum datagram frame size is %"PRIu64", cannot change it "
            "to %zd", params->tp_numerics[TPI_MAX_DATAGRAM_FRAME_SIZE],
            new_size);
        return -1;
    }

    conn->ifc_min_dg_sz = new_size;
    LSQ_DEBUG("set minimum datagram size to %zd bytes", new_size);
    return 0;
}
