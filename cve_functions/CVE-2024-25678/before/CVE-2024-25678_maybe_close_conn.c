maybe_close_conn (struct ietf_full_conn *conn)
{
    if ((conn->ifc_flags & (IFC_CLOSING|IFC_GOING_AWAY|IFC_SERVER))
                                            == (IFC_GOING_AWAY|IFC_SERVER)
        && !have_bidi_streams(conn))
    {
        conn->ifc_flags |= IFC_CLOSING|IFC_GOAWAY_CLOSE;
        LSQ_DEBUG("maybe_close_conn: GOAWAY sent and no responses remain");
        if (conn_ok_to_close(conn))
        {
            conn->ifc_send_flags |= SF_SEND_CONN_CLOSE;
            LSQ_DEBUG("maybe_close_conn: ok to close: "
                      "schedule to send CONNECTION_CLOSE");
        }
    }
}
