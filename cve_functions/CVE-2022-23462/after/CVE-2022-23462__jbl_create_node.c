static iwrc _jbl_create_node(
  JBLDRCTX   *ctx,
  const binn *bv,
  JBL_NODE    parent,
  const char *key,
  int         klidx,
  JBL_NODE   *node,
  bool        clone_strings
  ) {
  iwrc rc = 0;
  JBL_NODE n = iwpool_alloc(sizeof(*n), ctx->pool);
  if (node) {
    *node = 0;
  }
  if (!n) {
    return iwrc_set_errno(IW_ERROR_ALLOC, errno);
  }
  memset(n, 0, sizeof(*n));
  if (key && clone_strings) {
    n->key = iwpool_strndup(ctx->pool, key, klidx, &rc);
    RCGO(rc, finish);
  } else {
    n->key = key;
  }
  n->klidx = klidx;
  n->parent = parent;
  switch (bv->type) {
    case BINN_NULL:
      n->type = JBV_NULL;
      break;
    case BINN_STRING:
      n->type = JBV_STR;
      if (!clone_strings) {
        n->vptr = bv->ptr;
        n->vsize = bv->size;
      } else {
        n->vptr = iwpool_strndup(ctx->pool, bv->ptr, bv->size, &rc);
        n->vsize = bv->size;
        RCGO(rc, finish);
      }
      break;
    case BINN_OBJECT:
    case BINN_MAP:
      n->type = JBV_OBJECT;
      break;
    case BINN_LIST:
      n->type = JBV_ARRAY;
      break;
    case BINN_TRUE:
      n->type = JBV_BOOL;
      n->vbool = true;
      break;
    case BINN_FALSE:
      n->type = JBV_BOOL;
      n->vbool = false;
      break;
    case BINN_BOOL:
      n->type = JBV_BOOL;
      n->vbool = bv->vbool;
      break;
    case BINN_UINT8:
      n->vi64 = bv->vuint8;
      n->type = JBV_I64;
      break;
    case BINN_UINT16:
      n->vi64 = bv->vuint16;
      n->type = JBV_I64;
      break;
    case BINN_UINT32:
      n->vi64 = bv->vuint32;
      n->type = JBV_I64;
      break;
    case BINN_UINT64:
      n->vi64 = bv->vuint64;
      n->type = JBV_I64;
      break;
    case BINN_INT8:
      n->vi64 = bv->vint8; // NOLINT(bugprone-signed-char-misuse)
      n->type = JBV_I64;
      break;
    case BINN_INT16:
      n->vi64 = bv->vint16;
      n->type = JBV_I64;
      break;
    case BINN_INT32:
      n->vi64 = bv->vint32;
      n->type = JBV_I64;
      break;
    case BINN_INT64:
      n->vi64 = bv->vint64;
      n->type = JBV_I64;
      break;
    case BINN_FLOAT32:
    case BINN_FLOAT64:
      n->vf64 = bv->vdouble;
      n->type = JBV_F64;
      break;
    default:
      rc = JBL_ERROR_CREATION;
      goto finish;
  }
  if (parent) {
    _jbn_add_item(parent, n);
  }

finish:
  if (rc) {
    free(n);
  } else {
    if (node) {
      *node = n;
    }
  }
  return rc;
}
