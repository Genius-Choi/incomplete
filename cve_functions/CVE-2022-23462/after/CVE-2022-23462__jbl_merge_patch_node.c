static JBL_NODE _jbl_merge_patch_node(JBL_NODE target, JBL_NODE patch, IWPOOL *pool, iwrc *rcp) {
  *rcp = 0;
  if (!patch) {
    return 0;
  }
  if (patch->type == JBV_OBJECT) {
    if (!target) {
      target = iwpool_alloc(sizeof(*target), pool);
      if (!target) {
        *rcp = iwrc_set_errno(IW_ERROR_ALLOC, errno);
        return 0;
      }
      memset(target, 0, sizeof(*target));
      target->type = JBV_OBJECT;
      target->key = patch->key;
      target->klidx = patch->klidx;
    } else if (target->type != JBV_OBJECT) {
      _jbl_node_reset_data(target);
      target->type = JBV_OBJECT;
    }
    patch = patch->child;
    while (patch) {
      JBL_NODE patch_next = patch->next;
      if (patch->type == JBV_NULL) {
        JBL_NODE node = target->child;
        while (node) {
          if ((node->klidx == patch->klidx) && !strncmp(node->key, patch->key, node->klidx)) {
            _jbn_remove_item(target, node);
            break;
          }
          node = node->next;
        }
      } else {
        JBL_NODE node = target->child;
        while (node) {
          if ((node->klidx == patch->klidx) && !strncmp(node->key, patch->key, node->klidx)) {
            _jbl_copy_node_data(node, _jbl_merge_patch_node(node, patch, pool, rcp));
            break;
          }
          node = node->next;
        }
        if (!node) {
          _jbn_add_item(target, _jbl_merge_patch_node(0, patch, pool, rcp));
        }
      }
      patch = patch_next;
    }
    return target;
  } else {
    return patch;
  }
}
