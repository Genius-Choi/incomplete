char * mobi_decode_exthstring(const MOBIData *m, const unsigned char *data, const size_t size) {
    if (!m || !data) {
        return NULL;
    }
    size_t out_length = 3 * size + 1;
    size_t in_length = size;
    char *exth_string = malloc(out_length);
    if (exth_string == NULL) {
        debug_print("%s\n", "Memory allocation failed");
        return NULL;
    }
    if (mobi_is_cp1252(m)) {
        MOBI_RET ret = mobi_cp1252_to_utf8(exth_string, (const char *) data, &out_length, in_length);
        if (ret != MOBI_SUCCESS) {
            free(exth_string);
            return NULL;
        }
    } else {
        memcpy(exth_string, data, size);
        out_length = size;
    }
    exth_string[out_length] = '\0';
    char *exth_decoded = mobi_decode_htmlentities(exth_string);
    if (exth_decoded != NULL) {
        free(exth_string);
        return exth_decoded;
    }
    return exth_string;
}
