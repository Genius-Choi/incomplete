MOBI_RET mobi_insert_records_by_seqnumber(MOBIData *m, MOBIPdbRecord *record, const size_t num) {
    if (m == NULL || m->rec == NULL) {
        debug_print("%s", "Mobi structure not initialized\n");
        return MOBI_INIT_FAILED;
    }
    if (record == NULL) {
        return MOBI_SUCCESS;
    }
    
    MOBIPdbRecord *curr = record;
    size_t count = 1;
    while (curr->next != NULL) {
        curr = curr->next;
        count++;
    }
    
    if (m->ph->rec_count + count > UINT16_MAX) {
        debug_print("%s", "Number of records beyond database limit\n");
        return MOBI_DATA_CORRUPT;
    }
    
    MOBIPdbRecord *next = NULL;
    if (num == 0) {
        next = m->rec;
        m->rec = record;
    } else {
        MOBIPdbRecord *prev = mobi_get_record_by_seqnumber(m, num - 1);
        if (prev == NULL) {
            debug_print("%s", "Insert point not found\n");
            return MOBI_DATA_CORRUPT;
        }
        next = prev->next;
        prev->next = record;
    }
    curr->next = next;
    m->ph->rec_count += count;

    debug_print("Inserted %zu records at index = %zu\n", count, num);
        
    return MOBI_SUCCESS;
}
