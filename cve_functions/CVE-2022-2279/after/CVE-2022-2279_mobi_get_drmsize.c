uint32_t mobi_get_drmsize(const MOBIData *m) {
    if (m == NULL || !mobi_is_encrypted(m)) {
        return 0;
    }
    size_t size = 0;
    
    if (m->rh->encryption_type == MOBI_ENCRYPTION_V1) {
        size = 51;
    } else if (m->mh && m->mh->drm_size && *m->mh->drm_size > 0) {
        size = *m->mh->drm_size;
    }
    
    if (size > UINT32_MAX) {
        return 0;
    }
    return (uint32_t) size;
}
