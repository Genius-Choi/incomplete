static char * get_sub_public(struct _oidc_config * config, const char * username) {
  json_t * j_query, * j_result;
  int res;
  char * sub = NULL;

  j_query = json_pack("{sss[s]s{sssssoso}}",
                      "table",
                      GLEWLWYD_PLUGIN_OIDC_TABLE_SUBJECT_IDENTIFIER,
                      "columns",
                        "gposi_sub",
                      "where",
                        "gposi_plugin_name",
                        config->name,
                        "gposi_username",
                        username,
                        "gposi_client_id",
                        json_null(),
                        "gposi_sector_identifier_uri",
                        json_null());
  res = h_select(config->glewlwyd_config->glewlwyd_config->conn, j_query, &j_result, NULL);
  json_decref(j_query);
  if (res == H_OK) {
    if (json_array_size(j_result)) {
      sub = o_strdup(json_string_value(json_object_get(json_array_get(j_result, 0), "gposi_sub")));
    } else {
      sub = o_malloc((GLEWLWYD_SUB_LENGTH+1));
      if (sub != NULL) {
        *sub = '\0';
        if (rand_string(sub, GLEWLWYD_SUB_LENGTH) != NULL) {
          j_query = json_pack("{sss{sssssssoso}}",
                              "table",
                              GLEWLWYD_PLUGIN_OIDC_TABLE_SUBJECT_IDENTIFIER,
                              "values",
                                "gposi_plugin_name",
                                config->name,
                                "gposi_sub",
                                sub,
                                "gposi_username",
                                username,
                                "gposi_client_id",
                                json_null(),
                                "gposi_sector_identifier_uri",
                                json_null());
          if (h_insert(config->glewlwyd_config->glewlwyd_config->conn, j_query, NULL) != H_OK) {
            y_log_message(Y_LOG_LEVEL_ERROR, "get_sub_public - Error executing h_insert");
            o_free(sub);
            sub = NULL;
          }
          json_decref(j_query);
        } else {
          y_log_message(Y_LOG_LEVEL_ERROR, "get_sub_public - Error rand_string");
        }
      } else {
        y_log_message(Y_LOG_LEVEL_ERROR, "get_sub_public - Error allocating resources for sub");
      }
    }
    json_decref(j_result);
  } else {
    y_log_message(Y_LOG_LEVEL_ERROR, "get_sub_public - Error executing h_select");
  }
  return sub;
}
