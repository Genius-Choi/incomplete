static jwk_t * get_jwk_sign(struct _oidc_config * config, json_t * j_client, jwa_alg alg) {
  jwks_t * jwks_subset = NULL;
  jwk_t * jwk = NULL;
  const char * sign_kid = json_string_value(json_object_get(config->j_params, "client-sign_kid-parameter"));

  if (r_jwks_size(config->jwks_sign) == 1 || j_client == NULL) {
    return r_jwks_get_at(config->jwks_sign, 0);
  } else if (!json_string_null_or_empty(json_object_get(j_client, sign_kid))) {
    return r_jwks_get_by_kid(config->jwks_sign, json_string_value(json_object_get(j_client, sign_kid)));
  } else {
    if (alg == R_JWA_ALG_HS256 || alg == R_JWA_ALG_HS384 || alg == R_JWA_ALG_HS512) {
      jwks_subset = r_jwks_search_json_str(config->jwks_sign, "{\"kty\":\"oct\"}");
      jwk = r_jwks_get_at(jwks_subset, 0);
      r_jwks_free(jwks_subset);
    } else if (alg == R_JWA_ALG_RS256 || alg == R_JWA_ALG_RS384 || alg == R_JWA_ALG_RS512 ||
               alg == R_JWA_ALG_PS256 || alg == R_JWA_ALG_PS384 || alg == R_JWA_ALG_PS512) {
      jwks_subset = r_jwks_search_json_str(config->jwks_sign, "{\"kty\":\"RSA\"}");
      jwk = r_jwks_get_at(jwks_subset, 0);
      r_jwks_free(jwks_subset);
    } else if (alg == R_JWA_ALG_ES256 || alg == R_JWA_ALG_ES384 || alg == R_JWA_ALG_ES512) {
      jwks_subset = r_jwks_search_json_str(config->jwks_sign, "{\"kty\":\"EC\"}");
      jwk = r_jwks_get_at(jwks_subset, 0);
      r_jwks_free(jwks_subset);
    } else if (alg == R_JWA_ALG_EDDSA || alg == R_JWA_ALG_ES256K) {
      jwks_subset = r_jwks_search_json_str(config->jwks_sign, "{\"kty\":\"OKP\"}");
      jwk = r_jwks_get_at(jwks_subset, 0);
      r_jwks_free(jwks_subset);
    }
  }
  return jwk;
}
