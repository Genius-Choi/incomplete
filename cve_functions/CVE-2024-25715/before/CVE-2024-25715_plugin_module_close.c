int plugin_module_close(struct config_plugin * config, const char * name, void * cls) {
  UNUSED(name);
  if (cls != NULL) {
    y_log_message(Y_LOG_LEVEL_INFO, "Close plugin Glewlwyd Oauth2 '%s'", name);
    config->glewlwyd_callback_remove_plugin_endpoint(config, "GET", name, "auth/");
    config->glewlwyd_callback_remove_plugin_endpoint(config, "POST", name, "token/");
    config->glewlwyd_callback_remove_plugin_endpoint(config, "GET", name, "profile/");
    config->glewlwyd_callback_remove_plugin_endpoint(config, "GET", name, "profile/token/");
    config->glewlwyd_callback_remove_plugin_endpoint(config, "DELETE", name, "profile/token/");
    config->glewlwyd_callback_remove_plugin_endpoint(config, "DELETE", name, "profile/token/:token_hash");
    config->glewlwyd_callback_remove_plugin_endpoint(config, "*", name, "profile/*");
    config->glewlwyd_callback_remove_plugin_endpoint(config, "*", name, "profile/token/*");

    if (((struct _oauth2_config *)cls)->introspect_revoke_resource_config != NULL) {
      config->glewlwyd_callback_remove_plugin_endpoint(config, "POST", name, "introspect/");
      config->glewlwyd_callback_remove_plugin_endpoint(config, "POST", name, "revoke/");
      o_free(((struct _oauth2_config *)cls)->introspect_revoke_resource_config->oauth_scope);
      r_jwt_free(((struct _oauth2_config *)cls)->introspect_revoke_resource_config->jwt);
      o_free(((struct _oauth2_config *)cls)->introspect_revoke_resource_config);
    }
    if (((struct _oauth2_config *)cls)->glewlwyd_resource_config != NULL) {
      o_free(((struct _oauth2_config *)cls)->glewlwyd_resource_config->oauth_scope);
      r_jwt_free(((struct _oauth2_config *)cls)->glewlwyd_resource_config->jwt);
      o_free(((struct _oauth2_config *)cls)->glewlwyd_resource_config);
    }
    if (json_object_get(((struct _oauth2_config *)cls)->j_params, "auth-type-device-enabled") == json_true()) {
      config->glewlwyd_callback_remove_plugin_endpoint(config, "POST", name, "device_authorization/");
      config->glewlwyd_callback_remove_plugin_endpoint(config, "GET", name, "device/");
    }
    r_jwt_free(((struct _oauth2_config *)cls)->jwt_key);
    json_decref(((struct _oauth2_config *)cls)->j_params);
    pthread_mutex_destroy(&((struct _oauth2_config *)cls)->insert_lock);
    o_free(cls);
  }
  return G_OK;
}
