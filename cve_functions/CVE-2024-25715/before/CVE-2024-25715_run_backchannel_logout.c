static int run_backchannel_logout(struct _oidc_config * config, const char * username, const char * sid) {
  json_t * j_query, * j_result = NULL;
  int ret, res;
  pthread_t thread_logout;
  int thread_ret, thread_detach;
  pthread_attr_t attr;
  struct sched_param param;
  struct _backchannel_elements * elt;

  if (json_object_get(config->j_params, "back-channel-logout-allowed") == json_true()) {
    j_query = json_pack("{sss[s]s{sssssssi}}",
                        "table", GLEWLWYD_PLUGIN_OIDC_TABLE_ID_TOKEN,
                        "columns",
                          "DISTINCT(gpoi_client_id) AS client_id",
                        "where",
                          "gpoi_plugin_name", config->name,
                          "gpoi_username", username,
                          "gpoi_sid", sid,
                          "gpoi_enabled", 1);
    res = h_select(config->glewlwyd_config->glewlwyd_config->conn, j_query, &j_result, NULL);
    json_decref(j_query);
    if (res == H_OK) {
      if ((elt = o_malloc(sizeof(struct _backchannel_elements))) != NULL) {
        elt->config = config;
        elt->username = o_strdup(username);
        elt->sid = o_strdup(sid);
        elt->j_client_id_list = j_result;
        pthread_attr_init (&attr);
        pthread_attr_getschedparam (&attr, &param);
        param.sched_priority = 0;
        pthread_attr_setschedparam (&attr, &param);
        thread_ret = pthread_create(&thread_logout, &attr, run_backchannel_logout_thread, (void *)elt);
        thread_detach = pthread_detach(thread_logout);
        if (thread_ret || thread_detach) {
          y_log_message(Y_LOG_LEVEL_ERROR, "run_backchannel_logout - Error thread");
          o_free(elt->username);
          o_free(elt->sid);
          o_free(elt);
          json_decref(j_result);
          ret = G_ERROR;
        } else {
          ret = G_OK;
        }
      } else {
        y_log_message(Y_LOG_LEVEL_ERROR, "run_backchannel_logout - Error allocating resources for elt");
        json_decref(j_result);
        ret = G_ERROR_MEMORY;
      }
    } else {
      y_log_message(Y_LOG_LEVEL_ERROR, "run_backchannel_logout - Error executing j_query");
      ret = G_ERROR_DB;
    }
  } else {
    ret = G_OK;
  }
  return ret;
}
