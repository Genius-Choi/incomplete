static int is_client_auth_method_allowed(json_t * j_client, int client_auth_method) {
  int ret = 0;

  if (json_object_get(j_client, "confidential") == json_true() && client_auth_method != GLEWLWYD_CLIENT_AUTH_METHOD_NONE) {
    if (!json_string_null_or_empty(json_object_get(j_client, "token_endpoint_auth_method")) || json_array_size(json_object_get(j_client, "token_endpoint_auth_method"))) {
      switch (client_auth_method) {
        case GLEWLWYD_CLIENT_AUTH_METHOD_NONE:
          ret = 1;
          break;
        case GLEWLWYD_CLIENT_AUTH_METHOD_SECRET_POST:
          if (json_is_array(json_object_get(j_client, "token_endpoint_auth_method")) && json_array_has_string(json_object_get(j_client, "token_endpoint_auth_method"), "client_secret_post")) {
            ret = 1;
          }
          if (json_is_string(json_object_get(j_client, "token_endpoint_auth_method")) && 0 == o_strcmp("client_secret_post", json_string_value(json_object_get(j_client, "token_endpoint_auth_method")))) {
            ret = 1;
          }
          break;
        case GLEWLWYD_CLIENT_AUTH_METHOD_SECRET_BASIC:
          if (json_is_array(json_object_get(j_client, "token_endpoint_auth_method")) && json_array_has_string(json_object_get(j_client, "token_endpoint_auth_method"), "client_secret_basic")) {
            ret = 1;
          }
          if (json_is_string(json_object_get(j_client, "token_endpoint_auth_method")) && 0 == o_strcmp("client_secret_basic", json_string_value(json_object_get(j_client, "token_endpoint_auth_method")))) {
            ret = 1;
          }
          break;
        case GLEWLWYD_CLIENT_AUTH_METHOD_SECRET_JWT:
          if (json_is_array(json_object_get(j_client, "token_endpoint_auth_method")) && json_array_has_string(json_object_get(j_client, "token_endpoint_auth_method"), "client_secret_jwt")) {
            ret = 1;
          }
          if (json_is_string(json_object_get(j_client, "token_endpoint_auth_method")) && 0 == o_strcmp("client_secret_jwt", json_string_value(json_object_get(j_client, "token_endpoint_auth_method")))) {
            ret = 1;
          }
          break;
        case GLEWLWYD_CLIENT_AUTH_METHOD_PRIVATE_KEY_JWT:
          if (json_is_array(json_object_get(j_client, "token_endpoint_auth_method")) && json_array_has_string(json_object_get(j_client, "token_endpoint_auth_method"), "private_key_jwt")) {
            ret = 1;
          }
          if (json_is_string(json_object_get(j_client, "token_endpoint_auth_method")) && 0 == o_strcmp("private_key_jwt", json_string_value(json_object_get(j_client, "token_endpoint_auth_method")))) {
            ret = 1;
          }
          break;
        case GLEWLWYD_CLIENT_AUTH_METHOD_TLS:
          if (json_is_array(json_object_get(j_client, "token_endpoint_auth_method")) && json_array_has_string(json_object_get(j_client, "token_endpoint_auth_method"), "tls_client_auth")) {
            ret = 1;
          }
          if (json_is_string(json_object_get(j_client, "token_endpoint_auth_method")) && 0 == o_strcmp("tls_client_auth", json_string_value(json_object_get(j_client, "token_endpoint_auth_method")))) {
            ret = 1;
          }
          break;
        case GLEWLWYD_CLIENT_AUTH_METHOD_SELF_SIGNED_TLS:
          if (json_is_array(json_object_get(j_client, "token_endpoint_auth_method")) && json_array_has_string(json_object_get(j_client, "token_endpoint_auth_method"), "self_signed_tls_client_auth")) {
            ret = 1;
          }
          if (json_is_string(json_object_get(j_client, "token_endpoint_auth_method")) && 0 == o_strcmp("self_signed_tls_client_auth", json_string_value(json_object_get(j_client, "token_endpoint_auth_method")))) {
            ret = 1;
          }
          break;
        default:
          ret = 0;
          break;
      }
    } else {
      ret = 0;
    }
  } else if (json_object_get(j_client, "confidential") != json_true() && client_auth_method == GLEWLWYD_CLIENT_AUTH_METHOD_NONE) {
    ret = 1;
  }
  return ret;
}
