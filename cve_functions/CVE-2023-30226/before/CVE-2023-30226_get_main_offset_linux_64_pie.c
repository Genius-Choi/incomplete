static ut64 get_main_offset_linux_64_pie(ELFOBJ *bin, ut64 entry, ut8 *buf) {
	/* linux64 pie main -- probably buggy in some cases */
	int bo = 29; // Begin offset may vary depending on the entry prelude
	// endbr64 - fedora bins have this
	if (buf[0] == 0xf3 && buf[1] == 0x0f && buf[2] == 0x1e && buf[3] == 0xfa) {
		// Change begin offset if binary starts with 'endbr64'
		bo = 33;
		// double xor for init and fini
		if (!memcmp(buf + 19, "\x45\x31\xc0\x31\xc9", 5)) {
			bo = 24;
		}
	}
	if (buf[bo] == 0x48) {
		ut8 ch = buf[bo + 1];
		if (ch == 0x8d) { // lea rdi, qword [rip + MAINDELTA]
			ut8 *p = buf + bo + 3;
			st32 maindelta = (st32)rz_read_le32(p);
			ut64 ventry = Elf_(rz_bin_elf_p2v)(bin, entry);
			if (ventry == UT64_MAX) {
				return UT64_MAX;
			}
			ut64 vmain = (ut64)(ventry + bo + maindelta) + 7;
			return Elf_(rz_bin_elf_v2p)(bin, vmain);
		} else if (ch == 0xc7) { // mov rdi, 0xADDR
			ut8 *p = buf + bo + 3;
			ut64 addr = (ut64)rz_read_le32(p);
			return Elf_(rz_bin_elf_v2p)(bin, addr);
		}
	}

	return UT64_MAX;
}
