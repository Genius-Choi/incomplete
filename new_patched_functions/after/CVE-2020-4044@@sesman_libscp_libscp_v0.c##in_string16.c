int in_string16(struct stream *s, char str[], const char *param, int line)
{
    int result;

    if (!s_check_rem(s, 2))
    {
        log_message(LOG_LEVEL_WARNING,
                    "[v0:%d] connection aborted: %s len missing",
                    line, param);
        result = 0;
    }
    else
    {
        unsigned int sz;

        in_uint16_be(s, sz);
        if (sz > STRING16_MAX_LEN)
        {
            log_message(LOG_LEVEL_WARNING,
                        "[v0:%d] connection aborted: %s too long (%u chars)",
                        line, param, sz);
            result = 0;
        }
        else
        {
            result = s_check_rem(s, sz);
            if (!result)
            {
                log_message(LOG_LEVEL_WARNING,
                            "[v0:%d] connection aborted: %s data missing",
                            line, param);
            }
            else
            {
                in_uint8a(s, str, sz);
                str[sz] = '\0';
            }
        }
    }
    return result;
}
