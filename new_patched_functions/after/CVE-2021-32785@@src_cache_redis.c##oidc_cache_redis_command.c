static redisReply* oidc_cache_redis_command(request_rec *r,
		oidc_cache_cfg_redis_t *context, const char *format, ...) {

	redisReply *reply = NULL;
	int i = 0;
	va_list ap;
	va_start(ap, format);

	/* try to execute a command at max 2 times while reconnecting */
	for (i = 0; i < OIDC_REDIS_MAX_TRIES; i++) {

		/* connect */
		if (oidc_cache_redis_connect(r, context) != APR_SUCCESS)
			break;

		/* execute the actual command */
		reply = redisvCommand(context->ctx, format, ap);

		/* check for errors, need to return error replies for cache miss case REDIS_REPLY_NIL */
		if ((reply != NULL) && (reply->type != REDIS_REPLY_ERROR))
			/* break the loop and return the reply */
			break;

		/* something went wrong, log it */
		oidc_error(r,
				"Redis command (attempt=%d to %s:%d) failed, disconnecting: '%s' [%s]",
				i, context->host_str, context->port, context->ctx->errstr,
				reply ? reply->str : "<n/a>");

		/* free the reply (if there is one allocated) */
		oidc_cache_redis_reply_free(&reply);

		/* cleanup, we may try again (once) after reconnecting */
		oidc_cache_redis_free(context);
	}

	va_end(ap);

	return reply;
}
