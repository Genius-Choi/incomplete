void OnBeforeURLRequestAdBlockTP(const ResponseCallback& next_callback,
                                 std::shared_ptr<BraveRequestInfo> ctx) {
  DCHECK_CURRENTLY_ON(content::BrowserThread::UI);
  // If the following info isn't available, then proper content settings can't
  // be looked up, so do nothing.
  if (ctx->tab_origin.is_empty() || !ctx->tab_origin.has_host() ||
      ctx->request_url.is_empty()) {
    return;
  }
  DCHECK_NE(ctx->request_identifier, 0UL);

  scoped_refptr<base::SequencedTaskRunner> task_runner =
      g_brave_browser_process->ad_block_service()->GetTaskRunner();

  DCHECK(ctx->browser_context);
  // DoH or standard DNS quries won't be routed through Tor, so we need to skip
  // it.
  if (ctx->browser_context->IsTor()) {
    ShouldBlockAdWithOptionalCname(task_runner, std::move(next_callback), ctx,
                                   base::nullopt);
  } else {
    new AdblockCnameResolveHostClient(std::move(next_callback), task_runner,
                                      ctx);
  }
}
