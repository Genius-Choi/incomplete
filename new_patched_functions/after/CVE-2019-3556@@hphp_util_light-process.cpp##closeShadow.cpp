void LightProcess::closeShadow() {
  Lock lock(m_procMutex);
  if (m_shadowProcess) {
    try {
      lwp_write(m_afdt_fd, "exit");
    } catch (...) {
      handleException("closeShadow");
    }
    // removes the "zombie" process, so not to interfere with later waits
    while (true) {
      auto r = ::waitpid(m_shadowProcess, nullptr, 0);
      // retry on EINTR
      if (r != -1 || errno != EINTR) {
        break;
      }
    }

    m_shadowProcess = 0;
  }
  closeFiles();
}
