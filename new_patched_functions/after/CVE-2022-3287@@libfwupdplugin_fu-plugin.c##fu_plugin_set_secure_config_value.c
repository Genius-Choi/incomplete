fu_plugin_set_secure_config_value(FuPlugin *self,
				  const gchar *key,
				  const gchar *value,
				  GError **error)
{
	g_autofree gchar *conf_path = fu_plugin_get_config_filename(self);
	g_autofree gchar *data = NULL;
	g_autoptr(GKeyFile) keyfile = g_key_file_new();

	g_return_val_if_fail(FU_IS_PLUGIN(self), FALSE);
	g_return_val_if_fail(error == NULL || *error == NULL, FALSE);

	if (!g_file_test(conf_path, G_FILE_TEST_EXISTS)) {
		g_set_error(error, FWUPD_ERROR, FWUPD_ERROR_NOT_FOUND, "%s is missing", conf_path);
		return FALSE;
	}
	if (!g_key_file_load_from_file(keyfile, conf_path, G_KEY_FILE_KEEP_COMMENTS, error))
		return FALSE;
	g_key_file_set_string(keyfile, fu_plugin_get_name(self), key, value);
	data = g_key_file_to_data(keyfile, NULL, error);
	if (data == NULL)
		return FALSE;
	return g_file_set_contents_full(conf_path,
					data,
					-1,
					G_FILE_SET_CONTENTS_CONSISTENT,
					0660,
					error);
}
