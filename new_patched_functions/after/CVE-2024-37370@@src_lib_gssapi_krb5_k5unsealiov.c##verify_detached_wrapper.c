verify_detached_wrapper(const gss_OID_desc *mech, size_t *header_len,
                        uint8_t **header_in, size_t token_len)
{
    struct k5input in, mech_der;
    gss_OID_desc toid;
    size_t len;

    k5_input_init(&in, *header_in, *header_len);

    if (get_der_tag(&in, 0x60, &len)) {
        if (len != token_len - (in.ptr - *header_in))
            return G_BAD_TOK_HEADER;
        if (!k5_der_get_value(&in, 0x06, &mech_der))
            return G_BAD_TOK_HEADER;
        toid.elements = (uint8_t *)mech_der.ptr;
        toid.length = mech_der.len;
        if (!g_OID_equal(&toid, mech))
            return G_WRONG_MECH;
    }

    *header_in = (uint8_t *)in.ptr;
    *header_len = in.len;
    return 0;
}
