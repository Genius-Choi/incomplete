void trustedEncryptKeyAES(int *errStatus, char *errString, const char *key,
                     uint8_t *encryptedPrivateKey, uint32_t *enc_len) {

    LOG_DEBUG (__FUNCTION__);

    *errStatus = UNKNOWN_ERROR;

    memset(errString, 0, BUF_LEN);

    memset(encryptedPrivateKey, 0, BUF_LEN);

    int stat = AES_encrypt(key, encryptedPrivateKey);
    if (stat != 0) {
        *errStatus = stat;
        snprintf(errString, BUF_LEN, "AES encrypt failed with status %d", stat);
        return;
    }

    *enc_len = strlen(key) + SGX_AESGCM_MAC_SIZE + SGX_AESGCM_IV_SIZE;

    char decryptedKey[BUF_LEN];
    memset(decryptedKey, 0, BUF_LEN);

    stat = AES_decrypt(encryptedPrivateKey, *enc_len, decryptedKey);

    if (stat != 0) {
        *errStatus = stat;
        snprintf(errString, BUF_LEN, ":trustedDecryptKey failed with status %d", stat);
        return;
    }

    uint64_t decryptedKeyLen = strnlen(decryptedKey, MAX_KEY_LENGTH);

    if (decryptedKeyLen == MAX_KEY_LENGTH) {
        snprintf(errString, BUF_LEN, "Decrypted key is not null terminated");
        return;
    }


    *errStatus = -8;

    if (strncmp(key, decryptedKey, MAX_KEY_LENGTH) != 0) {
        snprintf(errString, BUF_LEN, "Decrypted key does not match original key");
        return;
    }

    *errStatus = 0;
}
