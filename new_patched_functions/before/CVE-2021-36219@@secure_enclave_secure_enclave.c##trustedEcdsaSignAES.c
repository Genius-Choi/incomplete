void trustedEcdsaSignAES(int *errStatus, char *errString, uint8_t *encryptedPrivateKey, uint32_t enc_len,
                    unsigned char *hash, char *sigR, char *sigS, uint8_t *sig_v, int base) {

    LOG_DEBUG (__FUNCTION__);

    domain_parameters curve = domain_parameters_init();
    domain_parameters_load_curve(curve, secp256k1);

    char skey[ECDSA_SKEY_LEN];

    int status = AES_decrypt(encryptedPrivateKey, enc_len, skey);

    if (status != 0) {
        *errStatus = status;
        snprintf(errString, BUF_LEN, "aes decrypt failed with status %d", status);
        return;
    }

    skey[enc_len - SGX_AESGCM_MAC_SIZE - SGX_AESGCM_IV_SIZE - 1] = '\0';

    snprintf(errString, BUF_LEN, "pr key is %s length %d ", skey, strlen(skey));
    mpz_t privateKeyMpz;
    mpz_init(privateKeyMpz);
    if (mpz_set_str(privateKeyMpz, skey, ECDSA_SKEY_BASE) == -1) {
        *errStatus = -1;
        snprintf(errString, BUF_LEN, "invalid secret key");
        mpz_clear(privateKeyMpz);
        return;
    }


    mpz_t msgMpz;
    mpz_init(msgMpz);
    if (mpz_set_str(msgMpz, hash, 16) == -1) {
        *errStatus = -1;
        snprintf(errString, BUF_LEN, "invalid message hash");
        mpz_clear(msgMpz);
        return;
    }

    signature sign = signature_init();

    signature_sign(sign, msgMpz, privateKeyMpz, curve);

    point Pkey = point_init();

    signature_extract_public_key(Pkey, privateKeyMpz, curve);

    if (!signature_verify(msgMpz, sign, Pkey, curve)) {
        *errStatus = -2;
        snprintf(errString, BUF_LEN, "signature is not verified! ");
        return;
    }


    char arrM[mpz_sizeinbase(msgMpz, 16) + 2];
    char *msg = mpz_get_str(arrM, 16, msgMpz);
    snprintf(errString, BUF_LEN, "message is %s ", arrM);

    char arrR[mpz_sizeinbase(sign->r, base) + 2];
    char *r = mpz_get_str(arrR, base, sign->r);
    strncpy(sigR, arrR, 1024);

    char arrS[mpz_sizeinbase(sign->s, base) + 2];
    char *s = mpz_get_str(arrS, base, sign->s);
    strncpy(sigS, arrS, 1024);

    *sig_v = sign->v;

    mpz_clear(privateKeyMpz);
    mpz_clear(msgMpz);
    domain_parameters_clear(curve);
    signature_free(sign);
    point_clear(Pkey);

}
