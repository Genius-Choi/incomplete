scp_v1s_connect_new_session(struct SCP_CONNECTION *c, SCP_DISPLAY d)
{
    /* send password request */
    tui32 version = 1;
    tui32 size = 14;
    tui16 cmd = 30;

    init_stream(c->out_s, c->out_s->size);

    out_uint32_be(c->out_s, version);                 /* version */
    out_uint32_be(c->out_s, size);                    /* size    */
    out_uint16_be(c->out_s, SCP_COMMAND_SET_DEFAULT); /* cmdset  */
    out_uint16_be(c->out_s, cmd);                     /* cmd     */

    out_uint16_be(c->out_s, d);                       /* display */

    if (0 != scp_tcp_force_send(c->in_sck, c->out_s->data, 14))
    {
        log_message(LOG_LEVEL_WARNING, "[v1s:%d] connection aborted: network error", __LINE__);
        return SCP_SERVER_STATE_NETWORK_ERR;
    }

    return SCP_SERVER_STATE_OK;
}
