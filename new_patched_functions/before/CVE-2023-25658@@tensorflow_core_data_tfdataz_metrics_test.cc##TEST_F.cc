TEST_F(TfDatazMetricsTest, GetMultipleAverageLatencies) {
  tfdataz_metrics_->RecordGetNextLatency(1);
  EXPECT_FLOAT_EQ(absl::ToDoubleMicroseconds(
                      tfdataz_metrics_->GetAverageLatencyForLastOneMinute()),
                  1.0);
  EXPECT_FLOAT_EQ(absl::ToDoubleMicroseconds(
                      tfdataz_metrics_->GetAverageLatencyForLastFiveMinutes()),
                  1.0);
  EXPECT_FLOAT_EQ(absl::ToDoubleMicroseconds(
                      tfdataz_metrics_->GetAverageLatencyForLastSixtyMinutes()),
                  1.0);

  env_->AdvanceByMicroseconds(k1MinutesInMicros);
  tfdataz_metrics_->RecordGetNextLatency(2);
  tfdataz_metrics_->RecordGetNextLatency(3);
  EXPECT_FLOAT_EQ(absl::ToDoubleMicroseconds(
                      tfdataz_metrics_->GetAverageLatencyForLastOneMinute()),
                  2.5);
  EXPECT_FLOAT_EQ(absl::ToDoubleMicroseconds(
                      tfdataz_metrics_->GetAverageLatencyForLastFiveMinutes()),
                  2.0);
  EXPECT_FLOAT_EQ(absl::ToDoubleMicroseconds(
                      tfdataz_metrics_->GetAverageLatencyForLastSixtyMinutes()),
                  2.0);

  env_->AdvanceByMicroseconds(k60MinutesInMicros);
  tfdataz_metrics_->RecordGetNextLatency(4);
  tfdataz_metrics_->RecordGetNextLatency(5);
  tfdataz_metrics_->RecordGetNextLatency(6);
  EXPECT_FLOAT_EQ(absl::ToDoubleMicroseconds(
                      tfdataz_metrics_->GetAverageLatencyForLastOneMinute()),
                  5.0);
  EXPECT_FLOAT_EQ(absl::ToDoubleMicroseconds(
                      tfdataz_metrics_->GetAverageLatencyForLastFiveMinutes()),
                  5.0);
  EXPECT_FLOAT_EQ(absl::ToDoubleMicroseconds(
                      tfdataz_metrics_->GetAverageLatencyForLastSixtyMinutes()),
                  5.0);
}
