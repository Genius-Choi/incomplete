njs_json_push_parse_state(njs_vm_t *vm, njs_json_parse_t *parse,
    njs_value_t *value)
{
    njs_json_state_t  *state;

    if (njs_slow_path(parse->depth >= NJS_JSON_MAX_DEPTH)) {
        njs_type_error(vm, "Nested too deep or a cyclic structure");
        return NULL;
    }

    state = &parse->states[parse->depth++];
    state->value = *value;
    state->index = 0;
    state->prop = NULL;
    state->keys = njs_value_own_enumerate(vm, value, NJS_ENUM_KEYS,
                                          NJS_ENUM_STRING, 0);
    if (state->keys == NULL) {
        return NULL;
    }

    return state;
}
