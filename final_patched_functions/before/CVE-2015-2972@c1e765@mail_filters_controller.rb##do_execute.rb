  def do_execute
    Log.add_info(request, params.inspect)

    mail_account = MailAccount.find_by_id(params[:mail_account_id])
    mail_folder = MailFolder.find_by_id(params[:mail_folder_id])

    if mail_account.user_id != @login_user.id \
        or mail_folder.user_id != @login_user.id
      render(:text => t('msg.need_to_be_owner'))
      return
    end

    mail_filters = MailFilter.get_for(mail_account.id, true, MailFilter::TRIGGER_MANUAL)
    emails = MailFolder.get_mails(mail_folder.id, mail_folder.user_id)

    filter_next = true
    emails.each do |email|
      mail_filters.each do |filter|
        filter_next = filter.execute(email)
        break unless filter_next
      end
      break unless filter_next
    end

    render(:text => '')
  end
