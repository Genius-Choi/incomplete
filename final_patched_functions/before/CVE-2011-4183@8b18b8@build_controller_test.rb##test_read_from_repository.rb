  def test_read_from_repository
    ActionController::IntegrationTest::reset_auth
    prepare_request_with_user "adrian", "so_alone"
    get "/build/home:Iggy/10.2/i586/_repository/not_existing.rpm"
    assert_response 404
    get "/build/home:Iggy/10.2/i586/TestPack/package-1.0-1.i586.rpm"
    assert_response :success
    get "/build/home:Iggy/10.2/i586/_repository"
    assert_response :success
    assert_tag :tag => "binarylist", :child => { :tag => "binary" }
    assert_tag :tag => "binary", :attributes => { :filename => "package.rpm" }
    get "/build/home:Iggy/10.2/i586/_repository/package.rpm"
    assert_response :success
    get "/build/home:Iggy/10.2/i586/_repository?binary=rpm&binary=package&view=cpio"
    assert_response :success
    ret = IO.popen("cpio -t 2>/dev/null", "r+") { |f| f.puts @response.body; f.close_write; f.gets }
    assert_match(/package.rpm/, ret)
  end
