    def shell_eval(opts={})
      should_escape = opts[:escape] != false
      command = yield(should_escape ? shell.escape(path) : path)
      run command, :escape => should_escape
    end
