def merge_lycoris(
    base_model,
    lycoris_model,
    weight,
    output_name,
    dtype,
    device,
    is_sdxl,
    is_v2,
):
    log.info("Merge model...")

    run_cmd = rf'"{PYTHON}" "{scriptdir}/tools/merge_lycoris.py"'
    run_cmd += rf' "{base_model}"'
    run_cmd += rf' "{lycoris_model}"'
    run_cmd += rf' "{output_name}"'
    run_cmd += f" --weight {weight}"
    run_cmd += f" --device {device}"
    run_cmd += f" --dtype {dtype}"
    if is_sdxl:
        run_cmd += f" --is_sdxl"
    if is_v2:
        run_cmd += f" --is_v2"

    log.info(run_cmd)

    env = os.environ.copy()
    env["PYTHONPATH"] = (
        rf"{scriptdir}{os.pathsep}{scriptdir}/sd-scripts{os.pathsep}{env.get('PYTHONPATH', '')}"
    )

    # Run the command
    subprocess.run(run_cmd, shell=True, env=env)

    log.info("Done merging...")
