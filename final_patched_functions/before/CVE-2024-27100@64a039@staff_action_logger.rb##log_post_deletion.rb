  def log_post_deletion(deleted_post, opts = {})
    unless deleted_post && deleted_post.is_a?(Post)
      raise Discourse::InvalidParameters.new(:deleted_post)
    end

    topic = deleted_post.topic || Topic.with_deleted.find_by(id: deleted_post.topic_id)

    username = deleted_post.user.try(:username) || I18n.t("staff_action_logs.unknown")
    name = deleted_post.user.try(:name) || I18n.t("staff_action_logs.unknown")
    topic_title = topic.try(:title) || I18n.t("staff_action_logs.not_found")

    details = [
      "id: #{deleted_post.id}",
      "created_at: #{deleted_post.created_at}",
      "user: #{username} (#{name})",
      "topic: #{topic_title}",
      "post_number: #{deleted_post.post_number}",
      "raw: #{deleted_post.raw}",
    ]

    UserHistory.create!(
      params(opts).merge(
        action: UserHistory.actions[:delete_post],
        post_id: deleted_post.id,
        details: details.join("\n"),
      ),
    )
  end
