def test_prepare_env_passes(sk_model):
    if no_conda:
        pytest.skip("This test requires conda.")

    with TempDir(chdr=True):
        with mlflow.start_run() as active_run:
            mlflow.sklearn.log_model(sk_model, "model")
            model_uri = f"runs:/{active_run.info.run_id}/model"

        # With conda
        subprocess.run(
            [
                "mlflow",
                "models",
                "prepare-env",
                "-m",
                model_uri,
            ],
            env=env_with_tracking_uri(),
            check=True,
        )

        # Should be idempotent
        subprocess.run(
            [
                "mlflow",
                "models",
                "prepare-env",
                "-m",
                model_uri,
            ],
            env=env_with_tracking_uri(),
            check=True,
        )
