def test_remote_repo_strip_components_doesnt_leak(remote_archiver):
    cmd(remote_archiver, "rcreate", RK_ENCRYPTION)
    create_regular_file(remote_archiver.input_path, "dir/file", contents=b"test file contents 1")
    create_regular_file(remote_archiver.input_path, "dir/file2", contents=b"test file contents 2")
    create_regular_file(remote_archiver.input_path, "skipped-file1", contents=b"test file contents 3")
    create_regular_file(remote_archiver.input_path, "skipped-file2", contents=b"test file contents 4")
    create_regular_file(remote_archiver.input_path, "skipped-file3", contents=b"test file contents 5")
    cmd(remote_archiver, "create", "test", "input")
    marker = "cached responses left in RemoteRepository"
    with changedir("output"):
        res = cmd(remote_archiver, "extract", "test", "--debug", "--strip-components", "3")
        assert marker not in res
        with assert_creates_file("file"):
            res = cmd(remote_archiver, "extract", "test", "--debug", "--strip-components", "2")
            assert marker not in res
        with assert_creates_file("dir/file"):
            res = cmd(remote_archiver, "extract", "test", "--debug", "--strip-components", "1")
            assert marker not in res
        with assert_creates_file("input/dir/file"):
            res = cmd(remote_archiver, "extract", "test", "--debug", "--strip-components", "0")
            assert marker not in res
