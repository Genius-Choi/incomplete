TEST_F(TestSPIFFEValidator, TestGetTrustBundleStore) {
  initialize();

  // No SAN
  auto cert = readCertFromFile(TestEnvironment::substitute(
      "{{ test_rundir }}/test/extensions/transport_sockets/tls/test_data/extensions_cert.pem"));
  EXPECT_FALSE(validator().getTrustBundleStore(cert.get()));

  // Non-SPIFFE SAN
  cert = readCertFromFile(TestEnvironment::substitute(
      "{{ test_rundir }}/test/extensions/transport_sockets/tls/test_data/non_spiffe_san_cert.pem"));
  EXPECT_FALSE(validator().getTrustBundleStore(cert.get()));

  // SPIFFE SAN
  cert = readCertFromFile(TestEnvironment::substitute(
      "{{ test_rundir }}/test/extensions/transport_sockets/tls/test_data/spiffe_san_cert.pem"));

  // Trust bundle not provided.
  EXPECT_FALSE(validator().getTrustBundleStore(cert.get()));

  // Trust bundle provided.
  validator().trustBundleStores().emplace("example.com", X509StorePtr(X509_STORE_new()));
  EXPECT_TRUE(validator().getTrustBundleStore(cert.get()));
}
