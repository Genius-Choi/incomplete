async def test_workdir():
    unit_name = 'systemdspawner-unittest-' + str(time.time())
    _, env_filename = tempfile.mkstemp()
    with tempfile.TemporaryDirectory() as d:
        await systemd.start_transient_service(
            unit_name,
            ['/bin/bash'],
            ['-c', 'pwd > {}/pwd'.format(d)],
            working_dir=d,
        )

        # Wait a tiny bit for the systemd unit to complete running
        await asyncio.sleep(0.1)
 
        with open(os.path.join(d, 'pwd')) as f:
            text = f.read().strip()
            assert text == d
