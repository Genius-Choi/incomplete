def privacy_preference_history(
    db,
    provided_identity_and_consent_request,
    privacy_notice,
    privacy_experience_privacy_center,
    served_notice_history,
):
    provided_identity, consent_request = provided_identity_and_consent_request
    privacy_notice_history = privacy_notice.histories[0]

    preference_history_record = PrivacyPreferenceHistory.create(
        db=db,
        data={
            "anonymized_ip_address": "92.158.1.0",
            "email": "test@email.com",
            "method": "button",
            "privacy_experience_config_history_id": privacy_experience_privacy_center.experience_config.experience_config_history_id,
            "privacy_experience_id": privacy_experience_privacy_center.id,
            "preference": "opt_out",
            "privacy_notice_history_id": privacy_notice_history.id,
            "provided_identity_id": provided_identity.id,
            "request_origin": "privacy_center",
            "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_2) AppleWebKit/324.42 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/425.24",
            "user_geography": "us_ca",
            "url_recorded": "example.com/privacy_center",
            "served_notice_history_id": served_notice_history.id,
        },
        check_name=False,
    )
    yield preference_history_record
    preference_history_record.delete(db)
