  std::unique_ptr<net::test_server::HttpResponse> HandleEmbeddedSrvrRequest(
      const net::test_server::HttpRequest& request) {
    auto http_response =
        std::make_unique<net::test_server::BasicHttpResponse>();
    http_response->set_content_type("text/html");

    // IPFS gateways set this
    http_response->AddCustomHeader("access-control-allow-origin", "*");

    std::string request_path = request.GetURL().path();
    http_response->set_code(net::HTTP_NOT_FOUND);
    if (request_path == "/simple_content") {
      http_response->set_content("simple content");
      http_response->set_code(net::HTTP_OK);
    } else if (request_path == "/simple_content_2") {
      http_response->set_content("simple content 2");
      http_response->set_code(net::HTTP_OK);
    } else if (request_path == "/simple.html") {
      http_response->set_content("simple.html");
      http_response->AddCustomHeader("x-ipfs-path", "/simple.html");
      http_response->set_code(net::HTTP_OK);
    } else if (request_path == "/gateway_redirect") {
      http_response->set_content("Welcome to IPFS :-)");
      http_response->set_code(net::HTTP_OK);
    } else if (request_path == "/ipfs/bafkqae2xmvwgg33nmuqhi3zajfiemuzahiwss") {
      http_response->set_content("Welcome to IPFS :-)");
      if (request.GetURL().host() == "127.0.0.1") {
        http_response->set_code(net::HTTP_TEMPORARY_REDIRECT);
        GURL new_location(
            GetURL("bafkqae2xmvwgg33nmuqhi3zajfiemuzahiwss.ipfs.a.com",
                   "/gateway_redirect"));
        http_response->AddCustomHeader("Location", new_location.spec());
      }
    } else if (request_path == "/iframe.html") {
      http_response->set_content(
          "<iframe "
          "src='ipfs://Qmc2JTQo4iXf24g98otZmGFQq176eQ2Cdbb88qA5ToMEvC/2'>"
          "</iframe>");
      http_response->set_code(net::HTTP_OK);
    } else if (request_path ==
               "/ipfs/"
               "Qmc2JTQo4iXf24g98otZmGFQq176eQ2Cdbb88qA5ToMEvC") {
      http_response->set_code(net::HTTP_TEMPORARY_REDIRECT);
      GURL new_location(ipfs::GetIPFSGatewayURL(
          "Qmc2JTQo4iXf24g98otZmGFQq176eQ2Cdbb88qA5ToMEvC", "simple_content",
          GetDefaultIPFSGateway(browser()->profile()->GetPrefs())));
      http_response->AddCustomHeader("Location", new_location.spec());
    } else if (request_path ==
               "/ipfs/"
               "Qmc2JTQo4iXf24g98otZmGFQq176eQ2Cdbb88qA5ToMEvC/2") {
      http_response->set_code(net::HTTP_TEMPORARY_REDIRECT);
      GURL new_location(ipfs::GetIPFSGatewayURL(
          "Qmc2JTQo4iXf24g98otZmGFQq176eQ2Cdbb88qA5ToMEvC", "simple_content_2",
          GetDefaultIPFSGateway(browser()->profile()->GetPrefs())));
      http_response->AddCustomHeader("Location", new_location.spec());
    } else if (request_path ==
               "/ipfs/"
               "bafybeiemxf5abjwjbikoz4mc3a3dla6ual3jsgpdr4cjr3oz3evfyavhwq") {
      http_response->set_content("test content 1");
      http_response->set_code(net::HTTP_OK);
    } else if (request_path ==
               "/ipfs/"
               "dbafybeiemxf5abjwjbikoz4mc3a3dla6ual3jsgpdr4cjr3oz3evfyavhwq") {
      http_response->set_content_type("image/png");
      std::string image;
      std::string base64_image =
          "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQYV2NIbbj6HwAF"
          "w"
          "gK6ho3LlwAAAABJRU5ErkJggg==";
      base::Base64Decode(base64_image, &image);
      http_response->set_content(image);
    }

    return http_response;
  }
