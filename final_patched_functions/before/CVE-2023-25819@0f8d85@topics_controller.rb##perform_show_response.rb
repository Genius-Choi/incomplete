  def perform_show_response
    if request.head?
      head :ok
      return
    end

    topic_view_serializer =
      TopicViewSerializer.new(
        @topic_view,
        scope: guardian,
        root: false,
        include_raw: !!params[:include_raw],
        exclude_suggested_and_related:
          !!params[:replies_to_post_number] || !!params[:filter_upwards_post_id] ||
            !!params[:filter_top_level_replies],
      )

    respond_to do |format|
      format.html do
        @tags = SiteSetting.tagging_enabled ? @topic_view.topic.tags : []
        @breadcrumbs = helpers.categories_breadcrumb(@topic_view.topic) || []
        @description_meta =
          @topic_view.topic.excerpt.present? ? @topic_view.topic.excerpt : @topic_view.summary
        store_preloaded("topic_#{@topic_view.topic.id}", MultiJson.dump(topic_view_serializer))
        render :show
      end

      format.json { render_json_dump(topic_view_serializer) }
    end
  end
