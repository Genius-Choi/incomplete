  def update
    Log.add_info(request, params.inspect)

    @address = Address.find(params[:id])
    @address.attributes = params[:address]

    @address = AddressbookHelper.arrange_per_scope(@address, @login_user, params[:scope], params[:groups], params[:teams])
    if @address.nil?
      flash[:notice] = t('msg.need_to_be_owner')
      redirect_to(:controller => 'desktop', :action => 'show')
      return
    end

    if @address.save
      flash[:notice] = t('msg.update_success')
      if request.xhr?
        render(:partial => 'common/flash_notice', :layout => false)
      else
        list
        render(:action => 'list')
      end
    else
      render(:controller => 'addressbook', :action => 'edit', :layout => (!request.xhr?))
    end
  end
