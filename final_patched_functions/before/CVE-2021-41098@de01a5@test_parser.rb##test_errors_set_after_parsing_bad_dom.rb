        def test_errors_set_after_parsing_bad_dom
          doc = Nokogiri::XML("<foo><bar></foo>")
          assert(doc.errors)

          @parser.parse("<foo><bar></foo>")
          assert(@parser.document.errors)
          assert(@parser.document.errors.length > 0)

          doc.errors.each do |error|
            assert_equal("UTF-8", error.message.encoding.name)
          end

          # when using JRuby Nokogiri, more errors will be generated as the DOM
          # parser continue to parse an ill formed document, while the sax parser
          # will stop at the first error
          unless Nokogiri.jruby?
            assert_equal(doc.errors.length, @parser.document.errors.length)
          end
        end
