static int fix_xattr(int fd, const Context *context) {

        static const char * const xattrs[_META_MAX] = {
                [META_ARGV_PID]          = "user.coredump.pid",
                [META_ARGV_UID]          = "user.coredump.uid",
                [META_ARGV_GID]          = "user.coredump.gid",
                [META_ARGV_SIGNAL]       = "user.coredump.signal",
                [META_ARGV_TIMESTAMP]    = "user.coredump.timestamp",
                [META_ARGV_RLIMIT]       = "user.coredump.rlimit",
                [META_ARGV_HOSTNAME]     = "user.coredump.hostname",
                [META_COMM]              = "user.coredump.comm",
                [META_EXE]               = "user.coredump.exe",
        };

        int r = 0;

        assert(fd >= 0);

        /* Attach some metadata to coredumps via extended
         * attributes. Just because we can. */

        for (unsigned i = 0; i < _META_MAX; i++) {
                int k;

                if (isempty(context->meta[i]) || !xattrs[i])
                        continue;

                k = fsetxattr(fd, xattrs[i], context->meta[i], strlen(context->meta[i]), XATTR_CREATE);
                if (k < 0 && r == 0)
                        r = -errno;
        }

        return r;
}
