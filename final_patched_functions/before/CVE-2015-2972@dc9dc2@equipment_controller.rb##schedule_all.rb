  def schedule_all
    Log.add_info(request, params.inspect)

    date_s = params[:date]
    if date_s.nil? or date_s.empty?
      @date = Date.today
    else
      @date = Date.parse(date_s)
    end

    if @login_user.nil? or params[:display].nil? or params[:display] == 'all'
      params[:display] = 'all'
      con = EquipmentHelper.get_scope_condition_for(@login_user)
    else
      display_type = params[:display].split('_').first
      display_id = params[:display].split('_').last

      case display_type
       when 'group'
        if @login_user.get_groups_a(true).include?(display_id)
          con = ApplicationHelper.get_sql_like([:groups], "|#{display_id}|")
        end
       when 'team'
        if @login_user.get_teams_a.include?(display_id)
          con = ApplicationHelper.get_sql_like([:teams], "|#{display_id}|")
        end
      end
    end

    return if con.nil?

    equipment_a = Equipment.where(con).to_a
    @equip_obj_cache ||= Equipment.build_cache(equipment_a)

    @equip_schedule_hash = {}
    unless equipment_a.nil?
      @holidays = Schedule.get_holidays
      equipment_a.each do |equip|
        @equip_schedule_hash[equip.id.to_s] = Schedule.get_equipment_week(equip.id, @date, @holidays)
      end
    end
  end
