void test_case (unsigned _i )
{
    const char *jwt_fname;
    const char *key_str;
    const char *decode_test_name;
    bool expected;
    int key_len;
    ssize_t jwt_bytes;
    int result = 0;
    cjwt_t *jwt = NULL;
    char jwt_buf[65535];
    char pem_buf[8192];
    jwt_fname = test_list[_i].jwt_file_name;
    key_str = test_list[_i].key;
    key_len = strlen( key_str );
    expected = test_list[_i].expected;
    decode_test_name = test_list[_i].decode_test_name;

    if( key_len == 0 ) {
        key_str = NULL;
    } else if( test_list[_i].is_key_in_file ) {
        key_len = read_file( key_str, pem_buf, sizeof( pem_buf ) );

        if( key_len >= 0 ) {
            key_str = ( const char * ) pem_buf;
        } else {
            printf( "Error reading pem file\n" );
            CU_ASSERT ( 0 == 1 );
            fail_cnt += 1;
            return;
        }
    }

    if( expected ) {
        printf( "\n--- Test %s expected good\n", decode_test_name );
    } else {
        printf( "\n--- Test %s expected bad\n", decode_test_name );
    }
    printf ("key in file %d, keylen = %d\n", test_list[_i].is_key_in_file,
        key_len);

    memset( jwt_buf, 0, sizeof(jwt_buf) );
    printf( "--- Input jwt : %s \n", jwt_fname );
    jwt_bytes = read_file( jwt_fname, jwt_buf, sizeof( jwt_buf ) );

    if( jwt_bytes > 0 ) {
        result = cjwt_decode( jwt_buf, 0, &jwt, ( const uint8_t * )key_str, key_len );
    } else {
        result = jwt_bytes;
    }

    if( expected == ( result == 0 ) ) {
        printf( "--- PASSED: %s\n", decode_test_name );
        pass_cnt += 1;
    } else {
        printf( "--- FAILED: %s\n", decode_test_name );
        fail_cnt += 1;
    }

    cjwt_destroy( &jwt );
    CU_ASSERT_EQUAL ( expected, ( result == 0 ) );
}
