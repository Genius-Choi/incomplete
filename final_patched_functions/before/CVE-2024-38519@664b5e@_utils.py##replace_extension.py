def replace_extension(filename, ext, expected_real_ext=None):
    name, real_ext = os.path.splitext(filename)
    return f'{name if not expected_real_ext or real_ext[1:] == expected_real_ext else filename}.{ext}'
