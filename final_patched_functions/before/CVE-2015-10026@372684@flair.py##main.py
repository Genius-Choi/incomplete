def main():
    r = praw.Reddit(user_agent='flairbotbr')
    r.login('botbr', 'apassword')
    if r.is_logged_in():
        print 'logged in'
    else:
        print 'failed to log in'
        return
    while True:
        time.sleep(0.5)
        for msg in r.get_unread(limit=None):
            try:
                print 'AUTHOR: %s - SUBJECT: %s - BODY: %s' % (msg.author, msg.subject, msg.body)
            except UnicodeEncodeError:
                print 'AUTHOR: %s - unprintable chars' % (msg.author)
            sub = r.get_subreddit('brasil')
            if msg.subject == 'flair':
                if dbLookup(msg.body):
                    estado = 'world' if len(msg.body.split(',')) < 2 else msg.body.split(',')[1].strip()
                    sub.set_flair(msg.author,msg.body,estado)
                    r.send_message(msg.author,'flair','Flair configurado.')
                    print('flair ok')
                else:
                    r.send_message(msg.author,'flair','Configuração de flair falhou.')
                    print('flair fail')
            if msg.subject == 'remover flair':
                sub.set_flair(msg.author,'','')
                r.send_message(msg.author,'flair','Flair removido.')
                print('remove flair ok')
                
            msg.mark_as_read()
