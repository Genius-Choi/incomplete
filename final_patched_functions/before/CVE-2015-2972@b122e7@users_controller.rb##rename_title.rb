  def rename_title
    Log.add_info(request, params.inspect)

    org_title = params[:org_title]
    new_title = params[:new_title]

    if org_title.nil? or new_title.nil? or org_title == new_title
      render(:partial => 'ajax_title', :layout => false)
      return
    end

    titles = User.get_config_titles
    unless titles.nil?
      if titles.include?(new_title)

        flash[:notice] = 'ERROR:' + t('user.title_duplicated')

      else

        idx = titles.index(org_title)
        unless idx.nil?
          titles[idx] = new_title
          User.save_config_titles titles

          User.rename_title(org_title, new_title)
          User.update_xorder(new_title, idx)
        end
      end
    end

    render(:partial => 'ajax_title', :layout => false)
  end
