  def rewrite_cooked_display_name(cooked, old_display_name, new_display_name)
    pattern = /(?<=\s)#{PrettyText::Helpers.format_username(old_display_name)}(?=:)/i

    cooked
      .css("aside.quote")
      .each do |aside|
        next unless div = aside.at_css("div.title")

        div.children.each do |child|
          if child.text?
            content = child.content
            display_name_replaced = content.gsub!(pattern, new_display_name).present?
            child.content = content if display_name_replaced
          end
        end
      end
  end
