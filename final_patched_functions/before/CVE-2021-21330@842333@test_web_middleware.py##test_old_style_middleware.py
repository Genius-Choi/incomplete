async def test_old_style_middleware(loop: Any, aiohttp_client: Any) -> None:
    async def view_handler(request):
        return web.Response(body=b"OK")

    with pytest.warns(DeprecationWarning, match="Middleware decorator is deprecated"):

        @web.middleware
        async def middleware(request, handler):
            resp = await handler(request)
            assert 200 == resp.status
            resp.set_status(201)
            resp.text = resp.text + "[old style middleware]"
            return resp

    app = web.Application(middlewares=[middleware])
    app.router.add_route("GET", "/", view_handler)
    client = await aiohttp_client(app)
    resp = await client.get("/")
    assert 201 == resp.status
    txt = await resp.text()
    assert "OK[old style middleware]" == txt
