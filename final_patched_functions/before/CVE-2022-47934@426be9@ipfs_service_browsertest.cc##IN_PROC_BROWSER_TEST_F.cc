IN_PROC_BROWSER_TEST_F(IpfsServiceBrowserTest, CanLoadIPFSImageFromIPFS) {
  ResetTestServer(
      base::BindRepeating(&IpfsServiceBrowserTest::HandleEmbeddedSrvrRequest,
                          base::Unretained(this)));
  SetIPFSDefaultGatewayForTest(GetURL("b.com", "/"));
  ASSERT_TRUE(ui_test_utils::NavigateToURL(
      browser(),
      GURL("ipfs://Qmc2JTQo4iXf24g98otZmGFQq176eQ2Cdbb88qA5ToMEvC")));
  content::WebContents* contents =
      browser()->tab_strip_model()->GetActiveWebContents();
  auto loaded = EvalJs(
      contents,
      "let img = document.createElement('img');"
      "img.src ="
      "  'ipfs://dbafybeiemxf5abjwjbikoz4mc3a3dla6ual3jsgpdr4cjr3oz3evfyavhwq';"
      "img.onload = function () {"
      "  window.domAutomationController.send(true);"
      "};"
      "img.onerror = function() {"
      "  window.domAutomationController.send(true);"
      "};",
      content::EXECUTE_SCRIPT_USE_MANUAL_REPLY);
  ASSERT_TRUE(loaded.error.empty());
  EXPECT_EQ(base::Value(true), loaded.value);
}
