def test_vault_client_base_get_secrets_implicit_cache_no_race_condition():
    # In this test, the same value is read twice by get-all and template
    # We check that 2 values are consistent

    vault = RaceConditionTestVaultClient()

    vault.db = {
        "a": {},
        "d": {"value": """!template!{{ vault("a").b }}-{{ vault("a").c }}"""},
    }

    assert vault.get_secrets("") == {
        "a": {"b": "b0", "c": "c0"},
        "d": {"value": "b0-c0"},
    }
