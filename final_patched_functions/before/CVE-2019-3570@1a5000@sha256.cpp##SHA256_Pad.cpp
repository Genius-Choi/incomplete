SHA256_Pad(struct SHA256_CTX * ctx)
{
  unsigned char len[8];
  uint32_t r, plen;

  /*
   * Convert length to a vector of bytes -- we do this now rather
   * than later because the length will change after we pad.
   */
  be32enc_vect(len, ctx->count, 8);

  /* Add 1--64 bytes so that the resulting length is 56 mod 64 */
  r = (ctx->count[1] >> 3) & 0x3f;
  plen = (r < 56) ? (56 - r) : (120 - r);
  scrypt_SHA256_Update(ctx, PAD, (size_t)plen);

  /* Add the terminating bit-count */
  scrypt_SHA256_Update(ctx, len, 8);
}
