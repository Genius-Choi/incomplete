def read_only():
	def innfn(fn):
		def wrapper_fn(*args, **kwargs):
			if conf.read_from_replica:
				connect_replica()

			try:
				retval = fn(*args, **get_newargs(fn, kwargs))
			except:
				raise
			finally:
				if local and hasattr(local, 'primary_db'):
					local.db.close()
					local.db = local.primary_db

			return retval
		return wrapper_fn
	return innfn
