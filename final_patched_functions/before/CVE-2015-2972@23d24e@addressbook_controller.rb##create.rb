  def create
    Log.add_info(request, params.inspect)

    @address = Address.new(params.require(:address).permit(Address::PERMIT_BASE))

    @address = AddressbookHelper.arrange_per_scope(@address, @login_user, params[:scope], params[:groups], params[:teams])
    if @address.nil?
      flash[:notice] = t('msg.need_to_be_owner')
      redirect_to(:controller => 'desktop', :action => 'show')
      return
    end

    begin
      @address.save!
    rescue
      render(:controller => 'addressbook', :action => 'edit', :layout => (!request.xhr?))
      return
    end

    flash[:notice] = t('msg.register_success')

    if request.xhr?
      render(:partial => 'common/flash_notice', :layout => false)
    else
      list
      render(:action => 'list')
    end
  end
