        def call_parse_io_with_encoding(encoding)
          File.open(XML_FILE, "rb") do |f|
            @parser.parse_io(f, encoding)
          end
          assert(@parser.document.cdata_blocks.length > 0)

          called = false
          @parser.document.start_elements.flatten.each do |thing|
            assert_equal("UTF-8", thing.encoding.name)
            called = true
          end
          assert(called)

          called = false
          @parser.document.end_elements.flatten.each do |thing|
            assert_equal("UTF-8", thing.encoding.name)
            called = true
          end
          assert(called)

          called = false
          @parser.document.data.each do |thing|
            assert_equal("UTF-8", thing.encoding.name)
            called = true
          end
          assert(called)

          called = false
          @parser.document.comments.flatten.each do |thing|
            assert_equal("UTF-8", thing.encoding.name)
            called = true
          end
          assert(called)

          called = false
          @parser.document.cdata_blocks.flatten.each do |thing|
            assert_equal("UTF-8", thing.encoding.name)
            called = true
          end
          assert(called)
        end
