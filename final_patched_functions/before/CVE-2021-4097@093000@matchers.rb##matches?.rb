  def matches?(block)
    begin
      $stderr = $stdout = StringIO.new
      $stdout.set_encoding('UTF-8') if $stdout.respond_to?(:set_encoding)
      block.call
      $stdout.rewind
      @actual = $stdout.read
    ensure
      $stdout = STDOUT
      $stderr = STDERR
    end

    if @actual then
      case @expected
      when String
        @actual.include? @expected
      when Regexp
        @expected.match @actual
      end
    else
      false
    end
  end
