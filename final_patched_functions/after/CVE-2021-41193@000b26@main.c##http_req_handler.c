static void http_req_handler(struct http_conn *conn,
			     const struct http_msg *msg, void *arg)
{
	struct mbuf *mb = mbuf_alloc(1024);
	int err = 0;
	(void)arg;

	info("restsrv: request %r %r%r from %J\n",
	     &msg->met, &msg->path, &msg->prm,
	     http_conn_peer(conn));

	if (0 == pl_strcasecmp(&msg->met, "POST") &&
	    0 == pl_strcasecmp(&msg->path, "/create")) {

		handle_post_create(conn, msg->mb, (size_t)msg->clen);
	}
	else if (0 == pl_strcasecmp(&msg->met, "PUT") &&
		 0 == pl_strcasecmp(&msg->path, "/publish")) {

		handle_put_publish(conn, msg, msg->mb, (size_t)msg->clen);
	}
	else if (0 == pl_strcasecmp(&msg->met, "PUT") &&
		 0 == pl_strcasecmp(&msg->path, "/accept")) {

		handle_put_accept(conn, msg, msg->mb, (size_t)msg->clen);
	}
	else if (0 == pl_strcasecmp(&msg->met, "GET") &&
		 0 == pl_strcasecmp(&msg->path, "/publish")) {

		handle_get_publish(conn, msg, msg->mb, (size_t)msg->clen);
	}
	else if (0 == pl_strcasecmp(&msg->met, "GET") &&
		 0 == pl_strcasecmp(&msg->path, "/accept")) {

		handle_get_accept(conn, msg, msg->mb, (size_t)msg->clen);
	}
	else {
		warning("no such resource\n");
		err = ENOENT;
		goto out;
	}

 out:
	if (err) {
		http_ereply(conn, 400, "Bad Request");
		warning("restsrv: response 400 Bad Request (%m)\n", err);

		http_conn_close(conn);
	}

	mem_deref(mb);
}
