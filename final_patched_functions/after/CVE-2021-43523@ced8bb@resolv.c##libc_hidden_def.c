libc_hidden_def(ns_name_pton)

/*
 * __hnbad(dotted)
 *	Check whether a name is valid enough for DNS. The rules, as
 *	laid down by glibc, are:
 *	- printable input string
 *	- converts to label notation
 *	- each label only contains [0-9a-zA-Z_-], up to 63 octets
 *	- first label doesn’t begin with ‘-’
 *	This both is weaker than Unix hostnames (e.g. it allows
 *	underscores and leading/trailing hyphen-minus) and stronger
 *	than general (e.g. a leading “*.” is valid sometimes), take care.
 * return:
 *	0 if the name is ok
 */
int __hnbad(const char *dotted)
{
	unsigned char c, n, *cp;
	unsigned char buf[NS_MAXCDNAME];

	cp = (unsigned char *)dotted;
	while ((c = *cp++))
		if (c < 0x21 || c > 0x7E)
			return (1);
	if (ns_name_pton(dotted, buf, sizeof(buf)) < 0)
		return (2);
	if (buf[0] > 0 && buf[1] == '-')
		return (3);
	cp = buf;
	while ((n = *cp++)) {
		if (n > 63)
			return (4);
		while (n--) {
			c = *cp++;
			if (c < '-' ||
			    (c > '-' && c < '0') ||
			    (c > '9' && c < 'A') ||
			    (c > 'Z' && c < '_') ||
			    (c > '_' && c < 'a') ||
			    c > 'z')
				return (5);
		}
	}
	return (0);
}
