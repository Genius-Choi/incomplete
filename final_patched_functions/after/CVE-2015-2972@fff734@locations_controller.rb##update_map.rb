  def update_map
    Log.add_info(request, params.inspect)

    return unless request.post?

    group_id = params[:group_id]
    SqlHelper.validate_token([group_id])

    @office_map = OfficeMap.get_for_group(group_id, true)

    params[:office_map].delete(:group_id)

    @office_map.update_attributes(params.require(:office_map).permit(OfficeMap::PERMIT_BASE))

    params.delete(:office_map)

    flash[:notice] = t('msg.update_success')
    render(:partial => 'groups/ajax_group_map', :layout => false)
  end
