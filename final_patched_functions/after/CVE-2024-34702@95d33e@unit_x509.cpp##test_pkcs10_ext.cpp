Test::Result test_pkcs10_ext(const Botan::Private_Key& key,
                             const std::string& sig_padding,
                             const std::string& hash_fn,
                             Botan::RandomNumberGenerator& rng) {
   Test::Result result("PKCS10 extensions");

   Botan::X509_Cert_Options opts;

   opts.dns = "main.example.org";
   opts.more_dns.push_back("more1.example.org");
   opts.more_dns.push_back("more2.example.org");

   opts.padding_scheme = sig_padding;

   Botan::AlternativeName alt_name;
   alt_name.add_attribute("DNS", "bonus.example.org");

   Botan::X509_DN alt_dn;
   alt_dn.add_attribute("X520.CommonName", "alt_cn");
   alt_dn.add_attribute("X520.Organization", "testing");
   alt_name.add_dn(alt_dn);

   opts.extensions.add(std::make_unique<Botan::Cert_Extension::Subject_Alternative_Name>(alt_name));

   const auto req = Botan::X509::create_cert_req(opts, key, hash_fn, rng);

   const auto alt_dns_names = req.subject_alt_name().get_attribute("DNS");

   result.test_eq("Expected number of DNS names", alt_dns_names.size(), 4);

   if(alt_dns_names.size() == 4) {
      result.test_eq("Expected DNS name 1", alt_dns_names.at(0), "bonus.example.org");
      result.test_eq("Expected DNS name 2", alt_dns_names.at(1), "main.example.org");
      result.test_eq("Expected DNS name 3", alt_dns_names.at(2), "more1.example.org");
      result.test_eq("Expected DNS name 3", alt_dns_names.at(3), "more2.example.org");
   }

   result.test_eq("Expected number of alt DNs", req.subject_alt_name().directory_names().size(), 1);
   result.confirm("Alt DN is correct", *req.subject_alt_name().directory_names().begin() == alt_dn);

   return result;
}
