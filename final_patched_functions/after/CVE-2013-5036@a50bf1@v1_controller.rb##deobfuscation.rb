  def deobfuscation
    require_params :api_key, :environment, :build, :namespace

    map = YAML.load(Zlib::Inflate.inflate(Base64.decode64(params['namespace'])), safe: true, deserialize_symbols: false)
    return head(:unprocessable_entity) unless map.kind_of?(Squash::Java::Namespace)

    deploy = Project.find_by_api_key!(params['api_key']).
        environments.with_name(params['environment']).first!.
        deploys.find_by_build!(params['build'])
    deploy.obfuscation_map.try :destroy
    deploy.create_obfuscation_map!({namespace: map}, as: :api)

    head :created
  end
