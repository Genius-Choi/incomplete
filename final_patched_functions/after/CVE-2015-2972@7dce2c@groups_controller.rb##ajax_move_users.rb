  def ajax_move_users
    Log.add_info(request, params.inspect)

    return unless request.post?

    org_group_id = params[:id]
    group_id = params[:thetisBoxSelKeeper].split(':').last
    SqlHelper.validate_token([org_group_id, group_id])

    unless params[:check_user].blank?

      count = 0
      params[:check_user].each do |user_id, value|
        if value == '1'

          begin
            user = User.find(user_id)
            user.exclude_from(org_group_id)
            user.add_to(group_id)
            user.save!
          rescue => evar
            user = nil
            Log.add_error(request, evar)
          end

          count += 1
        end
      end
      flash[:notice] = t('msg.move_success')
    end

    get_users
  end
