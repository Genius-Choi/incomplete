TEST(HeaderMapImplTest, TestAppendHeader) {
  // Test appending to a string with a value.
  {
    HeaderString value1;
    value1.setCopy("some;", 5);
    HeaderMapImpl::appendToHeader(value1, "test");
    EXPECT_EQ(value1, "some;,test");
  }

  // Test appending to an empty string.
  {
    HeaderString value2;
    HeaderMapImpl::appendToHeader(value2, "my tag data");
    EXPECT_EQ(value2, "my tag data");
  }

  // Test empty data case.
  {
    HeaderString value3;
    value3.setCopy("empty", 5);
    HeaderMapImpl::appendToHeader(value3, "");
    EXPECT_EQ(value3, "empty");
  }
  // Regression test for appending to an empty string with a short string, then
  // setting integer.
  {
    const std::string empty;
    HeaderString value4(empty);
    HeaderMapImpl::appendToHeader(value4, " ");
    value4.setInteger(0);
    EXPECT_EQ("0", value4.getStringView());
    EXPECT_EQ(1U, value4.size());
  }
}
