static const char *find_hostkey_preference(LIBSSH2_KNOWNHOSTS *known_hosts, const char *hostname, int port)
{
	struct libssh2_knownhost *host = NULL;
	/* Specify no key type so we don't filter on that */
	int type = LIBSSH2_KNOWNHOST_TYPE_PLAIN | LIBSSH2_KNOWNHOST_KEYENC_RAW;
	const char key = '\0';
	int error;

	/*
	 * In case of mismatch, we can find the type of key from known_hosts in
	 * the returned host's information as it means that an entry was found
	 * but our nonsense key obviously didn't match.
	 */
	error = libssh2_knownhost_checkp(known_hosts, hostname, port, &key, 1, type, &host);
	if (error == LIBSSH2_KNOWNHOST_CHECK_MISMATCH)
		return hostkey_type_to_string(host->typemask & LIBSSH2_KNOWNHOST_KEY_MASK);

	return NULL;
}
