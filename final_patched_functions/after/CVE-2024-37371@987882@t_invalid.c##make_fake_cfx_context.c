make_fake_cfx_context(krb5_key subkey)
{
    gss_union_ctx_id_t uctx;
    krb5_gss_ctx_id_t kgctx;

    kgctx = ealloc(sizeof(*kgctx));
    kgctx->established = 1;
    kgctx->proto = 1;
    if (g_seqstate_init(&kgctx->seqstate, 0, 0, 0, 0) != 0)
        abort();
    kgctx->mech_used = &mech_krb5;
    kgctx->sealalg = -1;
    kgctx->signalg = -1;

    kgctx->subkey = subkey;
    kgctx->cksumtype = CKSUMTYPE_HMAC_SHA1_96_AES128;

    uctx = ealloc(sizeof(*uctx));
    uctx->mech_type = &mech_krb5;
    uctx->internal_ctx_id = (gss_ctx_id_t)kgctx;
    return (gss_ctx_id_t)uctx;
}
