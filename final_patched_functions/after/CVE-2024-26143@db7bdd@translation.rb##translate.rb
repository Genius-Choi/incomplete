    def translate(key, **options)
      if key&.start_with?(".")
        path = controller_path.tr("/", ".")
        defaults = [:"#{path}#{key}"]
        defaults << options[:default] if options[:default]
        options[:default] = defaults.flatten
        key = "#{path}.#{action_name}#{key}"
      end

      i18n_raise = options.fetch(:raise, self.raise_on_missing_translations)

      if options[:default]
        options[:default] = [options[:default]] unless options[:default].is_a?(Array)
        options[:default] = options[:default].map do |value|
          value.is_a?(String) ? ERB::Util.html_escape(value) : value
        end
      end

      unless i18n_raise
        options[:default] = [] unless options[:default]
        options[:default] << MISSING_TRANSLATION
      end

      result = ActiveSupport::HtmlSafeTranslation.translate(key, **options, raise: i18n_raise)

      if result == MISSING_TRANSLATION
        +"translation missing: #{key}"
      else
        result
      end
    end
