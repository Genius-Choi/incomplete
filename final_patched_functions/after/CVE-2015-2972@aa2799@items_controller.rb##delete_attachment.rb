  def delete_attachment
    Log.add_info(request, params.inspect)

    return unless request.post?

    begin
      attach = Attachment.find(params[:attachment_id])

      @item = Item.find(attach.item_id)

      unless @item.check_user_auth(@login_user, 'w', true)
        raise t('msg.need_to_be_owner')
      end

      attach.destroy

      @item.update_attribute(:updated_at, Time.now)

    rescue => evar
      Log.add_error(request, evar)
    end

    render(:partial => 'ajax_item_attachment', :layout => false)
  end
