def custom_jinja_env(skip_undefined=False):
    if skip_undefined:
        env = DAEnvironment(undefined=DASkipUndefined, extensions=[DAExtension])
    else:
        env = DAEnvironment(undefined=DAStrictUndefined, extensions=[DAExtension])
    env.filters.update(registered_jinja_filters)
    env.filters.update(get_builtin_jinja_filters())
    return env
