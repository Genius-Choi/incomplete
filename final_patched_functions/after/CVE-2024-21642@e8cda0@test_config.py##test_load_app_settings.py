def test_load_app_settings():
    settings = {
        "theme": "dark",
        "github_fork": False,
        "hide_shutdown": True,
        "pin_menu": True,
        "language": "cn",
        "max_column_width": 50,
        "query_engine": "numexpr",
        "hide_header_editor": True,
        "lock_header_menu": True,
        "hide_header_menu": True,
        "hide_main_menu": True,
        "hide_column_menus": True,
        "enable_custom_filters": True,
        "enable_web_uploads": True,
    }
    with ExitStack() as stack:
        stack.enter_context(mock.patch("dtale.global_state.APP_SETTINGS", settings))

        load_app_settings(None)
        assert settings["hide_shutdown"]
        assert settings["pin_menu"]
        assert settings["language"] == "cn"
        assert settings["theme"] == "dark"
        assert settings["max_column_width"] == 50
        assert settings["query_engine"] == "numexpr"
        assert settings["hide_header_editor"]
        assert settings["lock_header_menu"]
        assert settings["hide_header_menu"]
        assert settings["hide_main_menu"]
        assert settings["hide_column_menus"]
        assert settings["enable_custom_filters"]
        assert settings["enable_web_uploads"]

        load_app_settings(
            load_config_state(os.path.join(os.path.dirname(__file__), "dtale.ini"))
        )
        assert not settings["hide_shutdown"]
        assert not settings["pin_menu"]
        assert settings["language"] == "en"
        assert settings["theme"] == "light"
        assert settings["max_column_width"] == 100
        assert settings["main_title"] == "My App"
        assert settings["main_title_font"] == "Arial"
        assert settings["query_engine"] == "python"
        assert not settings["hide_header_editor"]
        assert not settings["lock_header_menu"]
        assert not settings["hide_header_menu"]
        assert not settings["hide_main_menu"]
        assert not settings["hide_column_menus"]
        assert not settings["enable_custom_filters"]
        assert not settings["enable_web_uploads"]
