LibRaw_byte_buffer *LibRaw_buffer_datastream::make_byte_buffer(unsigned int sz)
{
  if(INT64(sz)>size())
    throw LIBRAW_EXCEPTION_IO_CORRUPT;

    LibRaw_byte_buffer *ret = new LibRaw_byte_buffer(0);
    if(!ret) // failed new should throw std::exception
      throw LIBRAW_EXCEPTION_ALLOC;
    if(streampos + sz > streamsize)
        sz = streamsize - streampos;
    ret->set_buffer(buf+streampos,sz);
    return ret;
}
