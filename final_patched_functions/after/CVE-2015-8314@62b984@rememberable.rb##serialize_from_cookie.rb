        def serialize_from_cookie(*args)
          id, token, generated_at = args

          # The token is only valid if:
          # 1. we have a date
          # 2. the current time does not pass the expiry period
          # 3. there is a record with the given id
          # 4. the record has a remember_created_at date
          # 5. the token date is bigger than the remember_created_at
          # 6. the token matches
          if generated_at &&
             (self.remember_for.ago < generated_at) &&
             (record = to_adapter.get(id)) &&
             (generated_at > (record.remember_created_at || Time.now).utc) &&
             Devise.secure_compare(record.rememberable_value, token)
            record
          end
        end
