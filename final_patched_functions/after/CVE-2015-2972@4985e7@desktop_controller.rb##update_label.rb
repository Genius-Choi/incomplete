  def update_label
    Log.add_info(request, params.inspect)

    return unless request.post?

    msg = params[:thetisBoxEdit]

    if params[:thetisBoxEdit].empty?
      render(:partial => 'ajax_label', :layout => false)
      return
    end

    if @login_user.nil?
      @toy = Toy.new
      @toy.id = params[:id]
      @toy.xtype = Toy::XTYPE_LABEL
      @toy.x = params[:x]
      @toy.y = params[:y]
      @toy.message = msg
    else
      @toy = Toy.find(params[:id])
      @toy.update_attribute(:message, msg)
    end

    render(:partial => 'ajax_label', :layout => false)

  rescue => evar
    Log.add_error(request, evar)
 
    render(:partial => 'ajax_label', :layout => false)
  end
