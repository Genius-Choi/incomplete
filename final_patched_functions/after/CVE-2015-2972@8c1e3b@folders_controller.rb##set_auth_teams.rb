  def set_auth_teams
    Log.add_info(request, params.inspect)

    return unless request.post?

    @folder = Folder.find(params[:id])

    if Folder.check_user_auth(@folder.id, @login_user, 'w', true)
      read_teams = []
      write_teams = []
      teams_auth = params[:teams_auth]
      unless teams_auth.nil?
        teams_auth.each do |auth_param|
          user_id = auth_param.split(':').first
          auths = auth_param.split(':').last.split('+')
          if auths.include?('r')
            read_teams << user_id
          end
          if auths.include?('w')
            write_teams << user_id
          end
        end
      end

      @folder.set_read_teams(read_teams)
      @folder.set_write_teams(write_teams)

      @folder.save

      flash[:notice] = t('msg.register_success')
    else
      flash[:notice] = 'ERROR:' + t('folder.need_auth_to_modify')
    end

    target_user_id = (@login_user.admin?(User::AUTH_TEAM))?(nil):(@login_user.id)
    @teams = Team.get_for(target_user_id, true)
    render(:partial => 'ajax_auth_teams', :layout => false)

  rescue => evar
    Log.add_error(request, evar)
    render(:partial => 'ajax_auth_teams', :layout => false)
  end
