    def initialize(ip_address)
      @logging_enabled = true
      @ip_address = ip_address

      @cr_present = false
      @previous_cr_present = nil

      if @ip_address
        check_ip_address
        @state = :welcome
      else
        @state = :preauth
      end
      transaction_reset
    end
