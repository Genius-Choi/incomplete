def is_safe_url(location):
    location_urlp = urlparse(location)
    #: if relative URL then must start with "/"
    if not location_urlp.netloc and location[0] != "/":
        return False
    host_urlp = urlparse(flask.request.host_url)
    test_urlp = urlparse(urljoin(flask.request.host_url, location))
    return test_urlp.scheme in ('http', 'https') and host_urlp.netloc == test_urlp.netloc
