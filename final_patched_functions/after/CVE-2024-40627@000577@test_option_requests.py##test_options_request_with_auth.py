def test_options_request_with_auth(
    client_multiple_authentications, api_key_auth, mock_opa_response
):
    client: TestClient = client_multiple_authentications

    # Test OPTIONS request for an existing item with authentication
    response = client.options(
        "/items/1",
        headers={api_key_auth["header_key"]: api_key_auth["api_key"]},
    )
    assert response.status_code == 200
    assert response.headers["Allow"] == "OPTIONS, GET, POST"
    assert response.json() == {}

    # Test OPTIONS request for a non-existing item with authentication
    response = client.options(
        "/items/3",
        headers={api_key_auth["header_key"]: api_key_auth["api_key"]},
    )
    assert response.status_code == 404
    assert response.json() == {"detail": "Not Found"}
