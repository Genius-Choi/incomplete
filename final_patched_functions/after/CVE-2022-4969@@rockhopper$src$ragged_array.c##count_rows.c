int count_rows(void * raw, int raw_length, int length_power, int big_endian,
               int itemsize) {
  /* Pre-parse data fed to ``RaggedArray.loads()``.

  Returns the number of rows or -1 for an error.
  */

  IntRead read = choose_int_read(length_power, big_endian);

  int rows = 0;

  void * start = raw;
  void * end = raw + raw_length;
  while (raw <= end - (1 << length_power) && raw >= start) {
    uint64_t length = read(raw);
    raw += (1 << length_power);
    raw += length * itemsize;
    rows ++;
  }

  if (raw == end)
    return rows;

  // This data is corrupt.
  return -1;
}
