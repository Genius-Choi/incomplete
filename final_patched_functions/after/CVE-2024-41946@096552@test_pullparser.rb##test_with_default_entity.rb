        def test_with_default_entity
          source = <<-XML
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE member [
  <!ENTITY a "a">
  <!ENTITY a2 "&a; &a;">
]>
<member>
&a;
&a2;
&lt;
</member>
          XML

          REXML::Security.entity_expansion_limit = 4
          parser = REXML::Parsers::PullParser.new(source)
          while parser.has_next?
            parser.pull
          end

          REXML::Security.entity_expansion_limit = 3
          parser = REXML::Parsers::PullParser.new(source)
          assert_raise(RuntimeError.new("number of entity expansions exceeded, processing aborted.")) do
            while parser.has_next?
              parser.pull
            end
          end
        end
