ClientListener::handleClientConnecting(const Event&, void*)
{
    // accept client connection
    IDataSocket* socket = m_listen->accept();

    if (socket == NULL) {
        return;
    }

    m_clientSockets.insert(socket);

    m_events->adoptHandler(m_events->forClientListener().accepted(),
                socket->getEventTarget(),
                new TMethodEventJob<ClientListener>(this,
                        &ClientListener::handleClientAccepted, socket));

    // When using non SSL, server accepts clients immediately, while SSL
    // has to call secure accept which may require retry
    if (security_level_ == ConnectionSecurityLevel::PLAINTEXT) {
        m_events->addEvent(Event(m_events->forClientListener().accepted(),
                                socket->getEventTarget()));
    }
}
