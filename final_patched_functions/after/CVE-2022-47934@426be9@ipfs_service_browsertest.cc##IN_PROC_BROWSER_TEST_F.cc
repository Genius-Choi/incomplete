IN_PROC_BROWSER_TEST_F(IpfsServiceBrowserTest, CannotLoadIframeFromHTTP) {
  browser()->profile()->GetPrefs()->SetInteger(
      kIPFSResolveMethod,
      static_cast<int>(ipfs::IPFSResolveMethodTypes::IPFS_ASK));

  ResetTestServer(
      base::BindRepeating(&IpfsServiceBrowserTest::HandleEmbeddedSrvrRequest,
                          base::Unretained(this)));
  SetIPFSDefaultGatewayForTest(GetURL("b.com", "/"));
  ASSERT_TRUE(
      ui_test_utils::NavigateToURL(browser(), GetURL("b.com", "/iframe.html")));
  content::WebContents* contents =
      browser()->tab_strip_model()->GetActiveWebContents();

  int child_index = 0;
  while (auto* child_frame =
             ChildFrameAt(contents->GetMainFrame(), child_index++)) {
    auto location =
        EvalJs(child_frame,
               "const timer = setInterval(function () {"
               "  if (document.readyState == 'complete') {"
               "    clearInterval(timer);"
               "    window.domAutomationController.send(window.location.href);"
               "  }"
               "}, 100);",
               content::EXECUTE_SCRIPT_USE_MANUAL_REPLY);

    ASSERT_TRUE(location.error.empty());
    EXPECT_EQ(base::Value("chrome-error://chromewebdata/"), location.value);
  }
}
