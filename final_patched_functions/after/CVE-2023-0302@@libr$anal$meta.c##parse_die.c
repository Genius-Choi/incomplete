static const ut8 *parse_die(const ut8 *buf, const ut8 *buf_end, RBinDwarfAbbrevDecl *abbrev, RBinDwarfCompUnitHdr *hdr, RBinDwarfDie *die, const ut8 *debug_str, size_t debug_str_len, Sdb *sdb) {
	size_t i;
	if (!buf || !buf_end || buf > buf_end) {
		return NULL;
	}
	for (i = 0; i < die->count; i++) {
		memset (&die->attr_values[i], 0, sizeof (RBinDwarfDie));
	}
	for (i = 0; i < abbrev->count && i < die->capacity; i++) {
		memset (&die->attr_values[i], 0, sizeof (die->attr_values[i]));
		// debug_str_len = r_str_nlen (debug_str, buf_end - buf);
		const ut8 *nbuf = parse_attr_value (buf, buf_end - buf,
			&abbrev->defs[i],
			&die->attr_values[i],
			hdr, debug_str, debug_str_len);
		if (nbuf) {
			buf = nbuf;
		} else {
			break;
		}

		RBinDwarfAttrValue *attribute = &die->attr_values[i];

		bool is_string = (attribute->attr_form == DW_FORM_strp || attribute->attr_form == DW_FORM_string);
		bool is_valid_string_form = is_string && attribute->string.content;
		// TODO  does this have a purpose anymore?
		// Or atleast it needs to rework becase there will be
		// more comp units -> more comp dirs and only the last one will be kept
		if (attribute->attr_name == DW_AT_comp_dir && is_valid_string_form) {
			char *name = strdup (attribute->string.content);
			r_str_ansi_strip (name);
			r_str_replace_ch (name, '\n', 0, true);
			r_str_replace_ch (name, '\t', 0, true);
			sdb_set_owned (sdb, "DW_AT_comp_dir", name, 0);
		}
		die->count++;
	}
	return buf;
}
