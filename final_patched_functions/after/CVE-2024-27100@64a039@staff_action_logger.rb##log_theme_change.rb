  def log_theme_change(old_json, new_theme, opts = {})
    raise Discourse::InvalidParameters.new(:new_theme) unless new_theme

    new_json = theme_json(new_theme)
    old_json, new_json = strip_duplicates(old_json, new_json)

    UserHistory.create!(
      params(opts).merge(json_params(old_json, new_json)).merge(
        action: UserHistory.actions[:change_theme],
        subject: new_theme.name,
      ),
    )
  end
