def test_url_with_fragment():
    mw = _get_mw()
    url = "http://example.com#id1"
    req = scrapy.Request("http://example.com", meta={
        'splash': {'args': {'url': url}}
    })
    req = mw.process_request(req, None)
    req = mw.process_request(req, None) or req
    assert json.loads(to_native_str(req.body)) == {'url': url}
