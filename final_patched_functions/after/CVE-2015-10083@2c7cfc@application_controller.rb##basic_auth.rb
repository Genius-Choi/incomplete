  def basic_auth
    authenticate_or_request_with_http_basic do |username, password|
      expected_username = ENV.fetch("DYNOSAUR_USERNAME", DEFAULT_USERNAME)
      expected_password = ENV.fetch("DYNOSAUR_PASSWORD", DEFAULT_PASSWORD)
      if username != expected_username
        puts "Failed username"
        return request_http_basic_authentication
      end
      if expected_password == password
        return true
      else
        begin
          bcyrpt_password = BCrypt::Password.new(expected_password)
          if bcyrpt_password == password
            return true
          else
            puts "Failed password"
          end
        rescue BCrypt::Errors::InvalidHash
          puts "DYNOSAUR_PASSWORD is not a valid bcrypt hash, so that's not gonna work"
        end

      end
      puts "ERROR: Failed basic auth"
      return request_http_basic_authentication
    end
  end
