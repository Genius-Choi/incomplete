  def get_params_for_tag_view
    filter_format_for_tag_view

    # Don't use sanitize here because these are only used for a DB query.
    @tag_expr = []
    # Tag conditions handled as OR.
    @tag_expr << params[:name].split(',')

    # Additional tag condition(s) handled as AND.
    @tag_expr << params[:and].split(',') if params[:and]
    i = 1
    while params['and' + i.to_s]
      @tag_expr << params['and' + i.to_s].split(',')
      i += 1
    end

    @single_tag = @tag_expr.size == 1 && @tag_expr[0].size == 1

    # These are used in the templates, sanitise to prevent XSS.
    @tag_name = sanitize(@tag_expr[0][0])
    @tag_title = sanitize(@single_tag ? @tag_name : tag_title(@tag_expr))
  end
