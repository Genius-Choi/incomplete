  def update_image_info
    Log.add_info(request, params.inspect)

    return unless request.post?

    image = Image.find(params[:image_id])

    # Getting Item at first for the case of resetting the db connection by an error.
    @item = Item.find(image.item_id)

    unless @item.check_user_auth(@login_user, 'w', true)
      raise t('msg.need_to_be_owner')
    end

    if !params[:image][:file].nil? and params[:image][:file].size == 0
      params[:image].delete(:file)
    end
    unless image.update_attributes(params.require(:image).permit(Image::PERMIT_BASE))
      @image = image
      render(:partial => 'ajax_item_image', :layout => false)
      return
    end

    @item = Item.find(image.item_id)
    @item.update_attribute(:updated_at, Time.now)

    render(:partial => 'ajax_item_image', :layout => false)

  rescue => evar
    Log.add_error(request, evar)

    @image = Image.new
    @image.errors.add_to_base(evar.to_s[0, 256])

    render(:partial => 'ajax_item_image', :layout => false)
  end
