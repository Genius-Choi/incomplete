def test_delete_user_device_unauthorized(client, user, monkeypatch):
    with override_settings(WAGTAIL_2FA_REQUIRED=True):
        user = get_user_model().objects.filter(is_staff=False).first()
        device = TOTPDevice.objects.create(name='Initial', user=user, confirmed=True)

        endpoint = reverse('wagtail_2fa_device_remove', kwargs={'pk': device.id})
        response = client.post(endpoint, {
            'user_id': user.id
        })
        assert response.status_code == 302
        assert TOTPDevice.objects.all().count() == 1
