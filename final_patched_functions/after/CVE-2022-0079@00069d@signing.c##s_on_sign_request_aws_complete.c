static void s_on_sign_request_aws_complete(aws_crt_signing_result *result, int error_code, void *user_data) {
    signing_state *state = user_data;
    struct aws_promise *promise = state->promise;

    state->signing_result = result;
    state->error_code = error_code;

    /*
     * Must execute PHP callback before this function returns, or signing_result will be killed
     * so the callback is queued back to the main thread and will have run when yield returns
     */
    aws_php_task complete_callback_task = {
        .callback = s_sign_aws_complete,
        .data = state,
    };
    aws_php_thread_queue_push(&s_aws_php_main_thread_queue, complete_callback_task);
    aws_php_thread_queue_yield(&s_aws_php_main_thread_queue);

    if (error_code) {
        aws_promise_fail(promise, error_code);
    } else {
        aws_promise_complete(promise, result, NULL);
    }
}
