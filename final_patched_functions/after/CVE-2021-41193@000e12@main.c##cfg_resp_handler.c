static void cfg_resp_handler(int err, const struct http_msg *msg,
			     struct mbuf *mb, struct json_object *jobj,
			     void *arg)
{
	char *json_str = NULL;
	struct zapi_ice_server *servers;
	size_t nservers = 0;
	size_t i;

	re_printf("config ready! err=%d\n");
	if (err == ECONNABORTED)
		goto out;

	if (!err && jobj) {
		err = jzon_encode(&json_str, jobj);
		if (err)
			goto out;
	}

	re_printf("CONFIG: %s\n", json_str);

	config_update(g_config, err, json_str, str_len(json_str));
	mem_deref(json_str);
	
	servers = config_get_iceservers(g_config, &nservers);
	re_printf("Probing: %d servers\n", nservers);

	for (i = 0; i < nservers; ++i) {
		struct zapi_ice_server *turn = &servers[i];
		struct stun_uri uri;

		err = stun_uri_decode(&uri, turn->url);
		if (err)
			err = turn_dns_lookup(turn, &uri);
		else {
			start_netprobe(&uri.addr, uri.proto, uri.secure,
				       turn->username, turn->credential);
		}
	}

	
 out:
	if (err)
		error("config request failed: %m\n", err);
}
