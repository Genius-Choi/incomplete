SecurityManager::~SecurityManager()
{
    if(authentication_plugin_ != nullptr)
    {
        SecurityException exception;

        for(auto& dp_it : discovered_participants_)
        {
            if(!dp_it.second.is_handshake_handle_null())
            {
                HandshakeHandle* handle = dp_it.second.get_handshake_handle();
                authentication_plugin_->return_handshake_handle(handle, exception);
            }

            if(!dp_it.second.is_identity_handle_null())
            {
                IdentityHandle* handle = dp_it.second.get_identity_handle();
                authentication_plugin_->return_identity_handle(handle, exception);
            }
        }

        if(local_identity_handle_ != nullptr)
            authentication_plugin_->return_identity_handle(local_identity_handle_, exception);

        delete_entities();

        delete authentication_plugin_;
    }
}
