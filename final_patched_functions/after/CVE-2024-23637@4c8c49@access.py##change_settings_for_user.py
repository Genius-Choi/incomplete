def change_settings_for_user(username):
    if (
        current_user is None
        or current_user.is_anonymous
        or (
            current_user.get_name() != username
            and not current_user.has_permission(Permissions.ADMIN)
        )
    ):
        abort(403)

    if current_user.get_name() != username:
        # this must be an admin, so we need to ensure credentials were checked
        ensure_credentials_checked_recently()

    data = request.get_json()

    try:
        userManager.change_user_settings(username, data)
        return jsonify(SUCCESS)
    except users.UnknownUser:
        abort(404)
