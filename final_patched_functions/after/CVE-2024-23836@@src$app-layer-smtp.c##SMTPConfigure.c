static void SMTPConfigure(void) {

    SCEnter();
    intmax_t imval;
    uint32_t content_limit = 0;
    uint32_t content_inspect_min_size = 0;
    uint32_t content_inspect_window = 0;

    ConfNode *config = ConfGetNode("app-layer.protocols.smtp.mime");
    if (config != NULL) {
        ConfNode *extract_urls_schemes = NULL;

        int val;
        int ret = ConfGetChildValueBool(config, "decode-mime", &val);
        if (ret) {
            smtp_config.decode_mime = val;
        }

        ret = ConfGetChildValueBool(config, "decode-base64", &val);
        if (ret) {
            smtp_config.mime_config.decode_base64 = val;
        }

        ret = ConfGetChildValueBool(config, "decode-quoted-printable", &val);
        if (ret) {
            smtp_config.mime_config.decode_quoted_printable = val;
        }

        ret = ConfGetChildValueInt(config, "header-value-depth", &imval);
        if (ret) {
            smtp_config.mime_config.header_value_depth = (uint32_t) imval;
        }

        ret = ConfGetChildValueBool(config, "extract-urls", &val);
        if (ret) {
            smtp_config.mime_config.extract_urls = val;
        }

        /* Parse extract-urls-schemes from mime config, add '://' suffix to found schemes,
         * and provide a default value of 'http' for the schemes to be extracted
         * if no schemes are found in the config */
        extract_urls_schemes = ConfNodeLookupChild(config, "extract-urls-schemes");
        if (extract_urls_schemes) {
            ConfNode *scheme = NULL;

            TAILQ_FOREACH (scheme, &extract_urls_schemes->head, next) {
                /* new_val_len: scheme value from config e.g. 'http' + '://' + null terminator */
                size_t new_val_len = strlen(scheme->val) + 3 + 1;
                if (new_val_len > UINT16_MAX) {
                    FatalError("Too long value for extract-urls-schemes");
                }
                char *new_val = SCMalloc(new_val_len);
                if (unlikely(new_val == NULL)) {
                    FatalError("SCMalloc failure.");
                }

                int r = snprintf(new_val, new_val_len, "%s://", scheme->val);
                if (r < 0 || r >= (int)new_val_len) {
                    FatalError("snprintf failure.");
                }

                /* replace existing scheme value stored on the linked list with new value including
                 * '://' suffix */
                SCFree(scheme->val);
                scheme->val = new_val;
            }

            smtp_config.mime_config.extract_urls_schemes = extract_urls_schemes;
        } else {
            /* Add default extract url scheme 'http' since
             * extract-urls-schemes wasn't found in the config */
            ConfNode *seq_node = ConfNodeNew();
            if (unlikely(seq_node == NULL)) {
                FatalError("ConfNodeNew failure.");
            }
            ConfNode *scheme = ConfNodeNew();
            if (unlikely(scheme == NULL)) {
                FatalError("ConfNodeNew failure.");
            }

            seq_node->name = SCStrdup("extract-urls-schemes");
            if (unlikely(seq_node->name == NULL)) {
                FatalError("SCStrdup failure.");
            }
            scheme->val = SCStrdup("http://");
            if (unlikely(scheme->val == NULL)) {
                FatalError("SCStrdup failure.");
            }

            seq_node->is_seq = 1;
            TAILQ_INSERT_TAIL(&seq_node->head, scheme, next);
            TAILQ_INSERT_TAIL(&config->head, seq_node, next);

            smtp_config.mime_config.extract_urls_schemes = seq_node;
        }

        ret = ConfGetChildValueBool(config, "log-url-scheme", &val);
        if (ret) {
            smtp_config.mime_config.log_url_scheme = val;
        }

        ret = ConfGetChildValueBool(config, "body-md5", &val);
        if (ret) {
            smtp_config.mime_config.body_md5 = val;
        }
    }

    /* Pass mime config data to MimeDec API */
    MimeDecSetConfig(&smtp_config.mime_config);

    ConfNode *t = ConfGetNode("app-layer.protocols.smtp.inspected-tracker");
    ConfNode *p = NULL;

    if (t != NULL) {
        TAILQ_FOREACH(p, &t->head, next) {
            if (strcasecmp("content-limit", p->name) == 0) {
                if (ParseSizeStringU32(p->val, &content_limit) < 0) {
                    SCLogWarning("parsing content-limit %s failed", p->val);
                    content_limit = FILEDATA_CONTENT_LIMIT;
                }
                smtp_config.content_limit = content_limit;
            }

            if (strcasecmp("content-inspect-min-size", p->name) == 0) {
                if (ParseSizeStringU32(p->val, &content_inspect_min_size) < 0) {
                    SCLogWarning("parsing content-inspect-min-size %s failed", p->val);
                    content_inspect_min_size = FILEDATA_CONTENT_INSPECT_MIN_SIZE;
                }
                smtp_config.content_inspect_min_size = content_inspect_min_size;
            }

            if (strcasecmp("content-inspect-window", p->name) == 0) {
                if (ParseSizeStringU32(p->val, &content_inspect_window) < 0) {
                    SCLogWarning("parsing content-inspect-window %s failed", p->val);
                    content_inspect_window = FILEDATA_CONTENT_INSPECT_WINDOW;
                }
                smtp_config.content_inspect_window = content_inspect_window;
            }
        }
    }

    smtp_config.sbcfg.buf_size = content_limit ? content_limit : 256;

    if (ConfGetBool("app-layer.protocols.smtp.raw-extraction",
                (int *)&smtp_config.raw_extraction) != 1) {
        smtp_config.raw_extraction = SMTP_RAW_EXTRACTION_DEFAULT_VALUE;
    }
    if (smtp_config.raw_extraction && smtp_config.decode_mime) {
        SCLogError("\"decode-mime\" and \"raw-extraction\" "
                   "options can't be enabled at the same time, "
                   "disabling raw extraction");
        smtp_config.raw_extraction = 0;
    }

    uint64_t value = SMTP_DEFAULT_MAX_TX;
    smtp_config.max_tx = SMTP_DEFAULT_MAX_TX;
    const char *str = NULL;
    if (ConfGet("app-layer.protocols.smtp.max-tx", &str) == 1) {
        if (ParseSizeStringU64(str, &value) < 0) {
            SCLogWarning("max-tx value cannot be deduced: %s,"
                         " keeping default",
                    str);
        }
        smtp_config.max_tx = value;
    }

    SCReturn;
}
