int bacapp_decode_application_data(
    uint8_t *apdu, uint32_t apdu_size, BACNET_APPLICATION_DATA_VALUE *value)
{
    int len = 0;
    int tag_len = 0;
    int decode_len = 0;
    uint8_t tag_number = 0;
    uint32_t len_value_type = 0;

    if (apdu && value && apdu_size && !IS_CONTEXT_SPECIFIC(*apdu)) {
        value->context_specific = false;
        tag_len = bacnet_tag_number_and_value_decode(
            &apdu[0], apdu_size, &tag_number, &len_value_type);
        if (tag_len > 0) {
            len += tag_len;
            value->tag = tag_number;
            if ((unsigned)len <= apdu_size) {
                decode_len =
                    bacapp_decode_data_len(NULL, tag_number, len_value_type);
                if ((unsigned)decode_len <= (apdu_size - len)) {
                    decode_len = bacapp_decode_data(
                        &apdu[len], tag_number, len_value_type, value);
                    if (value->tag != MAX_BACNET_APPLICATION_TAG) {
                        len += decode_len;
                    } else {
                        len = BACNET_STATUS_ERROR;
                    }
                } else {
                    len = BACNET_STATUS_ERROR;
                }
            } else {
                len = BACNET_STATUS_ERROR;
            }
        }
        value->next = NULL;
    }

    return len;
}
