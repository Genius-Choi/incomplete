def test_too_many_files_single_field_raise(app, expectation, test_client_factory):
    client = test_client_factory(app)
    fields = []
    for i in range(1001):
        # This uses the same field name "N" for all files, equivalent to a
        # multifile upload form field
        fields.append(
            "--B\r\n"
            f'Content-Disposition: form-data; name="N"; filename="F{i}";\r\n\r\n'
            "\r\n"
        )
    data = "".join(fields).encode("utf-8")
    with expectation:
        res = client.post(
            "/",
            data=data,
            headers={"Content-Type": ("multipart/form-data; boundary=B")},
        )
        assert res.status_code == 400
        assert res.text == "Too many files. Maximum number of files is 1000."
