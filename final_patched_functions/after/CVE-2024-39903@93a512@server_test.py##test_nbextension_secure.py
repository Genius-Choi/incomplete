def test_nbextension_secure(solara_server, solara_app, extra_include_path):
    nbextensions_url = solara_server.base_url + "/static/nbextensions"
    nbextensions_directories = [k for k in solara.server.server.nbextensions_directories if k.exists()]
    assert nbextensions_directories, "we should at least test one directory"
    nbextensions_directory = nbextensions_directories[0]

    with extra_include_path(HERE), solara_app("server_test:ClickButton"):
        url = nbextensions_url + "/jupyter-vuetify/nodeps.js"
        response = requests.get(url)
        assert response.status_code == 200
        test_file = nbextensions_directory.parent / "not-allowed"
        test_file.write_text("test")
        url = nbextensions_url + "/..%2fnot-allowed"
        response = requests.get(url)
        assert response.status_code == 404

        url = nbextensions_url + "/foo/..%2f..%2fnot-allowed"
        response = requests.get(url)
        assert response.status_code == 404
