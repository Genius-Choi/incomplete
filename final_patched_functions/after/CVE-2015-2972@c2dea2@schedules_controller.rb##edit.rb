  def edit
    Log.add_info(request, params.inspect)

    @date = Date.parse(params[:date])
    @schedule = Schedule.find(params[:id])

    begin
      schedule = Schedule.find(params[:id])
    rescue => evar
      Log.add_error(request, evar)
      flash[:notice] = 'ERROR:' + t('msg.already_deleted', :name => Schedule.model_name.human)
      render(:text => '')
      return
    end

    unless schedule.check_user_auth(@login_user, 'w', true)

      Log.add_check(request, '[Schedule.check_user_auth]'+request.to_s)

      if @login_user.nil?
        check_login
      else
        flash[:notice] = 'ERROR:' + t('schedule.need_auth_to_edit')
        render(:text => '')
      end
      return
    end

    render(:partial => 'edit_detail', :layout => false)

  rescue => evar
    Log.add_error(request, evar)

    render(:partial => 'edit_detail', :layout => false)
  end
