os__path_normpath_impl(PyObject *module, PyObject *path)
/*[clinic end generated code: output=b94d696d828019da input=5e90c39e12549dc0]*/
{
    if (!PyUnicode_Check(path)) {
        PyErr_Format(PyExc_TypeError, "expected 'str', not '%.200s'",
            Py_TYPE(path)->tp_name);
        return NULL;
    }
    Py_ssize_t len;
    wchar_t *buffer = PyUnicode_AsWideCharString(path, &len);
    if (!buffer) {
        return NULL;
    }
    Py_ssize_t norm_len;
    wchar_t *norm_path = _Py_normpath_and_size(buffer, len, &norm_len);
    PyObject *result = PyUnicode_FromWideChar(norm_path, norm_len);
    PyMem_Free(buffer);
    return result;
}
