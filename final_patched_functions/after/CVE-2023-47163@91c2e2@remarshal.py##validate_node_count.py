def validate_node_count(doc: Document, *, limit: int) -> None:
    count = 0

    def count_callback(x: Any) -> Any:
        nonlocal count
        nonlocal limit

        count += 1
        if count > limit:
            raise TooManyNodesError

        return x

    traverse(doc, instance_callbacks={(object, count_callback)})
