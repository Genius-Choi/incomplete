async def test_add_admin(app, create_user_with_scopes, is_admin):
    db = app.db
    name = 'newadmin'
    user = create_user_with_scopes("admin:users")
    user.admin = is_admin
    db.commit()
    r = await api_request(
        app,
        'users',
        name,
        method='post',
        data=json.dumps({'admin': True}),
        name=user.name,
    )
    if is_admin:
        assert r.status_code == 201
    else:
        assert r.status_code == 403
        return
    user = find_user(db, name)
    assert user is not None
    assert user.name == name
    assert user.admin
    # assert newadmin has default 'admin' role
    assert orm.Role.find(db, 'user') in user.roles
    assert orm.Role.find(db, 'admin') in user.roles
