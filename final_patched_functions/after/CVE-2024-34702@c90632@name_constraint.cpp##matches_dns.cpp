bool GeneralName::matches_dns(const std::string& nam) const
   {
   const std::string constraint = tolower_string(name());
   const std::string issued = tolower_string(nam);

   if(nam.size() == constraint.size())
      {
      return issued == constraint;
      }
   else if(constraint.size() > nam.size())
      {
      // The constraint is longer than the issued name: not possibly a match
      return false;
      }
   else
      {
      if(constraint.empty()) {
         return true;
      }

      std::string substr = issued.substr(nam.size() - constraint.size(), constraint.size());

      if(constraint.front() == '.') {
         return substr == constraint;
      } else if(substr[0] == '.') {
         return substr.substr(1) == constraint;
      } else {
         return substr == constraint && issued[issued.size() - constraint.size() - 1] == '.';
      }
   }
}
