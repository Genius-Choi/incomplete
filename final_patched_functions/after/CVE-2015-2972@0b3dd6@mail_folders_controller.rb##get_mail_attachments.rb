  def get_mail_attachments
    Log.add_info(request, params.inspect)

    email_id = params[:id]

    email = Email.find(email_id)
    if email.nil? or email.user_id != @login_user.id
      render(:text => '')
      return
    end

    download_name = "mail_attachments#{email.id}.zip"
    zip_file = email.zip_attachments(params[:enc])

    if zip_file.nil?
      send_data('', :type => 'application/octet-stream;', :disposition => 'attachment;filename="'+download_name+'"')
    else
      filepath = zip_file.path
      send_file(filepath, :filename => download_name, :stream => true, :disposition => 'attachment')
    end
  end
