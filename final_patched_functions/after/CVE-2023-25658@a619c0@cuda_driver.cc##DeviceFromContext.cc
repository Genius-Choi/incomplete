/* static */ tsl::StatusOr<CUdevice> GpuDriver::DeviceFromContext(
    GpuContext* context) {
  ScopedActivateContext activated{context};
  CUdevice device = -1;
  CUresult result = cuCtxGetDevice(&device);
  if (result == CUDA_SUCCESS) {
    return device;
  }

  return tsl::Status(
      tsl::error::INTERNAL,
      absl::StrCat("failed to get device for context: ", ToString(result)));
}
