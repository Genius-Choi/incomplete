def do_poll():
	if "p_id" in request.args:
		p_id = request.args['p_id']
		cursor = conn.cursor()
		sql_s = "select FTitle, FOptionDesc from t_vote_info where FVoteId=%s;"
		res = cursor.execute(sql_s, (p_id,))
		r = cursor.fetchone()
		cursor.close()
		title = r[0]
		opts_desc = r[1].split('|')
		return render_template("poll.html", title=title, opts=opts_desc)

	if "p_id" not in request.form:
		return render_template("poll.html")
	if "opt_idx" not in request.form:
		return render_template("poll.html")

	o_id = int(request.form['opt_idx'])-1
	p_id = request.form['p_id']
	try:
		cursor = conn.cursor()
		sql_s = "select FOptionVoteNum from t_vote_info where FVoteId=%s;"
		res = cursor.execute(sql_s, (p_id,))
		opt_pre = cursor.fetchone()[0].split('|')
		opt_pre[o_id] = str(int(opt_pre[o_id])+1)
		opt_new = '|'.join(opt_pre)
		sql_u = "update t_vote_info set FOptionVoteNum=%s where FVoteId=%s;"
		res = cursor.execute(sql_u, (opt_new,p_id))
		conn.commit()
		cursor.close()
	except Exception,e:
		cursor.close()
		return jsonify({"result_code":"-1", "result_msg":"error", "p_id":0})
	return jsonify({"result_code":"0", "result_msg":"success", "p_id":p_id})
