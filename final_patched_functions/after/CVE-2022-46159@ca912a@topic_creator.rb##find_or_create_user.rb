  def find_or_create_user(email, display_name)
    user = User.find_by_email(email)

    if !user && SiteSetting.enable_staged_users
      username = UserNameSuggester.sanitize_username(display_name) if display_name.present?

      user = User.create!(
        email: email,
        username: UserNameSuggester.suggest(username.presence || email),
        name: display_name.presence || User.suggest_name(email),
        staged: true
      )
    end

    user
  end
