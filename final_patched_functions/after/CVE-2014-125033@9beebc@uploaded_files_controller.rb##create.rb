  def create
    @uploaded_file = UploadedFile.new(uploaded_file_params)
    uploaded_io = params[:uploaded_file][:content]

    # Set the file name to the remote one, if not set by :name form field
    @uploaded_file.name = uploaded_io.original_filename if @uploaded_file.name == ''

    # Just to be sure, replace every whitespace with a '-'
    @uploaded_file.name.gsub!(/ /, '-')

    # Then write to file
    # WARNING : File.open is definitely vulnerable to Path Traversal Attacks
    # (https://www.owasp.org/index.php/Path_Traversal) 
    # The following line should take care of it, by only taking the past part of the path (aka filename)
    @uploaded_file.name = @uploaded_file.name.split(/\//)[-1]

    File.open(@uploaded_file.absolute_path, 'wb') do |file|
      file.write(uploaded_io.read)
    end

    respond_to do |format|
      if @uploaded_file.save
        format.html { redirect_to @uploaded_file, notice: 'Uploaded file was successfully created.' }
        format.json { render :show, status: :created, location: @uploaded_file }
      else
        format.html { render :new }
        format.json { render json: @uploaded_file.errors, status: :unprocessable_entity }
      end
    end
  end
