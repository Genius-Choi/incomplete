def secureOpenForWrite(filename=None, *, text=True):
    """Securely open a file for writing.

    If filename is not provided, a file is created in tempfile.gettempdir().
    The file always created with mode 600.

    :param string filename: name of file to be opened
    """
    if filename:
        fd = os.open(
            path=filename,
            flags=os.O_WRONLY | os.O_CREAT | os.O_TRUNC,
            mode=stat.S_IRUSR | stat.S_IWUSR,
        )
    else:
        fd, filename = tempfile.mkstemp(text=text)
    with open(fd, "w" if text else "wb", encoding="ascii") as fd:
        yield fd
