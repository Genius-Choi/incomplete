  def export_csv
    Log.add_info(request, params.inspect)

    book = params[:filter_book]
    book = Address::BOOK_PRIVATE unless @login_user.admin?(User::AUTH_ADDRESSBOOK)

    csv = Address.export_csv(@login_user, book)

    begin
      csv.encode!(params[:enc], Encoding::UTF_8, {:invalid => :replace, :undef => :replace, :replace => ' '})
    rescue => evar
      Log.add_error(request, evar)
    end

    send_data(csv, :type => 'application/octet-stream;charset=UTF-8', :disposition => 'attachment;filename="addressbook.csv"')
  end
