static int attach_link(LINK_HANDLE link, ON_ENDPOINT_FRAME_RECEIVED* on_frame_received)
{
    umock_c_reset_all_calls();

    STRICT_EXPECTED_CALL(session_begin(TEST_SESSION_HANDLE));
    STRICT_EXPECTED_CALL(session_start_link_endpoint(TEST_LINK_ENDPOINT, IGNORED_PTR_ARG, IGNORED_PTR_ARG, IGNORED_PTR_ARG, link))
        .CaptureArgumentValue_frame_received_callback(on_frame_received);

    return link_attach(link, test_on_transfer_received, test_on_link_state_changed, test_on_link_flow_on, NULL);
}
