void aws_php_thread_queue_yield(aws_php_thread_queue *queue) {
    /* If on the main thread, then just drain the queue */
    if (aws_php_is_main_thread()) {
        aws_php_thread_queue_drain(queue);
    } else {
        /* push a task onto the end of the queue, we will return once this task completes our promise */
        struct aws_promise *queue_drained = aws_promise_new(aws_crt_default_allocator());
        aws_php_task queue_drained_task = {
            .callback = s_thread_queue_complete_promise,
            .data = queue_drained,
        };
        aws_php_thread_queue_push(queue, queue_drained_task);
        aws_promise_wait(queue_drained);
        aws_promise_release(queue_drained);
    }
}
