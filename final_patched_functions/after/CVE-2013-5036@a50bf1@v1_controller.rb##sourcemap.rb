  def sourcemap
    require_params :api_key, :environment, :revision, :sourcemap

    sourcemap = YAML.load(Zlib::Inflate.inflate(Base64.decode64(params['sourcemap'])), safe: true, deserialize_symbols: false)
    return head(:unprocessable_entity) unless sourcemap.kind_of?(Squash::Javascript::SourceMap)

    Project.find_by_api_key!(params['api_key']).
        environments.with_name(params['environment']).find_or_create!({name: params['environment']}, as: :worker).
        source_maps.create({map: sourcemap, revision: params['revision']}, as: :api)
    head :created
  end
