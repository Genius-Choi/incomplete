  def month
    if params[:action] == 'month'
      Log.add_info(request, params.inspect)
    end

    if !params[:display].nil? and params[:display].split('_').first == 'group'
      @group_id = params[:display].split('_').last
    end

    if params[:user_id].nil?
      @selected_user = @login_user
    else
      @selected_user = User.find(params[:user_id])

      if @selected_user.id != @login_user.id and !@login_user.admin?(User::AUTH_TIMECARD)
        if (@selected_user.get_groups_a & @login_user.get_groups_a).empty?
          Log.add_check(request, '[User::AUTH_TIMECARD]'+request.to_s)
          redirect_to(:controller => 'frames', :action => 'http_error', :id => '401')
          return
        end
      end
    end

    year_begins_from, month_begins_at = TimecardsHelper.get_fiscal_params

    date_s = params[:date]

    if date_s.blank?
      date = Date.today
    else
      date_params = date_s.split('-')
      if date_params.length == 2
        @year = date_params.first.to_i
        @month = date_params.last.to_i
        date = TimecardsHelper.get_first_day_in_fiscal_month(@year, @month, month_begins_at)
      else
        date = Date.parse(date_s)
      end
    end

    @fiscal_year = TimecardsHelper.get_fiscal_year(date, year_begins_from, month_begins_at)
    fiscal_month = TimecardsHelper.get_fiscal_month(date, month_begins_at)

    if @year.nil? or @month.nil?
      @month = fiscal_month

      if fiscal_month < date.month and fiscal_month == 1
        @year = date.year + 1
      elsif fiscal_month > date.month and fiscal_month == 12
        @year = date.year - 1
      else
        @year = date.year
      end
    end

    @start_date, @end_date = TimecardsHelper.get_month_span(date, month_begins_at)

    @timecards = Timecard.find_term(@selected_user.id, @start_date, @end_date)

    @paid_holiday = PaidHoliday.get_for(@selected_user.id, @fiscal_year)

    year_start, year_end = TimecardsHelper.get_year_span(@fiscal_year, year_begins_from, month_begins_at)
    @applied_paid_hlds = Timecard.applied_paid_hlds(@selected_user.id, year_start, @start_date - 1)
  end
