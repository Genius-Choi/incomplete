def test_public_secure(solara_server, solara_app, extra_include_path):
    public_url = solara_server.base_url + "/static/public"

    with solara_app(str(HERE / "apps/secure/app.py")):
        apps = list(solara.server.app.apps.values())
        assert len(apps) == 1
        app = apps[0]
        public_directory = app.directory.parent / "public"
        url = public_url + "/test.txt"
        response = requests.get(url)
        assert response.status_code == 200
        test_file = public_directory.parent / "not-allowed"
        assert test_file.exists()
        url = public_url + "/..%2fnot-allowed"
        response = requests.get(url)
        assert response.status_code == 404

        url = public_url + "/foo/..%2f..%2fnot-allowed"
        response = requests.get(url)
        assert response.status_code == 404
