  def get_mail_raw
    Log.add_info(request, params.inspect)

    email = Email.find(params[:id])
    email_name = email.subject + Email::EXT_RAW

    agent = request.env['HTTP_USER_AGENT']
    unless agent.nil?
      ie_ver = nil
      agent.scan(/\sMSIE\s?(\d+)[.](\d+)/){|m|
                  ie_ver = m[0].to_i + (0.1 * m[1].to_i)
                }
      email_name = CGI::escape(email_name) unless ie_ver.nil?
    end

    filepath = File.join(email.get_dir, email.id.to_s + Email::EXT_RAW)
    if FileTest.exist?(filepath)
      send_file(filepath, :filename => email_name, :stream => true, :disposition => 'attachment')
    else
      send_data('', :type => 'application/octet-stream;', :disposition => 'attachment;filename="'+email_name+'"')
    end
  end
