def patch_run_shell_command(monkeypatch):
    generated_commands[:] = []

    pkg_list = 'openssl\nsed\ntar\nsome_package\nsome_other_package\n{}\nany_package'.format(APP_NAME)
    pkg_info = '{}\n\n{}\n\n{}\n\n{}'.format(some_package_info, some_other_package_info, app_package_info, any_package_info)

    def mock_run_shell_command(command, *args, **kwargs):
        # Keep track of the generated commands
        generated_commands.append(command)
        if command == 'dpkg --get-selections | grep -v deinstall | cut -f1':
            return pkg_list
        else:
            package_name = command.split()[-1]
            packages = re.split("\n\n", pkg_info)
            for package in packages:
                if package_name in package:
                    return package

            return ''

    monkeypatch.setattr(NodeControlUtil, 'run_shell_command', mock_run_shell_command)
