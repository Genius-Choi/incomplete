int main(int argc, char **argv)
{
	int local_port = -1;
	int err = 0;

	for (;;) {
		const int c = getopt(argc, argv, "p:");

		if (c < 0)
			break;

		switch (c) {

		case 'p':
			local_port = atoi(optarg);
			break;

		default:
			break;

		}
	}

	if (local_port == -1) {
		usage(argv[0]);
		err = EINVAL;
		goto out;
	}

	err = libre_init();
	if (err) {
		(void)re_fprintf(stderr, "libre init failed: %m\n", err);
		goto out;
	}

	err = avs_init(0);
	if (err) {
		(void)re_fprintf(stderr, "avs init failed: %m\n", err);
		goto out;
	}

	err = dict_alloc(&verifyd.idents);
	if (err) {
		re_fprintf(stderr,
			   "%s: cannot alloc idetifier dictionary: %m\n",
			   argv[0], err);
		goto out;
	}

	log_set_min_level(LOG_LEVEL_INFO);

	tmr_init(&verifyd.tmr);

	tmr_start(&verifyd.tmr, 1, init_timeout, &local_port);

	re_printf("re_main\n");
	re_main(signal_handler);
	re_printf("re_main DONE!\n");

 out:
	tmr_cancel(&verifyd.tmr);
	mem_deref(verifyd.idents);

	srv_close();

	libre_close();

	/* check for memory leaks */
	mem_debug();
	tmr_debug();

	return err;
}
