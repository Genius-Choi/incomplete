  def month
    Log.add_info(request, params.inspect)

    date_s = params[:date]

    if date_s.nil? or date_s.empty?
      @date = Date.today
    else
      @date = Date.parse(date_s)
    end

    if params[:user_id].nil? and !@login_user.nil? and !session[:settings].nil?
      timecard_icons = params[:timecard_icons]

      if timecard_icons.nil?
        params[:timecard_icons] = session[:settings][Setting::KEY_CALENDAR_WITH_TIMECARD_ICONS]
      else
        if timecard_icons != session[:settings][Setting::KEY_CALENDAR_WITH_TIMECARD_ICONS]
          Setting.save_value(@login_user.id, Setting::CATEGORY_SCHEDULE, Setting::KEY_CALENDAR_WITH_TIMECARD_ICONS, timecard_icons)
          session[:settings][Setting::KEY_CALENDAR_WITH_TIMECARD_ICONS] = timecard_icons
        end
      end

      if params[:timecard_icons] == 'true'
        start_date, end_date = TimecardsHelper.get_month_span(@date, 1)
        @timecards = Timecard.find_term(@login_user.id, start_date, end_date)
      end
    end

    params[:display] = 'month'
  end
