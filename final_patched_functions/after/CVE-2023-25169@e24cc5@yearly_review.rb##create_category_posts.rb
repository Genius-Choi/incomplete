    def create_category_posts(view, review_start, review_end, topic_id)
      review_categories = review_categories_from_settings

      review_categories.each do |category_id|
        category_post_topics = category_post_topics category_id, review_start, review_end
        if category_post_topics[:topics]
          view.assign(category_topics: category_post_topics)
          raw = view.render partial: "yearly_review_category", layout: false
          unless raw.empty?
            post_opts = {
              topic_id: topic_id,
              raw: raw,
              skip_validations: true,
              custom_fields: {
                ::YearlyReview::POST_CUSTOM_FIELD => review_start.year,
              },
            }

            PostCreator.create!(Discourse.system_user, post_opts)
          end
        end
      end
    end
