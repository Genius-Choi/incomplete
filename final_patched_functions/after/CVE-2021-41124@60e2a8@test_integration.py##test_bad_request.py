def test_bad_request(settings):
    class BadRequestSpider(ResponseSpider):
        def start_requests(self):
            yield SplashRequest(self.url, endpoint='execute',
                                args={'lua_source': DEFAULT_SCRIPT, 'wait': 'bar'})

    items, url, crawler = yield crawl_items(BadRequestSpider, HelloWorld,
                                            settings)
    resp = assert_single_response(items)
    assert resp.status == 400
    assert resp.splash_response_status == 400

    items, url, crawler = yield crawl_items(LuaSpider, Http400Resource,
                                            settings)
    resp = assert_single_response(items)
    assert resp.status == 400
    assert resp.splash_response_status == 200
