  def rewrite_raw_display_name(raw, old_display_name, new_display_name)
    escaped_old_display_name = Regexp.escape(old_display_name)
    pattern =
      /(?<pre>\[quote\s*=\s*["'']?)#{escaped_old_display_name}(?<post>\,[^\]]*username[^\]]*\])/i

    raw.gsub(pattern, "\\k<pre>#{new_display_name}\\k<post>")
  end
