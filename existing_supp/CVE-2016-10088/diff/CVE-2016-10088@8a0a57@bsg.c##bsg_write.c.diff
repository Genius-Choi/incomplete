--- before
+++ after
@@ -5,6 +5,9 @@
 	int ret;

 

 	dprintk("%s: write %Zd bytes\n", bd->name, count);

+

+	if (unlikely(segment_eq(get_fs(), KERNEL_DS)))

+		return -EINVAL;

 

 	bsg_set_block(bd, file);

 

