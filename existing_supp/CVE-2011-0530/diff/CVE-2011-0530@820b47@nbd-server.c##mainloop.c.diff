--- before
+++ after
@@ -36,7 +36,7 @@
 
 		if (request.magic != htonl(NBD_REQUEST_MAGIC))
 			err("Not enough magic.");
-		if (len > BUFSIZE + sizeof(struct nbd_reply))
+		if (len > BUFSIZE - sizeof(struct nbd_reply))
 			err("Request too big!");
 #ifdef DODBG
 		printf("%s from %llu (%llu) len %d, ", request.type ? "WRITE" :
@@ -90,4 +90,4 @@
 		DEBUG("OK!\n");
 	}
 	return 0;
-}+}
