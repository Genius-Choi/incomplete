--- before
+++ after
@@ -3,7 +3,8 @@
 	if ((ms->flags & MAGIC_CHECK) == 0)

 		return 0;

 

-	if (m->type != FILE_PSTRING && (m->str_flags & PSTRING_LEN) != 0) {

+	if ((m->type != FILE_REGEX || (m->str_flags & REGEX_LINE_COUNT) == 0) &&

+	    (m->type != FILE_PSTRING && (m->str_flags & PSTRING_LEN) != 0)) {

 		file_magwarn(ms,

 		    "'/BHhLl' modifiers are only allowed for pascal strings\n");

 		return -1;

