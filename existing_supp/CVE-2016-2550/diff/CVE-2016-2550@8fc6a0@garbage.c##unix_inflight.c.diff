--- before
+++ after
@@ -1,4 +1,4 @@
-void unix_inflight(struct file *fp)

+void unix_inflight(struct user_struct *user, struct file *fp)

 {

 	struct sock *s = unix_get_socket(fp);

 

@@ -15,6 +15,6 @@
 		}

 		unix_tot_inflight++;

 	}

-	fp->f_cred->user->unix_inflight++;

+	user->unix_inflight++;

 	spin_unlock(&unix_gc_lock);

 }

