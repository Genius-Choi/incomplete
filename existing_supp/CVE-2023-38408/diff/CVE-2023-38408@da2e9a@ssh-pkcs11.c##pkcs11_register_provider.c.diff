--- before
+++ after
@@ -23,6 +23,10 @@
 

 	if (pkcs11_provider_lookup(provider_id) != NULL) {

 		debug_f("provider already registered: %s", provider_id);

+		goto fail;

+	}

+	if (lib_contains_symbol(provider_id, "C_GetFunctionList") != 0) {

+		error("provider %s is not a PKCS11 library", provider_id);

 		goto fail;

 	}

 	/* open shared pkcs11-library */

