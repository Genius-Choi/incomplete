--- before
+++ after
@@ -19,6 +19,11 @@
 	if (parse_key_constraints(e->request, NULL, &death, &seconds, &confirm,

 	    NULL, &dest_constraints, &ndest_constraints) != 0) {

 		error_f("failed to parse constraints");

+		goto send;

+	}

+	if (e->nsession_ids != 0 && !remote_add_provider) {

+		verbose("failed PKCS#11 add of \"%.100s\": remote addition of "

+		    "providers is disabled", provider);

 		goto send;

 	}

 	if (realpath(provider, canonical_provider) == NULL) {

