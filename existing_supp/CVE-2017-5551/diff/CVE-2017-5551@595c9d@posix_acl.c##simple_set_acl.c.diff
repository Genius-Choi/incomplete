--- before
+++ after
@@ -3,11 +3,10 @@
 	int error;

 

 	if (type == ACL_TYPE_ACCESS) {

-		error = posix_acl_equiv_mode(acl, &inode->i_mode);

-		if (error < 0)

-			return 0;

-		if (error == 0)

-			acl = NULL;

+		error = posix_acl_update_mode(inode,

+				&inode->i_mode, &acl);

+		if (error)

+			return error;

 	}

 

 	inode->i_ctime = current_time(inode);

