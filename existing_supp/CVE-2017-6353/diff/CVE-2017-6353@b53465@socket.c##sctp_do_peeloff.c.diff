--- before
+++ after
@@ -7,6 +7,12 @@
 

 	if (!asoc)

 		return -EINVAL;

+

+	/* If there is a thread waiting on more sndbuf space for

+	 * sending on this asoc, it cannot be peeled.

+	 */

+	if (waitqueue_active(&asoc->wait))

+		return -EBUSY;

 

 	/* An association cannot be branched off from an already peeled-off

 	 * socket, nor is this supported for tcp style sockets.

