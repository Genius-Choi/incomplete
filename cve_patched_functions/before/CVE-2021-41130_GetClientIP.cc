std::string NgxEspRequest::GetClientIP() {
  // use remote_addr variable to get client_ip.
  ngx_esp_main_conf_t *mc = reinterpret_cast<ngx_esp_main_conf_t *>(
      ngx_http_get_module_main_conf(r_, ngx_esp_module));
  if (mc->remote_addr_variable_index != NGX_ERROR) {
    ngx_http_variable_value_t *vv =
        ngx_http_get_indexed_variable(r_, mc->remote_addr_variable_index);
    if (vv != nullptr && !vv->not_found) {
      return ngx_str_to_std(ngx_str_t({vv->len, vv->data}));
    }
  }
  return "";
}
