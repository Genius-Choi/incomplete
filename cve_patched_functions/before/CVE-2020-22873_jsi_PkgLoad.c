static Jsi_RC jsi_PkgLoad(Jsi_Interp *interp, const char *name, Jsi_Number ver) {
    Jsi_RC rc;
    const char *cp = NULL, *path;
    int len;
    uint i = 0;
    Jsi_Value *fval = NULL;
    Jsi_Value *pval = interp->pkgDirs;
    if (pval) {
        Jsi_Obj* obj = pval->d.obj;
        bool isJsish = !Jsi_Strcmp(name, "Jsish");
        for (; i<obj->arrCnt; i++) {
            const char *pnam = Jsi_ValueString(interp, obj->arr[i], NULL);
            if (isJsish && interp->selfZvfs && Jsi_Strncmp(pnam, JSI_ZVFS_DIR, sizeof(JSI_ZVFS_DIR)-1))
                continue;
            rc = jsi_PkgLoadOne(interp, name, pnam, -1, &fval, ver);
            if (rc != JSI_CONTINUE)
                goto done;
        }
    }
    // Check executable dir.
    path = jsiIntData.execName;
    if (path)
        cp = Jsi_Strrchr(path, '/');
    if (cp) {
        len = cp-path;
        rc = jsi_PkgLoadOne(interp, name, path, len, &fval, ver);
        if (rc != JSI_CONTINUE)
            goto done;
    }
    // Check script dir.
    if ((path = interp->framePtr->fileName) || (interp->argv0 && (path = Jsi_ValueString(interp, interp->argv0, NULL)))) {
        if ((cp = Jsi_Strrchr(path, '/'))) {
            len = (cp-path);
            rc = jsi_PkgLoadOne(interp, name, path, len, &fval, ver);
            if (rc != JSI_CONTINUE)
                goto done;
        }
    } else if (interp->curDir) { // Interactive mode 
        rc = jsi_PkgLoadOne(interp, name, interp->curDir, Jsi_Strlen(interp->curDir), &fval, ver);
        if (rc != JSI_CONTINUE)
            goto done;
    }
    return JSI_ERROR;
    
done:
    if (rc == JSI_CONTINUE)
        rc = JSI_ERROR;
    if (rc == JSI_OK) {
        Jsi_HashEntry *hPtr = Jsi_HashEntryFind(interp->packageHash, name);
        if (!hPtr)
            rc = JSI_ERROR;
        else {
            jsi_PkgInfo *ptr, *ptr2;
            Jsi_HashEntry *hPtr = Jsi_HashEntryFind(interp->packageHash, name);
            if (hPtr) {
                ptr = (jsi_PkgInfo*)Jsi_HashValueGet(hPtr);
                if (ptr)
                    if (fval) {
                        char *fval2 = Jsi_Realpath(interp, fval, NULL);
                        ptr->loadFile = Jsi_KeyAdd(interp, fval2);
                        if (interp->parent && ptr->initProc) {
                            if (interp->debugOpts.pkgTrace)
                                Jsi_Printf(interp, jsi_Stderr , "Package-Trace: load from topLevel: %s\n", name);
                            ptr2 = jsi_PkgGet(interp->topInterp, name);
                            if (ptr2)
                                ptr2->loadFile = Jsi_KeyAdd(interp->topInterp, ptr->loadFile);
                        }
                        Jsi_DecrRefCount(interp, fval);
                        free(fval2);
                    }
            }
        }
    }
    if (rc != JSI_OK && fval)
        Jsi_DecrRefCount(interp, fval);
    return rc;
}
