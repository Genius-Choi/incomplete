rec_parser_getc (rec_parser_t parser)
{
  int ci;

  /* Get the input character depending on the backend used (memory or
     file).  */
  if (parser->in_file)
    ci = getc (parser->in_file);
  else if (parser->in_buffer)
    {
      if (parser->p == parser->in_buffer + parser->in_size)
        ci = EOF;
      else
        {
          ci = *(parser->p);
          parser->p++;
        }
    }
  else
    {
      /* This point should not be reached!  */
      fprintf (stderr, "rec_parser_getc: no backend in parser. This is a bug.\
  Please report it.");
      return EOF;
    }

  /* Manage EOF and update statistics.  */
  if (ci == EOF)
    parser->eof = true;
  else
    {
      parser->character++;
      if (((char) ci) == '\n')
        parser->line++;
    }

  return ci;
}
