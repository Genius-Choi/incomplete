bytes_to_str_maxlen(wmem_allocator_t *scope,
			const guint8 *src, size_t src_size,
			size_t max_bytes_len)
{
	char *buf;
	size_t max_char_size;
	char *buf_ptr;
	int truncated = 0;

	ws_return_str_if_null(scope, src);
	ws_return_str_if_zero(scope, src_size);

	if (max_bytes_len == 0 || max_bytes_len > src_size) {
		max_bytes_len = src_size;
	}
	else if (max_bytes_len < src_size) {
		truncated = 1;
	}

	max_char_size = max_bytes_len * 2 + strlen(UTF8_HORIZONTAL_ELLIPSIS) + 1;

	buf = wmem_alloc(scope, max_char_size);
	buf_ptr = bytes_to_hexstr(buf, src, max_bytes_len);

	if (truncated)
		buf_ptr = g_stpcpy(buf_ptr, UTF8_HORIZONTAL_ELLIPSIS);

	*buf_ptr = '\0';
	return buf;
}
