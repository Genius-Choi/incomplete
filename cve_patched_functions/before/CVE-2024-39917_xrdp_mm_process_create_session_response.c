xrdp_mm_process_create_session_response(struct xrdp_mm *self)
{
    enum scp_screate_status status;
    int display;
    struct guid guid;

    int rv;

    self->mmcs_expecting_msg = 0;

    rv = scp_get_create_session_response(self->sesman_trans, &status,
                                         &display, &guid);
    if (rv == 0)
    {
        const char *username;

        /* Sort out some logging information */
        if ((username = xrdp_mm_get_value(self, "username")) == NULL)
        {
            username = "???";
        }

        if (status == E_SCP_SCREATE_OK)
        {
            xrdp_wm_log_msg(self->wm, LOG_LEVEL_INFO,
                            "session is available on display %d for user %s",
                            display, username);

            /* Carry on with the connect state machine */
            self->display = display;
            self->guid = guid;
            xrdp_mm_connect_sm(self);
        }
        else
        {
            char buff[128];
            scp_screate_status_to_str(status, buff, sizeof(buff));
            xrdp_wm_log_msg(self->wm, LOG_LEVEL_INFO,
                            "Can't create session for user %s - %s",
                            username, buff);
            /* Leave the sesman connection open for further login attenpts */
            xrdp_wm_mod_connect_done(self->wm, 1);
        }
    }

    return rv;
}
