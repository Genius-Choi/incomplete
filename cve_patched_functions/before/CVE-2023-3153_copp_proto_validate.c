copp_proto_validate(const char *proto_name)
{
    for (size_t i = COPP_PROTO_FIRST; i < COPP_PROTO_MAX; i++) {
        if (!strcmp(proto_name, copp_proto_get_name(i))) {
            return NULL;
        }
    }

    struct ds usage = DS_EMPTY_INITIALIZER;

    ds_put_cstr(&usage, "Invalid control protocol. Allowed values: ");
    for (size_t i = COPP_PROTO_FIRST; i < COPP_PROTO_MAX; i++) {
        ds_put_format(&usage, "%s, ", copp_proto_get_name(i));
    }
    ds_chomp(&usage, ' ');
    ds_chomp(&usage, ',');
    ds_put_cstr(&usage, ".");

    return ds_steal_cstr(&usage);
}
