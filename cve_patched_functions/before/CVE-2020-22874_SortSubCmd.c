static int SortSubCmd(const void *p1, const void *p2) {
    SortInfo *si = curSortInfo;
#else
#ifdef __WIN32
static int SortSubCmd(void *thunk, const void *p1, const void *p2)
#else
static int SortSubCmd(const void *p1, const void *p2, void *thunk)
#endif
{
    SortInfo *si = (SortInfo *)thunk;
#endif
    Jsi_Interp *interp = si->interp;
    int sortFlags = si->flags;

    if (interp == NULL || interp->deleting)
        return 0;
    Jsi_Value *v1 = *(Jsi_Value**)p1, *v2 = *(Jsi_Value**)p2;
    int rc = 0;
    if (v1 != NULL && v2 != NULL) {
        VALCHK(v1);
        VALCHK(v2);
        if (!si->compare)
            rc = Jsi_ValueCmp(interp, v1, v2, sortFlags);
        else {
            Jsi_Value *vv[2] = {v1, v2};
            Jsi_Value *retP = Jsi_ValueNew1(interp);
            Jsi_Value *vpargs = Jsi_ValueMakeObject(interp, NULL, Jsi_ObjNewArray(interp, vv, 2, 0));
            Jsi_IncrRefCount(interp, vpargs);
            rc = Jsi_FunctionInvoke(interp, si->compare, vpargs, &retP, NULL);
            Jsi_DecrRefCount(interp, vpargs);
            if (rc == JSI_OK) {
                Jsi_Number d = 0;
                if (Jsi_ValueGetNumber(interp, retP, &d) == JSI_OK)
                    rc = -(int)d;
                else {
                    if (!si->errCnt)
                        Jsi_LogWarn("invalid function return");
                    si->errCnt++;
                }
            }
            Jsi_DecrRefCount(interp, retP);
        }
    } else {
        if (v1 == v2) 
            rc = 0;
        else if (v1 == NULL)
            rc = 1;
        else
            rc = -1;
    }
    if ((sortFlags&JSI_SORT_DESCEND))
        return rc;
    return -rc;
}
