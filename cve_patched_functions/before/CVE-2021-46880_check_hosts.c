check_hosts(X509 *x, X509_VERIFY_PARAM_ID *id)
{
	size_t i, n;
	char *name;

	n = sk_OPENSSL_STRING_num(id->hosts);
	free(id->peername);
	id->peername = NULL;

	for (i = 0; i < n; ++i) {
		name = sk_OPENSSL_STRING_value(id->hosts, i);
		if (X509_check_host(x, name, strlen(name), id->hostflags,
		    &id->peername) > 0)
			return 1;
	}
	return n == 0;
}
