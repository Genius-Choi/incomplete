ecma_proxy_create (ecma_value_t target, /**< proxy target */
                   ecma_value_t handler, /**< proxy handler */
                   uint32_t options) /**< ecma_proxy_flag_types_t option bits */
{
  /* ES2015: 1, 3. */
  /* ES11+: 1 - 2. */
  if (!ecma_is_value_object (target) || !ecma_is_value_object (handler))
  {
    ecma_raise_type_error (ECMA_ERR_CANNOT_CREATE_PROXY);
    return NULL;
  }

  /* ES2015: 5 - 6. */
  /* ES11+: 3 - 4. */
  /* A Proxy does not have [[Prototype]] value as per standard */
  ecma_object_t *obj_p = ecma_create_object (NULL, sizeof (ecma_proxy_object_t), ECMA_OBJECT_TYPE_PROXY);

  ecma_proxy_object_t *proxy_obj_p = (ecma_proxy_object_t *) obj_p;

  obj_p->u2.prototype_cp = (jmem_cpointer_t) options;

  /* ES2015: 7. */
  /* ES11+: 5. */
  if (ecma_op_is_callable (target))
  {
    obj_p->u2.prototype_cp |= ECMA_PROXY_IS_CALLABLE;

    /* ES2015: 7.b. */
    /* ES11+: 5.b. */
    if (ecma_is_constructor (target))
    {
      obj_p->u2.prototype_cp |= ECMA_PROXY_IS_CONSTRUCTABLE;
    }
  }

  /* ES2015: 8. */
  /* ES11+: 6. */
  proxy_obj_p->target = target;

  /* ES2015: 9. */
  /* ES11+: 7. */
  proxy_obj_p->handler = handler;

  /* ES2015: 10. */
  /* ES11+: 8 */
  return obj_p;
} /* ecma_proxy_create */
