void ast_sip_persistent_endpoint_publish_contact_state(const char *endpoint_name, const struct ast_sip_contact_status *contact_status)
{
	struct sip_persistent_endpoint *persistent;
	struct ast_json *blob;
	char rtt[32];

	persistent = ao2_find(persistent_endpoints, endpoint_name, OBJ_SEARCH_KEY);
	if (!persistent) {
		return;
	}

	snprintf(rtt, sizeof(rtt), "%" PRId64, contact_status->rtt);
	blob = ast_json_pack("{s: s, s: s, s: s, s: s, s: s}",
		"contact_status", ast_sip_get_contact_status_label(contact_status->status),
		"aor", contact_status->aor,
		"uri", contact_status->uri,
		"roundtrip_usec", rtt,
		"endpoint_name", ast_endpoint_get_resource(persistent->endpoint));
	if (blob) {
		ast_endpoint_blob_publish(persistent->endpoint, ast_endpoint_contact_state_type(), blob);
		ast_json_unref(blob);
	}

	ao2_ref(persistent, -1);
}
