static int write_client_connection(turn_turnserver *server, ts_ur_super_session* ss, ioa_network_buffer_handle nbh, int ttl, int tos) {

	FUNCSTART;

	if (!(ss->client_socket)) {
		ioa_network_buffer_delete(server->e, nbh);
		FUNCEND;
		return -1;
	} else {

		if (eve(server->verbose)) {
			TURN_LOG_FUNC(TURN_LOG_LEVEL_INFO,
				"%s: prepare to write to s 0x%lx\n", __FUNCTION__,
				(long) (ss->client_socket));
		}

		int skip = 0;
		int ret = send_data_from_ioa_socket_nbh(ss->client_socket, NULL, nbh, ttl, tos, &skip);

		if(!skip && ret>-1) {
			++(ss->sent_packets);
			ss->sent_bytes += (uint32_t)ioa_network_buffer_get_size(nbh);
			turn_report_session_usage(ss, 0);
		}

		FUNCEND;
		return ret;
	}
}
