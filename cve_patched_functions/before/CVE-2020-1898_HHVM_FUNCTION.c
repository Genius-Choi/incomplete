int64_t HHVM_FUNCTION(HH_int_mul_add_overflow,
                      int64_t a, int64_t b, int64_t bias) {
  uint64_t ua = a;
  uint64_t ub = b;
  uint64_t umbias = static_cast<uint64_t>(-1 - bias);
  __uint128_t full =
    static_cast<__uint128_t>(ua) * static_cast<__uint128_t>(ub);
  // The assembly for this looks faster than 128-bit add to 'full'
  // (8 instructions vs. 11)
  uint64_t full_lower = static_cast<uint64_t>(full);
  return static_cast<int64_t>(full >> 64) + (full_lower > umbias);
}
