static int handle_NP_Shutdown(rpc_connection_t *connection)
{
  D(bug("handle_NP_Shutdown\n"));

  int error = rpc_method_get_args(connection, RPC_TYPE_INVALID);
  if (error != RPC_ERROR_NO_ERROR) {
	npw_perror("NP_Shutdown() get args", error);
	return error;
  }

  /* Clear any NPP_Destroys we may have delayed. Although it doesn't
     really matter, and the plugin is going to die soon.

	 XXX: To be really picky, we should probably delay this and make
	 sure it is run on a new event loop iteration. */
  delayed_destroys_process_cb(NULL);

  NPError ret = g_NP_Shutdown();
  return rpc_method_send_reply(connection, RPC_TYPE_INT32, ret, RPC_TYPE_INVALID);
}
