    void SipDialogController::endRetransmitFinalResponse( nta_incoming_t* irq, tport_t* tp, std::shared_ptr<SipDialog> dlg) {
        DR_LOG(log_error) << "SipDialogController::endRetransmitFinalResponse - never received ACK for final response to incoming INVITE; irq:" << 
            std::hex << (void*) irq << " source address was " << dlg->getSourceAddress() ;

        nta_leg_t* leg = const_cast<nta_leg_t *>(dlg->getNtaLeg());
        TimerEventHandle h = dlg->getTimerG() ;
        if( h ) {
            m_pTQM->removeTimer( h, "timerG");
            dlg->clearTimerG();
        }
        h = dlg->getTimerH() ;
        if (h) {
            dlg->clearTimerH();
        }

        IIP_Clear(m_invitesInProgress, leg);


        // we never got the ACK, so now we should tear down the call by sending a BYE
        // TODO: also need to remove dialog from hash table
        nta_outgoing_t* orq = nta_outgoing_tcreate( leg, NULL, NULL,
                                NULL,
                                SIP_METHOD_BYE,
                                NULL,
                                SIPTAG_REASON_STR("SIP ;cause=200 ;text=\"ACK timeout\""),
                                TAG_END() ) ;

        msg_t* m = nta_outgoing_getrequest(orq) ;  // adds a reference
        sip_t* sip = sip_object( m ) ;

        DR_LOG(log_info) << "SipDialogController::endRetransmitFinalResponse - created orq " << std::hex << (void *) orq 
            << " for BYE on leg " << (void *)leg;

        STATS_COUNTER_INCREMENT(STATS_COUNTER_SIP_REQUESTS_OUT, {{"method", "BYE"}})

        string encodedMessage ;
        EncodeStackMessage( sip, encodedMessage ) ;
        SipMsgData_t meta(m, orq) ;
        string s ;
        meta.toMessageFormat(s) ;

        m_pController->getClientController()->route_request_inside_dialog( encodedMessage, meta, sip, "unsolicited", dlg->getDialogId() ) ;

        msg_destroy( m ); // release the reference

        nta_outgoing_destroy(orq) ;
        SD_Clear(m_dialogs, leg);
    }
