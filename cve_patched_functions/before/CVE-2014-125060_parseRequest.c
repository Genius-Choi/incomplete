map<string, string>* parseRequest(const string& request) {
  map<string, string>* headers = new map<string, string>();
  string delim = "\r\n";
  vector<string> lines;
  boost::iter_split(lines, request,
                    boost::first_finder(delim, boost::is_iequal()));
  string method = lines[0].substr(0, lines[0].find(" "));
  (*headers)["method"] = method;
  lines[0] = lines[0].substr(lines[0].find(" ") + 1);
  (*headers)["uri"] = lines[0].substr(0, lines[0].find(" "));
  for (size_t i = 1; i < lines.size(); i++) {
    if (method.compare("POST") == 0 && i == lines.size() - 1) {
      //cout << "params is " << lines[i] << endl;
      (*headers)["params"] = lines[i];
      break;
    } else if (method.compare("GET") == 0 && lines[i].compare("") == 0) {
      break;
    } else if (method.compare("POST") == 0 && lines[i].compare("") == 0) {
      i = lines.size() - 2;
    } else if (method.compare("POST") != 0 || lines[i].compare("") != 0) {
      int mid = lines[i].find(": ");
      string name = lines[i].substr(0, mid);
      string val = lines[i].substr(mid+2, string::npos);
      transform(val.begin(), val.end(), val.begin(), ::tolower);
      (*headers)[name] = val;
    }
  }

  return headers;
}
