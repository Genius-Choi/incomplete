static void mpeg2ps_binary_seek (mpeg2ps_t *ps,
				 mpeg2ps_stream_t *sptr,
				 u64 search_dts,
				 u64 start_dts,
				 u64 start_loc,
				 u64 end_dts,
				u64 end_loc)
{
  u64 dts_perc;
  u64 loc;
  u16 pes_len;
  Bool have_ts = GF_FALSE;
  u64 found_loc;
  u64 found_dts;

  while (1) {
    /*
     * It's not a binary search as much as using a percentage between
     * the start and end dts to start.  We subtract off a bit, so we
     * approach from the beginning of the file - we're more likely to
     * hit a pts that way
     */
    dts_perc = (search_dts - start_dts) * 1000 / (end_dts - start_dts);
    dts_perc -= dts_perc % 10;

    loc = ((end_loc - start_loc) * dts_perc) / 1000;

    if (loc == start_loc || loc == end_loc) return;

    clear_stream_buffer(sptr);
    file_seek_to(sptr->m_fd, start_loc + loc);

    // we'll look for the next pes header for this stream that has a ts.
    do {
      if (search_for_next_pes_header(sptr,
				     &pes_len,
				     &have_ts,
				     &found_loc) == GF_FALSE) {
	return;
      }
      if (have_ts == GF_FALSE) {
	file_skip_bytes(sptr->m_fd, pes_len);
      }
    } while (have_ts == GF_FALSE);

    // record that spot...
    mpeg2ps_record_pts(sptr, found_loc, &sptr->next_pes_ts);

    found_dts = sptr->next_pes_ts.have_dts ?
      sptr->next_pes_ts.dts : sptr->next_pes_ts.pts;
    /*
     * Now, if we're before the search ts, and within 5 seconds,
     * we'll say we're close enough
     */
    if (found_dts + (5 * 90000) > search_dts &&
	found_dts < search_dts) {
      file_seek_to(sptr->m_fd, found_loc);
      return; // found it - we can seek from here
    }
    /*
     * otherwise, move the head or the tail (most likely the head).
     */
    if (found_dts > search_dts) {
      if (found_dts >= end_dts) {
	file_seek_to(sptr->m_fd, found_loc);
	return;
      }
      end_loc = found_loc;
      end_dts = found_dts;
    } else {
      if (found_dts <= start_dts) {
	file_seek_to(sptr->m_fd, found_loc);
	return;
      }
      start_loc = found_loc;
      start_dts = found_dts;
    }
  }
}
