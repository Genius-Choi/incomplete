Resource* ResourceHost::readFile(std::string path, struct stat sb) {
	// Make sure the webserver USER owns the file
	if (!(sb.st_mode & S_IRWXU))
		return NULL;

	std::ifstream file;
	unsigned int len = 0;

	// Open the file
	file.open(path.c_str(), std::ios::binary);

	// Return null if the file failed to open
	if (!file.is_open())
		return NULL;

	// Get the length of the file
	/*file.seekg(0, std::ios::end);
	len = file.tellg();
	file.seekg(0, std::ios::beg);*/
	len = sb.st_size;

	// Allocate memory for contents of file and read in the contents
	byte* fdata = new byte[len];
	file.read((char*)fdata, len);

	// Close the file
	file.close();

	// Create a new Resource object and setup it's contents
	Resource* res = new Resource(path);
	res->setMimeType(lookupMimeType(res->getExtension()));
	res->setData(fdata, len);

	return res;
}
