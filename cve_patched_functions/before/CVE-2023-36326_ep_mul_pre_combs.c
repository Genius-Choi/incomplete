void ep_mul_pre_combs(ep_t *t, const ep_t p) {
	int i, j, l;
	bn_t n;

	bn_null(n);

	RLC_TRY {
		bn_new(n);

		ep_curve_get_ord(n);
		l = RLC_CEIL(bn_bits(n), EP_DEPTH);

#if defined(EP_ENDOM)
		if (ep_curve_is_endom()) {
			l = RLC_CEIL(bn_bits(n), 2 * EP_DEPTH);
		}
#endif

		ep_set_infty(t[0]);

		ep_copy(t[1], p);
		for (j = 1; j < EP_DEPTH; j++) {
			ep_dbl(t[1 << j], t[1 << (j - 1)]);
			for (i = 1; i < l; i++) {
				ep_dbl(t[1 << j], t[1 << j]);
			}
#if defined(EP_MIXED)
			ep_norm(t[1 << j], t[1 << j]);
#endif
			for (i = 1; i < (1 << j); i++) {
				ep_add(t[(1 << j) + i], t[i], t[1 << j]);
			}
		}

		ep_norm_sim(t + 2, (const ep_t *)t + 2, RLC_EP_TABLE_COMBS - 2);
	}
	RLC_CATCH_ANY {
		RLC_THROW(ERR_CAUGHT);
	}
	RLC_FINALLY {
		bn_free(n);
	}
}
