xrdp_mm_check_wait_objs(struct xrdp_mm *self)
{
    int rv;

    if (self == 0)
    {
        return 0;
    }

    rv = 0;

    if (self->sesman_trans != NULL &&
            !self->delete_sesman_trans &&
            self->sesman_trans->status == TRANS_STATUS_UP)
    {
        if (trans_check_wait_objs(self->sesman_trans) != 0)
        {
            if (self->mmcs_expecting_msg)
            {
                /* The sesman transport has failed with an
                 * outstanding message */
                xrdp_wm_log_msg(self->wm, LOG_LEVEL_ERROR,
                                "Unexpected sesman failure - check sesman log");
                xrdp_wm_mod_connect_done(self->wm, 1);
            }
            self->delete_sesman_trans = 1;
            if (self->wm->hide_log_window)
            {
                /* if hide_log_window, this is fatal */
                rv = 1;
            }
        }
    }
    if (self->delete_sesman_trans)
    {
        trans_delete(self->sesman_trans);
        self->sesman_trans = NULL;
    }

    if (self->chan_trans != NULL &&
            self->chan_trans->status == TRANS_STATUS_UP)
    {
        if (trans_check_wait_objs(self->chan_trans) != 0)
        {
            /* This is safe to do here, as we're not in a chansrv
             * transport callback */
            trans_delete(self->chan_trans);
            self->chan_trans = NULL;
        }
    }

    if (self->mod != NULL)
    {
        if (self->mod->mod_check_wait_objs != NULL)
        {
            rv = self->mod->mod_check_wait_objs(self->mod);
        }
    }

    if (g_is_wait_obj_set(self->resize_ready))
    {
        g_reset_wait_obj(self->resize_ready);
        dynamic_monitor_process_queue(self);
    }

    if (self->encoder != NULL)
    {
        if (g_is_wait_obj_set(self->encoder->xrdp_encoder_event_processed))
        {
            g_reset_wait_obj(self->encoder->xrdp_encoder_event_processed);
            xrdp_mm_process_enc_done(self);
        }
    }

    if (self->wm->screen_dirty_region != NULL)
    {
        if (xrdp_region_not_empty(self->wm->screen_dirty_region))
        {
            int now = g_time3();
            int diff = now - self->wm->last_screen_draw_time;
            LOG_DEVEL(LOG_LEVEL_TRACE, "xrdp_mm_check_wait_objs: not empty diff %d", diff);
            if ((diff < 0) || (diff >= 40))
            {
                if (self->egfx_up)
                {
                    rv = xrdp_mm_draw_dirty(self);
                    xrdp_region_delete(self->wm->screen_dirty_region);
                    self->wm->screen_dirty_region = NULL;
                    self->wm->last_screen_draw_time = now;
                }
                else
                {
                    LOG(LOG_LEVEL_TRACE, "xrdp_mm_check_wait_objs: egfx is not up");
                }
            }
        }
    }

    return rv;
}
