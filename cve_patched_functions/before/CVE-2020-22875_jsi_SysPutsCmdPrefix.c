void jsi_SysPutsCmdPrefix(Jsi_Interp *interp, jsi_LogOptions *popts,Jsi_DString *dStr, int* quote, const char **fnPtr) {
    int didx = 0;
    const char *cp;
    const char *fn = interp->curIp->fname;
    if (fn && !popts->full && (cp=Jsi_Strrchr(fn, '/')))
        fn = cp +1;
    if (popts->time || (didx=popts->date)) {
        if (popts->time && popts->date)
            didx = 2;
        const char *fmts[3] = { "%H:%M:%S.%f", "%F", "%F %H:%M:%S.%f" },
            *fmt = (popts->timeFmt?popts->timeFmt:fmts[didx]);
        Jsi_DatetimeFormat(interp, Jsi_DateTime(), fmt, popts->isUTC, dStr);
        Jsi_DSAppend(dStr, ", ", NULL);
    }
    if (popts->file && popts->before) {
        Jsi_DSPrintf(dStr, "%s:%d: ", fn, interp->curIp->Line);
        if (interp->curIp->Line<1000)
            Jsi_DSAppend(dStr, (interp->curIp->Line<10?"  ":" "), NULL);
    }
    if (Jsi_DSLength(dStr)) {
        *quote = 1;
    }
    if (*quote)
        Jsi_DSAppendLen(dStr, "\"", 1);
    if (fnPtr)
        *fnPtr = fn;

}
