void HTTPServer::stop() {
	canRun = false;

	if (listenSocket != INVALID_SOCKET) {
		// Close all open connections and delete Client's from memory
		for (auto& x : clientMap)
			disconnectClient(x.second, false);

		// Clear the map
		clientMap.clear();

		// Remove listening socket from kqueue
		updateEvent(listenSocket, EVFILT_READ, EV_DELETE, 0, 0, NULL);

		// Shudown the listening socket and release it to the OS
		shutdown(listenSocket, SHUT_RDWR);
		close(listenSocket);
		listenSocket = INVALID_SOCKET;
	}

	if (kqfd != -1) {
		close(kqfd);
		kqfd = -1;
	}

	std::cout << "Server shutdown!" << std::endl;
}
