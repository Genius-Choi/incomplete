SendMessage(int fd, uint8_t* data, int dataSz)
{
	int bytesRemaining = dataSz;
	int offset = 0;

	while (bytesRemaining > 0)
	{
		ssize_t count = send(fd, &data[offset], bytesRemaining, MSG_NOSIGNAL);
		if (-1 == count)
		{
			if ((EINTR == errno) || (EAGAIN == errno))
			{
				continue;
			}

			WPRINTF(("Failed to send!"));
			return errno;
		}

		bytesRemaining -= count;
		offset += count;
	}
	return 0;
}
