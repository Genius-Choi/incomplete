pk_transaction_emit_properties_changed (PkTransaction *transaction,
                                        const gchar   *first_property_name,
                                        GVariant      *first_property_value,
                                        ...)
{
	GVariantBuilder builder;
	GVariantBuilder invalidated_builder;
	va_list args;
	const gchar *property_name;
	GVariant *property_value;

	/* build the dict */
	g_variant_builder_init (&invalidated_builder, G_VARIANT_TYPE ("as"));
	g_variant_builder_init (&builder, G_VARIANT_TYPE_ARRAY);

	va_start (args, first_property_value);

	for (property_name = first_property_name, property_value = first_property_value;
	     property_name != NULL;
	     property_name = va_arg (args, const gchar *), property_value = (property_name != NULL) ? va_arg (args, GVariant *) : NULL) {
		g_variant_builder_add (&builder,
				       "{sv}",
				       property_name,
				       property_value);
	}

	va_end (args);

	g_dbus_connection_emit_signal (transaction->priv->connection,
				       NULL,
				       transaction->priv->tid,
				       "org.freedesktop.DBus.Properties",
				       "PropertiesChanged",
				       g_variant_new ("(sa{sv}as)",
						      PK_DBUS_INTERFACE_TRANSACTION,
						      &builder,
						      &invalidated_builder),
				       NULL);
}
