static HTTPAPI_RESULT ReceiveContentInfoFromXIO(HTTP_HANDLE_DATA* http_instance, HTTP_HEADERS_HANDLE responseHeadersHandle, size_t* bodyLength, bool* chunked)
{
    HTTPAPI_RESULT result;
    char    buf[TEMP_BUFFER_SIZE];
    const char* substr;
    char* whereIsColon;
    int lengthInMsg;
    const char ContentLength[] = "content-length:";
    const size_t ContentLengthSize = sizeof(ContentLength) - 1;
    const char TransferEncoding[] = "transfer-encoding:";
    const size_t TransferEncodingSize = sizeof(TransferEncoding) - 1;
    const char Chunked[] = "chunked";
    const size_t ChunkedSize = sizeof(Chunked) - 1;

    http_instance->is_io_error = 0;

    //Read HTTP response headers
    if (readLine(http_instance, buf, sizeof(buf)) < 0)
    {
        /*Codes_SRS_HTTPAPI_COMPACT_21_032: [ If the HTTPAPI_ExecuteRequest cannot read the message with the request result, it shall return HTTPAPI_READ_DATA_FAILED. ]*/
        /*Codes_SRS_HTTPAPI_COMPACT_21_082: [ If the HTTPAPI_ExecuteRequest retries 20 seconds to receive the message without success, it shall fail and return HTTPAPI_READ_DATA_FAILED. ]*/
        result = HTTPAPI_READ_DATA_FAILED;
    }
    else
    {
        /*Codes_SRS_HTTPAPI_COMPACT_21_033: [ If the whole process succeed, the HTTPAPI_ExecuteRequest shall retur HTTPAPI_OK. ]*/
        result = HTTPAPI_OK;

        while (*buf && (result == HTTPAPI_OK))
        {
            if (InternStrnicmp(buf, ContentLength, ContentLengthSize) == 0)
            {
                substr = buf + ContentLengthSize;
                if (ParseStringToDecimal(substr, &lengthInMsg) != 1)
                {
                    /*Codes_SRS_HTTPAPI_COMPACT_21_032: [ If the HTTPAPI_ExecuteRequest cannot read the message with the request result, it shall return HTTPAPI_READ_DATA_FAILED. ]*/
                    result = HTTPAPI_READ_DATA_FAILED;
                }
                else
                {
                    (*bodyLength) = (size_t)lengthInMsg;
                }
            }
            else if (InternStrnicmp(buf, TransferEncoding, TransferEncodingSize) == 0)
            {
                substr = buf + TransferEncodingSize;

                while (isspace(*substr)) substr++;

                if (InternStrnicmp(substr, Chunked, ChunkedSize) == 0)
                {
                    (*chunked) = true;
                }
            }

            if (result == HTTPAPI_OK)
            {
                whereIsColon = strchr((char*)buf, ':');
                /*Codes_SRS_HTTPAPI_COMPACT_21_049: [ If responseHeadersHandle is provide, the HTTPAPI_ExecuteRequest shall prepare a Response Header usign the HTTPHeaders_AddHeaderNameValuePair. ]*/
                if (whereIsColon && (responseHeadersHandle != NULL))
                {
                    *whereIsColon = '\0';
                    HTTPHeaders_AddHeaderNameValuePair(responseHeadersHandle, buf, whereIsColon + 1);
                }

                if (readLine(http_instance, buf, sizeof(buf)) < 0)
                {
                    /*Codes_SRS_HTTPAPI_COMPACT_21_032: [ If the HTTPAPI_ExecuteRequest cannot read the message with the request result, it shall return HTTPAPI_READ_DATA_FAILED. ]*/
                    /*Codes_SRS_HTTPAPI_COMPACT_21_082: [ If the HTTPAPI_ExecuteRequest retries 20 seconds to receive the message without success, it shall fail and return HTTPAPI_READ_DATA_FAILED. ]*/
                    result = HTTPAPI_READ_DATA_FAILED;
                }
            }
        }
    }

    return result;
}
