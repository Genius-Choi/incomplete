vhost_net_stop(struct vhost_net *vhost_net)
{
	int rc;

	if (!vhost_net->vhost_started) {
		WPRINTF(("vhost net already stopped\n"));
		return 0;
	}

	/* if the backend is the TAP */
	if (vhost_net->tapfd > 0)
		vhost_net_set_backend(&vhost_net->vdev, -1);

	rc = vhost_dev_stop(&vhost_net->vdev);
	if (rc < 0)
		WPRINTF(("vhost_dev_stop failed\n"));

	vhost_net->vhost_started = false;
	return rc;
}
