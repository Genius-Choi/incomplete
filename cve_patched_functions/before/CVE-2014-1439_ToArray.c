Array c_SimpleXMLElement::ToArray(const ObjectData* obj) {
  auto thiz = static_cast<const c_SimpleXMLElement*>(obj);
  Array ret = Array::Create();
  if (!thiz->m_attributes.toArray().empty()) {
    ret.set(s_attributes, thiz->m_attributes);
  }
  ret += thiz->m_children;

  for (ArrayIter iter(ret); iter; ++iter) {
    if (iter.second().isObject()) {
      c_SimpleXMLElement *elem = iter.second().toObject().
        getTyped<c_SimpleXMLElement>();
      elem->m_is_array = true;
      // String elements are implicitly converted.
      if (elem->m_is_text) {
        ret.set(iter.first(), elem->t___tostring());
      }
    }
  }
  return ret;
}
