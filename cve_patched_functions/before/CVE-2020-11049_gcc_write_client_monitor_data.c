void gcc_write_client_monitor_data(wStream* s, rdpMcs* mcs)
{
	UINT32 i;
	UINT16 length;
	UINT32 left, top, right, bottom, flags;
	INT32 baseX = 0, baseY = 0;
	rdpSettings* settings = mcs->settings;

	if (settings->MonitorCount > 1)
	{
		length = (20 * settings->MonitorCount) + 12;
		gcc_write_user_data_header(s, CS_MONITOR, length);
		Stream_Write_UINT32(s, 0);                      /* flags */
		Stream_Write_UINT32(s, settings->MonitorCount); /* monitorCount */

		/* first pass to get the primary monitor coordinates (it is supposed to be
		 * in (0,0) */
		for (i = 0; i < settings->MonitorCount; i++)
		{
			if (settings->MonitorDefArray[i].is_primary)
			{
				baseX = settings->MonitorDefArray[i].x;
				baseY = settings->MonitorDefArray[i].y;
				break;
			}
		}

		for (i = 0; i < settings->MonitorCount; i++)
		{
			left = settings->MonitorDefArray[i].x - baseX;
			top = settings->MonitorDefArray[i].y - baseY;
			right = left + settings->MonitorDefArray[i].width - 1;
			bottom = top + settings->MonitorDefArray[i].height - 1;
			flags = settings->MonitorDefArray[i].is_primary ? MONITOR_PRIMARY : 0;
			Stream_Write_UINT32(s, left);   /* left */
			Stream_Write_UINT32(s, top);    /* top */
			Stream_Write_UINT32(s, right);  /* right */
			Stream_Write_UINT32(s, bottom); /* bottom */
			Stream_Write_UINT32(s, flags);  /* flags */
		}
	}
}
