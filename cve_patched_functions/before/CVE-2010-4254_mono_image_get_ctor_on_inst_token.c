mono_image_get_ctor_on_inst_token (MonoDynamicImage *assembly, MonoReflectionCtorOnTypeBuilderInst *c, gboolean create_methodspec)
{
	guint32 sig, token;
	MonoClass *klass;
	MonoGenericClass *gclass;
	MonoDynamicGenericClass *dgclass;
	MonoReflectionCtorBuilder *cb = c->cb;
	ReflectionMethodBuilder rmb;
	MonoType *type;
	char *name;

	/* A ctor cannot be a generic method, so we can ignore create_methodspec */

	token = GPOINTER_TO_UINT (g_hash_table_lookup (assembly->handleref, c));
	if (token)
		return token;
	type = mono_reflection_type_get_handle ((MonoReflectionType*)c->inst);
	klass = mono_class_from_mono_type (type);
	gclass = type->data.generic_class;
	g_assert (gclass->is_dynamic);
	dgclass = (MonoDynamicGenericClass *) gclass;

	reflection_methodbuilder_from_ctor_builder (&rmb, cb);

	name = mono_string_to_utf8 (rmb.name);

	sig = method_builder_encode_signature (assembly, &rmb);

	token = mono_image_get_memberref_token (assembly, &klass->byval_arg, name, sig);
	g_free (name);

	g_hash_table_insert (assembly->handleref, c, GUINT_TO_POINTER (token));
	return token;
}
