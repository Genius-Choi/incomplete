static void _stitch_ecall_stack(oe_sgx_td_t* td, uint64_t* first_enclave_frame)
{
    oe_ecall_context_t* ecall_context = td->host_ecall_context;

    if (oe_is_enclave_debug_allowed())
    {
        if (oe_is_outside_enclave(ecall_context, sizeof(*ecall_context)))
        {
            uint64_t host_rbp = ecall_context->debug_eenter_rbp;
            uint64_t host_rip = ecall_context->debug_eenter_rip;

            /* Check that the supplied host frame (hpst_rbp, host_rip) are set
             * and really lies outside before stitching the stack */
            if (oe_is_outside_enclave((void*)host_rbp, sizeof(uint64_t)) &&
                oe_is_outside_enclave((void*)host_rip, sizeof(uint64_t)))
            {
                first_enclave_frame[0] = host_rbp;
                first_enclave_frame[1] = host_rip;
            }
        }
    }
}
