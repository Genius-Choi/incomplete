Perl_quadmath_format_single(const char* format)
{
    STRLEN len;

    PERL_ARGS_ASSERT_QUADMATH_FORMAT_SINGLE;

    if (format[0] != '%' || strchr(format + 1, '%'))
        return NULL;
    len = strlen(format);
    /* minimum length three: %Qg */
    if (len < 3 || strchr("efgaEFGA", format[len - 1]) == NULL)
        return NULL;
    if (format[len - 2] != 'Q') {
        char* fixed;
        Newx(fixed, len + 1, char);
        memcpy(fixed, format, len - 1);
        fixed[len - 1] = 'Q';
        fixed[len    ] = format[len - 1];
        fixed[len + 1] = 0;
        return (const char*)fixed;
    }
    return format;
}
