static void lhs(void) {
	uint8_t k[S][K];
	bn_t m, n, msg[L], sk[S], d[S], x[S][L];
	g1_t _r, h, as[S], cs[S], sig[S];
	g1_t a[S][L], c[S][L], r[S][L];
	g2_t _s, s[S][L], pk[S], y[S], z[S];
	gt_t *hs[S], vk;
	const char *data = "id";
	const char *id[S] = { "0", "1", "2", "3", "4", "5", "6", "7", "8", "9"};
	dig_t ft[S], *f[S];
	size_t flen[S];
	int label[L];

	bn_null(m);
	bn_null(n);
	g1_null(h);
	g1_null(_r);
	g2_null(_s);
	gt_null(vk);

	bn_new(m);
	bn_new(n);
	g1_new(h);
	g1_new(_r);
	g2_new(_s);
	gt_new(vk);

	pc_get_ord(n);
	for (int i = 0; i < L; i++) {
		bn_null(msg[i]);
		bn_new(msg[i]);
		bn_rand_mod(msg[i], n);
	}
	for (int i = 0; i < S; i++) {
		hs[i] = RLC_ALLOCA(gt_t, RLC_TERMS);
		for (int j = 0; j < RLC_TERMS; j++) {
			gt_null(hs[i][j]);
			gt_new(hs[i][j]);
		}
		for (int j = 0; j < L; j++) {
			bn_null(x[i][j]);
			g1_null(a[i][j]);
			g1_null(c[i][j]);
			g1_null(r[i][j]);
			g2_null(s[i][j]);
			bn_new(x[i][j]);
			g1_new(a[i][j]);
			g1_new(c[i][j]);
			g1_new(r[i][j]);
			g2_new(s[i][j]);
		}
		bn_null(sk[i]);
		bn_null(d[i]);
		g1_null(sig[i]);
		g1_null(as[i]);
		g1_null(cs[i]);
		g2_null(y[i]);
		g2_null(z[i]);
		g2_null(pk[i]);

		bn_new(sk[i]);
		bn_new(d[i]);
		g1_new(sig[i]);
		g1_new(as[i]);
		g1_new(cs[i]);
		g2_new(y[i]);
		g2_new(z[i]);
		g2_new(pk[i]);
	}

	/* Define linear function. */
	for (int i = 0; i < S; i++) {
		f[i] = RLC_ALLOCA(dig_t, RLC_TERMS);
		for (int j = 0; j < RLC_TERMS; j++) {
			uint32_t t;
			rand_bytes((uint8_t *)&t, sizeof(uint32_t));
			f[i][j] = t;
		}
		flen[i] = L;
	}

	/* Initialize scheme for messages of single components. */
	cp_cmlhs_init(h);

	BENCH_ONE("cp_cmlhs_gen (ecdsa)",
		for (int j = 0; j < S; j++) {
			cp_cmlhs_gen(x[j], hs[j], L, k[j], K, sk[j], pk[j], d[j], y[j], 0);
		},
	S);

	BENCH_FEW("cp_cmlhs_sig (ecdsa)",
		/* Compute all signatures. */
		for (int j = 0; j < S; j++) {
			for (int l = 0; l < L; l++) {
				label[l] = l;
				bn_mod(msg[l], msg[l], n);
				cp_cmlhs_sig(sig[j], z[j], a[j][l], c[j][l], r[j][l], s[j][l],
					msg[l], data, label[l], x[j][l], h, k[j], K, d[j], sk[j], 0);
			}
		},
	S * L);

	BENCH_RUN("cp_cmlhs_fun") {
		for (int j = 0; j < S; j++) {
			BENCH_ADD(cp_cmlhs_fun(as[j], cs[j], a[j], c[j], f[j], L));
		}
	} BENCH_DIV(S);

	BENCH_RUN("cp_cmlhs_evl") {
		cp_cmlhs_evl(_r, _s, r[0], s[0], f[0], L);
		for (int j = 1; j < S; j++) {
			BENCH_ADD(cp_cmlhs_evl(r[0][0], s[0][0], r[j], s[j], f[j], L));
			g1_add(_r, _r, r[0][0]);
			g2_add(_s, _s, s[0][0]);
		}
		g1_norm(_r, _r);
		g2_norm(_s, _s);
	} BENCH_DIV(S);

	bn_zero(m);
	for (int j = 0; j < L; j++) {
		dig_t sum = 0;
		for (int l = 0; l < S; l++) {
			sum += f[l][j];
		}
		bn_mul_dig(msg[j], msg[j], sum);
		bn_add(m, m, msg[j]);
		bn_mod(m, m, n);
	}

	BENCH_RUN("cp_cmlhs_ver (ecdsa)") {
		BENCH_ADD(cp_cmlhs_ver(_r, _s, sig, z, as, cs, m, data, h, label,
			(const gt_t **)hs, (const dig_t **)f, flen, y, pk, S, 0));
	} BENCH_DIV(S);

	BENCH_RUN("cp_cmlhs_off") {
		BENCH_ADD(cp_cmlhs_off(vk, h, label, (const gt_t **)hs,
			(const dig_t **)f, flen, S));
	} BENCH_DIV(S);

	BENCH_RUN("cp_cmlhs_onv (ecdsa)") {
		BENCH_ADD(cp_cmlhs_onv(_r, _s, sig, z, as, cs, m, data, h, vk, y,
			pk, S, 0));
	} BENCH_DIV(S);

	BENCH_ONE("cp_cmlhs_gen (bls)",
		for (int j = 0; j < S; j++) {
			cp_cmlhs_gen(x[j], hs[j], L, k[j], K, sk[j], pk[j], d[j], y[j], 1);
		},
	S);

	BENCH_FEW("cp_cmlhs_sig (bls)",
		/* Compute all signatures. */
		for (int j = 0; j < S; j++) {
			for (int l = 0; l < L; l++) {
				label[l] = l;
				bn_mod(msg[l], msg[l], n);
				cp_cmlhs_sig(sig[j], z[j], a[j][l], c[j][l], r[j][l], s[j][l],
					msg[l], data, label[l], x[j][l], h, k[j], K, d[j], sk[j], 1);
			}
		},
	S * L);

	BENCH_RUN("cp_cmlhs_fun") {
		for (int j = 0; j < S; j++) {
			BENCH_ADD(cp_cmlhs_fun(as[j], cs[j], a[j], c[j], f[j], L));
		}
	} BENCH_DIV(S);

	BENCH_RUN("cp_cmlhs_evl") {
		cp_cmlhs_evl(_r, _s, r[0], s[0], f[0], L);
		for (int j = 1; j < S; j++) {
			BENCH_ADD(cp_cmlhs_evl(r[0][0], s[0][0], r[j], s[j], f[j], L));
			g1_add(_r, _r, r[0][0]);
			g2_add(_s, _s, s[0][0]);
		}
		g1_norm(_r, _r);
		g2_norm(_s, _s);
	} BENCH_DIV(S);

	bn_zero(m);
	for (int j = 0; j < L; j++) {
		dig_t sum = 0;
		for (int l = 0; l < S; l++) {
			sum += f[l][j];
		}
		bn_mul_dig(msg[j], msg[j], sum);
		bn_add(m, m, msg[j]);
		bn_mod(m, m, n);
	}

	BENCH_RUN("cp_cmlhs_ver (bls)") {
		BENCH_ADD(cp_cmlhs_ver(_r, _s, sig, z, as, cs, m, data, h, label,
			(const gt_t **)hs, (const dig_t **)f, flen, y, pk, S, 1));
	} BENCH_DIV(S);

	BENCH_RUN("cp_cmlhs_off") {
		BENCH_ADD(cp_cmlhs_off(vk, h, label, (const gt_t **)hs,
			(const dig_t **)f, flen, S));
	} BENCH_DIV(S);

	BENCH_RUN("cp_cmlhs_onv (bls)") {
		BENCH_ADD(cp_cmlhs_onv(_r, _s, sig, z, as, cs, m, data, h, vk, y,
			pk, S, 1));
	} BENCH_DIV(S);

#ifdef BENCH_LHS
	for (int t = 1; t <= S; t++) {
		util_print("(%2d ids) ", t);
		BENCH_RUN("cp_cmlhs_ver") {
			BENCH_ADD(cp_cmlhs_ver(_r, _s, sig, z, as, cs, m, data, h, label,
				hs, f, flen, y, pk, t));
		} BENCH_END;

		util_print("(%2d ids) ", t);
		BENCH_RUN("cp_cmlhs_off") {
			BENCH_ADD(cp_cmlhs_off(vk, h, label, hs, f, flen, y, pk, t));
		} BENCH_END;

		util_print("(%2d ids) ", t);
		BENCH_RUN("cp_cmlhs_onv") {
			BENCH_ADD(cp_cmlhs_onv(_r, _s, sig, z, as, cs, m, data, h, vk, y,
				pk, t));
		} BENCH_END;
	}

	for (int t = 1; t <= L; t++) {
		util_print("(%2d lbs) ", t);
		for (int u = 0; u < S; u++) {
			flen[u] = t;
		}
		BENCH_RUN("cp_cmlhs_ver") {
			BENCH_ADD(cp_cmlhs_ver(_r, _s, sig, z, as, cs, m, data, h, label,
				hs,	f, flen, y, pk, S));
		} BENCH_END;

		util_print("(%2d lbs) ", t);
		BENCH_RUN("cp_cmlhs_off") {
			BENCH_ADD(cp_cmlhs_off(vk, h, label, hs, f, flen, y, pk, t));
		} BENCH_END;

		util_print("(%2d lbs) ", t);
		BENCH_RUN("cp_cmlhs_onv") {
			BENCH_ADD(cp_cmlhs_onv(_r, _s, sig, z, as, cs, m, data, h, vk, y,
				pk, t));
		} BENCH_END;
	}
#endif  /* BENCH_LHS */

	char *ls[L];

	BENCH_RUN("cp_mklhs_gen") {
		for (int j = 0; j < S; j++) {
			BENCH_ADD(cp_mklhs_gen(sk[j], pk[j]));
		}
	} BENCH_DIV(S);

	BENCH_RUN("cp_mklhs_sig") {
		for (int j = 0; j < S; j++) {
			for (int l = 0; l < L; l++) {
				ls[l] = "l";
				bn_mod(msg[l], msg[l], n);
				BENCH_ADD(cp_mklhs_sig(a[j][l], msg[l], data,
					id[j], ls[l], sk[j]));
			}
		}
	} BENCH_DIV(S * L);

	BENCH_RUN("cp_mklhs_fun") {
		for (int j = 0; j < S; j++) {
			bn_zero(d[j]);
			BENCH_ADD(cp_mklhs_fun(d[j], msg, f[j], L));
		}
	}
	BENCH_DIV(S);

	BENCH_RUN("cp_mklhs_evl") {
		g1_set_infty(_r);
		for (int j = 0; j < S; j++) {
			BENCH_ADD(cp_mklhs_evl(r[0][j], a[j], f[j], L));
			g1_add(_r, _r, r[0][j]);
		}
		g1_norm(_r, _r);
	}
	BENCH_DIV(S);

	bn_zero(m);
	for (int j = 0; j < L; j++) {
		dig_t sum = 0;
		for (int l = 0; l < S; l++) {
			sum += f[l][j];
		}
		bn_mul_dig(msg[j], msg[j], sum);
		bn_add(m, m, msg[j]);
		bn_mod(m, m, n);
	}

	BENCH_RUN("cp_mklhs_ver") {
		BENCH_ADD(cp_mklhs_ver(_r, m, d, data, id, (const char **)ls,
			(const dig_t **)f, flen, pk, S));
	} BENCH_DIV(S);

	BENCH_RUN("cp_mklhs_off") {
		BENCH_ADD(cp_mklhs_off(cs, ft, id, (const char **)ls, (const dig_t **)f,
			flen, S));
	} BENCH_DIV(S);

	BENCH_RUN("cp_mklhs_onv") {
		BENCH_ADD(cp_mklhs_onv(_r, m, d, data, id, cs, ft, pk, S));
	} BENCH_DIV(S);

#ifdef BENCH_LHS
	for (int t = 1; t <= S; t++) {
		util_print("(%2d ids) ", t);
		BENCH_RUN("cp_mklhs_ver") {
			BENCH_ADD(cp_mklhs_ver(_r, m, d, data, id, ls, f, flen, pk, t));
		} BENCH_END;

		util_print("(%2d ids) ", t);
		BENCH_RUN("cp_mklhs_off") {
			BENCH_ADD(cp_mklhs_off(cs, ft, id, ls, f, flen, t));
		} BENCH_END;

		util_print("(%2d ids) ", t);
		BENCH_RUN("cp_mklhs_onv") {
			BENCH_ADD(cp_mklhs_onv(_r, m, d, data, id, cs, ft, pk, t));
		} BENCH_END;
	}

	for (int t = 1; t <= L; t++) {
		util_print("(%2d lbs) ", t);
		for (int u = 0; u < S; u++) {
			flen[u] = t;
		}
		BENCH_RUN("cp_mklhs_ver") {
			BENCH_ADD(cp_mklhs_ver(_r, m, d, data, id, ls, f, flen, pk, S));
		} BENCH_END;

		util_print("(%2d lbs) ", t);
		BENCH_RUN("cp_mklhs_off") {
			BENCH_ADD(cp_mklhs_off(cs, ft, id, ls, f, flen, S));
		} BENCH_END;

		util_print("(%2d lbs) ", t);
		BENCH_RUN("cp_mklhs_onv") {
			BENCH_ADD(cp_mklhs_onv(_r, m, d, data, id, cs, ft, pk, S));
		} BENCH_END;
	}
#endif /* BENCH_LHS */

	bn_free(n);
	bn_free(m);
	g1_free(h);
	g1_free(_r);
	g2_free(_s);
	gt_free(vk);

	for (int i = 0; i < L; i++) {
		bn_free(msg[i]);
	}
	for (int i = 0; i < S; i++) {
		RLC_FREE(f[i]);
		for (int j = 0; j < RLC_TERMS; j++) {
			gt_free(hs[i][j]);
		}
		RLC_FREE(hs[i]);
		for (int j = 0; j < L; j++) {
			bn_free(x[i][j]);
			g1_free(a[i][j]);
			g1_free(c[i][j]);
			g1_free(r[i][j]);
			g2_free(s[i][j]);
		}
		bn_free(sk[i]);
		bn_free(d[i]);
		g1_free(sig[i]);
		g1_free(as[i]);
		g1_free(cs[i]);
		g2_free(y[i]);
		g2_free(z[i]);
		g2_free(pk[i]);
	}
}
