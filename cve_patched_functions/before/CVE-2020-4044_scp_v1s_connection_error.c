scp_v1s_connection_error(struct SCP_CONNECTION *c, const char *error)
{
    tui16 len;

    len = g_strlen(error);
    init_stream(c->out_s, c->out_s->size);

    out_uint32_be(c->out_s, 1);
    /* packet size: 4 + 4 + 2 + 2 + len */
    /* version + size + cmdset + cmd */
    out_uint32_be(c->out_s, (12 + len));
    out_uint16_be(c->out_s, SCP_COMMAND_SET_DEFAULT);
    out_uint16_be(c->out_s, SCP_CMD_CONN_ERROR);

    if (0 != scp_tcp_force_send(c->in_sck, c->out_s->data, (12 + len)))
    {
        return SCP_SERVER_STATE_NETWORK_ERR;
    }

    return SCP_SERVER_STATE_END;
}
