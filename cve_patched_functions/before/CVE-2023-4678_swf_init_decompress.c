static void swf_init_decompress(SWFReader *read)
{
	u32 size, dst_size;
	uLongf destLen;
	char *src, *dst;

	size = (u32) gf_bs_get_size(read->bs)-8;
	if (gf_bs_get_size(read->bs) - 8 >= (u64)1<<31) {
		gf_bs_del(read->bs);
		read->bs = NULL;
		return;
	}
	dst_size = read->length;
	src = gf_malloc(sizeof(char)*size);
	dst = gf_malloc(sizeof(char)*dst_size);
	memset(dst, 0, sizeof(char)*8);
	gf_bs_read_data(read->bs, src, size);
	dst_size -= 8;
	destLen = (uLongf)dst_size;
	uncompress((Bytef *) dst+8, &destLen, (Bytef *) src, size);
	dst_size += 8;
	gf_free(src);
	read->mem = dst;
	gf_bs_del(read->bs);
	read->bs = gf_bs_new(read->mem, dst_size, GF_BITSTREAM_READ);
	gf_bs_skip_bytes(read->bs, 8);
}
