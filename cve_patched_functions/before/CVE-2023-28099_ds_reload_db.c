int ds_reload_db(ds_partition_t *partition)
{
	ds_data_t *old_data;
	ds_data_t *new_data;

	new_data = ds_load_data(partition, ds_persistent_state);
	if (new_data==NULL) {
		LM_ERR("failed to load the new data, dropping the reload\n");
		return -1;
	}

	lock_start_write( partition->lock );

	/* no more activ readers -> do the swapping */
	old_data = *partition->data;
	*partition->data = new_data;

	lock_stop_write( partition->lock );

	/* destroy old data */
	if (old_data) {
		/* copy the state of the destinations from the old set
		 * (for the matching ids) */
		ds_inherit_state( old_data, new_data);
		ds_destroy_data_set( old_data );
	}

	/* update the Black Lists with the new gateways */
	populate_ds_bls( new_data->sets, partition->name);

	return 0;
}
