static int decode_bgp_mup_nlri_type2_st_route(proto_tree *tree, tvbuff_t *tvb, gint offset, packet_info *pinfo,
                                              guint16 afi, guint8 architecture_type) {
    /*
        +-----------------------------------+
        |           RD  (8 octets)          |
        +-----------------------------------+
        |      Endpoint Length (1 octet)    |
        +-----------------------------------+
        |      Endpoint Address (variable)  |
        +-----------------------------------+
        | Architecture specific Endpoint    |
        |         Identifier (variable)     |
        +-----------------------------------+
    */
    int reader_offset = offset;
    guint32 total_length = 0;

    proto_item  *rd_pi;
    int         byte_length = 0;
    ws_in4_addr ipv4_prefix;
    address     ipv4_prefix_addr;
    ws_in6_addr ipv6_prefix;
    address     ipv6_prefix_addr;
    gchar       *prefix_str;
    guint8      prefix_length = 0;
    guint8      endpoint_length = 0;

    guint8      arch_spec_endpoint_length = 0;
    proto_item  *arch_spec_item;
    proto_tree  *arch_spec_tree;
    guint32     arch_spec_3gpp_5g_teid;

    rd_pi = proto_tree_add_item(tree, hf_bgp_mup_nlri_rd, tvb, reader_offset, 8, ENC_NA);
    proto_item_append_text(rd_pi, " (%s)", decode_bgp_rd(pinfo->pool, tvb, reader_offset));
    reader_offset += 8;

    endpoint_length = tvb_get_guint8(tvb, reader_offset);
    proto_tree_add_item(tree, hf_bgp_mup_nlri_ep_len, tvb, reader_offset, 1, ENC_BIG_ENDIAN);
    reader_offset++;

    switch (afi) {
    case AFNUM_INET:
        prefix_length = endpoint_length>32 ? 32 : endpoint_length;
        byte_length = tvb_get_ipv4_addr_with_prefix_len(tvb, reader_offset, &ipv4_prefix, prefix_length);
        set_address(&ipv4_prefix_addr, AT_IPv4, 4, &ipv4_prefix);
        prefix_str = address_to_str(pinfo->pool, &ipv4_prefix_addr);

        proto_tree_add_ipv4_format_value(tree, hf_bgp_mup_nlri_ep_ip_addr, tvb, reader_offset, byte_length,
                                         ipv4_prefix, "%s/%d", prefix_str, prefix_length);
        reader_offset += byte_length;

        if (endpoint_length>32) {
            arch_spec_endpoint_length = endpoint_length - 32;
        }
        break;
    case AFNUM_INET6:
        prefix_length = endpoint_length>128 ? 128 : endpoint_length;
        byte_length = tvb_get_ipv6_addr_with_prefix_len(tvb, reader_offset, &ipv6_prefix, prefix_length);
        set_address(&ipv6_prefix_addr, AT_IPv6, 16, ipv6_prefix.bytes);
        prefix_str = address_to_str(pinfo->pool, &ipv6_prefix_addr);

        proto_tree_add_ipv6_format_value(tree, hf_bgp_mup_nlri_ep_ipv6_addr, tvb, reader_offset, byte_length,
                        &ipv6_prefix, "%s/%d", prefix_str, prefix_length);
        reader_offset += byte_length;

        if (endpoint_length>128) {
            arch_spec_endpoint_length = endpoint_length - 128;
        }
        break;
    }
    if (arch_spec_endpoint_length>0) {
        switch (architecture_type) {
        case BGP_MUP_AT_3GPP_5G:
            /*
            +-----------------------------------+
            |          TEID (0-4 octets)        |
            +-----------------------------------+
            */
            byte_length = tvb_get_ipv4_addr_with_prefix_len(tvb, reader_offset, &arch_spec_3gpp_5g_teid, arch_spec_endpoint_length);

            arch_spec_item = proto_tree_add_item(tree, hf_bgp_mup_nlri_3gpp_5g_type2_st_route, tvb, reader_offset, byte_length, ENC_NA);
            arch_spec_tree = proto_item_add_subtree(arch_spec_item, ett_bgp_mup_nlri_3gpp_5g_type2_st_route);
            proto_tree_add_uint_format_value(arch_spec_tree, hf_bgp_mup_nlri_3gpp_5g_ep_teid, tvb, reader_offset, byte_length, arch_spec_3gpp_5g_teid,
                                            "0x%08x/%d", g_ntohl(arch_spec_3gpp_5g_teid), arch_spec_endpoint_length);
            reader_offset += byte_length;
            break;
        default:
            /* for unknown architecture types, just decode as binary */
            byte_length = (arch_spec_endpoint_length-1)/8 + 1;
            proto_tree_add_item(tree, hf_bgp_mup_nlri_unknown_data, tvb, reader_offset, byte_length, ENC_NA);
            reader_offset += byte_length;

            proto_tree_add_expert_format(tree, pinfo, &ei_bgp_mup_unknown_at, tvb, reader_offset, -1,
                                         "Architecture specific type 2 ST route for unknown architecture type: %d", architecture_type);
            break;
        }
    }

    total_length = reader_offset - offset;
    return total_length;
}
