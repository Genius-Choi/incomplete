test_no_gzip (TestCase *tc,
              gconstpointer fixture)
{
  GError *error = NULL;
  GBytes *message;
  JsonObject *object;
  GBytes *data;

  while (tc->closed == FALSE)
    g_main_context_iteration (NULL, TRUE);
  g_assert_cmpstr (tc->problem, ==, NULL);

  message = mock_transport_pop_channel (tc->transport, "444");
  object = cockpit_json_parse_bytes (message, &error);
  g_assert_no_error (error);
  cockpit_assert_json_eq (object, "{\"status\":200,\"reason\":\"OK\",\"headers\":{" STATIC_HEADERS ",\"X-Cockpit-Pkg-Checksum\":\"" CHECKSUM_GZIP "\",\"Content-Type\":\"text/plain\"}}");
  json_object_unref (object);

  data = mock_transport_combine_output (tc->transport, "444", NULL);
  g_assert_cmpint (g_bytes_get_size (data), ==, 26530);
  g_bytes_unref (data);
}
