QString StelScriptMgr::getDescription(const QString& s)
{
	QFile file(StelFileMgr::findFile("scripts/" + s, StelFileMgr::File));
	if (!file.open(QIODevice::ReadOnly | QIODevice::Text))
	{
		QString msg = QString("WARNING: script file %1 could not be opened for reading").arg(QDir::toNativeSeparators(s));
		emit scriptDebug(msg);
		qWarning() << msg;
		return QString();
	}

	//use a buffered stream instead of QFile::readLine - much faster!
	QTextStream textStream(&file);
#if (QT_VERSION>=QT_VERSION_CHECK(6,0,0))
	textStream.setEncoding(QStringConverter::Utf8);
#else
	textStream.setCodec("UTF-8");
#endif
	QString desc = "";
	bool inDesc = false;
	static const QRegularExpression descExp("^\\s*//\\s*Description:\\s*([^\\s].+)\\s*$");
	static const QRegularExpression descNewlineExp("^\\s*//\\s*$");
	static const QRegularExpression descContExp("^\\s*//\\s*([^\\s].*)\\s*$");
	while (!textStream.atEnd())
	{
		QString line = textStream.readLine();
		QRegularExpressionMatch descMatch=descExp.match(line);
		if (!inDesc && descMatch.hasMatch())
		{
			inDesc = true;
			desc = descMatch.captured(1) + " ";
			desc.replace("\n","");
		}
		else if (inDesc)
		{
			QString d("");
			QRegularExpressionMatch descContMatch=descContExp.match(line);
			if (descNewlineExp.match(line).hasMatch())
				d = "\n";
			else if (descContMatch.hasMatch())
			{
				d = descContMatch.captured(1) + " ";
				d.replace("\n","");
			}
			else
			{
				file.close();
				return desc;
			}
			desc += d;
		}
	}
	file.close();
	return desc.trimmed();
}
