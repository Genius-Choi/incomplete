MOBI_RET mobi_set_pdbname(MOBIData *m, const char *name) {
    if (m == NULL || m->ph == NULL) {
        return MOBI_INIT_FAILED;
    }
    char dbname[PALMDB_NAME_SIZE_MAX + 1];
    if (mobi_is_cp1252(m)) {
        size_t size = PALMDB_NAME_SIZE_MAX + 1;
        MOBI_RET ret = mobi_utf8_to_cp1252(dbname, name, &size, strlen(name));
        if (ret != MOBI_SUCCESS) {
            return ret;
        }
    } else {
        memcpy(dbname, name, PALMDB_NAME_SIZE_MAX);
        dbname[PALMDB_NAME_SIZE_MAX] = '\0';
    }
    char c;
    int i = 0;
    while ((c = dbname[i])) {
        if (!isalnum(c)) {
            c = '_';
        }
        m->ph->name[i++] = c;
    }
    m->ph->name[i] = '\0';
    return MOBI_SUCCESS;
}
