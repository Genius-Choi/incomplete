static int dtls_bio_filter_free(BIO *bio) {
	dtls_bio_filter *filter;

	if (bio == NULL) {
		return 0;
	}
 
	/* Get rid of the filter state */
#if OPENSSL_VERSION_NUMBER < 0x10100000L
	filter = (dtls_bio_filter *)bio->ptr;
#else
	filter = (dtls_bio_filter *)BIO_get_data(bio);
#endif

	if (filter != NULL) {
		switch_memory_pool_t *pool = filter->pool;
		switch_core_destroy_memory_pool(&pool);
		pool = NULL;
		filter = NULL;
	}

#if OPENSSL_VERSION_NUMBER < 0x10100000L
	bio->ptr = NULL;
	bio->init = 0;
	bio->flags = 0;
#else
	BIO_set_init(bio, 0);
	BIO_set_data(bio, NULL);
	BIO_clear_flags(bio, ~0);
#endif
	return 1;
}
