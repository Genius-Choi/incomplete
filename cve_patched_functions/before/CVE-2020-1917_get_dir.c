req::ptr<Directory> get_dir(const Resource& dir_handle) {
  if (dir_handle.isNull()) {
    auto defaultDir = s_directory_data->defaultDirectory;
    if (!defaultDir) {
      raise_warning("no Directory resource supplied");
      return nullptr;
    }
    return defaultDir;
  }

  auto d = dyn_cast_or_null<Directory>(dir_handle);
  if (!d) {
    raise_warning("Not a valid directory resource");
    return nullptr;
  }
  return d;
}
