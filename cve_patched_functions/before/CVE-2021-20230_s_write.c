void s_write(CLI *c, SOCKET fd, const void *buf, size_t len) {
        /* simulate a blocking write */
    uint8_t *ptr=(uint8_t *)buf;
    ssize_t num;

    while(len>0) {
        s_poll_init(c->fds, 0);
        s_poll_add(c->fds, fd, 0, 1); /* write */
        switch(s_poll_wait(c->fds, c->opt->timeout_busy, 0)) {
        case -1:
            sockerror("s_write: s_poll_wait");
            throw_exception(c, 1); /* error */
        case 0:
            s_log(LOG_INFO, "s_write: s_poll_wait:"
                " TIMEOUTbusy exceeded: sending reset");
            throw_exception(c, 1); /* timeout */
        case 1:
            break; /* OK */
        default:
            s_log(LOG_ERR, "s_write: s_poll_wait: unknown result");
            throw_exception(c, 1); /* error */
        }
        num=writesocket(fd, (void *)ptr, len);
        if(num==-1) { /* error */
            sockerror("writesocket (s_write)");
            throw_exception(c, 1);
        }
        ptr+=(size_t)num;
        len-=(size_t)num;
    }
}
