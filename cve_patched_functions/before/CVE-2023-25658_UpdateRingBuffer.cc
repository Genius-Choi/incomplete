void ApproximateLatencyEstimator::UpdateRingBuffer() TF_LOCKS_EXCLUDED(mu_) {
  int64_t now_minutes =
      absl::ToInt64Minutes(absl::Microseconds(env_.NowMicros()));

  mutex_lock l(mu_);
  int64_t elapsed_minutes = now_minutes - last_updated_time_mins_;
  int64_t minutes_to_update = std::min(elapsed_minutes, kSlots);
  for (int i = 0; i < minutes_to_update; ++i) {
    latency_value_[next_slot_] = latency_value_counter_;
    latency_count_[next_slot_] = latency_count_counter_;
    IncrementNextSlot();
  }
  last_updated_time_mins_ = now_minutes;
}
