void HTTPAPI_CloseConnection(HTTP_HANDLE handle)
{
    if (g_HTTPAPIState != HTTPAPI_INITIALIZED)
    {
        LogError("g_HTTPAPIState not HTTPAPI_INITIALIZED");
    }
    else
    {
        HTTP_HANDLE_DATA* handleData = (HTTP_HANDLE_DATA*)handle;

        if (handleData != NULL)
        {
            if (handleData->ConnectionHandle != NULL)
            {
                (void)WinHttpCloseHandle(handleData->ConnectionHandle);
                /*no x509 free because the options are owned by httpapiex.*/
                handleData->ConnectionHandle = NULL;
            }
            if (handleData->proxy_host != NULL)
            {
                free((void*)handleData->proxy_host);
            }
            if (handleData->proxy_username != NULL)
            {
                free((void*)handleData->proxy_username);
            }
            if (handleData->proxy_password != NULL)
            {
                free((void*)handleData->proxy_password);
            }
            x509_schannel_destroy(handleData->x509SchannelHandle);
            free(handleData);
        }
    }
}
