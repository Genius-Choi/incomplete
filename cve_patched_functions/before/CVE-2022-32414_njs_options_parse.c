njs_options_parse(njs_opts_t *opts, int argc, char **argv)
{
    char       *p;
    njs_int_t  i;

    static const char  help[] =
        "njs unit tests.\n"
        "\n"
        "njs_unit_test [options]"
        "\n"
        "Options:\n"
        "  -d                           print disassembled code.\n"
        "  -f PATTERN1[|PATTERN2..]     filter test suites to run.\n"
        "  -r count                     overrides repeat count for tests.\n"
        "  -s seed                      sets seed for async tests.\n"
        "  -v                           verbose mode.\n";

    for (i = 1; i < argc; i++) {

        p = argv[i];

        if (p[0] != '-') {
            goto help;
        }

        p++;

        switch (*p) {
        case '?':
        case 'h':
            (void) write(STDOUT_FILENO, help, njs_length(help));
            return NJS_DONE;

        case 'd':
            opts->disassemble = 1;
            break;

        case 'f':
            if (++i < argc) {
                opts->filter.start = (u_char *) argv[i];
                opts->filter.length = njs_strlen(argv[i]);
                break;
            }

            njs_stderror("option \"-f\" requires argument\n");
            return NJS_ERROR;

        case 'r':
            if (++i < argc) {
                opts->repeat = atoi(argv[i]);
                break;
            }

            njs_stderror("option \"-r\" requires argument\n");
            return NJS_ERROR;

        case 's':
            if (++i < argc) {
                opts->seed = atoi(argv[i]);
                break;
            }

            njs_stderror("option \"-s\" requires argument\n");
            return NJS_ERROR;

        case 'v':
            opts->verbose = 1;
            break;

        default:
            goto help;
        }
    }

    return NJS_OK;

help:

    njs_stderror("Unknown argument: \"%s\" "
                 "try \"%s -h\" for available options\n", argv[i],
                 argv[0]);

    return NJS_ERROR;
}
