ietf_full_conn_ci_log_stats (struct lsquic_conn *lconn)
{
    struct ietf_full_conn *conn = (struct ietf_full_conn *) lconn;
    struct batch_size_stats *const bs = &conn->ifc_enpub->enp_batch_size_stats;
    struct conn_stats diff_stats;
    uint64_t cwnd;
    char cidstr[MAX_CID_LEN * 2 + 1];

    if (!conn->ifc_last_stats)
    {
        conn->ifc_last_stats = calloc(1, sizeof(*conn->ifc_last_stats));
        if (!conn->ifc_last_stats)
            return;
        LSQ_DEBUG("allocated last stats");
    }

    cwnd = conn->ifc_send_ctl.sc_ci->cci_get_cwnd(
                                            conn->ifc_send_ctl.sc_cong_ctl);
    lsquic_conn_stats_diff(&conn->ifc_stats, conn->ifc_last_stats, &diff_stats);
    lsquic_logger_log1(LSQ_LOG_NOTICE, LSQLM_CONN_STATS,
        "%s: ticks: %lu; cwnd: %"PRIu64"; conn flow: max: %"PRIu64
        ", avail: %"PRIu64"; packets: sent: %lu, lost: %lu, retx: %lu, rcvd: %lu"
        "; batch: count: %u; min: %u; max: %u; avg: %.2f",
        (lsquic_cid2str(LSQUIC_LOG_CONN_ID, cidstr), cidstr),
        diff_stats.n_ticks, cwnd,
        conn->ifc_pub.conn_cap.cc_max,
        lsquic_conn_cap_avail(&conn->ifc_pub.conn_cap),
        diff_stats.out.packets, diff_stats.out.lost_packets,
        diff_stats.out.retx_packets, diff_stats.in.packets,
        bs->count, bs->min, bs->max, bs->avg);

    *conn->ifc_last_stats = conn->ifc_stats;
    memset(bs, 0, sizeof(*bs));
}
