int CEXEBuild::change_target_architecture(TARGETTYPE tt)
{
  const bool wide = TARGET_X86ANSI != tt;
  if (build_compressor_set || (build_unicode != wide && build_lockedunicodetarget))
  {
    ERROR_MSG(_T("Error: Can't change target %") NPRIs _T(" after data already got compressed or header already changed!\n"), _T("architecture"));
    return PS_ERROR;
  }

  if (TARGET_X86ANSI == m_target_type || TARGET_X86UNICODE == m_target_type)
    m_previous_x86_unicode = build_unicode;
  m_target_type = tt;
  build_unicode = wide;

  int ec = set_target_architecture_data();
  if (PS_OK == ec) ec = load_stub();
#ifdef NSIS_CONFIG_PLUGIN_SUPPORT
  if (PS_OK == ec) ec = initialize_default_plugins(true);
#endif
  changed_target = true;
  return ec;
}
