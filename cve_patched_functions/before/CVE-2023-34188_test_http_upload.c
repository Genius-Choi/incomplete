static void test_http_upload(void) {
  struct mg_mgr mgr;
  const char *url = "http://127.0.0.1:12352";
  int i, del = 1;
  const char *s1 = "ok (chunked)\n";
  const char *s2 = "ok (8 foo\nbar\n)\n";

  mg_mgr_init(&mgr);
  mg_http_listen(&mgr, url, us, (void *) &del);

  mg_http_connect(&mgr, url, uc, (void *) &s1);
  for (i = 0; i < 20; i++) mg_mgr_poll(&mgr, 5);
  ASSERT(s1 == NULL);

  del = 0;
  mg_http_connect(&mgr, url, uc, (void *) &s2);
  for (i = 0; i < 20; i++) mg_mgr_poll(&mgr, 5);
  ASSERT(s2 == NULL);

  mg_mgr_free(&mgr);
  ASSERT(mgr.conns == NULL);
}
