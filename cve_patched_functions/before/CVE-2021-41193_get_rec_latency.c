    uint32_t audio_io_osx::get_rec_latency(const AudioTimeStamp* input_time_stamp) {
        UInt64 capture_time_ns = AudioConvertHostTimeToNanos(
                                                             input_time_stamp->mHostTime);
        UInt64 now_ns = AudioConvertHostTimeToNanos(AudioGetCurrentHostTime());
        
        if (capture_time_ns > now_ns){
            return 0;
        }
        
        double delay_ms = static_cast<double>
        (1e-6 * (now_ns - capture_time_ns));
        
        return (uint32_t)delay_ms; // Round here AEC is working with integer ms delay anyways
    }
