Variant HHVM_FUNCTION(fb_unserialize,
                      const Variant& thing,
                      bool& success,
                      int64_t options) {
  if (thing.isString()) {
    String sthing = thing.toString();

    if (sthing.size() && (sthing.data()[0] & 0x80)) {
      Variant error;
      return fb_compact_unserialize(sthing.data(), sthing.size(),
                                    success, error);
    } else {
      return fb_unserialize(sthing.data(), sthing.size(), success, options);
    }
  }

  success = false;
  return false;
}
