static int load_plugin_data(char *plugin_name, char *config_file)
{
  FILE *file_ptr;
  char path[FN_REFLEN];
  char line[1024];
  char *reason= 0;
  char *res;
  int i= -1;

  if (opt_plugin_ini == 0)
  {
    fn_format(path, config_file, opt_plugin_dir, "", MYF(0));
    opt_plugin_ini= my_strdup(path, MYF(MY_FAE));
  }
  if (!file_exists(opt_plugin_ini))
  {
    reason= (char *)"File does not exist.";
    goto error;
  }

  file_ptr= fopen(opt_plugin_ini, "r");
  if (file_ptr == NULL)
  {
    reason= (char *)"Cannot open file.";
    goto error;
  }

  /* save name */
  plugin_data.name= my_strdup(plugin_name, MYF(MY_WME));

  /* Read plugin components */
  while (i < 16)
  {
    res= fgets(line, sizeof(line), file_ptr);
    /* strip /n */
    if (line[strlen(line)-1] == '\n')
    {
      line[strlen(line)-1]= '\0';
    }
    if (res == NULL)
    {
      if (i < 1)
      {
        reason= (char *)"Bad format in plugin configuration file.";
        fclose(file_ptr);
        goto error;        
      }
      break;
    }
    if ((line[0] == '#') || (line[0] == '\n')) // skip comment and blank lines
    {
      continue;
    }
    if (i == -1) // if first pass, read this line as so_name
    {
      /* Add proper file extension for soname */
      strcat(line, FN_SOEXT);
      /* save so_name */
      plugin_data.so_name= my_strdup(line, MYF(MY_WME|MY_ZEROFILL));
      i++;
    }
    else
    {
      if (strlen(line) > 0)
      {
        plugin_data.components[i]= my_strdup(line, MYF(MY_WME));
        i++;
      }
      else
      {
        plugin_data.components[i]= NULL;
      }
    }
  }
  
  fclose(file_ptr);
  return 0;

error:
  fprintf(stderr, "ERROR: Cannot read plugin config file %s. %s\n",
          plugin_name, reason);
  return 1;
}
