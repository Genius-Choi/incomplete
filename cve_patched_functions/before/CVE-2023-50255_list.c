PluginFinishType LibzipPlugin::list()
{
    qInfo() << "LibzipPlugin插件加载压缩包数据";
    setPassword(QString());
    m_mapFileCode.clear();
    m_setHasHandlesDirs.clear();
    m_setHasRootDirs.clear();
    DataManager::get_instance().resetArchiveData();

    // 处理加载流程
    int errcode = 0;
    zip_error_t err;

    // 打开压缩包文件
    zip_t *archive = zip_open(QFile::encodeName(m_strArchiveName).constData(), ZIP_RDONLY, &errcode);   // 打开压缩包文件
    zip_error_init_with_code(&err, errcode);

    // 若打开失败，返回错误
    if (nullptr == archive) {
        m_eErrorType = ET_ArchiveDamaged;
        return PFT_Error;
    }

    // 获取文件压缩包文件数目
    const auto nofEntries = zip_get_num_entries(archive, 0);

    // 获取压缩包的注释内容
    QByteArray strCode;
    m_strComment = m_common->trans2uft8(zip_get_archive_comment(archive, nullptr, ZIP_FL_ENC_RAW), strCode);

    // 循环构建数据
    for (zip_int64_t i = 0; i < nofEntries; i++) {
        if (QThread::currentThread()->isInterruptionRequested()) {
            break;
        }

        handleArchiveData(archive, i);  // 构建数据
    }

    zip_close(archive);

    return PFT_Nomral;
}
