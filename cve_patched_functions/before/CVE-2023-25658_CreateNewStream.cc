StatusOr<int64_t> SnapshotManager::CreateNewStream(
    const std::string& worker_address) {
  int64_t new_stream_index = streams_.size();

  for (int64_t source_index = 0; source_index < num_sources(); ++source_index) {
    TF_RETURN_IF_ERROR(env_->RecursivelyCreateDir(
        SourceDirectory(path_, new_stream_index, source_index)));
  }

  streams_.push_back(Stream(num_sources()));
  assignments_.insert({worker_address, new_stream_index});
  VLOG(1) << "creating stream " << new_stream_index
          << " and assigning it to worker " << worker_address;

  return new_stream_index;
}
