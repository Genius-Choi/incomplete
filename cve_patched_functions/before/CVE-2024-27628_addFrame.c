OFCondition EctEnhancedCT::Frames<PixelType>::addFrame(PixelType* data,
                                                       const size_t numPixels,
                                                       const OFVector<FGBase*>& perFrameInformation)
{
    OFCondition result;
    if (data && numPixels)
    {
        if (!perFrameInformation.empty())
        {
            OFunique_ptr<DcmIODTypes::Frame> f(new DcmIODTypes::Frame);
            if (f)
            {
                f->length  = numPixels * sizeof(PixelType);
                f->pixData = new Uint8[f->length];
                memcpy(f->pixData, data, f->length);
                m_CT.m_Frames.push_back(f.release());
                OFVector<FGBase*>::const_iterator fg = perFrameInformation.begin();
                while (result.good() && (fg != perFrameInformation.end()))
                {
                    result = m_CT.m_FGInterface.addPerFrame(OFstatic_cast(Uint32, m_CT.m_Frames.size()), **fg);
                    if (result.bad())
                    {
                        DCMECT_ERROR(
                            "Could not add functional group: " << DcmFGTypes::FGType2OFString((*fg)->getType()));
                        break;
                    }
                    ++fg;
                }
            }
        }
    }
    // Clean up if necessary
    if (result.bad())
        m_CT.m_FGInterface.deleteFrame(OFstatic_cast(Uint32, m_CT.m_Frames.size()));
    return result;
}
