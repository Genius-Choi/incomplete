void handleClient(int clientSocket){
  // Buffer to hold part of the request.
  char requestBuffer[BUFFERSIZE];
  // c++ strings for the request and response.
  string request;
  string response;
  // How many bytes we received this call.
  int bytesReceived;
  // How many bytes we've sent total.
  unsigned bytesSent;
  // How many bytes we've sent this call.
  int sending;

  //while(true){
    // Recieve a single request.
    bytesReceived = recv(clientSocket, requestBuffer, BUFFERSIZE, 0);
    while(bytesReceived == BUFFERSIZE){
      request.append(requestBuffer, bytesReceived);
      bytesReceived = recv(clientSocket, requestBuffer, BUFFERSIZE, MSG_DONTWAIT);
    }
    if (bytesReceived != -1) {
      request.append(requestBuffer, bytesReceived);
    }
    if (bytesReceived == 0) return;
    // Get the response.
    try{
      response = handleRequest(request);
    } catch (exception e){
      cerr << "got an exception, killing client thread..." << endl;
      return;
    }

    // Reply
    bytesSent = 0;
    while(bytesSent < response.length()){
      sending = send(clientSocket, response.c_str(), response.length(), 0);
      if (sending == -1){
	cerr << "Failed to respond to client. " << endl;
	break;
      }
      bytesSent += sending;
    }

    // If the client didn't close the connection, we'll reply
    // again. Otherwise, we'll just try to receive andf then break.
    //}
  close(clientSocket);
  openSockets.remove(clientSocket);
}
