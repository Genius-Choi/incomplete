virtio_net_set_status(void *vdev, uint64_t status)
{
	struct virtio_net *net = vdev;
	int rc;

	if (!net->vhost_net)
		return;

	if (!net->vhost_net->vhost_started &&
		(status & VIRTIO_CONFIG_S_DRIVER_OK)) {
		if (net->mevp)
			mevent_disable(net->mevp);

		rc = vhost_net_start(net->vhost_net);
		if (rc < 0) {
			WPRINTF(("vhost_net_start failed\n"));
			return;
		}
	} else if (net->vhost_net->vhost_started &&
		((status & VIRTIO_CONFIG_S_DRIVER_OK) == 0)) {
		rc = vhost_net_stop(net->vhost_net);
		if (rc < 0)
			WPRINTF(("vhost_net_stop failed\n"));
	}
}
