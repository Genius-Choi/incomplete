int spider_db_mbase::select_binlog_gtid_pos(
  SPIDER_TRX *trx,
  SPIDER_SHARE *share,
  int all_link_idx,
  int *need_mon,
  TABLE *table,
  spider_string *str,
  const char *binlog_file_name,
  uint binlog_file_name_length,
  const char *binlog_pos,
  uint binlog_pos_length,
  SPIDER_DB_RESULT **res
) {
  int error_num;
  size_t length;
  const char *gtid_pos;
  DBUG_ENTER("spider_db_mbase::select_binlog_gtid_pos");
  str->length(0);
  if (str->reserve(
    SPIDER_SQL_BINLOG_GTID_POS_LEN +
    SPIDER_SQL_OPEN_PAREN_LEN +
    SPIDER_SQL_VALUE_QUOTE_LEN +
    binlog_file_name_length * 2 +
    SPIDER_SQL_VALUE_QUOTE_LEN +
    SPIDER_SQL_COMMA_LEN +
    SPIDER_SQL_VALUE_QUOTE_LEN +
    binlog_pos_length * 2 +
    SPIDER_SQL_VALUE_QUOTE_LEN +
    SPIDER_SQL_CLOSE_PAREN_LEN
  ))
    DBUG_RETURN(HA_ERR_OUT_OF_MEM);
  str->q_append(SPIDER_SQL_BINLOG_GTID_POS_STR,
    SPIDER_SQL_BINLOG_GTID_POS_LEN);
  str->q_append(SPIDER_SQL_OPEN_PAREN_STR, SPIDER_SQL_OPEN_PAREN_LEN);
  str->q_append(SPIDER_SQL_VALUE_QUOTE_STR, SPIDER_SQL_VALUE_QUOTE_LEN);
  length = conn->db_conn->escape_string((char *)str->ptr() + str->length(),
     binlog_file_name, binlog_file_name_length);
  str->length(str->length() + length);
  str->q_append(SPIDER_SQL_VALUE_QUOTE_STR, SPIDER_SQL_VALUE_QUOTE_LEN);
  str->q_append(SPIDER_SQL_COMMA_STR, SPIDER_SQL_COMMA_LEN);
  str->q_append(SPIDER_SQL_VALUE_QUOTE_STR, SPIDER_SQL_VALUE_QUOTE_LEN);
  length = conn->db_conn->escape_string((char *)str->ptr() + str->length(),
     binlog_pos, binlog_pos_length);
  str->length(str->length() + length);
  str->q_append(SPIDER_SQL_VALUE_QUOTE_STR, SPIDER_SQL_VALUE_QUOTE_LEN);
  str->q_append(SPIDER_SQL_CLOSE_PAREN_STR, SPIDER_SQL_CLOSE_PAREN_LEN);

  if ((error_num = exec_simple_sql_with_result(trx, share,
    str->ptr(), str->length(), all_link_idx, need_mon, res)))
  {
    DBUG_PRINT("info", ("spider error_num=%d 1", error_num));
    DBUG_RETURN(error_num);
  }
  if (!(error_num = ((spider_db_mbase_result *)*res)->fetch_select_binlog_gtid_pos(&gtid_pos)))
  {
    spider_store_binlog_pos_gtid(table, gtid_pos, strlen(gtid_pos), conn->access_charset);
  }
/*
  res->free_result();
  delete res;
*/
  if (error_num)
  {
    DBUG_PRINT("info", ("spider error_num=%d 2", error_num));
    DBUG_RETURN(error_num);
  }
  DBUG_RETURN(0);
}
