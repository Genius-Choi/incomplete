static void parse_cache_log_message(DebugMessages **debugMessages)
{
    DebugMessage msg;
    DebugMessageId minId = 0;
    DebugMessageId maxId = 0;

    char *key = nullptr;
    char *value = nullptr;
    while (ConfigParser::NextKvPair(key, value)) {
        if (strcmp(key, "id") == 0) {
            if (minId > 0)
                break;
            minId = maxId = ParseDebugMessageId(value, '\0');
        } else if (strcmp(key, "ids") == 0) {
            if (minId > 0)
                break;
            const auto dash = strchr(value, '-');
            if (!dash)
                throw TextException(ToSBuf("malformed cache_log_message ID range: ", key, '=', value), Here());
            minId = ParseDebugMessageId(value, '-');
            maxId = ParseDebugMessageId(dash+1, '\0');
            if (minId > maxId)
                throw TextException(ToSBuf("invalid cache_log_message ID range: ", key, '=', value), Here());
        } else if (strcmp(key, "level") == 0) {
            if (msg.levelled())
                break;
            const auto level = xatoi(value);
            if (level < 0)
                throw TextException(ToSBuf("negative cache_log_message level: ", value), Here());
            msg.level = level;
        } else if (strcmp(key, "limit") == 0) {
            if (msg.limited())
                break;
            msg.limit = xatoull(value, 10);
        } else {
            throw TextException(ToSBuf("unsupported cache_log_message option: ", key), Here());
        }
        key = value = nullptr;
    }

    if (key && value)
        throw TextException(ToSBuf("repeated or conflicting cache_log_message option: ", key, '=', value), Here());

    if (!minId)
        throw TextException("cache_log_message is missing a required id=... or ids=... option", Here());

    if (!(msg.levelled() || msg.limited()))
        throw TextException("cache_log_message is missing a required level=... or limit=... option", Here());

    assert(debugMessages);
    if (!*debugMessages)
        *debugMessages = new DebugMessages();

    for (auto id = minId; id <= maxId; ++id) {
        msg.id = id;
        (*debugMessages)->messages.at(id) = msg;
    }
}
