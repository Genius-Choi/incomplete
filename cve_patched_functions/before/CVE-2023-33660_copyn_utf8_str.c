copyn_utf8_str(const uint8_t *src, uint32_t *pos, int *str_len, int limit)
{
	*str_len      = 0;
	uint8_t *dest = NULL;

	if (limit <= 0)
		return NULL;
	NNI_GET16(src + (*pos), *str_len);

	*pos = (*pos) + 2;
	if (*str_len > (limit-2)) {
		//buffer overflow
		*str_len = -1;
		return NULL;
	}
	if (*str_len > 0) {
		if (utf8_check((const char *) (src + *pos), *str_len) ==
		    ERR_SUCCESS) {
			if ((dest = nng_alloc(*str_len + 1)) == NULL) {
				*str_len = 0;
				return NULL;
			}
			memcpy(dest, src + (*pos), *str_len);
			dest[*str_len] = '\0';
			*pos           = (*pos) + (*str_len);
		} else {
			*str_len = -1;
		}
	}
	return dest;
}
