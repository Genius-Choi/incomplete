static oe_result_t _enclave_destructor(void)
{
    oe_result_t result = OE_FAILURE;
    static bool _destructor_done = false;
    static oe_spinlock_t _lock = OE_SPINLOCK_INITIALIZER;

    oe_spin_lock(&_lock);
    if (!_destructor_done)
    {
        /* Cleanup attesters */
        oe_attester_shutdown();

        /* Cleanup verifiers */
        oe_verifier_shutdown();

        /* If memory still allocated, print a trace and return an error */
        OE_CHECK(oe_check_memory_leaks());

        /* Cleanup the allocator */
        oe_allocator_cleanup();

        _destructor_done = true;
    }

    result = OE_OK;

done:
    oe_spin_unlock(&_lock);
    return result;
}
