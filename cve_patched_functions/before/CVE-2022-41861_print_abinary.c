void print_abinary(char *out, size_t outlen, uint8_t const *data, size_t len, int8_t quote)
{
	size_t 	i;
	char	*p;
	ascend_filter_t	const *filter;

	static char const *action[] = {"drop", "forward"};
	static char const *direction[] = {"out", "in"};

	p = out;

	/*
	 *  Just for paranoia: wrong size filters get printed as octets
	 */
	if (len != sizeof(*filter)) {
		strcpy(p, "0x");
		p += 2;
		outlen -= 2;
		for (i = 0; i < len; i++) {
			snprintf(p, outlen, "%02x", data[i]);
			p += 2;
			outlen -= 2;
		}
		return;
	}

	if (quote > 0) {
		*(p++) = (char) quote;
		outlen -= 3;			/* account for leading & trailing quotes */
	}

	filter = (ascend_filter_t const *) data;
	i = snprintf(p, outlen, "%s %s %s", fr_int2str(filterType, filter->type, "??"),
		     direction[filter->direction & 0x01], action[filter->forward & 0x01]);

	p += i;
	outlen -= i;

	/*
	*	Handle IP filters
	*/
	if (filter->type == RAD_FILTER_IP) {

		if (filter->u.ip.srcip) {
			i = snprintf(p, outlen, " srcip %d.%d.%d.%d/%d",
				     ((uint8_t const *) &filter->u.ip.srcip)[0],
				     ((uint8_t const *) &filter->u.ip.srcip)[1],
				     ((uint8_t const *) &filter->u.ip.srcip)[2],
				     ((uint8_t const *) &filter->u.ip.srcip)[3],
				     filter->u.ip.srcmask);
			p += i;
			outlen -= i;
		}

		if (filter->u.ip.dstip) {
			i = snprintf(p, outlen, " dstip %d.%d.%d.%d/%d",
				     ((uint8_t const *) &filter->u.ip.dstip)[0],
				     ((uint8_t const *) &filter->u.ip.dstip)[1],
				     ((uint8_t const *) &filter->u.ip.dstip)[2],
				     ((uint8_t const *) &filter->u.ip.dstip)[3],
				     filter->u.ip.dstmask);
			p += i;
			outlen -= i;
		}

		i = snprintf(p, outlen, " %s", fr_int2str(filterProtoName, filter->u.ip.proto, "??"));
		p += i;
		outlen -= i;

		if (filter->u.ip.srcPortComp > RAD_NO_COMPARE) {
			i = snprintf(p, outlen, " srcport %s %d",
				     fr_int2str(filterCompare, filter->u.ip.srcPortComp, "??"),
				     ntohs(filter->u.ip.srcport));
			p += i;
			outlen -= i;
		}

		if (filter->u.ip.dstPortComp > RAD_NO_COMPARE) {
			i = snprintf(p, outlen, " dstport %s %d",
				     fr_int2str(filterCompare, filter->u.ip.dstPortComp, "??"),
				     ntohs(filter->u.ip.dstport));
			p += i;
			outlen -= i;
		}

		if (filter->u.ip.established) {
			i = snprintf(p, outlen, " est");
			p += i;
		}

		/*
		 *	Handle IPX filters
		 */
	} else if (filter->type == RAD_FILTER_IPX) {
		/* print for source */
		if (filter->u.ipx.src.net) {
			i = snprintf(p, outlen, " srcipxnet 0x%04x srcipxnode 0x%02x%02x%02x%02x%02x%02x",
				  (unsigned int)ntohl(filter->u.ipx.src.net),
				  filter->u.ipx.src.node[0], filter->u.ipx.src.node[1],
				  filter->u.ipx.src.node[2], filter->u.ipx.src.node[3],
				  filter->u.ipx.src.node[4], filter->u.ipx.src.node[5]);
			p += i;
			outlen -= i;

			if (filter->u.ipx.srcSocComp > RAD_NO_COMPARE) {
				i = snprintf(p, outlen, " srcipxsock %s 0x%04x",
					     fr_int2str(filterCompare, filter->u.ipx.srcSocComp, "??"),
					     ntohs(filter->u.ipx.src.socket));
				p += i;
				outlen -= i;
			}
		}

		/* same for destination */
		if (filter->u.ipx.dst.net) {
			i = snprintf(p, outlen, " dstipxnet 0x%04x dstipxnode 0x%02x%02x%02x%02x%02x%02x",
				  (unsigned int)ntohl(filter->u.ipx.dst.net),
				  filter->u.ipx.dst.node[0], filter->u.ipx.dst.node[1],
				  filter->u.ipx.dst.node[2], filter->u.ipx.dst.node[3],
				  filter->u.ipx.dst.node[4], filter->u.ipx.dst.node[5]);
			p += i;
			outlen -= i;

			if (filter->u.ipx.dstSocComp > RAD_NO_COMPARE) {
				i = snprintf(p, outlen, " dstipxsock %s 0x%04x",
					     fr_int2str(filterCompare, filter->u.ipx.dstSocComp, "??"),
					     ntohs(filter->u.ipx.dst.socket));
				p += i;
			}
		}
	} else if (filter->type == RAD_FILTER_GENERIC) {
		int count;

		i = snprintf(p, outlen, " %u ", (unsigned int) ntohs(filter->u.generic.offset));
		p += i;

		/* show the mask */
		for (count = 0; count < ntohs(filter->u.generic.len); count++) {
			i = snprintf(p, outlen, "%02x", filter->u.generic.mask[count]);
			p += i;
			outlen -= i;
		}

		strcpy(p, " ");
		p++;
		outlen--;

		/* show the value */
		for (count = 0; count < ntohs(filter->u.generic.len); count++) {
			i = snprintf(p, outlen, "%02x", filter->u.generic.value[count]);
			p += i;
			outlen -= i;
		}

		i = snprintf(p, outlen, " %s", (filter->u.generic.compNeq) ? "!=" : "==");
		p += i;
		outlen -= i;

		if (filter->u.generic.more != 0) {
			i = snprintf(p, outlen, " more");
			p += i;
		}
	}

	if (quote > 0) {
		*(p++) = (char) quote;
	}
	*p = '\0';
}
