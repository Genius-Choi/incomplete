void uwsgi_setns(char *path) {
	int (*u_setns) (int, int) = (int (*)(int, int)) dlsym(RTLD_DEFAULT, "setns");
	if (!u_setns) {
		uwsgi_log("your system misses setns() syscall !!!\n");
		exit(1);
	}

	// count be overwritten
	int count = 64;

	uwsgi_log("joining namespaces from %s ...\n", path);
	for (;;) {
		int ns_fd = uwsgi_connect(path, 30, 0);
		if (ns_fd < 0) {
			uwsgi_error("uwsgi_setns()/uwsgi_connect()");
			sleep(1);
			continue;
		}
		int *fds = uwsgi_attach_fd(ns_fd, &count, "uwsgi-setns", 11);
		if (fds && count > 0) {
			int i;
			for (i = 0; i < count; i++) {
				if (fds[i] > -1) {
					if (u_setns(fds[i], 0) < 0) {
						uwsgi_error("uwsgi_setns()/setns()");
						exit(1);
					}
					close(fds[i]);
				}
			}
			free(fds);
			close(ns_fd);
			break;
		}
		if (fds)
			free(fds);
		close(ns_fd);
		sleep(1);
	}
}
