static void update_logging(MYSQL_THD thd,
              struct st_mysql_sys_var *var  __attribute__((unused)),
              void *var_ptr  __attribute__((unused)), const void *save)
{
  char new_logging= *(char *) save;
  if (new_logging == logging)
    return;

  ADD_ATOMIC(internal_stop_logging, 1);
  if (!maria_55_started || !debug_server_started)
    flogger_mutex_lock(&lock_operations);
  if ((logging= new_logging))
  {
    start_logging();
    if (!logging)
    {
      CLIENT_ERROR(1, "Logging was disabled.", MYF(ME_JUST_WARNING));
    }
    mark_always_logged(thd);
  }
  else
  {
    log_current_query(thd);
    stop_logging();
  }

  if (!maria_55_started || !debug_server_started)
    flogger_mutex_unlock(&lock_operations);
  ADD_ATOMIC(internal_stop_logging, -1);
}
