static JSValue js_typed_array_at(JSContext *ctx, JSValueConst this_val,
                                 int argc, JSValueConst *argv)
{
    JSObject *p;
    int64_t idx, len;

    p = get_typed_array(ctx, this_val, 0);
    if (!p)
        return JS_EXCEPTION;

    if (typed_array_is_detached(ctx, p)) {
        JS_ThrowTypeErrorDetachedArrayBuffer(ctx);
        return JS_EXCEPTION;
    }

    if (JS_ToInt64Sat(ctx, &idx, argv[0]))
        return JS_EXCEPTION;

    len = p->u.array.count;
    if (idx < 0)
        idx = len + idx;
    if (idx < 0 || idx >= len)
        return JS_UNDEFINED;
    return JS_GetPropertyUint32(ctx, this_val, idx);
}
