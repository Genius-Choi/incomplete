static unsigned char * _r_generate_signature(jws_t * jws, jwk_t * jwk, jwa_alg alg, int x5u_flags) {
  unsigned char * str_ret = NULL;
  int res;

  if (jws != NULL && (jwk != NULL || alg == R_JWA_ALG_NONE)) {
    switch (alg) {
      case R_JWA_ALG_HS256:
      case R_JWA_ALG_HS384:
      case R_JWA_ALG_HS512:
        if (r_jwk_key_type(jwk, NULL, x5u_flags) & R_KEY_TYPE_HMAC) {
          str_ret = r_jws_sign_hmac(jws, jwk);
        }
        break;
      case R_JWA_ALG_RS256:
      case R_JWA_ALG_RS384:
      case R_JWA_ALG_RS512:
      case R_JWA_ALG_PS256:
      case R_JWA_ALG_PS384:
      case R_JWA_ALG_PS512:
        res = r_jwk_key_type(jwk, NULL, x5u_flags);
        if (res & R_KEY_TYPE_RSA && res &R_KEY_TYPE_PRIVATE) {
          str_ret = r_jws_sign_rsa(jws, jwk);
        }
        break;
      case R_JWA_ALG_ES256:
      case R_JWA_ALG_ES384:
      case R_JWA_ALG_ES512:
        res = r_jwk_key_type(jwk, NULL, x5u_flags);
        if (res & R_KEY_TYPE_EC && res & R_KEY_TYPE_PRIVATE) {
          str_ret = r_jws_sign_ecdsa(jws, jwk);
        }
        break;
      case R_JWA_ALG_EDDSA:
        res = r_jwk_key_type(jwk, NULL, x5u_flags);
        if (res & R_KEY_TYPE_EDDSA && res & R_KEY_TYPE_PRIVATE) {
          str_ret = r_jws_sign_eddsa(jws, jwk);
        }
        break;
      case R_JWA_ALG_NONE:
        str_ret = (unsigned char *)o_strdup("");
        break;
#if 0
      case R_JWA_ALG_ES256K:
        res = r_jwk_key_type(jwk, NULL, x5u_flags);
        if (res & R_KEY_TYPE_EC && res & R_KEY_TYPE_PRIVATE) {
          str_ret = r_jws_sign_es256k(jws, jwk);
        }
        break;
#endif
      default:
        y_log_message(Y_LOG_LEVEL_ERROR, "_r_generate_signature - Unsupported algorithm");
        break;
    }
  } else {
    y_log_message(Y_LOG_LEVEL_ERROR, "_r_generate_signature - Error input parameters");
  }
  return str_ret;
}
