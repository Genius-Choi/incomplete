static int _icall_get_members(struct icall *icall, struct wcall_members **mmp)
{
	struct ecall *ecall = (struct ecall *) icall;
	struct wcall_members *mm = NULL;
	struct wcall_member *memb = NULL;
	int n = 1;
	int err = 0;

	if (!ecall)
		return EINVAL;

	if (ecall->userid_peer && ecall->clientid_peer)
		n++;
	
	mm = mem_zalloc(sizeof(*mm), members_destructor);
	if (!mm) {
		err = ENOMEM;
		goto out;
	}

	mm->membv = mem_zalloc(n * sizeof(*memb), NULL);
	if (!mm->membv) {
		err = ENOMEM;
		goto out;
	}
	mm->membc = n;	

	memb = &mm->membv[0];
	str_dup(&memb->userid, ecall->userid_self);
	str_dup(&memb->clientid, ecall->clientid_self);
	memb->audio_state = ecall->audio.estab ?
		ICALL_AUDIO_STATE_ESTABLISHED : ICALL_AUDIO_STATE_CONNECTING;
	memb->video_recv = (int)ecall->vstate;
	memb->muted = msystem_get_muted();
	
	if (mm->membc > 1) {
		memb = &mm->membv[1];

		str_dup(&memb->userid, ecall->userid_peer);
		str_dup(&memb->clientid, ecall->clientid_peer);
		memb->audio_state = ecall->audio.estab ?
			ICALL_AUDIO_STATE_ESTABLISHED : ICALL_AUDIO_STATE_CONNECTING;
		memb->video_recv = (int)ecall->video.recv_state;
		memb->muted = ecall->audio.remote_muted_state;
	}

 out:
	if (err) {
		mem_deref(memb);
		mem_deref(mm);
	}
	else {
		if (mmp)
			*mmp = mm;
	}

	return err;
}
