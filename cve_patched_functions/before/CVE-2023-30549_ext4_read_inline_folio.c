static int ext4_read_inline_folio(struct inode *inode, struct folio *folio)
{
	void *kaddr;
	int ret = 0;
	size_t len;
	struct ext4_iloc iloc;

	BUG_ON(!folio_test_locked(folio));
	BUG_ON(!ext4_has_inline_data(inode));
	BUG_ON(folio->index);

	if (!EXT4_I(inode)->i_inline_off) {
		ext4_warning(inode->i_sb, "inode %lu doesn't have inline data.",
			     inode->i_ino);
		goto out;
	}

	ret = ext4_get_inode_loc(inode, &iloc);
	if (ret)
		goto out;

	len = min_t(size_t, ext4_get_inline_size(inode), i_size_read(inode));
	BUG_ON(len > PAGE_SIZE);
	kaddr = kmap_local_folio(folio, 0);
	ret = ext4_read_inline_data(inode, kaddr, len, &iloc);
	flush_dcache_folio(folio);
	kunmap_local(kaddr);
	folio_zero_segment(folio, len, folio_size(folio));
	folio_mark_uptodate(folio);
	brelse(iloc.bh);

out:
	return ret;
}
