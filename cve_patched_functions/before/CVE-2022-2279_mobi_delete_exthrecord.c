MOBIExthHeader * mobi_delete_exthrecord(MOBIData *m, MOBIExthHeader *record) {
    if (record == NULL || m == NULL || m->eh == NULL) {
        return NULL;
    }
    MOBIExthHeader *next = record->next;
    if (next) {
        /* not last */
        MOBIExthHeader *curr = m->eh;
        if (curr == record) {
            /* first */
            m->eh = next;
        } else {
            /* not first */
            while (curr) {
                if (curr->next == record) {
                    curr->next = next;
                    break;
                }
                curr = curr->next;
            }
        }
        free(record->data);
        free(record);
    } else if (m->eh == record) {
        /* last && first */
        free(m->eh->data);
        free(m->eh);
        m->eh = NULL;
    } else {
        /* last */
        MOBIExthHeader *curr = m->eh;
        while (curr) {
            if (curr->next == record) {
                curr->next = NULL;
                break;
            }
            curr = curr->next;
        }
        free(record->data);
        free(record);
    }
    return next;
}
