njs_dump_terminal(njs_json_stringify_t *stringify, njs_chb_t *chain,
    njs_value_t *value, njs_uint_t console)
{
    njs_str_t          str;
    njs_int_t          ret;
    njs_value_t        str_val, tag;
    njs_typed_array_t  *array;
    njs_string_prop_t  string;

    static const njs_value_t  name_string = njs_string("name");

    njs_int_t   (*to_string)(njs_vm_t *, njs_value_t *, const njs_value_t *);

    switch (value->type) {
    case NJS_NULL:
        njs_chb_append_literal(chain, "null");
        break;

    case NJS_UNDEFINED:
        njs_chb_append_literal(chain, "undefined");
        break;

    case NJS_BOOLEAN:
        if (njs_is_true(value)) {
            njs_chb_append_literal(chain, "true");

        } else {
            njs_chb_append_literal(chain, "false");
        }

        break;

    case NJS_STRING:
        njs_string_get(value, &str);

        if (!console || stringify->depth != 0) {
            njs_json_append_string(chain, value, '\'');
            return NJS_OK;
        }

        njs_chb_append_str(chain, &str);

        break;

    case NJS_SYMBOL:
        ret = njs_symbol_descriptive_string(stringify->vm, &str_val, value);
        if (njs_slow_path(ret != NJS_OK)) {
            return NJS_ERROR;
        }

        njs_string_get(&str_val, &str);
        njs_chb_append_str(chain, &str);

        break;

    case NJS_INVALID:
        njs_chb_append_literal(chain, "<empty>");
        break;

    case NJS_OBJECT_VALUE:
        value = njs_object_value(value);

        switch (value->type) {
        case NJS_BOOLEAN:
            if (njs_is_true(value)) {
                njs_chb_append_literal(chain, "[Boolean: true]");

            } else {
                njs_chb_append_literal(chain, "[Boolean: false]");
            }

            break;

        case NJS_NUMBER:
            if (njs_slow_path(njs_number(value) == 0.0
                              && signbit(njs_number(value))))
            {

                njs_chb_append_literal(chain, "[Number: -0]");
                break;
            }

            ret = njs_number_to_string(stringify->vm, &str_val, value);
            if (njs_slow_path(ret != NJS_OK)) {
                return NJS_ERROR;
            }

            njs_string_get(&str_val, &str);
            njs_chb_sprintf(chain, 16 + str.length, "[Number: %V]", &str);
            break;

        case NJS_SYMBOL:
            ret = njs_symbol_descriptive_string(stringify->vm, &str_val, value);
            if (njs_slow_path(ret != NJS_OK)) {
                return NJS_ERROR;
            }

            njs_string_get(&str_val, &str);
            njs_chb_sprintf(chain, 16 + str.length, "[Symbol: %V]", &str);

            break;

        case NJS_STRING:
        default:
            njs_chb_append_literal(chain, "[String: ");
            njs_json_append_string(chain, value, '\'');
            njs_chb_append_literal(chain, "]");
            break;
        }

        break;

    case NJS_FUNCTION:
        ret = njs_value_property(stringify->vm, value,
                                 njs_value_arg(&name_string), &tag);
        if (njs_slow_path(ret == NJS_ERROR)) {
            return ret;
        }

        if (njs_is_string(&tag)) {
            njs_string_get(&tag, &str);

        } else if (njs_function(value)->native) {
            str = njs_str_value("native");

        } else {
            str = njs_str_value("");
        }

        if (str.length != 0) {
            njs_chb_sprintf(chain, 32 + str.length, "[Function: %V]", &str);

        } else {
            njs_chb_append_literal(chain, "[Function]");
        }

        break;

    case NJS_TYPED_ARRAY:
        array = njs_typed_array(value);
        ret = njs_object_string_tag(stringify->vm, value, &tag);
        if (njs_slow_path(ret == NJS_ERROR)) {
            return ret;
        }

        if (ret == NJS_OK) {
            (void) njs_string_prop(&string, &tag);
            njs_chb_append(chain, string.start, string.size);
            njs_chb_append_literal(chain, " ");
        }

        njs_chb_append_literal(chain, "[");

        (void) njs_typed_array_to_chain(stringify->vm, chain, array, NULL);

        njs_chb_append_literal(chain, "]");

        break;

    case NJS_NUMBER:
        if (njs_slow_path(njs_number(value) == 0.0
                          && signbit(njs_number(value))))
        {

            njs_chb_append_literal(chain, "-0");
            break;
        }

        /* Fall through. */

    case NJS_OBJECT:
    case NJS_REGEXP:
    case NJS_DATE:

        switch (value->type) {
        case NJS_NUMBER:
            to_string = njs_number_to_string;
            break;

        case NJS_REGEXP:
            to_string = njs_regexp_to_string;
            break;

        case NJS_DATE:
            to_string = njs_date_to_string;
            break;

        default:
            to_string = njs_error_to_string;
        }

        ret = to_string(stringify->vm, &str_val, value);
        if (njs_slow_path(ret != NJS_OK)) {
            return NJS_ERROR;
        }

        njs_string_get(&str_val, &str);
        njs_chb_append_str(chain, &str);

        break;

    default:

        njs_chb_sprintf(chain, 64, "[Unknown value type:%uD]", value->type);
    }

    return NJS_OK;
}
