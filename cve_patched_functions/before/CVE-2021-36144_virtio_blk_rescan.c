virtio_blk_rescan(struct vmctx *ctx, struct pci_vdev *dev, char *newpath)
{
	int error = -1;
	char bident[16];
	struct blockif_ctxt *bctxt;
	struct virtio_blk *blk = (struct virtio_blk *) dev->arg;

	if (!blk) {
		pr_err("Invalid virtio_blk device!\n");
		goto end;
	}

	/* validate inputs for virtio-blk blockrescan */
	if (newpath == NULL) {
		pr_err("no path info available\n");
		goto end;
	}

	if (strstr(newpath, "nodisk") != NULL) {
		pr_err("no valid backend file found\n");
		goto end;
	}

	if (snprintf(bident, sizeof(bident), "%d:%d",
				dev->slot, dev->func) >= sizeof(bident)) {
		pr_err("bident error, please check slot and func\n");
		goto end;
	}

	/* If bctxt is valid, then return error. Current support is only when
	 * user has passed empty file during VM launch and wants to update it.
	 * If this is the case, blk->bc would be null.
	 */
	if (blk->bc) {
		pr_err("Replacing valid backend file not supported!\n");
		goto end;
	}

	pr_err("name=%s, Path=%s, ident=%s\n", dev->name, newpath, bident);
	/* update the bctxt for the virtio-blk device */
	bctxt = blockif_open(newpath, bident);
	if (bctxt == NULL) {
		pr_err("Error opening backing file\n");
		goto end;
	}

	blk->bc = bctxt;
	blk->dummy_bctxt = false;

	/* Update virtio-blk device configuration on valid file*/
	virtio_blk_update_config_space(blk);

	/* Notify guest of config change */
	virtio_config_changed(dev->arg);

	error = 0;
end:
	return error;
}
