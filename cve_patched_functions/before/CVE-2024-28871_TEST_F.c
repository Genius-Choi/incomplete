TEST_F(ConnectionParsing, ResponseBodyData) {
    htp_config_register_response_body_data(cfg, callback_RESPONSE_BODY_DATA);

    int rc = test_run(home, "100-response-body-data.t", cfg, &connp);
    ASSERT_GE(rc, 0);

    ASSERT_EQ(1, htp_list_size(connp->conn->transactions));
    htp_tx_t *tx = (htp_tx_t *) htp_list_get(connp->conn->transactions, 0);
    ASSERT_TRUE(tx != NULL);
    ASSERT_EQ(HTP_REQUEST_COMPLETE, tx->request_progress);
    ASSERT_EQ(HTP_RESPONSE_COMPLETE, tx->response_progress);

    struct ResponseBodyDataCallback *user_data = (struct ResponseBodyDataCallback *) htp_tx_get_user_data(tx);
    ASSERT_TRUE(user_data);

    ASSERT_EQ(3, user_data->data.size());
    EXPECT_EQ("1\n", user_data->data[0]);
    EXPECT_EQ("23\n", user_data->data[1]);
    EXPECT_EQ("4", user_data->data[2]);

    delete user_data;
}
