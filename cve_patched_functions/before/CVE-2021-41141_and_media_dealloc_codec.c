static pj_status_t and_media_dealloc_codec(pjmedia_codec_factory *factory,
					   pjmedia_codec *codec )
{
    and_media_private_t *codec_data;

    PJ_ASSERT_RETURN(factory && codec, PJ_EINVAL);
    PJ_ASSERT_RETURN(factory == &and_media_factory.base, PJ_EINVAL);

    /* Close codec, if it's not closed. */
    codec_data = (and_media_private_t*) codec->codec_data;
    if (codec_data->enc) {
        AMediaCodec_stop(codec_data->enc);
        AMediaCodec_delete(codec_data->enc);
        codec_data->enc = NULL;
    }

    if (codec_data->dec) {
        AMediaCodec_stop(codec_data->dec);
        AMediaCodec_delete(codec_data->dec);
        codec_data->dec = NULL;
    }
    pj_pool_release(codec_data->pool);

    return PJ_SUCCESS;
}
