void oidc_util_set_app_info(request_rec *r, const char *s_key, const char *s_value, const char *claim_prefix,
			    apr_byte_t as_header, apr_byte_t as_env_var, int pass_as) {

	/* construct the header name, cq. put the prefix in front of a normalized key name */
	const char *s_name = apr_psprintf(r->pool, "%s%s", claim_prefix, oidc_normalize_header_name(r, s_key));
	char *d_value = NULL;

	if (s_value != NULL) {
		if (pass_as == OIDC_PASS_APP_INFO_AS_BASE64URL) {
			oidc_base64url_encode(r, &d_value, s_value, _oidc_strlen(s_value), TRUE);
		} else if (pass_as == OIDC_PASS_APP_INFO_AS_LATIN1) {
			d_value = oidc_util_utf8_to_latin1(r, s_value);
		}
	}

	if (as_header) {
		oidc_util_hdr_in_set(r, s_name, (d_value != NULL) ? d_value : s_value);
	}

	if (as_env_var) {

		/* do some logging about this event */
		oidc_debug(r, "setting environment variable \"%s: %s\"", s_name, (d_value != NULL) ? d_value : s_value);

		apr_table_set(r->subprocess_env, s_name, (d_value != NULL) ? d_value : s_value);
	}
}
