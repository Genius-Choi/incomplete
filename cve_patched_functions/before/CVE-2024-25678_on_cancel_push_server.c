on_cancel_push_server (void *ctx, uint64_t push_id)
{
    struct ietf_full_conn *const conn = ctx;
    struct lsquic_hash_elem *el;
    struct push_promise *promise;

    EV_LOG_CONN_EVENT(LSQUIC_LOG_CONN_ID, "Received CANCEL_PUSH(%"PRIu64")",
                                                                    push_id);
    if (push_id >= conn->ifc_u.ser.ifser_next_push_id)
    {
        ABORT_QUIETLY(1, HEC_ID_ERROR, "received CANCEL_PUSH with ID=%"PRIu64
            ", which is greater than the maximum Push ID ever generated by "
            "this connection", push_id);
        return;
    }

    el = lsquic_hash_find(conn->ifc_pub.u.ietf.promises, &push_id,
                                                            sizeof(push_id));
    if (!el)
    {
        LSQ_DEBUG("push promise %"PRIu64" not found", push_id);
        return;
    }

    promise = lsquic_hashelem_getdata(el);
    cancel_push_promise(conn, promise);
}
