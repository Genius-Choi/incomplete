njs_json_stringify_to_json(njs_json_stringify_t* stringify,
    njs_json_state_t *state, njs_value_t *key, njs_value_t *value)
{
    njs_value_t     arguments[2];
    njs_function_t  *to_json;

    if (!njs_is_object(value)) {
        return NJS_OK;
    }

    to_json = njs_object_to_json_function(stringify->vm, value);
    if (to_json == NULL) {
        return NJS_OK;
    }

    arguments[0] = *value;

    if (!state->array) {
        arguments[1] = *key;

    } else {
        njs_uint32_to_string(&arguments[1], state->index);
    }

    return njs_function_apply(stringify->vm, to_json, arguments, 2,
                              &stringify->retval);
}
