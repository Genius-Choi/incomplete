void kill_query(const char *reason)
{
  char kill_buffer[40];
  MYSQL *kill_mysql= NULL;

  kill_mysql= mysql_init(kill_mysql);
  init_connection_options(kill_mysql);

  if (!mysql_real_connect(kill_mysql, current_host, current_user,
                          opt_password, "", opt_mysql_port,
                          opt_mysql_unix_port, 0))
  {
    tee_fprintf(stdout, "%s -- Sorry, cannot connect to the server to kill "
                "query, giving up ...\n", reason);
    goto err;
  }

  interrupted_query ++;

  /* mysqld < 5 does not understand KILL QUERY, skip to KILL CONNECTION */
  sprintf(kill_buffer, "KILL %s%lu",
          (mysql_get_server_version(&mysql) < 50000) ? "" : "QUERY ",
          mysql_thread_id(&mysql));

  if (verbose)
    tee_fprintf(stdout, "%s -- sending \"%s\" to server ...\n", reason,
                kill_buffer);
  mysql_real_query(kill_mysql, kill_buffer, (uint) strlen(kill_buffer));
  tee_fprintf(stdout, "%s -- query aborted\n", reason);

err:
  mysql_close(kill_mysql);
  return;
}
