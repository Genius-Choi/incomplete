static bool __io_uring_cancel_task_requests(struct io_ring_ctx *ctx,
					    struct task_struct *task,
					    struct files_struct *files)
{
	bool ret;

	ret = io_uring_cancel_files(ctx, files);
	if (!files) {
		enum io_wq_cancel cret;

		cret = io_wq_cancel_cb(ctx->io_wq, io_cancel_task_cb, task, true);
		if (cret != IO_WQ_CANCEL_NOTFOUND)
			ret = true;

		/* SQPOLL thread does its own polling */
		if (!(ctx->flags & IORING_SETUP_SQPOLL)) {
			while (!list_empty_careful(&ctx->iopoll_list)) {
				io_iopoll_try_reap_events(ctx);
				ret = true;
			}
		}

		ret |= io_poll_remove_all(ctx, task);
		ret |= io_kill_timeouts(ctx, task);
	}

	return ret;
}
