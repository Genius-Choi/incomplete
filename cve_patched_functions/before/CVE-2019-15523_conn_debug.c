void conn_debug(const char *name, const char*buf, size_t count)
{
	char buffer[1024];
	struct conn_debug_buf b = {
		.pos = buffer,
		.rlen = sizeof(buffer)
	};
	int i;

	if ( csync_debug_level < 3 ) return;

	if (csync_server_child_pid)
		buf_printf(&b, "<%d> ", csync_server_child_pid);
	buf_printf(&b, "%s> ", name);
	for (i=0; i<count; i++) {
		switch (buf[i]) {
			case '\n':
				buf_printf(&b, "\\n");
				break;
			case '\r':
				buf_printf(&b, "\\r");
				break;
			default:
				if (buf[i] < 32 || buf[i] >= 127)
					buf_printf(&b, "\\%03o", buf[i]);
				else
					buf_printf(&b, "%c", buf[i]);
				break;
		}
	}
	fprintf(csync_debug_out, "%s\n", buffer);
}
