bool sign_sha256(EVP_PKEY* private_key, const unsigned char* data, const size_t data_length,
        std::vector<uint8_t>& signature)
{
    assert(private_key);
    assert(data);

    bool returnedValue = false;
    EVP_MD_CTX ctx;
    EVP_MD_CTX_init(&ctx);

    if(EVP_DigestSignInit(&ctx, NULL, EVP_sha256(), NULL, private_key) == 1)
    {
        if(EVP_DigestSignUpdate(&ctx, data, data_length) == 1)
        {
            size_t length = 0;
            if(EVP_DigestSignFinal(&ctx, NULL, &length) == 1 && length > 0)
            {
                size_t aux_length = length;
                signature.resize(length);

                if(EVP_DigestSignFinal(&ctx, signature.data(), &length) ==  1)
                {
                    signature.resize(length);
                    returnedValue = true; 
                }
                else
                    logError(AUTHENTICATION, "Cannot finish signature (" << ERR_get_error() << ")");
            }
            else
                logError(AUTHENTICATION, "Cannot retrieve signature length (" << ERR_get_error() << ")");
        }
        else
            logError(AUTHENTICATION, "Cannot sign data (" << ERR_get_error() << ")");
    }
    else
        logError(AUTHENTICATION, "Cannot init signature (" << ERR_get_error() << ")");

    EVP_MD_CTX_cleanup(&ctx);

    return returnedValue;
}
