PJ_DEF(pj_status_t) pjmedia_transport_srtp_stop(pjmedia_transport *srtp)
{
    transport_srtp *p_srtp = (transport_srtp*) srtp;

    PJ_ASSERT_RETURN(srtp, PJ_EINVAL);

    pj_lock_acquire(p_srtp->mutex);

    if (!p_srtp->session_inited) {
        pj_lock_release(p_srtp->mutex);
        return PJ_SUCCESS;
    }

    destroy_srtp_ctx(p_srtp, &p_srtp->srtp_ctx);
    destroy_srtp_ctx(p_srtp, &p_srtp->srtp_rtcp);

    p_srtp->session_inited = PJ_FALSE;

    pj_lock_release(p_srtp->mutex);

    return PJ_SUCCESS;
}
