static void econn_conn_handler(struct econn *econn,
			       uint32_t msg_time,
			       const char *userid_sender,
			       const char *clientid_sender,
			       uint32_t age,
			       const char *sdp,
			       struct econn_props *props,
			       bool reset,
			       void *arg)
{
	struct ecall *ecall = arg;
	int err = 0;
	const char *vr;
	bool video_active = false;
	char userid_anon1[ANON_ID_LEN];
	char userid_anon2[ANON_ID_LEN];
	//char clientid_anon[ANON_CLIENT_LEN];

	assert(ECALL_MAGIC == ecall->magic);

	/* check if the Peer UserID is set */
	if (str_isset(ecall->userid_peer)) {

		if (0 != str_casecmp(ecall->userid_peer,
				     userid_sender)) {

			warning("ecall: conn_handler:"
			     " peer UserID already set to `%s'"
			     " - dropping message with `%s'\n",
			     anon_id(userid_anon1, ecall->userid_peer),
			     anon_id(userid_anon2, userid_sender));
		}
	}
	else {
		err = str_dup(&ecall->userid_peer, userid_sender);
		if (err)
			goto error;
	}

	if (reset || !ecall->flow) {
		err = alloc_flow(ecall, ASYNC_ANSWER, ecall->call_type, false);
		if (err)
			goto error;
	}

	IFLOW_CALL(ecall->flow, set_remote_userclientid,
		userid_sender, clientid_sender);

	set_offer_sdp(ecall, sdp);
	
#if 0
	err = mediaflow_handle_offer(ecall->flow, sdp);
	if (err) {
		warning("ecall[%s]: handle_offer error (%m)\n",
			anon_id(userid_anon1, ecall->userid_self), err);
		goto error;
	}
#endif

/*
	if (!IFLOW_CALLE(ecall->flow, has_data)) {
		warning("ecall: conn_handler: remote peer does not"
			" support datachannels (%s|%s)\n",
			anon_id(userid_anon1, userid_sender),
			anon_client(clientid_anon, clientid_sender));
		return;
	}
*/
	/* check for remote properties */
	if (reset) {
		ecall->props_remote = mem_deref(ecall->props_remote);
	}

	if (ecall->props_remote) {
		warning("ecall: conn_handler: remote props already set");
		err = EPROTO;
		goto error;
	}
	ecall->props_remote = mem_ref(props);

	vr = ecall_props_get_remote(ecall, "videosend");
	if (vr) {
		if (strcmp(vr, "true") == 0) {
			video_active = true;
		}
	}

	info("ecall(%p): conn_handler: message age is %u seconds\n",
	     ecall, age);

	if (reset) {
		ecall->sdp.async = ASYNC_NONE;
		ecall->update = false;
		err = ecall_answer(ecall, ecall->call_type, ecall->audio_cbr);
		if (err)
			goto error;
	}
	else {
		ICALL_CALL_CB(ecall->icall, starth,
			&ecall->icall, msg_time, userid_sender, clientid_sender,
			video_active, true, ICALL_CONV_TYPE_ONEONONE,
			ecall->icall.arg);

		ecall->ts_started = tmr_jiffies();
		ecall->call_setup_time = -1;
	}

	return;

 error:
	ecall_close(ecall, err, msg_time);
}
