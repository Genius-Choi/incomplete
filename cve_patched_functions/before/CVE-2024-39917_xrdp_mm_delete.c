xrdp_mm_delete(struct xrdp_mm *self)
{
    if (self == 0)
    {
        return;
    }

    /* shutdown input method */
    xrdp_mm_send_unicode_shutdown(self, self->chan_trans);

    /* free any module stuff */
    xrdp_mm_module_cleanup(self);

    /* shutdown thread */
    xrdp_encoder_delete(self->encoder);

    trans_delete(self->sesman_trans);
    self->sesman_trans = 0;
    list_delete(self->login_names);
    list_delete(self->login_values);
    list_delete(self->resize_queue);
    g_free(self->resize_data);
    g_delete_wait_obj(self->resize_ready);
    xrdp_egfx_shutdown_full(self->egfx);
    g_free(self);
}
