typedArrayPrototypeIndexOf(void *ctx, Runtime &runtime, NativeArgs args) {
  const auto indexOfMode = *reinterpret_cast<const IndexOfMode *>(&ctx);
  // indexOfMode stores Whether this call is "includes", "indexOf", or
  // "lastIndexOf".
  auto ret = [indexOfMode](bool x = false, double y = -1) {
    switch (indexOfMode) {
      case IndexOfMode::includes:
        return HermesValue::encodeBoolValue(x);
      default:
        return HermesValue::encodeNumberValue(y);
    }
  };
  if (JSTypedArrayBase::validateTypedArray(runtime, args.getThisHandle()) ==
      ExecutionStatus::EXCEPTION) {
    return ExecutionStatus::EXCEPTION;
  }
  auto self = args.vmcastThis<JSTypedArrayBase>();
  double len = self->getLength();
  if (len == 0) {
    return ret();
  }
  auto searchElement = args.getArgHandle(0);
  if (!searchElement->isNumber() && !searchElement->isBigInt()) {
    // If it's not a number, nothing will match.
    return ret();
  }
  double fromIndex = 0;
  if (args.getArgCount() < 2) {
    // Zero default for forward, end default for backward.
    if (indexOfMode == IndexOfMode::lastIndexOf) {
      fromIndex = len - 1;
    }
  } else {
    auto res = toIntegerOrInfinity(runtime, args.getArgHandle(1));
    if (res == ExecutionStatus::EXCEPTION) {
      return ExecutionStatus::EXCEPTION;
    }
    fromIndex = res->getNumber();
    if (LLVM_UNLIKELY(!self->attached(runtime))) {
      // If the ToInteger call detached this TypedArray, raise a TypeError and
      // don't continue.
      return runtime.raiseTypeError("Detached the TypedArray in the callback");
    }
  }
  // Negative zero case.
  if (fromIndex == 0) {
    fromIndex = 0;
  }
  double k = 0;
  if (indexOfMode == IndexOfMode::lastIndexOf) {
    k = fromIndex >= 0 ? std::min(fromIndex, len - 1) : len + fromIndex;
  } else {
    k = fromIndex >= 0 ? fromIndex : std::max(len + fromIndex, 0.0);
  }
  auto delta = indexOfMode == IndexOfMode::lastIndexOf ? -1 : 1;
  auto inRange = [indexOfMode](double k, double len) {
    if (indexOfMode == IndexOfMode::lastIndexOf) {
      return k >= 0;
    } else {
      return k < len;
    }
  };
  for (; inRange(k, len); k += delta) {
    HermesValue curr =
        JSObject::getOwnIndexed(createPseudoHandle(self.get()), runtime, k);
    NoAllocScope noAllocs{runtime};

    bool comp = indexOfMode == IndexOfMode::includes
        ? isSameValueZero(curr, *searchElement)
        : strictEqualityTest(curr, *searchElement);
    if (comp) {
      return ret(true, k);
    }
  }
  return ret();
}
