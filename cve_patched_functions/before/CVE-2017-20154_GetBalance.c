int64 CWallet::GetBalance(uint nSettings) const {
    int64 nTotal = 0;
    LOCK(cs_wallet);
    for(map<uint256, CWalletTx>::const_iterator it = mapWallet.begin(); it != mapWallet.end(); ++it) {
        const CWalletTx* pcoin = &(*it).second;
        int nDepth = pcoin->GetDepthInMainChain();
        if((nSettings & 0x1) && (nDepth >= TX_MATURITY))
          nTotal += pcoin->GetAvailableCredit();
        if((nSettings & 0x2) && (nDepth < TX_MATURITY) && (nDepth >= 0))
          nTotal += pcoin->GetAvailableCredit();
    }
    return(nTotal);
}
