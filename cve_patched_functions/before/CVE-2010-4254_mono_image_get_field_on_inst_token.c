mono_image_get_field_on_inst_token (MonoDynamicImage *assembly, MonoReflectionFieldOnTypeBuilderInst *f)
{
	guint32 token;
	MonoClass *klass;
	MonoGenericClass *gclass;
	MonoDynamicGenericClass *dgclass;
	MonoReflectionFieldBuilder *fb = f->fb;
	MonoType *type;
	char *name;

	token = GPOINTER_TO_UINT (g_hash_table_lookup (assembly->handleref, f));
	if (token)
		return token;
	type = mono_reflection_type_get_handle ((MonoReflectionType*)f->inst);
	klass = mono_class_from_mono_type (type);
	gclass = type->data.generic_class;
	g_assert (gclass->is_dynamic);
	dgclass = (MonoDynamicGenericClass *) gclass;

	name = mono_string_to_utf8 (fb->name);
	token = mono_image_get_memberref_token (assembly, &klass->byval_arg, name, 
											field_encode_signature (assembly, fb));
	g_free (name);
	g_hash_table_insert (assembly->handleref, f, GUINT_TO_POINTER (token));
	return token;
}
