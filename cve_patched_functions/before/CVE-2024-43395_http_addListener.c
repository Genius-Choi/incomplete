static int http_addListener(lua_State *L) {
    lastCFunction = __func__;
    const lua_Integer port_ = (int)luaL_checkinteger(L, 1);
    if (port_ < 0 || port_ > 65535) return 0;
    const unsigned short port = (unsigned short)port_;
    if (listeners.find(port) != listeners.end()) {
        delete listeners[port];
        listeners.erase(port);
    }
    HTTPServer * srv;
    try {
        srv = new HTTPServer((HTTPRequestHandlerFactory*)new HTTPListener::Factory(get_comp(L), port), port, new HTTPServerParams);
    } catch (NetException &e) {
        return luaL_error(L, "Could not open server: %s\n", e.message().c_str());
    } catch (std::exception &e) {
        return luaL_error(L, "Could not open server: %s\n", e.what());
    }
    srv->start();
    listeners[port] = srv;
    return 0;
}
