CV8RealTimeWorker::CV8RealTimeWorker(NSDoctRenderer::CDocBuilder* pBuilder)
{
	m_nFileType = -1;

	m_context = new CJSContext();
	m_context->Initialize();

	m_isolate_scope = m_context->CreateIsolateScope();
	m_handle_scope  = m_context->CreateLocalScope();

	m_context->CreateGlobalForContext();
	CNativeControlEmbed::CreateObjectBuilderInContext("CreateNativeEngine", m_context);
	CGraphicsEmbed::CreateObjectInContext("CreateNativeGraphics", m_context);
	NSJSBase::CreateDefaults(m_context);
	m_context->CreateContext();

	JSSmart<CJSContextScope> context_scope = m_context->CreateContextScope();
	JSSmart<CJSTryCatch> try_catch = m_context->GetExceptions();

	builder_CreateNative("builderJS", m_context, pBuilder);
}
