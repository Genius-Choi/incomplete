static int connect_socket(SOCKET socket, struct sockaddr* addr, size_t len)
{
    int result;
    u_long iMode = 1;

    if (connect(socket, addr, (int)len) != 0)
    {
        LogError("Failure: connect failure %d.", WSAGetLastError());
        result = MU_FAILURE;
    }
    else if (ioctlsocket(socket, FIONBIO, &iMode) != 0)
    {
        LogError("Failure: ioctlsocket failure %d.", WSAGetLastError());
        result = MU_FAILURE;
    }
    else
    {
        result = 0;
    }

    return result;
}
