struct ncrx *ncrx_create(const struct ncrx_param *param)
{
	const struct ncrx_param *dfl = &ncrx_dfl_param;
	struct ncrx_param *p;
	struct ncrx *ncrx;
	int i;

	ncrx = calloc(1, sizeof(*ncrx));
	if (!ncrx)
		return NULL;

	p = &ncrx->p;
	if (param) {
		p->nr_slots	= param->nr_slots	?: dfl->nr_slots;

		p->ack_intv	= param->ack_intv	?: dfl->ack_intv;
		p->retx_intv	= param->retx_intv	?: dfl->retx_intv;
		p->retx_stride	= param->retx_stride	?: dfl->retx_stride;
		p->msg_timeout	= param->msg_timeout	?: dfl->msg_timeout;

		p->oos_thr	= param->oos_thr	?: dfl->oos_thr;
		p->oos_intv	= param->oos_intv	?: dfl->oos_intv;
		p->oos_timeout	= param->oos_timeout	?: dfl->oos_timeout;
	} else {
		*p = *dfl;
	}

	ncrx->acked_seq = UINT64_MAX;
	init_list(&ncrx->hole_list);
	init_list(&ncrx->oos_list.head);
	init_list(&ncrx->retired_list.head);

	ncrx->slots = calloc(ncrx->p.nr_slots, sizeof(ncrx->slots[0]));
	if (!ncrx->slots)
		return NULL;

	for (i = 0; i < ncrx->p.nr_slots; i++)
		init_list(&ncrx->slots[i].hole_node);

	return ncrx;
}
