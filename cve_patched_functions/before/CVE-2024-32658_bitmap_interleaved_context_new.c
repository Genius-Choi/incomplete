BITMAP_INTERLEAVED_CONTEXT* bitmap_interleaved_context_new(BOOL Compressor)
{
	BITMAP_INTERLEAVED_CONTEXT* interleaved = NULL;
	interleaved = (BITMAP_INTERLEAVED_CONTEXT*)winpr_aligned_recalloc(
	    NULL, 1, sizeof(BITMAP_INTERLEAVED_CONTEXT), 32);

	if (interleaved)
	{
		interleaved->TempSize = 64 * 64 * 4;
		interleaved->TempBuffer = winpr_aligned_calloc(interleaved->TempSize, sizeof(BYTE), 16);

		if (!interleaved->TempBuffer)
			goto fail;

		interleaved->bts = Stream_New(NULL, interleaved->TempSize);

		if (!interleaved->bts)
			goto fail;
	}

	return interleaved;

fail:
	WINPR_PRAGMA_DIAG_PUSH
	WINPR_PRAGMA_DIAG_IGNORED_MISMATCHED_DEALLOC
	bitmap_interleaved_context_free(interleaved);
	WINPR_PRAGMA_DIAG_POP
	return NULL;
}
