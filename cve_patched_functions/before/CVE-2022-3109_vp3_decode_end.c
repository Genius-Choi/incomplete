static av_cold int vp3_decode_end(AVCodecContext *avctx)
{
    Vp3DecodeContext *s = avctx->priv_data;
    int i, j;

    free_tables(avctx);
    av_freep(&s->edge_emu_buffer);

    s->theora_tables = 0;

    /* release all frames */
    vp3_decode_flush(avctx);
    av_frame_free(&s->current_frame.f);
    av_frame_free(&s->last_frame.f);
    av_frame_free(&s->golden_frame.f);

    for (i = 0; i < FF_ARRAY_ELEMS(s->coeff_vlc); i++)
        ff_free_vlc(&s->coeff_vlc[i]);

    ff_free_vlc(&s->superblock_run_length_vlc);
    ff_free_vlc(&s->fragment_run_length_vlc);
    ff_free_vlc(&s->mode_code_vlc);
    ff_free_vlc(&s->motion_vector_vlc);

    for (j = 0; j < 2; j++)
        for (i = 0; i < 7; i++)
            ff_free_vlc(&s->vp4_mv_vlc[j][i]);

    for (i = 0; i < 2; i++)
        ff_free_vlc(&s->block_pattern_vlc[i]);
    return 0;
}
