char * ulfius_url_encode(const char * str) {
  char * pstr = (char*)str, * buf = NULL, * pbuf = NULL;
  if (str != NULL) {
    buf = malloc(strlen(str) * 3 + 1);
    if (buf != NULL) {
      pbuf = buf;
      while (* pstr) {
        // "$-_.+!*'(),"
        if (isalnum(* pstr) || * pstr == '$' || * pstr == '-' || * pstr == '_' ||
            * pstr == '.' || * pstr == '!' || * pstr == '*' ||
            * pstr == '\'' || * pstr == '(' || * pstr == ')' || * pstr == ',')
          * pbuf++ = * pstr;
        else if (* pstr == ' ')
          * pbuf++ = '+';
        else
          * pbuf++ = '%', * pbuf++ = to_hex(* pstr >> 4), * pbuf++ = to_hex(* pstr & 15);
        pstr++;
      }
      * pbuf = '\0';
    } else {
      y_log_message(Y_LOG_LEVEL_ERROR, "Ulfius - Error allocating resources for buf (ulfius_url_encode)");
    }
    return buf;
  } else {
    return NULL;
  }
}
