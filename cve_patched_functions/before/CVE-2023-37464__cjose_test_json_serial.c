static void _cjose_test_json_serial(const char *json, const char *match_json, cjose_jwe_recipient_t *rec)
{

    cjose_jwe_t *jwe;
    cjose_err err;

    jwe = cjose_jwe_import_json(json, strlen(json), &err);
    ck_assert_msg(NULL != jwe,
                  "failed to import multi-recipient json: "
                  "%s, file: %s, function: %s, line: %ld",
                  err.message, err.file, err.function, err.line);

    size_t decoded_len;
    char *decoded = cjose_jwe_decrypt_multi(jwe, cjose_multi_key_locator, rec, &decoded_len, &err);
    ck_assert_msg(NULL != decoded,
                  "failed to decrypt for multiple recipients: "
                  "%s, file: %s, function: %s, line: %ld",
                  err.message, err.file, err.function, err.line);
    ck_assert_msg(memcmp(decoded, PLAINTEXT, decoded_len) == 0 && decoded_len == strlen(PLAINTEXT) + 1,
                  "decrypted plaintext does not match");
    cjose_get_dealloc()(decoded);

    decoded = cjose_jwe_export_json(jwe, &err);
    ck_assert_msg(NULL != decoded,
                  "failed to serialize JWE into json: "
                  "%s, file: %s, function: %s, line: %ld",
                  err.message, err.file, err.function, err.line);
    ck_assert_msg(strcmp(decoded, match_json) == 0, "serialized json doesn't match expectation");

    cjose_get_dealloc()(decoded);

    cjose_jwe_release(jwe);
}
