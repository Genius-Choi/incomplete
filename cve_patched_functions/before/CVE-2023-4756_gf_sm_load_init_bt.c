GF_Err gf_sm_load_init_bt(GF_SceneLoader *load)
{
	GF_Err e;
	GF_BTParser *parser;

	if (!load || (!load->ctx && !load->scene_graph) ) return GF_BAD_PARAM;
	if (!load->scene_graph) load->scene_graph = load->ctx->scene_graph;

	GF_SAFEALLOC(parser, GF_BTParser);
	if (!parser) return GF_OUT_OF_MEM;
	parser->load = load;
	load->loader_priv = parser;
	parser->def_symbols = gf_list_new();
	parser->unresolved_routes = gf_list_new();
	parser->inserted_routes = gf_list_new();
	parser->undef_nodes = gf_list_new();
	parser->def_nodes = gf_list_new();
	parser->peeked_nodes = gf_list_new();
	parser->scripts = gf_list_new();

	load->process = load_bt_run;
	load->done = load_bt_done;
	load->suspend = load_bt_suspend;
	load->parse_string = load_bt_parse_string;

#ifdef GPAC_ENABLE_COVERAGE
	if (gf_sys_is_cov_mode()) {
		gf_bt_report(parser, GF_OK, NULL);
	}
#endif

	e = gf_sm_load_bt_initialize(load, NULL, 0);
	if (e) {
		load_bt_done(load);
		return e;
	}
	return GF_OK;
}
