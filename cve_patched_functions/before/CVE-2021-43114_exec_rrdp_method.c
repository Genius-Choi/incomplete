exec_rrdp_method(struct sia_ca_uris *sia_uris)
{
	bool data_updated;
	int error;

	/* Start working on the RRDP local workspace */
	error = db_rrdp_uris_workspace_enable();
	if (error)
		return error;

	data_updated = false;
	error = rrdp_load(sia_uris->rpkiNotify.uri, &data_updated);
	if (error)
		goto err;

	error = verify_rrdp_mft_loc(sia_uris->mft.uri);
	switch(error) {
	case 0:
		/* MFT exists, great! We're good to go. */
		break;
	case -ENOENT:
		/* Doesn't exist and the RRDP data was updated: error */
		if (data_updated)
			goto err;

		/* Otherwise, force the snapshot processing and check again */
		error = rrdp_reload_snapshot(sia_uris->rpkiNotify.uri);
		if (error)
			goto err;
		error = verify_rrdp_mft_loc(sia_uris->mft.uri);
		if (error)
			goto err;
		break;
	default:
		goto err;
	}

	/* Successfully loaded (or no updates yet), update MFT local URI */
	error = replace_rrdp_mft_uri(&sia_uris->mft);
	if (error)
		goto err;

	return 0;
err:
	db_rrdp_uris_workspace_disable();
	return error;
}
