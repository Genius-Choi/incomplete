void AuthChecker::InitKey() {
  Certs &key_cache = context_->service_context()->certs();
  auto cert = key_cache.GetCert(user_info_.issuer);

  if (cert == nullptr || system_clock::now() > cert->second) {
    // Key has not been fetched or has expired.
    std::string url;
    bool tryOpenId =
        context_->service_context()->GetJwksUri(user_info_.issuer, &url);
    if (url.empty()) {
      Unauthenticated("Cannot determine the URI of the key");
      return;
    }

    if (tryOpenId) {
      DiscoverJwksUri(url);
    } else {
      // JwksUri is available. No need to try openID discovery.
      FetchPubKey(url);
    }
  } else {
    // Key is in the cache, next step is to verify signature.
    VerifySignature();
  }
}
