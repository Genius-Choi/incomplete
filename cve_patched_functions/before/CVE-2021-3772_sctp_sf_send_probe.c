enum sctp_disposition sctp_sf_send_probe(struct net *net,
					 const struct sctp_endpoint *ep,
					 const struct sctp_association *asoc,
					 const union sctp_subtype type,
					 void *arg,
					 struct sctp_cmd_seq *commands)
{
	struct sctp_transport *transport = (struct sctp_transport *)arg;
	struct sctp_chunk *reply;

	if (!sctp_transport_pl_enabled(transport))
		return SCTP_DISPOSITION_CONSUME;

	if (sctp_transport_pl_send(transport)) {
		reply = sctp_make_heartbeat(asoc, transport, transport->pl.probe_size);
		if (!reply)
			return SCTP_DISPOSITION_NOMEM;
		sctp_add_cmd_sf(commands, SCTP_CMD_REPLY, SCTP_CHUNK(reply));
	}
	sctp_add_cmd_sf(commands, SCTP_CMD_PROBE_TIMER_UPDATE,
			SCTP_TRANSPORT(transport));

	return SCTP_DISPOSITION_CONSUME;
}
