mt_copy(mrb_state *mrb, mt_tbl *t)
{
  mt_tbl *t2;
  size_t i;

  if (t == NULL) return NULL;
  if (t->alloc == 0) return NULL;
  if (t->size == 0) return NULL;

  t2 = mt_new(mrb);
  for (i=0; i<t->alloc; i++) {
    struct mt_elem *slot = &t->table[i];

    if (slot->key) {
      mt_put(mrb, t2, slot->key, slot->func_p, slot->noarg_p, slot->ptr);
    }
  }
  return t2;
}
