handle_file_based_request(struct mg_connection *conn,
                          const char *path,
                          struct mg_file *file)
{
	if (!conn || !conn->dom_ctx) {
		return;
	}

	if (0) {
#if defined(USE_LUA)
	} else if (match_prefix(
	               conn->dom_ctx->config[LUA_SERVER_PAGE_EXTENSIONS],
	               strlen(conn->dom_ctx->config[LUA_SERVER_PAGE_EXTENSIONS]),
	               path) > 0) {
		if (is_in_script_path(conn, path)) {
			/* Lua server page: an SSI like page containing mostly plain
			 * html
			 * code
			 * plus some tags with server generated contents. */
			handle_lsp_request(conn, path, file, NULL);
		} else {
			/* Script was in an illegal path */
			mg_send_http_error(conn, 403, "%s", "Forbidden");
		}

	} else if (match_prefix(conn->dom_ctx->config[LUA_SCRIPT_EXTENSIONS],
	                        strlen(
	                            conn->dom_ctx->config[LUA_SCRIPT_EXTENSIONS]),
	                        path) > 0) {
		if (is_in_script_path(conn, path)) {
			/* Lua in-server module script: a CGI like script used to
			 * generate
			 * the
			 * entire reply. */
			mg_exec_lua_script(conn, path, NULL);
		} else {
			/* Script was in an illegal path */
			mg_send_http_error(conn, 403, "%s", "Forbidden");
		}
#endif
#if defined(USE_DUKTAPE)
	} else if (match_prefix(
	               conn->dom_ctx->config[DUKTAPE_SCRIPT_EXTENSIONS],
	               strlen(conn->dom_ctx->config[DUKTAPE_SCRIPT_EXTENSIONS]),
	               path) > 0) {
		if (is_in_script_path(conn, path)) {
			/* Call duktape to generate the page */
			mg_exec_duktape_script(conn, path);
		} else {
			/* Script was in an illegal path */
			mg_send_http_error(conn, 403, "%s", "Forbidden");
		}
#endif
#if !defined(NO_CGI)
	} else if (match_prefix(conn->dom_ctx->config[CGI_EXTENSIONS],
	                        strlen(conn->dom_ctx->config[CGI_EXTENSIONS]),
	                        path) > 0) {
		if (is_in_script_path(conn, path)) {
			/* CGI scripts may support all HTTP methods */
			handle_cgi_request(conn, path);
		} else {
			/* Script was in an illegal path */
			mg_send_http_error(conn, 403, "%s", "Forbidden");
		}
#endif /* !NO_CGI */
	} else if (match_prefix(conn->dom_ctx->config[SSI_EXTENSIONS],
	                        strlen(conn->dom_ctx->config[SSI_EXTENSIONS]),
	                        path) > 0) {
		if (is_in_script_path(conn, path)) {
			handle_ssi_file_request(conn, path, file);
		} else {
			/* Script was in an illegal path */
			mg_send_http_error(conn, 403, "%s", "Forbidden");
		}
#if !defined(NO_CACHING)
	} else if ((!conn->in_error_handler)
	           && is_not_modified(conn, &file->stat)) {
		/* Send 304 "Not Modified" - this must not send any body data */
		handle_not_modified_static_file_request(conn, file);
#endif /* !NO_CACHING */
	} else {
		handle_static_file_request(conn, path, file, NULL, NULL);
	}
}
