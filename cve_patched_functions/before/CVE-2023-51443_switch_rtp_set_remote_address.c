SWITCH_DECLARE(switch_status_t) switch_rtp_set_remote_address(switch_rtp_t *rtp_session, const char *host, switch_port_t port, switch_port_t remote_rtcp_port,
															  switch_bool_t change_adv_addr, const char **err)
{
	switch_sockaddr_t *remote_addr;
	switch_status_t status = SWITCH_STATUS_SUCCESS;
	*err = "Success";

	if (switch_sockaddr_info_get(&remote_addr, host, SWITCH_UNSPEC, port, 0, rtp_session->pool) != SWITCH_STATUS_SUCCESS || !remote_addr) {
		*err = "Remote Address Error!";
		return SWITCH_STATUS_FALSE;
	}


	switch_mutex_lock(rtp_session->write_mutex);

	rtp_session->remote_addr = remote_addr;

	if (change_adv_addr) {
		rtp_session->remote_host_str = switch_core_strdup(rtp_session->pool, host);
		rtp_session->remote_port = port;
	}

	rtp_session->eff_remote_host_str = switch_core_strdup(rtp_session->pool, host);
	rtp_session->eff_remote_port = port;

	if (rtp_session->sock_input && switch_sockaddr_get_family(rtp_session->remote_addr) == switch_sockaddr_get_family(rtp_session->local_addr)) {
		rtp_session->sock_output = rtp_session->sock_input;
	} else {
		if (rtp_session->sock_output && rtp_session->sock_output != rtp_session->sock_input) {
			switch_socket_close(rtp_session->sock_output);
		}
		if ((status = switch_socket_create(&rtp_session->sock_output,
										   switch_sockaddr_get_family(rtp_session->remote_addr),
										   SOCK_DGRAM, 0, rtp_session->pool)) != SWITCH_STATUS_SUCCESS) {

			*err = "Socket Error!";
		}
	}

	if (rtp_session->dtls) {
		rtp_session->dtls->sock_output = rtp_session->sock_output;

		if (rtp_session->flags[SWITCH_RTP_FLAG_RTCP_MUX]) {
			status = switch_sockaddr_info_get(&rtp_session->dtls->remote_addr, host, SWITCH_UNSPEC, port, 0, rtp_session->pool);
		}
	}


	if (rtp_session->flags[SWITCH_RTP_FLAG_ENABLE_RTCP]) {
		if (rtp_session->flags[SWITCH_RTP_FLAG_RTCP_MUX]) {
			rtp_session->rtcp_remote_addr = rtp_session->remote_addr;
			rtp_session->rtcp_sock_output = rtp_session->sock_output;
		}/* else {
			if (remote_rtcp_port) {
				rtp_session->remote_rtcp_port = remote_rtcp_port;
			} else {
				rtp_session->remote_rtcp_port = rtp_session->eff_remote_port + 1;
			}
			status = enable_remote_rtcp_socket(rtp_session, err);

			if (rtp_session->rtcp_dtls) {
				//switch_sockaddr_info_get(&rtp_session->rtcp_dtls->remote_addr, host, SWITCH_UNSPEC, port, 0, rtp_session->pool);
				rtp_session->rtcp_dtls->remote_addr = rtp_session->rtcp_remote_addr;
				rtp_session->rtcp_dtls->sock_output = rtp_session->rtcp_sock_output;
			}
			}*/
	}

	switch_mutex_unlock(rtp_session->write_mutex);

	return status;
}
