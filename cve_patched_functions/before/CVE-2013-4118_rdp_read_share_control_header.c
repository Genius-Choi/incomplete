BOOL rdp_read_share_control_header(STREAM* s, UINT16* length, UINT16* type, UINT16* channel_id)
{
	if (stream_get_left(s) < 2)
		return FALSE;

	/* Share Control Header */
	stream_read_UINT16(s, *length); /* totalLength */

	if (*length - 2 > stream_get_left(s))
		return FALSE;

	stream_read_UINT16(s, *type); /* pduType */
	*type &= 0x0F; /* type is in the 4 least significant bits */

	if (*length > 4)
		stream_read_UINT16(s, *channel_id); /* pduSource */
	else
		*channel_id = 0; /* Windows XP can send such short DEACTIVATE_ALL PDUs. */

	return TRUE;
}
