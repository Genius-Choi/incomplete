static int try_to_authenticate(struct MHD_Connection *connection, t_client *client, const char *host, const char *url)
{
	s_config *config;
	const char *tok;
	char *rhid;
	char *rhidraw;

	config = config_get_config();

	// Check for authdir
	if (check_authdir_match(url, config->authdir)) {
		tok = MHD_lookup_connection_value(connection, MHD_GET_ARGUMENT_KIND, "tok");

		if (tok == NULL) {
			return send_error(connection, 403);
		}

		debug(LOG_DEBUG, "client->token=%s tok=%s ", client->token, tok );

		//Check if token (tok) or hash_id (hid) mode
		if (strlen(tok) > 8) {
			// hid mode
			rhidraw = safe_calloc(SMALL_BUF);
			safe_asprintf(&rhidraw, "%s%s", client->hid, config->fas_key);
			rhid = safe_calloc(STATUS_BUF);
			hash_str(rhid, STATUS_BUF, rhidraw);
			free (rhidraw);
			if (tok && !strcmp(rhid, tok)) {
				// rhid is valid
				free(rhid);
				return 1;
			}
			free(rhid);
		} else {
			// tok mode
			if (tok && !strcmp(client->token, tok)) {
				// Token is valid
				return 1;
			}
		}
	}

	debug(LOG_WARNING, "Token is invalid" );

/*	//TODO: do we need denydir?
	if (check_authdir_match(url, config->denydir)) {
		// matched to deauth
		return 0;
	}
*/

	return 0;
}
