static void test_wl5928()
{
  MYSQL_STMT *stmt;
  int         rc;
  MYSQL_RES  *result;

  myheader("test_wl5928");

  if (mysql_get_server_version(mysql) < 50702)
  {
    if (!opt_silent)
      fprintf(stdout, "Skipping test_wl5928: "
              "tested feature does not exist in versions before MySQL 5.7.2\n");
    return;
  }

  stmt= mysql_simple_prepare(mysql, "SHOW WARNINGS");
  DIE_UNLESS(stmt == NULL);
  stmt= mysql_simple_prepare(mysql, "SHOW ERRORS");
  DIE_UNLESS(stmt == NULL);
  stmt= mysql_simple_prepare(mysql, "SHOW COUNT(*) WARNINGS");
  DIE_UNLESS(stmt == NULL);
  stmt= mysql_simple_prepare(mysql, "SHOW COUNT(*) ERRORS");
  DIE_UNLESS(stmt == NULL);
  stmt= mysql_simple_prepare(mysql, "SELECT @@warning_count");
  DIE_UNLESS(stmt == NULL);
  stmt= mysql_simple_prepare(mysql, "SELECT @@error_count");
  DIE_UNLESS(stmt == NULL);
  stmt= mysql_simple_prepare(mysql, "GET DIAGNOSTICS");
  DIE_UNLESS(stmt == NULL);

  /* PREPARE */

  stmt= mysql_simple_prepare(mysql, "CREATE TABLE t1 (f1 YEAR(1))");
  DIE_UNLESS(mysql_warning_count(mysql) == 1);
  check_stmt(stmt);

  /* SHOW WARNINGS.  (Will keep diagnostics) */
  rc= mysql_query(mysql, "SHOW WARNINGS");
  myquery(rc);
  result= mysql_store_result(mysql);
  mytest(result);
  rc= my_process_result_set(result);
  DIE_UNLESS(rc == 1);
  mysql_free_result(result);

  /* EXEC */
  rc= mysql_stmt_execute(stmt);
  check_execute(stmt, rc);
  DIE_UNLESS(mysql_warning_count(mysql) == 0);

  /* SHOW WARNINGS.  (Will keep diagnostics) */
  rc= mysql_query(mysql, "SHOW WARNINGS");
  myquery(rc);
  result= mysql_store_result(mysql);
  mytest(result);
  rc= my_process_result_set(result);
  DIE_UNLESS(rc == 0);
  mysql_free_result(result);

  /* clean up */
  mysql_stmt_close(stmt);

  stmt= mysql_simple_prepare(mysql, "DROP TABLE t1");
  check_stmt(stmt);
  rc= mysql_stmt_execute(stmt);
  check_execute(stmt, rc);
  mysql_stmt_close(stmt);

  stmt= mysql_simple_prepare(mysql, "SELECT 1");
  check_stmt(stmt);
  rc= mysql_stmt_execute(stmt);
  check_execute(stmt, rc);
  mysql_stmt_close(stmt);
}
