BOOL gcc_write_server_network_data(wStream* s, rdpMcs* mcs)
{
	UINT32 i;
	int payloadLen = 8 + mcs->channelCount * 2 + (mcs->channelCount % 2 == 1 ? 2 : 0);

	if (!Stream_EnsureRemainingCapacity(s, payloadLen + 4))
		return FALSE;

	gcc_write_user_data_header(s, SC_NET, payloadLen);
	Stream_Write_UINT16(s, MCS_GLOBAL_CHANNEL_ID); /* MCSChannelId */
	Stream_Write_UINT16(s, mcs->channelCount);     /* channelCount */

	for (i = 0; i < mcs->channelCount; i++)
	{
		Stream_Write_UINT16(s, mcs->channels[i].ChannelId);
	}

	if (mcs->channelCount % 2 == 1)
		Stream_Write_UINT16(s, 0);

	return TRUE;
}
