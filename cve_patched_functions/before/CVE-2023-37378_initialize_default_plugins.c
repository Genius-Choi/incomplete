int CEXEBuild::initialize_default_plugins(bool newtargetarc)
{
  if (!m_pPlugins)
  {
    plugin_used = uninst_plugin_used = false;
    newtargetarc = true;
  }
  if (!newtargetarc) return PS_OK;

  m_pPlugins = &m_plugins[m_target_type];

  tstring searchPath = definedlist.find(_T("NSISDIR"));
  searchPath += PLATFORM_PATH_SEPARATOR_STR _T("Plugins") PLATFORM_PATH_SEPARATOR_STR;
  searchPath += get_target_suffix();

  SCRIPT_MSG(_T("Processing default plugins: \"%") NPRIs PLATFORM_PATH_SEPARATOR_STR _T("*.dll\"\n"), searchPath.c_str());
  if (!m_pPlugins->Initialize(searchPath.c_str(), is_target_64bit(), !!display_script))
  {
    ERROR_MSG(_T("Error initializing default plugins!\n"));
    return PS_ERROR;
  }
  SCRIPT_MSG(_T("\n"));
  return PS_OK;
}
