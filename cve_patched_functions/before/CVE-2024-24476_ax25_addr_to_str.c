static int ax25_addr_to_str(const address* addr, gchar *buf, int buf_len)
{
    _addr_return_if_nospace(10, buf, buf_len);

    const guint8 *addrdata = (const guint8 *)addr->data;
    int i, ssid;
    gchar *bufp = buf;

    for (i = 0; i < 6; i++) {
        if (addrdata[i] == 0x40) {
            /* end of callsign, start of space-padding */
            break;
        }
        *bufp++ = printable_char_or_period(addrdata[i] >> 1);
    }

    ssid = (addrdata[6] >> 1) & 0x0f;
    if (ssid != 0) {
        bufp += snprintf(bufp,buf_len-(int)(bufp-buf),"-%d",ssid);
    } else {
        *bufp++ = '\0'; /* NULL terminate */
    }

    return (int)(bufp - buf);
}
