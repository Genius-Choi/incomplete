size_t mobi_get_fdst_record_number(const MOBIData *m) {
    if (!mobi_exists_mobiheader(m)) {
        return MOBI_NOTSET;
    }
    const size_t offset = mobi_get_kf8offset(m);
    if (m->mh->fdst_index && *m->mh->fdst_index != MOBI_NOTSET) {
        if (m->mh->fdst_section_count && *m->mh->fdst_section_count > 1) {
            return *m->mh->fdst_index + offset;
        }
    }
    if (m->mh->fdst_section_count && *m->mh->fdst_section_count > 1) {
        /* FIXME: if KF7, is it safe to asume last_text_index has fdst index */
        if (m->mh->last_text_index) {
            return *m->mh->last_text_index;
        }
    }
    return MOBI_NOTSET;
}
