pf_purge_states(void *null)
{
	unsigned int limit;
	unsigned int scanned;

	limit = pf_purge_states_limit;
	if (limit < pf_purge_states_collect)
		limit = pf_purge_states_collect;

	scanned = pf_purge_expired_states(limit, pf_purge_states_collect);
	if (scanned >= pf_purge_states_limit) {
		/* we've run out of states to scan this "interval" */
		timeout_add_sec(&pf_purge_states_to, 1);
		return;
	}

	pf_purge_states_limit -= scanned;
	task_add(systqmp, &pf_purge_states_task);
}
