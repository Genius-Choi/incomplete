folly::Optional<folly::fs::path> RuntimeOption::GetHomePath(
  const folly::StringPiece user) {

  auto homePath = folly::fs::path{RuntimeOption::SandboxHome}
    / folly::fs::path{user};
  if (folly::fs::is_directory(homePath)) {
    return {std::move(homePath)};
  }

  if (!RuntimeOption::SandboxFallback.empty()) {
    homePath = folly::fs::path{RuntimeOption::SandboxFallback}
      / folly::fs::path{user};
    if (folly::fs::is_directory(homePath)) {
      return {std::move(homePath)};
    }
  }

  return {};
}
