static void auditing_v8(MYSQL_THD thd, struct mysql_event_general_v8 *ev_v8)
{
#ifdef __linux__
#ifdef DBUG_OFF
  #ifdef __x86_64__
  static const int cmd_off= 4200;
  static const int db_off= 120;
  static const int db_len_off= 128;
  #else
  static const int cmd_off= 2668;
  static const int db_off= 60;
  static const int db_len_off= 64;
  #endif /*x86_64*/
#else
  #ifdef __x86_64__
  static const int cmd_off= 4432;
  static const int db_off= 120;
  static const int db_len_off= 128;
  #else
  static const int cmd_off= 2808;
  static const int db_off= 64;
  static const int db_len_off= 68;
  #endif /*x86_64*/
#endif /*DBUG_OFF*/
#endif /*__linux*/

  struct mysql_event_general event;

  if (ev_v8->event_class != MYSQL_AUDIT_GENERAL_CLASS)
    return;

  event.event_subclass= ev_v8->event_subclass;
  event.general_error_code= ev_v8->general_error_code;
  event.general_thread_id= ev_v8->general_thread_id;
  event.general_user= ev_v8->general_user;
  event.general_user_length= ev_v8->general_user_length;
  event.general_command= ev_v8->general_command;
  event.general_command_length= ev_v8->general_command_length;
  event.general_query= ev_v8->general_query;
  event.general_query_length= ev_v8->general_query_length;
  event.general_charset= ev_v8->general_charset;
  event.general_time= ev_v8->general_time;
  event.general_rows= ev_v8->general_rows;
  event.database= 0;
  event.database_length= 0;

  if (event.general_query_length > 0)
  {
    event.event_subclass= MYSQL_AUDIT_GENERAL_STATUS;
    event.general_command= "Query";
    event.general_command_length= 5;
#ifdef __linux__
    event.database= *(char **) (((char *) thd) + db_off);
    event.database_length= *(size_t *) (((char *) thd) + db_len_off);
#endif /*__linux*/
  }
#ifdef __linux__
  else if (*((int *) (((char *)thd) + cmd_off)) == 2)
  {
    event.event_subclass= MYSQL_AUDIT_GENERAL_LOG;
    event.general_command= "Init DB";
    event.general_command_length= 7;
    event.general_query= *(char **) (((char *) thd) + db_off);
    event.general_query_length= *(size_t *) (((char *) thd) + db_len_off);
  }
#endif /*__linux*/
  auditing(thd, ev_v8->event_class, &event);
}
