static void rtcp_stats_init(switch_rtp_t *rtp_session)
{
	switch_rtcp_numbers_t * stats = &rtp_session->stats.rtcp;
	srtp_hdr_t * hdr = &rtp_session->last_rtp_hdr;
	switch_core_session_t *session = switch_core_memory_pool_get_data(rtp_session->pool, "__session");
	stats->ssrc = ntohl(hdr->ssrc);
	stats->last_rpt_ts = rtp_session->write_timer.samplecount;
	stats->init = 1;
	stats->last_rpt_ext_seq = 0;
	stats->last_rpt_cycle = 0;
	stats->last_pkt_tsdiff = 0;
	stats->inter_jitter = 0;
	stats->cycle = 0;
	stats->high_ext_seq_recv = ntohs((uint16_t)hdr->seq);
	stats->base_seq = ntohs((uint16_t)hdr->seq);
	stats->bad_seq = (1<<16) + 1; /* Make sure we wont missmatch 2 consecutive packets, so seq == bad_seq is false */
	stats->cum_lost = 0;
	stats->period_pkt_count = 0;
	stats->sent_pkt_count = 0;
	stats->pkt_count = 0;
	stats->rtcp_rtp_count = 0;

	if (!rtp_session->flags[SWITCH_RTP_FLAG_ENABLE_RTCP]) {
		switch_log_printf(SWITCH_CHANNEL_SESSION_LOG(session), SWITCH_LOG_DEBUG, "rtcp_stats_init: %s rtcp disabled\n", rtp_type(rtp_session));
	} else if (!rtp_session->rtcp_sock_output) {
		switch_log_printf(SWITCH_CHANNEL_SESSION_LOG(session), SWITCH_LOG_WARNING, "rtcp_stats_init: %s no rtcp socket\n", rtp_type(rtp_session));
	} else if (rtp_session->flags[SWITCH_RTP_FLAG_RTCP_PASSTHRU]) {
		switch_log_printf(SWITCH_CHANNEL_SESSION_LOG(session), SWITCH_LOG_DEBUG, "rtcp_stats_init: %s rtcp passthru\n", rtp_type(rtp_session));
	} else {
		switch_log_printf(SWITCH_CHANNEL_SESSION_LOG(session), SWITCH_LOG_DEBUG, "rtcp_stats_init: %s ssrc[%u] base_seq[%u]\n", rtp_type(rtp_session), stats->ssrc, stats->base_seq);
	}

	if (rtp_session->flags[SWITCH_RTP_FLAG_ENABLE_RTCP] && (switch_core_media_codec_get_cap(rtp_session->session,
															SWITCH_MEDIA_TYPE_AUDIO, SWITCH_CODEC_FLAG_HAS_ADJ_BITRATE))) {
			kalman_estimator_t *estimators[KALMAN_SYSTEM_MODELS];
			cusum_kalman_detector_t *detectors[KALMAN_SYSTEM_MODELS];

			rtp_session->flags[SWITCH_RTP_FLAG_ADJ_BITRATE_CAP] = 1;
			rtp_session->flags[SWITCH_RTP_FLAG_ESTIMATORS] = 1;

			rtp_session->estimators[EST_LOSS] = switch_core_alloc(rtp_session->pool, sizeof(*estimators[0]));
			switch_kalman_init(rtp_session->estimators[EST_LOSS],0.1,0.1);
			rtp_session->estimators[EST_RTT] = switch_core_alloc(rtp_session->pool, sizeof(*estimators[0]));
			switch_kalman_init(rtp_session->estimators[EST_RTT],0.03,1);
			rtp_session->detectors[EST_RTT] = switch_core_alloc(rtp_session->pool, sizeof(*detectors[0]));
			switch_kalman_cusum_init(rtp_session->detectors[EST_RTT],0.005,0.5);
			rtp_session->detectors[EST_LOSS] = switch_core_alloc(rtp_session->pool, sizeof(*detectors[0]));
			switch_kalman_cusum_init(rtp_session->detectors[EST_LOSS], 0.5, 1);
	}
}
