void CoreUserInputHandler::issueAway(const QString &msg, bool autoCheck)
{
    QString awayMsg = msg;
    IrcUser *me = network()->me();

    // if there is no message supplied we have to check if we are already away or not
    if (autoCheck && msg.isEmpty()) {
        if (me && !me->isAway()) {
            Identity *identity = network()->identityPtr();
            if (identity) {
                awayMsg = identity->awayReason();
            }
            if (awayMsg.isEmpty()) {
                awayMsg = tr("away");
            }
        }
    }
    if (me)
        me->setAwayMessage(awayMsg);

    putCmd("AWAY", serverEncode(awayMsg));
}
