static BOOL ntlm_write_ntlm_v2_client_challenge(wStream* s,
                                                const NTLMv2_CLIENT_CHALLENGE* challenge)
{
	ULONG length;

	WINPR_ASSERT(s);
	WINPR_ASSERT(challenge);

	if (Stream_GetRemainingCapacity(s) < 28)
	{
		WLog_ERR(TAG, "NTLMv2_CLIENT_CHALLENGE expected 28bytes, have %" PRIuz "bytes",
		         Stream_GetRemainingCapacity(s));
		return FALSE;
	}
	Stream_Write_UINT8(s, challenge->RespType);
	Stream_Write_UINT8(s, challenge->HiRespType);
	Stream_Write_UINT16(s, challenge->Reserved1);
	Stream_Write_UINT32(s, challenge->Reserved2);
	Stream_Write(s, challenge->Timestamp, 8);
	Stream_Write(s, challenge->ClientChallenge, 8);
	Stream_Write_UINT32(s, challenge->Reserved3);
	length = ntlm_av_pair_list_length(challenge->AvPairs, challenge->cbAvPairs);
	if (Stream_GetRemainingCapacity(s) < length)
	{
		WLog_ERR(TAG,
		         "NTLMv2_CLIENT_CHALLENGE::AvPairs expected %" PRIu32 "bytes, have %" PRIuz "bytes",
		         length, Stream_GetRemainingCapacity(s));
		return FALSE;
	}
	Stream_Write(s, challenge->AvPairs, length);
	return TRUE;
}
