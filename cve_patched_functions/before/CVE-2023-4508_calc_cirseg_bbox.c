calc_cirseg_bbox(const gerbv_cirseg_t *cirseg,
		double apert_size_x, double apert_size_y,
		gerbv_render_size_t *bbox)
{
	gdouble x, y, ang1, ang2, step_pi_2;

	/* For bounding box calculation only half of aperture size is used */
	apert_size_x /= 2;
	apert_size_y /= 2;

	ang1 = DEG2RAD(MIN(cirseg->angle1, cirseg->angle2));
	ang2 = DEG2RAD(MAX(cirseg->angle1, cirseg->angle2));

	/* Start arc point */
	x = cirseg->cp_x + cirseg->width*cos(ang1)/2;
	y = cirseg->cp_y + cirseg->width*sin(ang1)/2;
	gerber_update_min_and_max(bbox, x, y,
				apert_size_x, apert_size_x,
				apert_size_y, apert_size_y);

	/* Middle arc points */
	for (step_pi_2 = (ang1/M_PI_2 + 1)*M_PI_2;
				step_pi_2 < MIN(ang2, ang1 + 2*M_PI);
				step_pi_2 += M_PI_2) {
		x = cirseg->cp_x + cirseg->width*cos(step_pi_2)/2;
		y = cirseg->cp_y + cirseg->width*sin(step_pi_2)/2;
		gerber_update_min_and_max(bbox, x, y,
					apert_size_x, apert_size_x,
					apert_size_y, apert_size_y);
	}

	/* Stop arc point */
	x = cirseg->cp_x + cirseg->width*cos(ang2)/2;
	y = cirseg->cp_y + cirseg->width*sin(ang2)/2;
	gerber_update_min_and_max(bbox, x, y,
				apert_size_x, apert_size_x,
				apert_size_y, apert_size_y);
}
