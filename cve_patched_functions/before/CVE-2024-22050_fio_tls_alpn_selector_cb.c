static int fio_tls_alpn_selector_cb(SSL *ssl, const unsigned char **out,
                                    unsigned char *outlen,
                                    const unsigned char *in, unsigned int inlen,
                                    void *tls_) {
  fio_tls_s *tls = tls_;
  alpn_s *alpn;
  /* TODO: select ALPN and call on_selected */
  fio_tls_connection_s *c = SSL_get_ex_data(ssl, 0);
  c->alpn_ok = 1;

  if (alpn_list_count(&tls->alpn) == 0)
    return SSL_TLSEXT_ERR_NOACK;
  const unsigned char *end = in + inlen;
  while (in < end) {
    uint8_t l = in[0];
    alpn = alpn_find(tls, (char *)in + 1, l);
    in += l + 1;
    if (!alpn)
      continue;
    fio_str_info_s info = fio_str_info(&alpn->name);
    *out = (unsigned char *)info.data;
    *outlen = (unsigned char)info.len;
    FIO_LOG_DEBUG("TLS ALPN set to: %s for %p", info.data, (void *)c->uuid);
    alpn_select(alpn, c->uuid, c->alpn_arg);
    return SSL_TLSEXT_ERR_OK;
  }
  /* set protocol to default protocol */
  alpn = alpn_default(tls);
  alpn_select(alpn, c->uuid, c->alpn_arg);
  FIO_LOG_DEBUG(
      "TLS ALPN handshake failed, falling back on default (%s) for %p",
      fio_str_data(&alpn->name), (void *)c->uuid);
  return SSL_TLSEXT_ERR_NOACK;
  (void)ssl;
  (void)out;
  (void)outlen;
  (void)in;
  (void)inlen;
  (void)tls;
}
