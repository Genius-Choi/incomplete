const void *fdt_getprop_by_offset(const void *fdt, int offset,
				  const char **namep, int *lenp)
{
	const struct fdt_property *prop;

	prop = fdt_get_property_by_offset_(fdt, offset, lenp);
	if (!prop)
		return NULL;
	if (namep) {
		const char *name;
		int namelen;

		if (fdt_chk_extra()) {
			name = fdt_get_string(fdt, fdt32_to_cpu(prop->nameoff),
					      &namelen);
			if (!name) {
				if (lenp)
					*lenp = namelen;
				return NULL;
			}
			*namep = name;
		} else {
			*namep = fdt_string(fdt, fdt32_to_cpu(prop->nameoff));
		}
	}

	/* Handle realignment */
	if (fdt_chk_version() && fdt_version(fdt) < 0x10 &&
	    (offset + sizeof(*prop)) % 8 && fdt32_to_cpu(prop->len) >= 8)
		return prop->data + 4;
	return prop->data;
}
