static inline int16_t decodeSample(adpcmState &state, uint8_t code)
{
	int step = stepTable[state.index];

	int diff = step >> 3;
	if (code & 4) diff += step;
	if (code & 2) diff += step>>1;
	if (code & 1) diff += step>>2;

	int predictor = state.previousValue;
	if (code & 8)
		predictor -= diff;
	else
		predictor += diff;

	state.previousValue = clamp(predictor, MIN_INT16, MAX_INT16);
	state.index = clamp(state.index + indexTable[code], 0, 88);
	return state.previousValue;
}
