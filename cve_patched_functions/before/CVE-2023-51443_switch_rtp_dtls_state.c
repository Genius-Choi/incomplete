SWITCH_DECLARE(dtls_state_t) switch_rtp_dtls_state(switch_rtp_t *rtp_session, dtls_type_t type)
{
	dtls_state_t s = DS_OFF;

	if (!rtp_session) {
		return s;
	}

	switch_mutex_lock(rtp_session->ice_mutex);

	if (!rtp_session->dtls && !rtp_session->rtcp_dtls) {
		s = DS_OFF;
		goto done;
	}

	if ((type == DTLS_TYPE_RTP) && rtp_session->dtls) {
		s = rtp_session->dtls->state;
		goto done;
	}

	if ((type == DTLS_TYPE_RTCP) && rtp_session->rtcp_dtls) {
		s = rtp_session->rtcp_dtls->state;
	}

 done:

	switch_mutex_unlock(rtp_session->ice_mutex);

	return s;
}
