static void parse_key(sdp_parser_t *p, char *r, sdp_key_t **result)
{
  char *s;
  /*
   key-field =           ["k=" key-type CRLF]

   key-type =            "prompt" |
                         "clear:" key-data |
                         "base64:" key-data |
                         "uri:" uri

   key-data =            email-safe | "~" | "
   */

  s = token(&r, ":", TOKEN, SPACE TAB);
  if (!s) {
    parsing_error(p, "invalid key method");
    return;
  }

  {
    PARSE_ALLOC(p, sdp_key_t, k);
    if (result) *result = k;

    /* These are defined as key-sensitive in RFC 4566 */
#define MATCH(s, tok) \
    (STRICT(p) ? su_strmatch((s), (tok)) : su_casematch((s), (tok)))

    if (MATCH(s, "clear"))
      k->k_method = sdp_key_clear, k->k_method_name = "clear";
    else if (MATCH(s, "base64"))
      k->k_method = sdp_key_base64, k->k_method_name = "base64";
    else if (MATCH(s, "uri"))
      k->k_method = sdp_key_uri, k->k_method_name = "uri";
    else if (MATCH(s, "prompt"))
      k->k_method = sdp_key_prompt, k->k_method_name = "prompt";
    else if (!STRICT(p))
      k->k_method = sdp_key_x, k->k_method_name = s;
    else {
      parsing_error(p, "invalid key method");
      return;
    }

    k->k_material = r;
  }
}
