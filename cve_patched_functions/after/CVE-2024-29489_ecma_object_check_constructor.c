ecma_object_check_constructor (ecma_object_t *obj_p) /**< ecma object */
{
  JERRY_ASSERT (!ecma_is_lexical_environment (obj_p));

  ecma_object_type_t type = ecma_get_object_type (obj_p);

  if (JERRY_UNLIKELY (type < ECMA_OBJECT_TYPE_PROXY))
  {
    return ECMA_ERR_INVALID_TYPE_FOR_CONSTRUCTOR_CALL;
  }

  while (JERRY_UNLIKELY (type == ECMA_OBJECT_TYPE_BOUND_FUNCTION))
  {
    ecma_bound_function_t *bound_func_p = (ecma_bound_function_t *) obj_p;

    obj_p =
      ECMA_GET_NON_NULL_POINTER_FROM_POINTER_TAG (ecma_object_t, bound_func_p->header.u.bound_function.target_function);

    type = ecma_get_object_type (obj_p);
  }

  if (JERRY_LIKELY (type == ECMA_OBJECT_TYPE_FUNCTION))
  {
    const ecma_compiled_code_t *byte_code_p = ecma_op_function_get_compiled_code ((ecma_extended_object_t *) obj_p);

    if (!CBC_FUNCTION_IS_CONSTRUCTABLE (byte_code_p->status_flags))
    {
#if JERRY_ERROR_MESSAGES
      switch (CBC_FUNCTION_GET_TYPE (byte_code_p->status_flags))
      {
        case CBC_FUNCTION_SCRIPT:
        {
          return ECMA_ERR_SCRIPT_GLOBAL_FUNCTIONS_INVOKE_WITH_NEW;
        }
        case CBC_FUNCTION_GENERATOR:
        {
          return ECMA_ERR_GENERATOR_FUNCTIONS_INVOKE_WITH_NEW;
        }
        case CBC_FUNCTION_ASYNC:
        {
          return ECMA_ERR_ASYNC_FUNCTIONS_INVOKE_WITH_NEW;
        }
        case CBC_FUNCTION_ASYNC_GENERATOR:
        {
          return ECMA_ERR_ASYNC_GENERATOR_FUNCTIONS_INVOKE_WITH_NEW;
        }
        case CBC_FUNCTION_ACCESSOR:
        {
          return ECMA_ERR_ACCESSOR_FUNCTIONS_INVOKE_WITH_NEW;
        }
        case CBC_FUNCTION_METHOD:
        {
          return ECMA_ERR_METHODS_INVOKE_WITH_NEW;
        }
        case CBC_FUNCTION_ARROW:
        {
          return ECMA_ERR_ARROW_FUNCTIONS_INVOKE_WITH_NEW;
        }
        default:
        {
          JERRY_ASSERT (CBC_FUNCTION_GET_TYPE (byte_code_p->status_flags) == CBC_FUNCTION_ASYNC_ARROW);
          return ECMA_ERR_ASYNC_ARROW_FUNCTIONS_INVOKE_WITH_NEW;
        }
      }
#else /* !JERRY_ERROR_MESSAGES */
      return ECMA_ERR_EMPTY;
#endif /* JERRY_ERROR_MESSAGES */
    }

    return ECMA_IS_VALID_CONSTRUCTOR;
  }

#if JERRY_BUILTIN_PROXY
  if (ECMA_OBJECT_TYPE_IS_PROXY (type))
  {
    if (!(obj_p->u2.prototype_cp & ECMA_PROXY_IS_CONSTRUCTABLE))
    {
      return ECMA_ERR_PROXY_TARGET_IS_NOT_A_CONSTRUCTOR;
    }

    return ECMA_IS_VALID_CONSTRUCTOR;
  }
#endif /* JERRY_BUILTIN_PROXY */

  JERRY_ASSERT (type == ECMA_OBJECT_TYPE_NATIVE_FUNCTION || type == ECMA_OBJECT_TYPE_BUILT_IN_FUNCTION
                || type == ECMA_OBJECT_TYPE_CONSTRUCTOR_FUNCTION);

  if (type == ECMA_OBJECT_TYPE_BUILT_IN_FUNCTION)
  {
    if (ecma_builtin_function_is_routine (obj_p))
    {
      return ECMA_ERR_BULTIN_ROUTINES_HAVE_NO_CONSTRUCTOR;
    }

    JERRY_ASSERT (((ecma_extended_object_t *) obj_p)->u.built_in.id != ECMA_BUILTIN_ID_HANDLER);
  }

  return ECMA_IS_VALID_CONSTRUCTOR;
} /* ecma_object_check_constructor */
