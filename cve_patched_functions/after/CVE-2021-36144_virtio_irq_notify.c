virtio_irq_notify(void *vdev, struct virtio_vq_info *vq)
{
	struct iovec iov[1];
	struct virtio_gpio *gpio;
	uint16_t idx, flag;
	int n;

	idx = vq->qsize;
	gpio = (struct virtio_gpio *)vdev;
	if (vq_has_descs(vq)) {
		n = vq_getchain(vq, &idx, iov, 1, &flag);
		if (n != 1) {
			WPRINTF(("virtio gpio, invalid irq chain %d\n", n));
			virtio_gpio_abort(vq, idx);
			return;
		}

		virtio_gpio_irq_proc(gpio, iov, flag);
		/*
		 * Release this chain and handle more
		 */
		vq_relchain(vq, idx, 1);

		/* Generate interrupt if appropriate. */
		vq_endchains(vq, 1);
	}
}
