Jsi_RC jsi_GetVerFromVal(Jsi_Interp *interp, Jsi_Value *val, Jsi_Number *nPtr, bool isProvide)
{
    Jsi_Number n = *nPtr;
    if (!val)
        return Jsi_LogError("missing version");
    if (Jsi_ValueIsNumber(interp, val)) {
        if (Jsi_GetDoubleFromValue(interp, val, &n) != JSI_OK || Jsi_NumberIsNaN(n) || (isProvide?n<=0.0:n<0.0) || n>=100.0)
            return Jsi_LogError("bad version: %." JSI_VERFMT_LEN JSI_NUMGFMT, n);
        *nPtr = n;
        return JSI_OK;
    }
    const char *vstr = Jsi_ValueString(interp, val, NULL), *vs = vstr;
    if (!vstr)
        return Jsi_LogError("bad version");
    uint v[3] = {};
    while (*vs && (isdigit(*vs) || *vs=='.')) vs++;
    if (*vs || sscanf(vstr, "%u.%u.%u", v, v+1, v+2) < 1 || v[0]>=100 || v[1]>=100 || v[2]>=100)
        return Jsi_LogError("bad version string: %s", vstr);
    *nPtr = jsi_VersionNormalize((Jsi_Number)v[0] + ((Jsi_Number)v[1]/100.0) + ((Jsi_Number)v[2]/10000.0), NULL, 0);
    return JSI_OK;
}
