vmei_get_devname(char *name, size_t namesize,
		 unsigned int bus, unsigned int slot, unsigned int func)
{
	char path[256];
	struct stat buf;
	struct dirent **namelist = NULL;
	int n, ret = 0;

	snprintf(path, sizeof(path),
		 "/sys/bus/pci/drivers/mei_me/0000:%02x:%02x.%1u/mei/",
		 bus, slot, func);

	if (stat(path, &buf) < 0)
		return -1;

	n = scandir(path, &namelist, filter_dirs, alphasort);
	if (n == 1)
		snprintf(name, namesize, "%s", namelist[0]->d_name);
	else
		ret = -1;

	while (n-- > 0)
		free(namelist[n]);
	free(namelist);

	return ret;
}
