const char* Jsi_OptionsData(Jsi_Interp *interp, Jsi_OptionSpec *specs, Jsi_DString *dStr, bool schema) {
    const Jsi_OptionSpec *send;
    for (send = specs; send->id>=JSI_OPTION_BOOL && send->id<JSI_OPTION_END; send++) ;
    if (!send)
        return NULL;
    if (schema) {
        char tbuf[100];
        int i = 0;
        if (send->name)
            Jsi_DSAppend(dStr, "  -- '", send->name, "\': ", NULL);
        if (send->help)
            Jsi_DSAppend(dStr,  send->help, NULL);
        Jsi_DSAppend(dStr, "\n", NULL);
        for (; specs->id>=JSI_OPTION_BOOL && specs->id<JSI_OPTION_END; specs++) {
            const char *tstr = NULL;
            if (specs->flags&JSI_OPT_DB_DIRTY)
                continue;
            if (!Jsi_Strcmp(specs->name, "rowid"))
                continue;
            switch(specs->id) {
            case JSI_OPTION_BOOL: tstr = "BOOLEAN"; break;
            case JSI_OPTION_TIME_T: tstr = "TIMESTAMP"; break;
            case JSI_OPTION_TIME_D:
            case JSI_OPTION_TIME_W:
                if (specs->flags & JSI_OPT_TIME_TIMEONLY)
                    tstr = "TIME";
                else if (specs->flags & JSI_OPT_TIME_TIMEONLY)
                    tstr = "DATE";
                else
                    tstr = "DATETIME";
                break;
            case JSI_OPTION_SIZE_T:
            case JSI_OPTION_SSIZE_T:
            case JSI_OPTION_INTPTR_T:
            case JSI_OPTION_UINTPTR_T:
            case JSI_OPTION_UINT:
            case JSI_OPTION_INT:
            case JSI_OPTION_ULONG:
            case JSI_OPTION_LONG:
            case JSI_OPTION_USHORT:
            case JSI_OPTION_SHORT:
            case JSI_OPTION_UINT8:
            case JSI_OPTION_UINT16:
            case JSI_OPTION_UINT32:
            case JSI_OPTION_UINT64:
            case JSI_OPTION_INT8:
            case JSI_OPTION_INT16:
            case JSI_OPTION_INT32:
            case JSI_OPTION_INT64: tstr = "INT"; break;
            case JSI_OPTION_FLOAT:
            case JSI_OPTION_NUMBER:
            case JSI_OPTION_LDOUBLE:
            case JSI_OPTION_DOUBLE: tstr = "FLOAT"; break;
            
            case JSI_OPTION_STRBUF:
                tstr = tbuf;
                snprintf(tbuf, sizeof(tbuf), "VARCHAR(%d)", specs->size);;
                break;
            case JSI_OPTION_DSTRING: 
            case JSI_OPTION_STRKEY:
            case JSI_OPTION_STRING:
                tstr = "TEXT";
                break;
            case JSI_OPTION_CUSTOM:
                if (specs->custom == Jsi_Opt_SwitchEnum || specs->custom == Jsi_Opt_SwitchBitset) {
                    if (specs->flags&JSI_OPT_FORCE_INT)
                        tstr = "INT";
                    else
                        tstr = "TEXT";
                } else
                    tstr = "";
                break;
            case JSI_OPTION_VALUE: /* Unsupported. */
            case JSI_OPTION_VAR:
            case JSI_OPTION_OBJ:
            case JSI_OPTION_ARRAY:
            case JSI_OPTION_FUNC:
            case JSI_OPTION_USEROBJ:
            case JSI_OPTION_REGEXP:
                break;
#ifdef __cplusplus
            case JSI_OPTION_END:
#else
            default:
#endif
                Jsi_LogBug("invalid option type: %d", specs->id);
            }
            
            if (!tstr) continue;
            Jsi_DSAppend(dStr, (i?"\n ,":"  "), specs->name, " ", (tstr[0]?tstr:specs->tname), NULL);

            const char *cp;
            if ((cp=specs->userData)) {
                const char *udrest = NULL;
                if (!Jsi_Strcmp(cp, "DEFAULT")) {
                    if ((specs->id == JSI_OPTION_TIME_D || specs->id <= JSI_OPTION_TIME_T)) {
                        if (specs->flags & JSI_OPT_TIME_DATEONLY)
                            udrest = "(round((julianday('now') - 2440587.5)*86400000))";
                        else if (specs->flags & JSI_OPT_TIME_TIMEONLY)
                            udrest = "(round((julianday('now')-julianday('now','start of day') - 2440587.5)*86400000))";
                        else
                            udrest = "(round((julianday('now') - 2440587.5)*86400000.0))";
                    } else if (specs->id <= JSI_OPTION_TIME_T) {
                        if (specs->flags & JSI_OPT_TIME_DATEONLY)
                            udrest = "(round((julianday('now') - 2440587.5)*86400))";
                        else if (specs->flags & JSI_OPT_TIME_TIMEONLY)
                            udrest = "(round((julianday('now')-julianday('now','start of day') - 2440587.5)*86400))";
                        else
                            udrest = "(round((julianday('now') - 2440587.5)*86400.0))";
                    }
                }
                Jsi_DSAppend(dStr, " ", cp, udrest, NULL);
            }
            if (specs->help)
                Jsi_DSAppend(dStr, " -- ", specs->help, NULL);
            if (specs->id==JSI_OPTION_END)
                break;
            i++;
        }
        if (send->userData)
            Jsi_DSAppend(dStr,  send->userData, NULL);
        Jsi_DSAppend(dStr, "\n  -- MD5=", NULL);

    } else {
        int i = 0;
        Jsi_DSAppend(dStr, "\n/* ", send->name, ": ", NULL);
        if (send->help)
            Jsi_DSAppend(dStr,  send->help, NULL);
        Jsi_DSAppend(dStr, " */\ntypedef struct ",  send->name, " {", NULL);
        for (; specs->id>=JSI_OPTION_BOOL && specs->id<JSI_OPTION_END; specs++) {
            int nsz = 0;
            const char *tstr = NULL;
            switch(specs->id) {
            case JSI_OPTION_STRBUF: nsz=1;
            case JSI_OPTION_BOOL:
            case JSI_OPTION_TIME_T:
            case JSI_OPTION_TIME_W:
            case JSI_OPTION_TIME_D:;
            case JSI_OPTION_SIZE_T:
            case JSI_OPTION_SSIZE_T:
            case JSI_OPTION_INTPTR_T:
            case JSI_OPTION_UINTPTR_T:
            case JSI_OPTION_INT:
            case JSI_OPTION_UINT:
            case JSI_OPTION_LONG:
            case JSI_OPTION_ULONG:
            case JSI_OPTION_SHORT:
            case JSI_OPTION_USHORT:
            case JSI_OPTION_UINT8:
            case JSI_OPTION_UINT16:
            case JSI_OPTION_UINT32:
            case JSI_OPTION_UINT64:
            case JSI_OPTION_INT8:
            case JSI_OPTION_INT16:
            case JSI_OPTION_INT32:
            case JSI_OPTION_INT64:
            case JSI_OPTION_FLOAT:
            case JSI_OPTION_DOUBLE:
            case JSI_OPTION_LDOUBLE:
            case JSI_OPTION_NUMBER:
            case JSI_OPTION_DSTRING:
            case JSI_OPTION_STRKEY: 
            case JSI_OPTION_STRING:
                tstr = jsi_OptionTypeStr(specs->id, 1); 
                break;
            case JSI_OPTION_CUSTOM:
                if (specs->custom == Jsi_Opt_SwitchEnum || specs->custom == Jsi_Opt_SwitchBitset) {
                    tstr = "int";
                } else {
                    tstr = "char";
                    nsz = 1;
                }
                break;
            case JSI_OPTION_VALUE: /* Unsupported. */
            case JSI_OPTION_VAR:
            case JSI_OPTION_OBJ:
            case JSI_OPTION_ARRAY:
            case JSI_OPTION_REGEXP:
            case JSI_OPTION_FUNC:
            case JSI_OPTION_USEROBJ:
                break;
#ifdef __cplusplus
            case JSI_OPTION_END:
#else
            default:
#endif
                Jsi_LogBug("invalid option type: %d", specs->id);
            }
            
            if (!tstr) continue;
            Jsi_DSAppend(dStr, "\n    ", tstr, " ", specs->name, NULL);
            if (nsz) {
                Jsi_DSPrintf(dStr, "[%d]", specs->size);
            }
            Jsi_DSAppend(dStr, ";", NULL);
            if (specs->help)
                Jsi_DSAppend(dStr, " /* ", specs->help, " */", NULL);
            if (specs->id==JSI_OPTION_END)
                break;
            i++;
        }
        Jsi_DSAppend(dStr, "\n};\n// MD5=", NULL);

    }
    char buf[33];
    Jsi_CryptoHash(buf, Jsi_DSValue(dStr), Jsi_DSLength(dStr), Jsi_CHash_MD5, 0, 0, NULL);
    //Jsi_Md5Str(buf, Jsi_DSValue(dStr), -1);
    Jsi_DSAppend(dStr, buf, NULL);

    return Jsi_DSValue(dStr);
}
