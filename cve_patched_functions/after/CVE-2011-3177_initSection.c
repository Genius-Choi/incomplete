IniSection& IniSection::initSection (const string&name,const string&comment,int rb, int wb)
{
    string k = ip->changeCase (name);
    
    IniSection s (ip);
    IniSectionIdxIterator sxi;
    if (!ip->repeatNames () && (sxi = isections.find (k)) != isections.end ())
	{
	    IniIterator si = sxi->second;
	    s = si->s ();
	    if (!s.dirty)
		{
		    s.comment = comment;
		    s.read_by = rb;
		    if (wb != -2) s.rewrite_by = wb;
		    s.name = k;
		}

	    // remove and unindex the old section
	    container.erase (si);
	    isections.erase (sxi);
	}
    else
	{			// new section
	    s.dirty = false;
	    s.comment = comment;
	    s.read_by = rb;
	    if (wb != -2) s.rewrite_by = wb;
	    s.name = k;
	    s.ip = ip;
	}
    // insert it
    IniContainerElement ce (s);
    container.push_back (ce);
    // index it
    isections.insert (IniSectionIndex::value_type (k, --container.end ()));
    // return reference to the new copy(!)
    return container.back().s();
}
