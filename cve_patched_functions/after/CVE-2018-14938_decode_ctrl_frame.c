int WifiPacket::decode_ctrl_frame(const u_char * ptr, size_t len, u_int16_t fc)
{
    u_int16_t du = EXTRACT_LE_16BITS(ptr+2);        //duration

    switch (FC_SUBTYPE(fc)) {
    case CTRL_PS_POLL: {
	ctrl_ps_poll_t hdr;
	hdr.fc = fc;
	hdr.aid = du;
	hdr.bssid =  MAC::ether2MAC(ptr+4);
	hdr.ta =  MAC::ether2MAC(ptr+10);
	cbs->Handle80211( *this, fc, MAC::null, MAC::null, MAC::null, hdr.ta, ptr, len);
	cbs->Handle80211CtrlPSPoll( *this, &hdr);
	break;
    }
    case CTRL_RTS: {
	ctrl_rts_t hdr;
	hdr.fc = fc;
	hdr.duration = du;
	hdr.ra =  MAC::ether2MAC(ptr+4);
	hdr.ta =  MAC::ether2MAC(ptr+10);
	cbs->Handle80211( *this, fc, MAC::null, MAC::null, hdr.ra, hdr.ta, ptr, len);
	cbs->Handle80211CtrlRTS( *this, &hdr);
	break;
    }
    case CTRL_CTS: {
	ctrl_cts_t hdr;
	hdr.fc = fc;
	hdr.duration = du;
	hdr.ra =  MAC::ether2MAC(ptr+4);
	cbs->Handle80211( *this, fc, MAC::null, MAC::null, hdr.ra, MAC::null, ptr, len);
	cbs->Handle80211CtrlCTS( *this, &hdr);
	break;
    }
    case CTRL_ACK: {
	ctrl_ack_t hdr;
	hdr.fc = fc;
	hdr.duration = du;
	hdr.ra =  MAC::ether2MAC(ptr+4);
	cbs->Handle80211( *this, fc, MAC::null, MAC::null, hdr.ra, MAC::null, ptr, len);
	cbs->Handle80211CtrlAck( *this, &hdr);
	break;
    }
    case CTRL_CF_END: {
	ctrl_end_t hdr;
	hdr.fc = fc;
	hdr.duration = du;
	hdr.ra =  MAC::ether2MAC(ptr+4);
	hdr.bssid =  MAC::ether2MAC(ptr+10);
	cbs->Handle80211( *this, fc, MAC::null, MAC::null, hdr.ra, MAC::null, ptr, len);
	cbs->Handle80211CtrlCFEnd( *this, &hdr);
	break;
    }
    case CTRL_END_ACK: {	
	ctrl_end_ack_t hdr;
	hdr.fc = fc;
	hdr.duration = du;
	hdr.ra =  MAC::ether2MAC(ptr+4);
	hdr.bssid =  MAC::ether2MAC(ptr+10);
	cbs->Handle80211( *this, fc, MAC::null, MAC::null, hdr.ra, MAC::null, ptr, len);
	cbs->Handle80211CtrlEndAck( *this, &hdr);
	break;
    }
    default: {
	cbs->Handle80211( *this, fc, MAC::null, MAC::null, MAC::null, MAC::null, ptr, len);
	cbs->Handle80211Unknown( *this, fc, ptr, len);
	return -1;
	//add the case statements for QoS control frames once ieee802_11.h is updated
    }
    }
    return 0;
}
