int rrd_graph(
    int argc,
    char **argv,
    char ***prdata,
    int *xsize,
    int *ysize,
    FILE * stream,
    double *ymin,
    double *ymax)
{
    int       prlines = 0;
    rrd_info_t *grinfo = NULL;
    rrd_info_t *walker;

    grinfo = rrd_graph_v(argc, argv);
    if (grinfo == NULL)
        return -1;
    walker = grinfo;
    (*prdata) = NULL;
    while (walker) {
        if (strcmp(walker->key, "image_info") == 0) {
            prlines++;
            if (((*prdata) =
                 (char**)rrd_realloc((*prdata),
                             (prlines + 1) * sizeof(char *))) == NULL) {
                rrd_set_error("realloc prdata");
                return 0;
            }
            /* imginfo goes to position 0 in the prdata array */
            (*prdata)[prlines - 1] = (char*)malloc((strlen(walker->value.u_str)
                                             + 2) * sizeof(char));
            strcpy((*prdata)[prlines - 1], walker->value.u_str);
            (*prdata)[prlines] = NULL;
        }
        /* skip anything else */
        walker = walker->next;
    }
    walker = grinfo;
    *xsize = 0;
    *ysize = 0;
    *ymin = 0;
    *ymax = 0;
    while (walker) {
        if (strcmp(walker->key, "image_width") == 0) {
            *xsize = walker->value.u_cnt;
        } else if (strcmp(walker->key, "image_height") == 0) {
            *ysize = walker->value.u_cnt;
        } else if (strcmp(walker->key, "value_min") == 0) {
            *ymin = walker->value.u_val;
        } else if (strcmp(walker->key, "value_max") == 0) {
            *ymax = walker->value.u_val;
        } else if (strncmp(walker->key, "print", 5) == 0) { /* keys are prdate[0..] */
            prlines++;
            if (((*prdata) =
                 (char**)rrd_realloc((*prdata),
                             (prlines + 1) * sizeof(char *))) == NULL) {
                rrd_set_error("realloc prdata");
                return 0;
            }
            (*prdata)[prlines - 1] = (char*)malloc((strlen(walker->value.u_str)
                                             + 2) * sizeof(char));
            (*prdata)[prlines] = NULL;
            strcpy((*prdata)[prlines - 1], walker->value.u_str);
        } else if (strcmp(walker->key, "image") == 0) {
            if ( fwrite(walker->value.u_blo.ptr, walker->value.u_blo.size, 1,
                   (stream ? stream : stdout)) == 0 && ferror(stream ? stream : stdout)){
                rrd_set_error("writing image");
                return 0;
            }
        }
        /* skip anything else */
        walker = walker->next;
    }
    rrd_info_free(grinfo);
    return 0;
}
