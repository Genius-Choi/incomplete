virtio_console_close_backend(struct virtio_console_backend *be)
{
	if (!be)
		return;

	switch (be->be_type) {
	case VIRTIO_CONSOLE_BE_PTY:
		if (be->pts_fd > 0) {
			close(be->pts_fd);
			be->pts_fd = -1;
		}
		break;
	case VIRTIO_CONSOLE_BE_STDIO:
		virtio_console_restore_stdio();
		break;
	case VIRTIO_CONSOLE_BE_SOCKET:
		if (be->socket_type == NULL || !strcmp(be->socket_type,"server")) {
			virtio_console_socket_clear(be);
			if (be->server_fd > 0) {
				close(be->server_fd);
				be->server_fd = -1;
			}
		}
		break;
	default:
		break;
	}

	if (be->be_type != VIRTIO_CONSOLE_BE_STDIO && be->fd > 0) {
		close(be->fd);
		be->fd = -1;
	}

	memset(be->port, 0, sizeof(*be->port));
	free(be);
}
