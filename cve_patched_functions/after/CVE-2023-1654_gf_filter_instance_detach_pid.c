void gf_filter_instance_detach_pid(GF_FilterPidInst *pidinst)
{
	u32 i, count;
	if (!pidinst->filter) return;

	count = gf_fq_count(pidinst->packets);
	for (i=0; i<count; i++) {
		GF_FilterPacketInstance *pcki = gf_fq_get(pidinst->packets, i);
		if (!pcki) break;
		if (pcki->pck->info.flags & GF_PCKF_FORCE_MAIN) {
			assert(pidinst->filter->nb_main_thread_forced);
			safe_int_dec(&pidinst->filter->nb_main_thread_forced);
		}
	}
	count = gf_list_count(pidinst->pck_reassembly);
	for (i=0; i<count; i++) {
		GF_FilterPacketInstance *pcki = gf_list_get(pidinst->pck_reassembly, i);
		if (!pcki) break;
		if (pcki->pck->info.flags & GF_PCKF_FORCE_MAIN) {
			assert(pidinst->filter->nb_main_thread_forced);
			safe_int_dec(&pidinst->filter->nb_main_thread_forced);
		}
	}
	pidinst->filter = NULL;
}
