Array * IMAPSession::fetchMessagesByUIDWithExtraHeaders(String * folder, IMAPMessagesRequestKind requestKind,
                                                        IndexSet * uids, IMAPProgressCallback * progressCallback,
                                                        Array * extraHeaders, ErrorCode * pError)
{
    struct mailimap_set * imapset = setFromIndexSet(uids);
    IMAPSyncResult * syncResult = fetchMessages(folder, requestKind, true, imapset, uids, NULL, 0, NULL,
                                                progressCallback, extraHeaders, pError);
    if (syncResult == NULL) {
        mailimap_set_free(imapset);
        return NULL;
    }
    Array * result = syncResult->modifiedOrAddedMessages();
    result->retain()->autorelease();
    mailimap_set_free(imapset);
    return result;
}
