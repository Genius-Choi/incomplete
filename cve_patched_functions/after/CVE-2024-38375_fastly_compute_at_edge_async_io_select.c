bool fastly_compute_at_edge_async_io_select(fastly_world_list_handle_t *hs, uint32_t timeout_ms,
                                            fastly_world_option_u32_t *ret,
                                            fastly_compute_at_edge_types_error_t *err) {
  if (!convert_result(fastly::async_select(hs->ptr, hs->len, timeout_ms, &ret->val), err)) {
    if (*err == FASTLY_COMPUTE_AT_EDGE_TYPES_ERROR_OPTIONAL_NONE) {
      ret->is_some = false;
      return true;
    }
    return false;
  }

  // The result is only valid if the timeout didn't expire.
  ret->is_some = ret->val != UINT32_MAX;

  return true;
}
