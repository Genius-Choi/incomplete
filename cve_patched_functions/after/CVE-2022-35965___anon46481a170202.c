    auto work_fn = [&](int64_t first, int64_t last) {
      for (int b = 0; b < batch_size; ++b) {
        const T* sorted_inputs_ptr = sorted_inputs.data() + b * num_inputs;
        OutType* output_ptr = output->data() + b * num_values;
        for (int i = first; i < last; ++i) {
          output_ptr[i] = std::lower_bound(sorted_inputs_ptr,
                                           sorted_inputs_ptr + num_inputs,
                                           values(i + b * num_values)) -
                          sorted_inputs_ptr;
        }
      }
    };
