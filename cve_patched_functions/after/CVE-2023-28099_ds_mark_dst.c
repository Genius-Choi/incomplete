int ds_mark_dst(struct sip_msg *msg, int mode, ds_partition_t *partition)
{
	int group, ret;
	struct usr_avp *prev_avp;
	int_str avp_value;

	prev_avp = search_first_avp(partition->grp_avp_type,
		partition->grp_avp_name, &avp_value, 0);

	if(prev_avp==NULL || prev_avp->flags&AVP_VAL_STR)
		return -1; /* grp avp deleted -- strange */
	group = avp_value.n;

	prev_avp = search_first_avp(partition->dst_avp_type,
		partition->dst_avp_name, &avp_value, 0);

	if(prev_avp==NULL || !(prev_avp->flags&AVP_VAL_STR))
		return -1; /* dst avp deleted -- strange */

	if(mode==1) {
		/* set as "active" */
		ret = ds_set_state(group, &avp_value.s,
				DS_INACTIVE_DST|DS_PROBING_DST, 0, partition);
	} else if(mode==2) {
		/* set as "probing" */
		ret = ds_set_state(group, &avp_value.s, DS_PROBING_DST, 1, partition);
		if (ret == 0) ret = ds_set_state(group, &avp_value.s,
				DS_INACTIVE_DST, 0, partition);
	} else {
		/* set as "inactive" */
		ret = ds_set_state(group, &avp_value.s, DS_INACTIVE_DST, 1, partition);
		if (ret == 0) ret = ds_set_state(group, &avp_value.s,
				DS_PROBING_DST, 0, partition);
	}

	LM_DBG("mode [%d] grp [%d] dst [%.*s]\n", mode, group, avp_value.s.len,
			avp_value.s.s);

	return (ret==0)?1:-1;
}
