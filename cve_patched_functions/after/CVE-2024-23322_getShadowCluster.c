absl::optional<absl::string_view> Filter::getShadowCluster(const ShadowPolicy& policy,
                                                           const Http::HeaderMap& headers) const {
  if (!policy.cluster().empty()) {
    return policy.cluster();
  } else {
    ASSERT(!policy.clusterHeader().get().empty());
    const auto entry = headers.get(policy.clusterHeader());
    if (!entry.empty() && !entry[0]->value().empty()) {
      return entry[0]->value().getStringView();
    }
    ENVOY_STREAM_LOG(debug, "There is no cluster name in header: {}", *callbacks_,
                     policy.clusterHeader());
    return absl::nullopt;
  }
}
