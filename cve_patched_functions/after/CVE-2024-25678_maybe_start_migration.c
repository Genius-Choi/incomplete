maybe_start_migration (struct ietf_full_conn *conn)
{
    struct lsquic_conn *const lconn = &conn->ifc_conn;
    const struct transport_params *params;

    params = lconn->cn_esf.i->esfi_get_peer_transport_params(
                                                        lconn->cn_enc_session);
    if (params->tp_set & (1 << TPI_PREFERRED_ADDRESS))
        switch (try_to_begin_migration(conn, params))
        {
        case BM_MIGRATING:
            break;
        case BM_NOT_MIGRATING:
            if (lconn->cn_version == LSQVER_ID27)
                retire_cid_from_tp(conn, params);
            else
            {
/*
 * [draft-ietf-quic-transport-28] Section 5.1.1:
 "                         Connection IDs that are issued and not
 " retired are considered active; any active connection ID is valid for
 " use with the current connection at any time, in any packet type.
 " This includes the connection ID issued by the server via the
 " preferred_address transport parameter.
 */
                LSQ_DEBUG("not migrating: save DCID from transport params");
                (void) insert_new_dcid(conn, 1,
                            &params->tp_preferred_address.cid,
                            params->tp_preferred_address.srst, 0);
            }
            break;
        case BM_ERROR:
            ABORT_QUIETLY(0, TEC_INTERNAL_ERROR, "error initiating migration");
            break;
        }
}
