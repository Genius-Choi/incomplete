Perl_get_context(void)
{
#if defined(USE_ITHREADS)
    dVAR;
#  ifdef OLD_PTHREADS_API
    pthread_addr_t t;
    int error = pthread_getspecific(PL_thr_key, &t)
    if (error)
	Perl_croak_nocontext("panic: pthread_getspecific, error=%d", error);
    return (void*)t;
#  elif defined(I_MACH_CTHREADS)
    return (void*)cthread_data(cthread_self());
#  else
    return (void*)PTHREAD_GETSPECIFIC(PL_thr_key);
#  endif
#else
    return (void*)NULL;
#endif
}
