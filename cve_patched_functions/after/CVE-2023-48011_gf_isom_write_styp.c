static GF_Err gf_isom_write_styp(GF_ISOFile *movie, Bool last_segment)
{
	/*write STYP if we write to a different file or if we write the last segment*/
	if (movie->use_segments && !movie->append_segment && !movie->segment_start && movie->write_styp) {
		GF_Err e;

		/*modify brands STYP*/
		if (movie->write_styp==1) {
			/*"msix" brand: this is a DASH Initialization Segment*/
			gf_isom_modify_alternate_brand(movie, GF_ISOM_BRAND_MSIX, GF_TRUE);
			if (last_segment) {
				/*"lmsg" brand: this is the last DASH Segment*/
				gf_isom_modify_alternate_brand(movie, GF_ISOM_BRAND_LMSG, GF_TRUE);
			}
		}
		movie->brand->type = GF_ISOM_BOX_TYPE_STYP;
		e = gf_isom_box_size((GF_Box *) movie->brand);
		if (e) return e;
		e = gf_isom_box_write((GF_Box *) movie->brand, movie->editFileMap->bs);
		if (e) return e;

		movie->write_styp = 0;
	}

	if (movie->emsgs) {
		while (1) {
			GF_Box *b = gf_list_pop_front(movie->emsgs);
			if (!b) break;
			gf_isom_box_size(b);
			gf_isom_box_write(b, movie->editFileMap->bs);
			gf_isom_box_del(b);
		}
		gf_list_del(movie->emsgs);
		movie->emsgs = NULL;
	}

	return GF_OK;
}
