maybe_enable_spin (struct ietf_full_conn *conn, struct conn_path *cpath)
{
    uint8_t nyb;

    if (conn->ifc_settings->es_spin
                    && lsquic_crand_get_nybble(conn->ifc_enpub->enp_crand))
    {
        cpath->cop_flags |= COP_SPIN_BIT;
        cpath->cop_spin_bit = 0;
        LSQ_DEBUG("spin bit enabled on path %hhu", cpath->cop_path.np_path_id);
    }
    else
    {
        /* " It is RECOMMENDED that endpoints set the spin bit to a random
         * " value either chosen independently for each packet or chosen
         * " independently for each connection ID.
         * (ibid.)
         */
        cpath->cop_flags &= ~COP_SPIN_BIT;
        nyb = lsquic_crand_get_nybble(conn->ifc_enpub->enp_crand);
        cpath->cop_spin_bit = nyb & 1;
        LSQ_DEBUG("spin bit disabled %s on path %hhu; random spin bit "
            "value is %hhu",
            !conn->ifc_settings->es_spin ? "via settings" : "randomly",
            cpath->cop_path.np_path_id, cpath->cop_spin_bit);
    }
}
