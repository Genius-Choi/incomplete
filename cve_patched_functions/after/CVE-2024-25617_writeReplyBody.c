HttpStateData::writeReplyBody()
{
    truncateVirginBody(); // if needed
    const char *data = inBuf.rawContent();
    int len = inBuf.length();
    addVirginReplyBody(data, len);
    inBuf.consume(len);

    // after addVirginReplyBody() wrote (when not adapting) everything we have
    // received to Store, check whether we have received/parsed the entire reply
    int64_t clen = -1;
    const char *parsedWhole = nullptr;
    if (!virginReply()->expectingBody(request->method, clen))
        parsedWhole = "http parsed header-only reply";
    else if (clen >= 0 && clen == payloadSeen - payloadTruncated)
        parsedWhole = "http parsed Content-Length body bytes";
    else if (clen < 0 && eof)
        parsedWhole = "http parsed body ending with expected/required EOF";

    if (parsedWhole)
        markParsedVirginReplyAsWhole(parsedWhole);
    else if (eof)
        markPrematureReplyBodyEofFailure();
}
