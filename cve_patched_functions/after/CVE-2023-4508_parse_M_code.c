parse_M_code(gerb_file_t *fd, gerbv_image_t *image, long int *line_num_p)
{
    int op_int;
    gerbv_stats_t *stats = image->gerbv_stats;
    
    op_int=gerb_fgetint(fd, NULL);
    
    switch (op_int) {
    case 0:  /* Program stop */
	stats->M0++;
	return 1;
    case 1:  /* Optional stop */
	stats->M1++;
	return 2;
    case 2:  /* End of program */
	stats->M2++;
	return 3;
    default:
	gerbv_stats_printf(stats->error_list, GERBV_MESSAGE_ERROR, -1,
		_("Encountered unknown M%02d code at line %ld in file \"%s\""),
		op_int, *line_num_p, fd->filename);
	gerbv_stats_printf(stats->error_list, GERBV_MESSAGE_WARNING, -1,
		_("Ignoring unknown M%02d code"), op_int);
	stats->M_unknown++;
    }
    return 0;
} /* parse_M_code */
