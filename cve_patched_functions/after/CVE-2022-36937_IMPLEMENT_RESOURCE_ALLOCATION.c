IMPLEMENT_RESOURCE_ALLOCATION(Certificate)

BIO *Certificate::ReadData(const Variant& var, bool *file /* = NULL */) {
  if (var.isString() || var.isObject()) {
    String svar = var.toString();
    if (StringUtil::IsFileUrl(svar)) {
      String decoded = StringUtil::DecodeFileUrl(svar);
      if (decoded.empty()) {
        raise_warning("invalid file URL, %s", svar.data());
        return nullptr;
      }
      if (file) *file = true;
      BIO *ret = BIO_new_file(decoded.data(), "r");
      if (ret == nullptr) {
        raise_warning("error opening the file, %s", decoded.data());
      }
      return ret;
    }

    if (file) *file = false;
    return BIO_new_mem_buf((char*)svar.data(), svar.size());
  }
  return nullptr;
}
