int ss_parse_multipart_data(Request *req) {
    std::string *body = req->get_body()->get_raw_string();
    if (body->empty()) {
        LOG_DEBUG("multipart data is empty, url:%s", req->get_request_url().c_str());
        return 0;
    }
    // parse boundary
    std::string ct = req->get_header("Content-Type");
    std::vector<std::string> ct_tokens;
    int ret = ss_split_str(ct, ';', ct_tokens);
    if (ret != 0 || ct_tokens.size() != 2) {
        LOG_ERROR("parse multipart data content type err:%d, ct:%s", ret, ct.c_str());
        return ret;
    }
    std::vector<std::string> boundary_tokens;
    ret = ss_split_str(ct_tokens[1], '=', boundary_tokens);
    if (ret != 0 || boundary_tokens.size() != 2) {
        LOG_ERROR("parse multipart data(boundary) content type err:%d, ct:%s", ret, ct.c_str());
        return ret;
    }
    std::string boundary = "--" + boundary_tokens[1];
    LOG_DEBUG("get url:%s, bounday:%s", req->get_request_url().c_str(), boundary.c_str());

    multipart_parser_settings mp_settings;
    memset(&mp_settings, 0, sizeof(multipart_parser_settings));
    mp_settings.on_header_field = ss_on_multipart_name;
    mp_settings.on_header_value = ss_on_multipart_value;
    mp_settings.on_part_data = ss_on_multipart_data;
    mp_settings.on_part_data_end = ss_on_multipart_data_over;
    mp_settings.on_body_end = ss_on_multipart_body_end;

    multipart_parser* parser = multipart_parser_init(boundary.c_str(), &mp_settings);
    multipart_parser_set_data(parser, req);
    size_t parsed = multipart_parser_execute(parser, body->c_str(), body->size());
    int parse_ret = 0;
    if (parsed != body->size()) {
        LOG_WARN("parse multipart data err, parsed:%lu, total:%lu, url:%s", 
                parsed, body->size(), req->get_request_url().c_str());
        parse_ret = -1;
    }
    LOG_DEBUG("multipart_parser_execute, parsed:%lu, total:%lu", 
                parsed, body->size());
    multipart_parser_free(parser);

    return parse_ret;
}
