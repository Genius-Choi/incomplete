static void calculate_quic_tp_tag(uint8_t *tag64, const quicly_context_t *ctx)
{
    ptls_buffer_t buf;
    uint8_t full_digest[PTLS_SHA256_DIGEST_SIZE];

    /* calculate sha256 hash of remembered tp */
    ptls_buffer_init(&buf, "", 0);
    if (quicly_build_session_ticket_auth_data(&buf, ctx) != 0 ||
        ptls_calc_hash(&ptls_openssl_sha256, full_digest, buf.base, buf.off) != 0)
        h2o_fatal("failed to calculate sha256 of remembered TPs");
    ptls_buffer_dispose(&buf);

    /* use the first 64-bit */
    memcpy(tag64, full_digest, 8);
}
