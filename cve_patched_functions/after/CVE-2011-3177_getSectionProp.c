int IniSection::getSectionProp (const YCPPath&p, YCPValue&out, int what, int depth)
{
    string k = ip->changeCase (p->component_str (depth));
    // Find the matching sections.
    // If we need to recurse, choose one
    // Otherwise gather properties of all of the leaf sections

    pair <IniSectionIdxIterator, IniSectionIdxIterator> r =
	isections.equal_range (k);
    IniSectionIdxIterator xi = r.first, xe = r.second;

    if (depth + 1 < p->length())
    {
	// recurse
	if (xi != xe)
	{
	    // there's something
	    IniSection& s = (--xe)->second->s ();
	    return s.getSectionProp (p, out, what, depth+1);
	}
	//error
    }
    else
    {
	// bottom level, take all
	YCPList results;
	bool found = false;
	for (; xi != xe; ++xi)
	{
	    found = true;
	    IniSection& s = xi->second->s ();
	    if (what == 0)
		out = YCPString (s.comment);
	    else if (what == 1)
		out = YCPInteger (s.rewrite_by);
	    else
		out = YCPInteger (s.read_by);
	    results->add (out);
	}

	if (ip->repeatNames ())
	{
	    out = results;
	    return 0;
	}
	else if (found)
	{
	    // nonempty range, the cycle ran once, out has the right value
	    return 0;
	}
	// empty range, no such key
    }

    y2debug ("Read: Invalid path %s [%d]", p->toString().c_str(), depth);
    return -1;
}
