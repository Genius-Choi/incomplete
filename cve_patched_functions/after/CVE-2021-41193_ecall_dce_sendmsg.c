int ecall_dce_sendmsg(struct ecall *ecall, struct econn_message *msg)
{
	char *str = NULL;
	int err;

	err = econn_message_encode(&str, msg);
	if (err) {
		warning("ecall: dce_sendmsg: econn_message_encode"
			" failed (%m)\n", err);
		goto out;
	}

	if (msg->msg_type != ECONN_PING) {
		ecall_trace(ecall, msg, true, ECONN_TRANSP_DIRECT,
			    "DataChan %H\n",
			    econn_message_brief, msg);
	}

	err = IFLOW_CALLE(ecall->flow, dce_send,
			  (const uint8_t *)str, str_len(str));
 out:
	mem_deref(str);

	return err;
}
