GF_Err gf_isom_shift_cts_offset(GF_ISOFile *the_file, u32 trackNumber, s32 offset_shift)
{
	u32 i;
	GF_TrackBox *trak = gf_isom_get_track_from_file(the_file, trackNumber);
	if (!trak) return GF_BAD_PARAM;
	if (!trak->Media->information->sampleTable->CompositionOffset) return GF_BAD_PARAM;
	if (!trak->Media->information->sampleTable->CompositionOffset->unpack_mode) return GF_BAD_PARAM;

	GF_CompositionOffsetBox *ctso = trak->Media->information->sampleTable->CompositionOffset;
	for (i=0; i<ctso->nb_entries; i++) {
		s64 new_ts = ctso->entries[i].decodingOffset;
		new_ts -= offset_shift;
		/*we're in unpack mode: one entry per sample*/
		ctso->entries[i].decodingOffset = (s32) new_ts;
	}
	if (trak->Media->mediaHeader->duration >= -offset_shift) {
		s64 new_dur = trak->Media->mediaHeader->duration;
		new_dur -= offset_shift;
		if (new_dur<0) new_dur = 0;
		trak->Media->mediaHeader->duration = (u32) new_dur;
	}
	return GF_OK;
}
