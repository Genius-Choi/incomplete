bool ots_ltsh_parse(OpenTypeFile *file, const uint8_t *data, size_t length) {
  Buffer table(data, length);

  if (!file->maxp) {
    return OTS_FAILURE_MSG("Missing maxp table from font needed by ltsh");
  }

  OpenTypeLTSH *ltsh = new OpenTypeLTSH;
  file->ltsh = ltsh;

  uint16_t num_glyphs = 0;
  if (!table.ReadU16(&ltsh->version) ||
      !table.ReadU16(&num_glyphs)) {
    return OTS_FAILURE_MSG("Failed to read ltsh header");
  }

  if (ltsh->version != 0) {
    DROP_THIS_TABLE("bad version: %u", ltsh->version);
    return true;
  }

  if (num_glyphs != file->maxp->num_glyphs) {
    DROP_THIS_TABLE("bad num_glyphs: %u", num_glyphs);
    return true;
  }

  ltsh->ypels.reserve(num_glyphs);
  for (unsigned i = 0; i < num_glyphs; ++i) {
    uint8_t pel = 0;
    if (!table.ReadU8(&pel)) {
      return OTS_FAILURE_MSG("Failed to read pixels for glyph %d", i);
    }
    ltsh->ypels.push_back(pel);
  }

  return true;
}
