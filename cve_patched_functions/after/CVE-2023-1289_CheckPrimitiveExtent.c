static MagickBooleanType CheckPrimitiveExtent(MVGInfo *mvg_info,
  const double pad)
{
  char
    **text = (char **) NULL;

  double
    extent;

  size_t
    quantum;

  ssize_t
    i;

  /*
    Check if there is enough storage for drawing primitives.
  */
  quantum=sizeof(**mvg_info->primitive_info);
  extent=(double) mvg_info->offset+pad+(PrimitiveExtentPad+1)*(double) quantum;
  if (extent <= (double) *mvg_info->extent)
    return(MagickTrue);
  if ((extent >= (double) MAGICK_SSIZE_MAX) || (IsNaN(extent) != 0))
    return(MagickFalse);
  if (mvg_info->offset > 0)
    {
      text=(char **) AcquireQuantumMemory(mvg_info->offset,sizeof(*text));
      if (text == (char **) NULL)
        return(MagickFalse);
      for (i=0; i < mvg_info->offset; i++)
        text[i]=(*mvg_info->primitive_info)[i].text;
    }
  *mvg_info->primitive_info=(PrimitiveInfo *) ResizeQuantumMemory(
    *mvg_info->primitive_info,(size_t) (extent+1),quantum);
  if (*mvg_info->primitive_info != (PrimitiveInfo *) NULL)
    {
      if (text != (char **) NULL)
        text=(char **) RelinquishMagickMemory(text);
      *mvg_info->extent=(size_t) extent;
      for (i=mvg_info->offset+1; i <= (ssize_t) extent; i++)
      {
        (*mvg_info->primitive_info)[i].primitive=UndefinedPrimitive;
        (*mvg_info->primitive_info)[i].text=(char *) NULL;
      }
      return(MagickTrue);
    }
  /*
    Reallocation failed, allocate a primitive to facilitate unwinding.
  */
  if (text != (char **) NULL)
    {
      for (i=0; i < mvg_info->offset; i++)
        if (text[i] != (char *) NULL)
          text[i]=DestroyString(text[i]);
      text=(char **) RelinquishMagickMemory(text);
    }
  (void) ThrowMagickException(mvg_info->exception,GetMagickModule(),
    ResourceLimitError,"MemoryAllocationFailed","`%s'","");
  *mvg_info->primitive_info=(PrimitiveInfo *) AcquireCriticalMemory((size_t)
    (PrimitiveExtentPad+1)*quantum);
  (void) memset(*mvg_info->primitive_info,0,(size_t) ((PrimitiveExtentPad+1)*
    quantum));
  *mvg_info->extent=1;
  mvg_info->offset=0;
  return(MagickFalse);
}
