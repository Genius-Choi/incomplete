idle_alarm_expired (enum alarm_id al_id, void *ctx, lsquic_time_t expiry,
                                                            lsquic_time_t now)
{
    struct ietf_full_conn *const conn = (struct ietf_full_conn *) ctx;

    if ((conn->ifc_mflags & MF_NOPROG_TIMEOUT)
        && conn->ifc_pub.last_prog + conn->ifc_enpub->enp_noprog_timeout < now)
    {
        EV_LOG_CONN_EVENT(LSQUIC_LOG_CONN_ID, "connection timed out due to "
                                                            "lack of progress");
        /* Different flag so that CONNECTION_CLOSE frame is sent */
        ABORT_QUIETLY(0, TEC_APPLICATION_ERROR,
                                "connection timed out due to lack of progress");
    }
    else
    {
        LSQ_DEBUG("connection timed out");
        EV_LOG_CONN_EVENT(LSQUIC_LOG_CONN_ID, "connection timed out");
        conn->ifc_flags |= IFC_TIMED_OUT;
    }
}
