static void setWarningsAreErrorsFromFlags(SourceErrorManager &sm) {
  std::vector<Warning>::iterator yesIt = cl::Werror.begin();
  std::vector<Warning>::iterator noIt = cl::Wnoerror.begin();
  // Argument positions are indices into argv and start at 1 (or 2 if there's a
  // subcommand). See llvh::cl::CommandLineParser::ParseCommandLineOptions().
  // In this loop, position 0 represents the lack of a value.
  unsigned noPos = 0, yesPos = 0;
  while (true) {
    if (noIt != cl::Wnoerror.end()) {
      noPos = cl::Wnoerror.getPosition(noIt - cl::Wnoerror.begin());
    } else {
      noPos = 0;
    }
    if (yesIt != cl::Werror.end()) {
      yesPos = cl::Werror.getPosition(yesIt - cl::Werror.begin());
    } else {
      yesPos = 0;
    }

    Warning warning;
    bool enable;
    if (yesPos != 0 && (noPos == 0 || yesPos < noPos)) {
      warning = *yesIt;
      enable = true;
      ++yesIt;
    } else if (noPos != 0 && (yesPos == 0 || noPos < yesPos)) {
      warning = *noIt;
      enable = false;
      ++noIt;
    } else {
      break;
    }

    if (warning == Warning::NoWarning) {
      sm.setWarningsAreErrors(enable);
    } else {
      sm.setWarningIsError(warning, enable);
    }
  }
}
