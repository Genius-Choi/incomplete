    .SetShapeFn([](shape_inference::InferenceContext* c) {
      std::vector<ShapeHandle> input;
      TF_RETURN_IF_ERROR(c->input("input", &input));
      TF_RETURN_IF_ERROR(c->set_output("output", input));
      // If any of the input shapes are not known, we should return error.
      for (int i = 0; i < input.size(); i++) {
        if (!input[i].Handle()) {
          return errors::InvalidArgument(absl::StrCat(
              "Cannot infer output shape #", i,
              " for IdentityN node because input shape #", i, " is unknown."));
        }
      }
      return OkStatus();
    });
