TEST(acm, wifi_channel_20ms_20pct_loss_fec)
{
    float cpu_load;
    ACMtestSetup setup;
    ACMtestStats stats;
    
    initACMtestSetup(&setup);
    setup.bitrate_bps = 32000;
    setup.sample_rate_hz = 16000;
    setup.nw_type = NW_type_wifi;
    setup.plr = 20;
    setup.useFec = true;
    
    int ret = ACM_unit_test(
                            "./test/data/near16.pcm",
                            "./test/data/rtp.dat",
                            "./test/data/out.pcm",
                            "./test/data/",
                            &stats,
                            &setup);
    
    ASSERT_EQ(0, ret);
    EXPECT_LT( stats.avg_bitrate_bps, 35000.0 );
    COMPLEXITY_CHECK( stats.cpu_load_encoder, 8.0 );
    COMPLEXITY_CHECK( stats.cpu_load_decoder, 2.0 );
    EXPECT_LT( stats.max_buffer_size, 150.0 );
    EXPECT_LT( stats.avg_buffer_size, 90.0 );
    EXPECT_LT( stats.max_packet_loss_rate, 10.0 );
    EXPECT_LT( stats.avg_packet_loss_rate, 5.0 );
    EXPECT_LT( stats.max_expand_rate, 10.0 );
    EXPECT_LT( stats.avg_expand_rate, 6.0 );
}
