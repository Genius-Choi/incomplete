static std::string websocket_success(lua_State *L, void* userp) {
    ws_handle ** wsh = (ws_handle**)userp;
    luaL_checkstack(L, 10, "Could not grow stack for websocket_success");
    lua_pushstring(L, (*wsh)->url.c_str());
    lua_createtable(L, 0, 4);
    ws_handle ** ws = (ws_handle**)lua_newuserdata(L, sizeof(ws_handle*));
    *ws = *wsh;
    (*wsh)->ud = ws;
    lua_createtable(L, 0, 1);
    lua_pushstring(L, "__gc");
    lua_pushcfunction(L, websocket_free);
    lua_settable(L, -3);
    lua_setmetatable(L, -2);
    luaL_setfuncs(L, websocket_funcs, 1);
    return "websocket_success";
}
