static jwa_alg get_token_sign_alg(struct _oidc_config * config, json_t * j_client, int type) {
  const char * sign_kid = json_string_value(json_object_get(config->j_params, "client-sign_kid-parameter"));
  jwk_t * jwk = NULL;
  jwa_alg alg = R_JWA_ALG_UNKNOWN;

  if (j_client != NULL) {
    if (!json_string_null_or_empty(json_object_get(j_client, sign_kid))) {
      jwk = r_jwks_get_by_kid(config->jwks_sign, json_string_value(json_object_get(j_client, sign_kid)));
      alg = r_str_to_jwa_alg(r_jwk_get_property_str(jwk, "alg"));
      r_jwk_free(jwk);
    } else {
      switch (type) {
        case GLEWLWYD_TOKEN_TYPE_ACCESS_TOKEN:
          if (json_object_get(j_client, "access_token_signing_alg") != NULL) {
            alg = r_str_to_jwa_alg(json_string_value(json_object_get(j_client, "access_token_signing_alg")));
          }
          break;
        case GLEWLWYD_TOKEN_TYPE_ID_TOKEN:
          if (json_object_get(j_client, "id_token_signing_alg") != NULL) {
            alg = r_str_to_jwa_alg(json_string_value(json_object_get(j_client, "id_token_signing_alg")));
          }
          break;
        case GLEWLWYD_TOKEN_TYPE_USERINFO:
          if (json_object_get(j_client, "userinfo_signing_alg") != NULL) {
            alg = r_str_to_jwa_alg(json_string_value(json_object_get(j_client, "userinfo_signing_alg")));
          }
          break;
        case GLEWLWYD_TOKEN_TYPE_AUTH:
          if (json_object_get(j_client, "authorization_signed_response_alg") != NULL) {
            alg = r_str_to_jwa_alg(json_string_value(json_object_get(j_client, "authorization_signed_response_alg")));
          }
          break;
        default:
          alg = R_JWA_ALG_UNKNOWN;
          break;
      }
    }
  }
  if (alg == R_JWA_ALG_UNKNOWN) {
    jwk = r_jwks_get_at(config->jwks_sign, 0);
    alg = r_str_to_jwa_alg(r_jwk_get_property_str(jwk, "alg"));
    r_jwk_free(jwk);
  }
  return alg;
}
