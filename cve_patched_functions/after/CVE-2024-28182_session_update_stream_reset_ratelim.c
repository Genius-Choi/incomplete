static int session_update_stream_reset_ratelim(nghttp2_session *session) {
  if (!session->server || (session->goaway_flags & NGHTTP2_GOAWAY_SUBMITTED)) {
    return 0;
  }

  nghttp2_ratelim_update(&session->stream_reset_ratelim,
                         nghttp2_time_now_sec());

  if (nghttp2_ratelim_drain(&session->stream_reset_ratelim, 1) == 0) {
    return 0;
  }

  return nghttp2_session_add_goaway(session, session->last_recv_stream_id,
                                    NGHTTP2_INTERNAL_ERROR, NULL, 0,
                                    NGHTTP2_GOAWAY_AUX_NONE);
}
