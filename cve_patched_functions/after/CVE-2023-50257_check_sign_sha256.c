bool check_sign_sha256(X509* certificate, const unsigned char* data, const size_t data_length,
        const std::vector<uint8_t>& signature)
{
    assert(certificate);
    assert(data);

    bool returnedValue = false;

    EVP_MD_CTX ctx;
    EVP_MD_CTX_init(&ctx);

    EVP_PKEY* pubkey = X509_get_pubkey(certificate);
    
    if(pubkey != nullptr)
    {
        if(EVP_DigestVerifyInit(&ctx, NULL, EVP_sha256(), NULL, pubkey) == 1)
        {
            if(EVP_DigestVerifyUpdate(&ctx, data, data_length) == 1)
            {
                if(EVP_DigestVerifyFinal(&ctx, signature.data(), signature.size()) == 1)
                    returnedValue = true;
                else
                    logWarning(AUTHENTICATION, "Signature verification error (" << ERR_get_error() << ")");
            }
            else
                logError(AUTHENTICATION, "Cannot update signature check (" << ERR_get_error() << ")");

        }
        else
            logError(AUTHENTICATION, "Cannot init signature check (" << ERR_get_error() << ")");

        EVP_PKEY_free(pubkey);
    }
    else
        logError(AUTHENTICATION, "Cannot get public key from certificate");

    EVP_MD_CTX_cleanup(&ctx);

    return returnedValue;
}
