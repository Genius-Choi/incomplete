void test_fpu_stack_overflow(oe_enclave_t* enclave)
{
    double float_result = 0;
    uint64_t dummy = 0;

    printf("=== test_fpu_stack_overflow()\n");

#ifdef _WIN32
    oe_dummy_fpu_loads();
#else
    asm("fldl %0\n\t"
        "fldl %0\n\t"
        "fldl %0\n\t"
        "fldl %0\n\t"
        "fldl %0\n\t"
        "fldl %0\n\t"
        "fldl %0\n\t"
        "fldl %0\n\t" ::"m"(dummy)
        :);
#endif

    OE_TEST(enclave_add_float(enclave, &float_result) == OE_OK);

    printf("x87 FPU result = %f\n", float_result);
    OE_TEST(!isnan(float_result));
}
