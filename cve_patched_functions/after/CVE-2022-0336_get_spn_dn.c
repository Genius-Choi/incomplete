static int get_spn_dn(struct ldb_context *ldb,
		      TALLOC_CTX *tmp_ctx,
		      const char *candidate,
		      struct ldb_dn **dn)
{
	int ret;
	const char *empty_attrs[] = { NULL };
	struct ldb_message *msg = NULL;
	struct ldb_dn *base_dn = ldb_get_default_basedn(ldb);

	const char *enc_candidate = NULL;

	*dn = NULL;

	enc_candidate = ldb_binary_encode_string(tmp_ctx, candidate);
	if (enc_candidate == NULL) {
		return ldb_operr(ldb);
	}

	ret = dsdb_search_one(ldb,
			      tmp_ctx,
			      &msg,
			      base_dn,
			      LDB_SCOPE_SUBTREE,
			      empty_attrs,
			      0,
			      "(servicePrincipalName=%s)",
			      enc_candidate);
	if (ret != LDB_SUCCESS) {
		return ret;
	}
	*dn = msg->dn;
	return LDB_SUCCESS;
}
