int spider_mbase_handler::append_index_hint(
  spider_string *str,
  int link_idx,
  ulong sql_type
  )
{
  List<Index_hint> *index_hints = spider_get_index_hints(spider);
  List_iterator <Index_hint> iter(*index_hints);
  Index_hint *hint;
//  THD *thd = current_thd;
  int error_num = 0;
  DBUG_ENTER("spider_mbase_handler::append_index_hint");
  DBUG_PRINT("info",("spider this=%p", this));

  while(index_hints && (hint = iter++))
  {
//    hint->print(thd, str);
    if (sql_type != SPIDER_SQL_TYPE_HANDLER)
    {
      switch(hint->type)
      {
      case INDEX_HINT_IGNORE:
        if (str->reserve(hint->key_name.length+ SPIDER_SQL_INDEX_IGNORE_LEN + SPIDER_SQL_OPEN_PAREN_LEN + SPIDER_SQL_CLOSE_PAREN_LEN))
          DBUG_RETURN(HA_ERR_OUT_OF_MEM);
        str->q_append(SPIDER_SQL_INDEX_IGNORE_STR,SPIDER_SQL_INDEX_IGNORE_LEN);
        str->q_append(SPIDER_SQL_OPEN_PAREN_STR,SPIDER_SQL_OPEN_PAREN_LEN);
        str->q_append(hint->key_name.str, hint->key_name.length);
        str->q_append(SPIDER_SQL_CLOSE_PAREN_STR,SPIDER_SQL_CLOSE_PAREN_LEN);
        break;
      case INDEX_HINT_USE:
        if (str->reserve(hint->key_name.length+ SPIDER_SQL_INDEX_USE_LEN + SPIDER_SQL_OPEN_PAREN_LEN + SPIDER_SQL_CLOSE_PAREN_LEN))
          DBUG_RETURN(HA_ERR_OUT_OF_MEM);
        str->q_append(SPIDER_SQL_INDEX_USE_STR,SPIDER_SQL_INDEX_USE_LEN);
        str->q_append(SPIDER_SQL_OPEN_PAREN_STR,SPIDER_SQL_OPEN_PAREN_LEN);
        str->q_append(hint->key_name.str, hint->key_name.length);
        str->q_append(SPIDER_SQL_CLOSE_PAREN_STR,SPIDER_SQL_CLOSE_PAREN_LEN);
        break;
      case INDEX_HINT_FORCE:
        if (str->reserve(hint->key_name.length+ SPIDER_SQL_INDEX_FORCE_LEN + SPIDER_SQL_OPEN_PAREN_LEN + SPIDER_SQL_CLOSE_PAREN_LEN))
          DBUG_RETURN(HA_ERR_OUT_OF_MEM);
        str->q_append(SPIDER_SQL_INDEX_FORCE_STR,SPIDER_SQL_INDEX_FORCE_LEN);
        str->q_append(SPIDER_SQL_OPEN_PAREN_STR,SPIDER_SQL_OPEN_PAREN_LEN);
        str->q_append(hint->key_name.str, hint->key_name.length);
        str->q_append(SPIDER_SQL_CLOSE_PAREN_STR,SPIDER_SQL_CLOSE_PAREN_LEN);
        break;
      default:
        //    SPIDER_SQL_COMMA_STR
        break;
      }
    }
  }
  DBUG_RETURN(error_num);
}
