void IMAPSession::unsetup()
{
    mailimap * imap;
    
    LOCK();
    imap = mImap;
    mImap = NULL;
    mIdleEnabled = false;
    UNLOCK();
    
    if (imap != NULL) {
        if (imap->imap_stream != NULL) {
            mailstream_close(imap->imap_stream);
            imap->imap_stream = NULL;
        }
        mailimap_free(imap);
        imap = NULL;
    }
    
    mState = STATE_DISCONNECTED;
}
