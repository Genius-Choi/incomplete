gerbv_save_layer_from_index(gerbv_project_t *gerbvProject, gint index, gchar *filename) 
{
	gerbv_fileinfo_t *file = gerbvProject->file[index];
	gerbv_user_transformation_t *trans = &file->transform;

	switch (file->image->layertype) {
	case GERBV_LAYERTYPE_RS274X:
		if (trans) {
			/* NOTE: mirrored file is not yet supported */
			if (trans->mirrorAroundX || trans->mirrorAroundY) {
				GERB_COMPILE_ERROR(_("Exporting mirrored file "
							"is not supported!"));
				return FALSE;
			}

			/* NOTE: inverted file is not yet supported */
			if (trans->inverted) {
				GERB_COMPILE_ERROR(_("Exporting inverted file "
							"is not supported!"));
				return FALSE;
			}
		}

		gerbv_export_rs274x_file_from_image (filename,
				file->image, trans);
		break;

	case GERBV_LAYERTYPE_DRILL:
		if (trans) {
			/* NOTE: inverted file is not yet supported */
			if (trans->inverted) {
				GERB_COMPILE_ERROR(_("Exporting inverted file "
							"is not supported!"));
				return FALSE;
			}
		}

		gerbv_export_drill_file_from_image (filename,
				file->image, trans);
		break;
	default:
		return FALSE;
	}

	file->layer_dirty = FALSE;

	return TRUE;
}
