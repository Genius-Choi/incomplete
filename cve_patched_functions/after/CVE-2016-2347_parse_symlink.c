static int parse_symlink(LHAFileHeader *header)
{
	char *fullpath;
	char *p;

	// Although the format is always the same, some files have
	// symlink headers where the path is split between the path
	// and filename headers. For example:
	//    path = etc|../../
	//    filename = etc

	fullpath = lha_file_header_full_path(header);

	if (fullpath == NULL) {
		return 0;
	}

	p = strchr(fullpath, '|');

	if (p == NULL) {
		free(fullpath);
		return 0;
	}

	header->symlink_target = strdup(p + 1);

	if (header->symlink_target == NULL) {
		free(fullpath);
		return 0;
	}

	// Cut the string in half at the separator. Keep the left side
	// as the value for filename.

	*p = '\0';

	free(header->path);
	free(header->filename);
	header->path = NULL;
	header->filename = fullpath;

	// Having joined path and filename together during processing,
	// we now have the opposite problem: header->filename might
	// contain a full path rather than just a filename. Split back
	// into two again.

	return split_header_filename(header);
}
