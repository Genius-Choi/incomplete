static int mcast_group_update(struct pico_mcast_group *g, struct pico_tree *MCASTFilter, uint8_t filter_mode)
{
    struct pico_tree_node *index = NULL, *_tmp = NULL;
    struct pico_ip4 *source = NULL;
    /* cleanup filter */
    pico_tree_foreach_safe(index, &g->MCASTSources, _tmp) {
        source = index->keyValue;
        pico_tree_delete(&g->MCASTSources, source);
        PICO_FREE(source);
    }
    /* insert new filter */
    if (MCASTFilter) {
        pico_tree_foreach(index, MCASTFilter) {
            if (index->keyValue) {
                source = PICO_ZALLOC(sizeof(struct pico_ip4));
                if (!source) {
                    pico_err = PICO_ERR_ENOMEM;
                    return -1;
                }
                source->addr = ((struct pico_ip4 *)index->keyValue)->addr;
                if (pico_tree_insert(&g->MCASTSources, source)) {
                    dbg("IPv4: Failed to insert source in tree\n");
					PICO_FREE(source);
					return -1;
				}
            }
        }
    }

    g->filter_mode = filter_mode;
    return 0;
}
