lldpd_configure(int debug, const char *path, const char *ctlname)
{
	pid_t lldpcli = vfork();
	int devnull;

	char sdebug[debug + 3];
	memset(sdebug, 'd', debug + 3);
	sdebug[debug + 2] = '\0';
	sdebug[0] = '-'; sdebug[1] = 's';
	log_debug("main", "invoke %s %s", path, sdebug);

	switch (lldpcli) {
	case -1:
		log_warn("main", "unable to fork");
		return -1;
	case 0:
		/* Child, exec lldpcli */
		if ((devnull = open("/dev/null", O_RDWR, 0)) != -1) {
			dup2(devnull,   STDIN_FILENO);
			dup2(devnull,   STDOUT_FILENO);
			if (devnull > 2) close(devnull);

			execl(path, "lldpcli", sdebug,
			    "-u", ctlname,
			    "-c", SYSCONFDIR "/lldpd.conf",
			    "-c", SYSCONFDIR "/lldpd.d",
			    "resume",
			    (char *)NULL);
			log_warn("main", "unable to execute %s", path);
			log_warnx("main", "configuration is incomplete, lldpd needs to be unpaused");
		}
		_exit(127);
		break;
	default:
		/* Father, don't do anything stupid */
		return lldpcli;
	}
	/* Should not be here */
	return -1;
}
