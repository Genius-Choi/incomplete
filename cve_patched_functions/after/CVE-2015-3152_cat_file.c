int cat_file(DYNAMIC_STRING* ds, const char* filename)
{
  int fd;
  size_t len;
  char buff[512];
  bool dangling_cr= 0;

  if ((fd= my_open(filename, O_RDONLY, MYF(0))) < 0)
    return 1;
  while((len= my_read(fd, (uchar*)&buff,
                      sizeof(buff), MYF(0))) > 0)
  {
    char *p= buff, *start= buff;
    if (dangling_cr)
    {
      if (*p != '\n')
       dynstr_append_mem(ds, "\r", 1);
      dangling_cr= 0;
    }
    while (p < buff+len)
    {
      /* Convert cr/lf to lf */
      if (*p == '\r' && *(p+1) && *(p+1)== '\n')
      {
        /* Add fake newline instead of cr and output the line */
        *p= '\n';
        p++; /* Step past the "fake" newline */
        dynstr_append_mem(ds, start, p-start);
        p++; /* Step past the "fake" newline */
        start= p;
      }
      else
        p++;
    }
    if (*(p-1) == '\r' && len == 512)
      dangling_cr=1;
    /* Output any chars that migh be left */
    if (dangling_cr)
      dynstr_append_mem(ds, start, p-start-1);
    else
      dynstr_append_mem(ds, start, p-start);
  }
  my_close(fd, MYF(0));
  return 0;
}
