bool AdminRequestHandler::handleInvalidateUnitRequest(const std::string &cmd,
                                                      Transport *transport) {
  if (RuntimeOption::RepoAuthoritative) {
    transport->sendString("Cannot invalidate units in repo authoritative mode\n", 400);
    return true;
  }

  std::string invalidated;
  std::vector<std::string> paths;
  // Support GET for convenience, and POST for large requests.
  transport->getArrayParam("path", paths, Transport::Method::AUTO);

  bool first = true;
  for (auto const& path : paths) {
    String translatedPath = File::TranslatePathKeepRelative(path);
    invalidateUnit(translatedPath.get());

    if (first) {
      first = false;
    } else {
      invalidated += " ";
    }
    invalidated += translatedPath.c_str();
  }

  auto msg = folly::sformat("Invalidated {} path(s): {}\n",
                            paths.size(), invalidated);
  transport->sendString(msg);
  return true;
}
