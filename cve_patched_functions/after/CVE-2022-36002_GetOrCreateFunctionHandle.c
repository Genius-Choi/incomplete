Status BatchFunctionKernel::GetOrCreateFunctionHandle(
    OpKernelContext* c, FunctionLibraryRuntime::Handle* handle) {
  mutex_lock ml(mu_);
  if (!fhandle_) {
    TF_RETURN_IF_ERROR(InstantiateFunction(c, handle));
    fhandle_ = *handle;
  } else {
    *handle = fhandle_.value();
  }
  return OkStatus();
}
