int im_free(
    image_desc_t *im)
{
    unsigned long i, ii;
    cairo_status_t status = (cairo_status_t) 0;

    if (im == NULL)
        return 0;

    if (im->daemon_addr != NULL)
      free(im->daemon_addr);

    if (im->gdef_map){
        g_hash_table_destroy(im->gdef_map);        
    }

    if (im->rrd_map){
        g_hash_table_destroy(im->rrd_map);        
    }

    for (i = 0; i < (unsigned) im->gdes_c; i++) {
        if (im->gdes[i].data_first) {
            /* careful here, because a single pointer can occur several times */
            free(im->gdes[i].data);
            if (im->gdes[i].ds_namv) {
                for (ii = 0; ii < im->gdes[i].ds_cnt; ii++)
                    free(im->gdes[i].ds_namv[ii]);
                free(im->gdes[i].ds_namv);
            }
        }
        /* free allocated memory used for dashed lines */
        if (im->gdes[i].p_dashes != NULL)
            free(im->gdes[i].p_dashes);

        free(im->gdes[i].p_data);
        free(im->gdes[i].rpnp);
    }
    free(im->gdes);

    for (i = 0; i < DIM(text_prop);i++){
        pango_font_description_free(im->text_prop[i].font_desc);
        im->text_prop[i].font_desc = NULL;
    }

    if (im->font_options)
        cairo_font_options_destroy(im->font_options);

    if (im->cr) {
        status = cairo_status(im->cr);
        cairo_destroy(im->cr);
    }


    if (im->rendered_image) {
        free(im->rendered_image);
    }

    if (im->layout) {
        g_object_unref (im->layout);
    }

    if (im->surface)
        cairo_surface_destroy(im->surface);

    if (status)
        fprintf(stderr, "OOPS: Cairo has issues it can't even die: %s\n",
                cairo_status_to_string(status));

    return 0;
}
