  curl_socket_t opensocket(void *clientp, curlsocktype purpose,
                                  struct curl_sockaddr *address) {
    std::shared_ptr<RequestHandler> p = drachtio::RequestHandler::getInstance() ;
    std::map<curl_socket_t, boost::asio::ip::tcp::socket *>& socket_map = p->getSocketMap() ;
    boost::asio::io_service& io_service = p->getIOService() ;

    curl_socket_t sockfd = CURL_SOCKET_BAD;

    /* restrict to IPv4 */
    if(purpose == CURLSOCKTYPE_IPCXN && address->family == AF_INET) {
      /* create a tcp socket object */
      boost::asio::ip::tcp::socket *tcp_socket =
        new boost::asio::ip::tcp::socket(io_service);

      /* open it and get the native handle*/
      boost::system::error_code ec;
      tcp_socket->open(boost::asio::ip::tcp::v4(), ec);

      if(ec) {
        /* An error occurred */
        DR_LOG(log_error) << "Couldn't open socket [" << ec << "][" << ec.message() << "]";
      }
      else {
        sockfd = tcp_socket->native_handle();

        /* save it for monitoring */
        socket_map.insert(std::pair<curl_socket_t,
                          boost::asio::ip::tcp::socket *>(sockfd, tcp_socket));
      }
    }

    return sockfd;
  }
