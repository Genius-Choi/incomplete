void oe_abort(void)
{
    /* Bypass the FS check given that the oe_abort can be invoked anywhere */
    oe_sgx_td_t* td = oe_sgx_get_td_no_fs_check();

    /* It is unlikely that td is invalid. If this is the case, we cannot
     * call _abort to exit the enclave. Instead, we intentionally trigger
     * the page fault by writing to the code page to exit the enclave.
     * Note that the subsequent execution may hang in case that state machine
     * check fails in oe_enter, which will block the call to the
     * __oe_handle_main(). If the execution reaches __oe_handle_main(), we can
     * safely abort with valid td via the check against __oe_enclave_status. */
    if (!td)
    {
        uint64_t oe_abort_address = (uint64_t)oe_abort;

        __oe_enclave_status = OE_ENCLAVE_ABORTING;

        asm volatile("mov $1, %0" : "=r"(*(uint64_t*)oe_abort_address));
    }

    oe_abort_with_td(td);
}
