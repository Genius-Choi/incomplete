int64_t SSLSocket::writeImpl(const char *buffer, int64_t length) {
  int didwrite;
  if (m_data->m_ssl_active) {
    IOStatusHelper io("sslsocket::send", getAddress().c_str(), getPort());

    bool retry = true;
    do {
      didwrite = SSL_write(m_data->m_handle, buffer, length);
      if (didwrite > 0) break;
      retry = handleError(didwrite, false);
    } while (retry);
  } else {
    didwrite = Socket::writeImpl(buffer, length);
  }
  return didwrite < 0 ? 0 : didwrite;
}
