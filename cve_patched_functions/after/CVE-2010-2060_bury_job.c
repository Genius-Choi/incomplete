bury_job(job j, char update_store)
{
    size_t z;

    if (update_store) {
        z = binlog_reserve_space_update(j);
        if (!z) return 0;
        j->reserved_binlog_space += z;
    }

    job_insert(&j->tube->buried, j);
    global_stat.buried_ct++;
    j->tube->stat.buried_ct++;
    j->state = JOB_STATE_BURIED;
    j->reserver = NULL;
    j->bury_ct++;

    if (update_store) return binlog_write_job(j);

    return 1;
}
