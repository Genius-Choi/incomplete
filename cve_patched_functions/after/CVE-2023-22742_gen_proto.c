static int gen_proto(git_str *request, const char *cmd, git_net_url *url)
{
	const char *repo;

	repo = url->path;

	if (repo && repo[0] == '/' && repo[1] == '~')
		repo++;

	if (!repo || !repo[0]) {
		git_error_set(GIT_ERROR_NET, "malformed git protocol URL");
		return -1;
	}

	git_str_puts(request, cmd);
	git_str_puts(request, " '");
	git_str_puts(request, repo);
	git_str_puts(request, "'");

	if (git_str_oom(request))
		return -1;

	return 0;
}
