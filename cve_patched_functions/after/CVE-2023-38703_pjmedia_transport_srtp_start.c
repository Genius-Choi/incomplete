PJ_DEF(pj_status_t) pjmedia_transport_srtp_start(
                           pjmedia_transport *tp,
                           const pjmedia_srtp_crypto *tx,
                           const pjmedia_srtp_crypto *rx)
{
    transport_srtp  *srtp = (transport_srtp*) tp;
    pj_status_t status;

    PJ_ASSERT_RETURN(tp && tx && rx, PJ_EINVAL);

    pj_lock_acquire(srtp->mutex);

    if (srtp->session_inited) {
        pjmedia_transport_srtp_stop(tp);
    }

    status = create_srtp_ctx(srtp, &srtp->srtp_ctx, &srtp->setting, tx, rx);
    if (status == PJ_SUCCESS) {
        if (srtp->srtp_ctx.srtp_tx_ctx && srtp->srtp_ctx.srtp_rx_ctx) {
            /* Declare SRTP session initialized */
            srtp->session_inited = PJ_TRUE;
        } else {
            srtp->bypass_srtp = PJ_TRUE;
        }
    }

    pj_lock_release(srtp->mutex);

    return status;
}
