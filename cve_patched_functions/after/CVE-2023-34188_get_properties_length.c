static size_t get_properties_length(struct mg_mqtt_prop *props, size_t count) {
  size_t i, size = 0;
  for (i = 0; i < count; i++) {
    size++;  // identifier
    switch (mqtt_prop_type_by_id(props[i].id)) {
      case MQTT_PROP_TYPE_STRING_PAIR:
        size += (uint32_t) (props[i].val.len + props[i].key.len +
                            2 * sizeof(uint16_t));
        break;
      case MQTT_PROP_TYPE_STRING:
        size += (uint32_t) (props[i].val.len + sizeof(uint16_t));
        break;
      case MQTT_PROP_TYPE_BINARY_DATA:
        size += (uint32_t) (props[i].val.len + sizeof(uint16_t));
        break;
      case MQTT_PROP_TYPE_VARIABLE_INT:
        size += compute_variable_length_size((uint32_t) props[i].iv);
        break;
      case MQTT_PROP_TYPE_INT: size += (uint32_t) sizeof(uint32_t); break;
      case MQTT_PROP_TYPE_SHORT: size += (uint32_t) sizeof(uint16_t); break;
      default: return size;  // cannot parse further down
    }
  }

  return size;
}
