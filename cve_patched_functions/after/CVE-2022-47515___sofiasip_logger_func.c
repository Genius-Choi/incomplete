	static void __sofiasip_logger_func(void *logarg, char const *fmt, va_list ap) {
        
        static bool loggingSipMsg = false ;
        static bool sourceIsBlacklisted = false;
        static std::shared_ptr<drachtio::StackMsg> msg ;

        char output[MAXLOGLEN+1] ;
        vsnprintf( output, MAXLOGLEN, fmt, ap ) ;
        va_end(ap) ;

        if( loggingSipMsg ) {
            loggingSipMsg = NULL == ::strstr( fmt, MSG_SEPARATOR) ;
            msg->appendLine( output, !loggingSipMsg ) ;

            if( !loggingSipMsg ) {
                //DR_LOG(drachtio::log_debug) << "Completed logging sip message"  ;
                if (!sourceIsBlacklisted) {
                    DR_LOG( drachtio::log_info ) << msg->getFirstLine()  << msg->getSipMessage() <<  " " ;            

                    msg->isIncoming() 
                    ? theOneAndOnlyController->setLastRecvStackMessage( msg ) 
                    : theOneAndOnlyController->setLastSentStackMessage( msg ) ;
                }
                sourceIsBlacklisted = false;
            }
        }
        else if( ::strstr( output, "recv ") == output || ::strstr( output, "send ") == output ) {
            drachtio::Blacklist* pBlacklist;
            loggingSipMsg = true ;
            //DR_LOG(drachtio::log_debug) << "started logging sip message: " << output  ;

            if ((pBlacklist = theOneAndOnlyController->getBlacklist())) {
                std::string header(output);
                std::regex re("\\[(.*)\\]");
                std::smatch mr;
                if (std::regex_search(header, mr, re) && mr.size() > 1) {
                    std::string host = mr[1] ;
                    if (pBlacklist->isBlackListed(host.c_str())) {
                        sourceIsBlacklisted = true;
                        DR_LOG(drachtio::log_debug) << "discarding message from blacklisted host " << host  ;
                    }
                }
            }

            char* szStartSeparator = strstr( output, "   " MSG_SEPARATOR ) ;
            if( NULL != szStartSeparator ) *szStartSeparator = '\0' ;

            msg = std::make_shared<drachtio::StackMsg>( output ) ;
        }
        else {
            int len = strlen(output) ;
            output[len-1] = '\0' ;
            DR_LOG(drachtio::log_info) << output ;
        }
    } ;
