void IMAPSession::capabilitySetWithSessionState(IndexSet * capabilities)
{
    if (mailimap_has_extension(mImap, (char *)"STARTTLS")) {
        capabilities->addIndex(IMAPCapabilityStartTLS);
    }
    if (mailimap_has_authentication(mImap, (char *)"PLAIN")) {
        capabilities->addIndex(IMAPCapabilityAuthPlain);
    }
    if (mailimap_has_authentication(mImap, (char *)"LOGIN")) {
        capabilities->addIndex(IMAPCapabilityAuthLogin);
    }
    if (mailimap_has_idle(mImap)) {
        capabilities->addIndex(IMAPCapabilityIdle);
    }
    if (mailimap_has_id(mImap)) {
        capabilities->addIndex(IMAPCapabilityId);
    }
    if (mailimap_has_xlist(mImap)) {
        capabilities->addIndex(IMAPCapabilityXList);
    }
    if (mailimap_has_extension(mImap, (char *) "X-GM-EXT-1")) {
        // Disable use of XLIST if this is the Gmail IMAP server because it implements
        // RFC 6154.
        capabilities->addIndex(IMAPCapabilityGmail);
    }
    if (mailimap_has_condstore(mImap)) {
        capabilities->addIndex(IMAPCapabilityCondstore);
    }
    if (mailimap_has_qresync(mImap)) {
        capabilities->addIndex(IMAPCapabilityQResync);
    }
    if (mailimap_has_xoauth2(mImap)) {
        capabilities->addIndex(IMAPCapabilityXOAuth2);
    }
    if (mailimap_has_namespace(mImap)) {
        capabilities->addIndex(IMAPCapabilityNamespace);
    }
    if (mailimap_has_compress_deflate(mImap)) {
        capabilities->addIndex(IMAPCapabilityCompressDeflate);
    }
    if (mailimap_has_extension(mImap, (char *)"CHILDREN")) {
        capabilities->addIndex(IMAPCapabilityChildren);
    }
    if (mailimap_has_extension(mImap, (char *)"MOVE")) {
        capabilities->addIndex(IMAPCapabilityMove);
    }
    if (mailimap_has_extension(mImap, (char *)"XYMHIGHESTMODSEQ")) {
        capabilities->addIndex(IMAPCapabilityXYMHighestModseq);
    }
    applyCapabilities(capabilities);
}
