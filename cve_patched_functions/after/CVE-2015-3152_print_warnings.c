static void print_warnings(MYSQL *mysql)
{
  const char   *query;
  MYSQL_RES    *result= NULL;
  MYSQL_ROW    cur;
  my_ulonglong num_rows;
  uint         error;

  /* Save current error before calling "show warnings" */
  error= mysql_errno(mysql);

  /* Get the warnings */
  query= "show warnings";
  if (mysql_real_query(mysql, query, strlen(query)) ||
      !(result= mysql_store_result(mysql)))
  {
    my_printf_error(0,"Could not print warnings; error: '%-.200s'",
                    error_flags, mysql_error(mysql));
  }

  /* Bail out when no warnings */
  if (!(num_rows= mysql_num_rows(result)))
    goto end;

  cur= mysql_fetch_row(result);

  /*
    Don't print a duplicate of the current error.  It is possible for SHOW
    WARNINGS to return multiple errors with the same code, but different
    messages.  To be safe, skip printing the duplicate only if it is the only
    warning.
  */
  if (!cur || (num_rows == 1 && error == (uint) strtoul(cur[1], NULL, 10)))
    goto end;

  do
  {
    printf("%s (Code %s): %s\n", cur[0], cur[1], cur[2]);
  } while ((cur= mysql_fetch_row(result)));

end:
  mysql_free_result(result);
}
