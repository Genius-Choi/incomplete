bool ots_gasp_serialise(OTSStream *out, OpenTypeFile *file) {
  const OpenTypeGASP *gasp = file->gasp;

  const uint16_t num_ranges = static_cast<uint16_t>(gasp->gasp_ranges.size());
  if (num_ranges != gasp->gasp_ranges.size() ||
      !out->WriteU16(gasp->version) ||
      !out->WriteU16(num_ranges)) {
    return OTS_FAILURE_MSG("failed to write gasp header");
  }

  for (uint16_t i = 0; i < num_ranges; ++i) {
    if (!out->WriteU16(gasp->gasp_ranges[i].first) ||
        !out->WriteU16(gasp->gasp_ranges[i].second)) {
      return OTS_FAILURE_MSG("Failed to write gasp subtable %d", i);
    }
  }

  return true;
}
