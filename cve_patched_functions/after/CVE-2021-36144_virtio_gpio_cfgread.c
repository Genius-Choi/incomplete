virtio_gpio_cfgread(void *vdev, int offset, int size, uint32_t *retval)
{
	struct virtio_gpio *gpio = vdev;
	void *ptr;
	int cfg_size;
	uint32_t reg;

	cfg_size = sizeof(struct virtio_gpio_config);
	if (offset < 0 || offset >= cfg_size + GPIO_PIO_SIZE) {
		WPRINTF(("virtio_gpio: read from invalid reg %d\n", offset));
		return -1;
	} else if (offset < cfg_size) {
		ptr = (uint8_t *)&gpio->config + offset;
		memcpy(retval, ptr, size);
	} else {
		reg = gpio_pio_read(gpio, (offset - cfg_size) >> 2);
		memcpy(retval, &reg, size);
	}
	return 0;
}
