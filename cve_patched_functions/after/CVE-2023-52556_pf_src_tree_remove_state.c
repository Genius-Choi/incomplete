pf_src_tree_remove_state(struct pf_state *st)
{
	u_int32_t		 timeout;
	struct pf_sn_item	*sni;

	while ((sni = SLIST_FIRST(&st->src_nodes)) != NULL) {
		SLIST_REMOVE_HEAD(&st->src_nodes, next);
		if (st->src.tcp_est)
			--sni->sn->conn;
		if (--sni->sn->states == 0) {
			timeout = st->rule.ptr->timeout[PFTM_SRC_NODE];
			if (!timeout)
				timeout =
				    pf_default_rule.timeout[PFTM_SRC_NODE];
			sni->sn->expire = getuptime() + timeout;
		}
		pool_put(&pf_sn_item_pl, sni);
	}
}
