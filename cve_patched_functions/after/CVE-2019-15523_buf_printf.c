static void buf_printf(struct conn_debug_buf *b, const char *fmt, ...)
{
	va_list ap;
	int c;

	if (b->rlen <= 0)
		return;

	va_start(ap, fmt);
	c = vsnprintf(b->pos, b->rlen, fmt, ap);
	va_end(ap);

	if (c >= b->rlen) {
		b->pos[b->rlen - 1] = '\0';
		c = b->rlen;
	}
	if (c >= 0) {
		b->rlen -= c;
		b->pos += c;
	}
}
