njs_json_append_value(njs_vm_t *vm, njs_chb_t *chain, njs_value_t *value)
{
    njs_int_t  ret;

    if (njs_is_object_value(value)) {
        switch (njs_object_value(value)->type) {
        case NJS_NUMBER:
            ret = njs_value_to_numeric(vm, value, value);
            if (njs_slow_path(ret != NJS_OK)) {
                return ret;
            }

            break;

        case NJS_BOOLEAN:
            njs_value_assign(value, njs_object_value(value));
            break;

        case NJS_STRING:
            ret = njs_value_to_string(vm, value, value);
             if (njs_slow_path(ret != NJS_OK)) {
                 return ret;
             }

            break;

        default:
            break;
        }
    }

    switch (value->type) {
    case NJS_STRING:
        njs_json_append_string(chain, value, '\"');
        break;

    case NJS_NUMBER:
        njs_json_append_number(chain, value);
        break;

    case NJS_BOOLEAN:
        if (njs_is_true(value)) {
            njs_chb_append_literal(chain, "true");

        } else {
            njs_chb_append_literal(chain, "false");
        }

        break;

    case NJS_UNDEFINED:
    case NJS_NULL:
    case NJS_SYMBOL:
    case NJS_INVALID:
    case NJS_FUNCTION:
    default:
        njs_chb_append_literal(chain, "null");
    }

    return NJS_OK;
}
