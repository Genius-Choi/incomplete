absl::optional<uint32_t> Utility::getDaysUntilExpiration(const X509* cert,
                                                         TimeSource& time_source) {
  if (cert == nullptr) {
    return absl::make_optional(std::numeric_limits<uint32_t>::max());
  }
  int days, seconds;
  if (ASN1_TIME_diff(&days, &seconds, currentASN1Time(time_source).get(),
                     X509_get0_notAfter(cert))) {
    if (days >= 0 && seconds >= 0) {
      return absl::make_optional(days);
    }
  }
  return absl::nullopt;
}
