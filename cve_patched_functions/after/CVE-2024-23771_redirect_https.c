static void redirect_https(struct connection *conn) {
    char *host, *url;

    /* work out path of file being requested */
    url = urldecode(conn->url);

    /* make sure it's safe */
    if (make_safe_url(url) == NULL) {
        default_reply(conn, 400, "Bad Request",
                      "You requested an invalid URL.");
        free(url);
        return;
    }

    host = parse_field(conn, "Host: ");
    if (host == NULL) {
        default_reply(conn, 400, "Bad Request",
                "Missing 'Host' header.");
        free(url);
        return;
    }

    redirect(conn, "https://%s%s", host, url);
    free(host);
    free(url);
}
