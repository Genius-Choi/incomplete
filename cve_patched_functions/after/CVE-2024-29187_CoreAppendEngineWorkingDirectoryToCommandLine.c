extern "C" HRESULT CoreAppendEngineWorkingDirectoryToCommandLine(
    __in_z_opt LPCWSTR wzEngineWorkingDirectory,
    __deref_inout_z LPWSTR* psczCommandLine,
    __deref_inout_z_opt LPWSTR* psczObfuscatedCommandLine
    )
{
    HRESULT hr = S_OK;
    LPWSTR sczArgument = NULL;

    if (wzEngineWorkingDirectory)
    {
        hr = EscapeAndAppendArgumentToCommandLineFormatted(psczCommandLine, psczObfuscatedCommandLine, L"-%ls=%ls", BURN_COMMANDLINE_SWITCH_WORKING_DIRECTORY, wzEngineWorkingDirectory);
        ExitOnFailure(hr, "Failed to append the custom working directory to the command line.");
    }

LExit:
    ReleaseStr(sczArgument);

    return hr;
}
