static void on_sni_update_tracing(void *conn, int is_quic, const char *server_name, size_t server_name_len)
{
    int cur_skip_tracing;

    if (is_quic) {
        cur_skip_tracing = ptls_skip_tracing(quicly_get_tls(conn));
    } else {
        cur_skip_tracing = h2o_socket_skip_tracing(conn);
    }

    uint64_t flags = cur_skip_tracing ? H2O_EBPF_FLAGS_SKIP_TRACING_BIT : 0;
    flags = h2o_socket_ebpf_lookup_flags_sni(conf.threads[thread_index].ctx.loop, flags, server_name, server_name_len);

    int new_skip_tracing = (flags & H2O_EBPF_FLAGS_SKIP_TRACING_BIT) != 0;

    if (cur_skip_tracing != new_skip_tracing) {
        if (is_quic) {
            ptls_set_skip_tracing(quicly_get_tls(conn), new_skip_tracing);
        } else {
            h2o_socket_set_skip_tracing(conn, new_skip_tracing);
        }
    }
}
