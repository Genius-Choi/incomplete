static void ds_inherit_state( ds_data_t *old_data , ds_data_t *new_data)
{
	ds_set_p new_set, old_set;
	ds_dest_p new_ds, old_ds;
	int changed;

	/* search the new sets through the old sets */
	for ( new_set=new_data->sets ; new_set ; new_set=new_set->next ) {
		for ( old_set=old_data->sets ; old_set ; old_set=old_set->next ) {
			if (new_set->id==old_set->id)
				break;
		}
		if (old_set==NULL) {
			LM_DBG("new set id %d not found in old sets\n",new_set->id);
			continue;
		}
		LM_DBG("set id %d found in old sets\n",new_set->id);
		changed = 0;

		/* sets are matching, try to match the destinations, one by one */
		for ( new_ds=new_set->dlist ; new_ds ; new_ds=new_ds->next ) {
			for ( old_ds=old_set->dlist ; old_ds ; old_ds=old_ds->next ) {
				if (new_ds->uri.len==old_ds->uri.len &&
				strncasecmp(new_ds->uri.s, old_ds->uri.s, old_ds->uri.len)==0 ) {
					LM_DBG("DST <%.*s> found in old set, copying state\n",
						new_ds->uri.len,new_ds->uri.s);
					if (new_ds->flags != old_ds->flags) {
						new_ds->flags = old_ds->flags;
						changed = 1;
					}
					break;
				}
			}
			if (old_ds==NULL)
				LM_DBG("DST <%.*s> not found in old set\n",
					new_ds->uri.len,new_ds->uri.s);
		}
		if (changed)
			re_calculate_active_dsts(new_set);
	}
}
