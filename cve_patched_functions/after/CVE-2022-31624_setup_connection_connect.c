static void setup_connection_connect(struct connection_info *cn,
    const struct mysql_event_connection *event)
{
  cn->query_id= 0;
  cn->query_length= 0;
  cn->log_always= 0;
  cn->thread_id= event->thread_id;
  get_str_n(cn->db, &cn->db_length, sizeof(cn->db),
            event->database, event->database_length);
  get_str_n(cn->user, &cn->user_length, sizeof(cn->db),
            event->user, event->user_length);
  get_str_n(cn->host, &cn->host_length, sizeof(cn->host),
            event->host, event->host_length);
  get_str_n(cn->ip, &cn->ip_length, sizeof(cn->ip),
            event->ip, event->ip_length);
  cn->header= 0;
  if (event->proxy_user && event->proxy_user[0])
  {
    const char *priv_host= event->proxy_user +
            sizeof(char[MAX_HOSTNAME+USERNAME_LENGTH+5]);
    size_t priv_host_length;

    if (mysql_57_started)
    {
      priv_host+= sizeof(size_t);
      priv_host_length= *(size_t *) (priv_host + MAX_HOSTNAME);
    }
    else
      priv_host_length= strlen(priv_host);


    get_str_n(cn->proxy, &cn->proxy_length, sizeof(cn->proxy),
              event->priv_user, event->priv_user_length);
    get_str_n(cn->proxy_host, &cn->proxy_host_length,
              sizeof(cn->proxy_host),
              priv_host, priv_host_length);
  }
  else
    cn->proxy_length= 0;
}
