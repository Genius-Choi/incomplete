    void SipDialogController::doSendCancelRequest( SipMessageData* pData ) {
        string transactionId( pData->getTransactionId() ) ;
        std::shared_ptr<IIP> iip ;
        tagi_t* tags = nullptr;

        if (IIP_FindByTransactionId(m_invitesInProgress, transactionId, iip)) {
            iip->setCanceled();
            tags = makeSafeTags( pData->getHeaders()) ;
            nta_outgoing_t *cancel = nta_outgoing_tcancel(const_cast<nta_outgoing_t *>(iip->orq()), NULL, NULL, TAG_NEXT(tags));
            if( NULL != cancel ) {
                msg_t* m = nta_outgoing_getrequest(cancel) ;    // adds a reference
                sip_t* sip = sip_object( m ) ;

                string cancelTransactionId ;
                generateUuid( cancelTransactionId ) ;

                string encodedMessage ;
                EncodeStackMessage( sip, encodedMessage ) ;
                SipMsgData_t meta(m, cancel) ;
                string s ;
                meta.toMessageFormat(s) ;
                string data = s + "|" + cancelTransactionId + "|Msg sent:|" + DR_CRLF + encodedMessage ;
                msg_destroy(m) ;    // releases reference

                //Note: not adding an RIP because the 200 OK to the CANCEL is not passed up to us

                m_pController->getClientController()->route_api_response( pData->getClientMsgId(), "OK", data ) ;     
                deleteTags(tags);
                return ;           
            }
            else {
                DR_LOG(log_error) << "SipDialogController::doSendCancelRequest - internal server error canceling transaction id " << 
                    transactionId << " / orq: " << std::hex << (void *) iip->orq();
                m_pController->getClientController()->route_api_response( pData->getClientMsgId(), "NOK", 
                    string("internal server error canceling transaction id: ") + transactionId ) ; 
            }
        }
        else {
            DR_LOG(log_error) << "SipDialogController::doSendCancelRequest - unknown transaction id " << transactionId ;
            m_pController->getClientController()->route_api_response( pData->getClientMsgId(), "NOK", 
                string("unable to cancel unknown transaction id: ") + transactionId ) ; 
        }
        pData->~SipMessageData() ;
        deleteTags(tags);
   }
