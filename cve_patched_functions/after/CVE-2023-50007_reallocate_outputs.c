static int reallocate_outputs(AudioFWTDNContext *s,
                              double **out, int *out_length,
                              int in_length, int levels, int ch, uint64_t sn)
{
    ChannelParams *cp = &s->cp[ch];
    int temp_length = 0;
    int add = 0;

    for (int level = 0; level < levels; level++) {
        temp_length = nb_coefs(in_length, level + 1, sn);
        if (temp_length > out_length[level]) {
            av_freep(&cp->subbands_to_free[level]);
            out_length[level] = 0;

            add = max_left_zeros_inverse(levels, level + 1, s->wavelet_length);
            cp->subbands_to_free[level] = av_calloc(add + temp_length + 1, sizeof(**out));
            if (!cp->subbands_to_free[level])
                return AVERROR(ENOMEM);
            out_length[level] = add + temp_length + 1;
            out[level] = cp->subbands_to_free[level] + add;
        }

        memset(out[level] + temp_length, 0,
               FFMAX(out_length[level] - temp_length - add, 0) * sizeof(**out));
        out_length[level] = temp_length;
    }

    temp_length = nb_coefs(in_length, levels, sn);
    if (temp_length > out_length[levels]) {
        av_freep(&cp->subbands_to_free[levels]);
        out_length[levels] = 0;

        cp->subbands_to_free[levels] = av_calloc(temp_length + 1, sizeof(**out));
        if (!cp->subbands_to_free[levels])
            return AVERROR(ENOMEM);
        out_length[levels] = temp_length + 1;
        out[levels] = cp->subbands_to_free[levels];
    }

    memset(out[levels] + temp_length, 0,
           (out_length[levels] - temp_length) * sizeof(**out));
    out_length[levels] = temp_length;

    return 0;
}
