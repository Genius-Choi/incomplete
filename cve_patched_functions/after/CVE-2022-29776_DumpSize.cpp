uint32_t CxImage::DumpSize()
{
	uint32_t n;
	n = sizeof(BITMAPINFOHEADER) + sizeof(CXIMAGEINFO) + GetSize();

#if CXIMAGE_SUPPORT_ALPHA
	if (pAlpha){
		n += 1 + head.biWidth * head.biHeight;
	} else n++;
#endif

#if CXIMAGE_SUPPORT_SELECTION
	if (pSelection){
		n += 1 + head.biWidth * head.biHeight;
	} else n++;
#endif

#if CXIMAGE_SUPPORT_LAYERS
	if (ppLayers){
		for (int32_t m=0; m<GetNumLayers(); m++){
			if (GetLayer(m)){
				n += 1 + GetLayer(m)->DumpSize();
			}
		}
	} else n++;
#endif

	if (ppFrames){
		for (int32_t m=0; m<GetNumFrames(); m++){
			if (GetFrame(m)){
				n += 1 + GetFrame(m)->DumpSize();
			}
		}
	} else n++;

	return n;
}
