int wcall_init(int env)
{
	int err = 0;
	info(APITAG "wcall: init: initialized=%d env=%d\n", calling.initialized, env);

#if ENABLE_PEERFLOW
	/* Ensure that Android linker pulls in all wcall symbols */
	wcall_get_members(WUSER_INVALID_HANDLE, NULL);

	peerflow_set_funcs();
#endif

	if (calling.initialized)
		return EALREADY;

	calling.initialized = true;
	calling.env = env;

	msystem_set_env(env);

	list_init(&calling.logl);
	list_init(&calling.instances);

	err = lock_alloc(&calling.lock);
	if (err)
		warning("wcall_init: could not allocate lock: %m\n", err);

#if (defined ANDROID || defined __EMSCRIPTEN__)
	/* DNS is initialized from wrapper */
#else
	dns_init(NULL);
#endif

	return err;
}
