int Monitor::print_nodes(Formatter *f, ostream& err)
{
  map<int, Metadata> metadata;
  if (int r = load_metadata(metadata)) {
    err << "Unable to load metadata.\n";
    return r;
  }

  map<string, list<int> > mons;	// hostname => mon
  for (map<int, Metadata>::iterator it = metadata.begin();
       it != metadata.end(); ++it) {
    const Metadata& m = it->second;
    Metadata::const_iterator hostname = m.find("hostname");
    if (hostname == m.end()) {
      // not likely though
      continue;
    }
    mons[hostname->second].push_back(it->first);
  }

  dump_services(f, mons, "mon");
  return 0;
}
