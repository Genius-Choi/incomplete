static void  belle_sip_provider_update_or_create_auth_context(belle_sip_provider_t *p, belle_sip_header_call_id_t *call_id, belle_sip_header_www_authenticate_t *authenticate, belle_sip_uri_t *from_uri, const char *realm) {
	belle_sip_list_t *auth_context_lst = NULL;
	belle_sip_list_t *auth_context_it;
	authorization_context_t *auth_context;

	for (auth_context_it = auth_context_lst = belle_sip_provider_get_auth_context_by_realm_or_call_id(p, call_id, from_uri, realm);
	     auth_context_it != NULL; auth_context_it = auth_context_it->next) {
		auth_context = (authorization_context_t *)auth_context_it->data;
		if ((strcmp(auth_context->realm, belle_sip_header_www_authenticate_get_realm(authenticate)) == 0) && ((auth_context->algorithm == NULL) || strcasecmp(auth_context->algorithm, belle_sip_header_www_authenticate_get_algorithm(authenticate)) == 0))  {
			authorization_context_fill_from_auth(auth_context, authenticate, from_uri);
			goto end; /*only one realm is supposed to be found for now*/
		}
	}
	/*no auth context found, creating one*/
	auth_context = belle_sip_authorization_create(call_id);

	if (BELLE_SIP_OBJECT_IS_INSTANCE_OF(authenticate, belle_sip_header_proxy_authenticate_t)) {
		auth_context->is_proxy = 1; /*this cannot be changed*/
	}

	belle_sip_debug("belle_sip_provider_auth: no matching auth context, creating one for [realm=%s][user_id=%s][call_id=%s]"
	                , belle_sip_header_www_authenticate_get_realm(authenticate) ? belle_sip_header_www_authenticate_get_realm(authenticate) : "(null)"
	                , from_uri ? belle_sip_uri_get_user(from_uri) : "(null)"
	                , call_id ? belle_sip_header_call_id_get_call_id(call_id) : "(null)");
	authorization_context_fill_from_auth(auth_context, authenticate, from_uri);

	p->auth_contexts = belle_sip_list_append(p->auth_contexts, auth_context);
end:
	if (auth_context_lst) belle_sip_list_free(auth_context_lst);
	return;
}
