virtio_rpmb_notify(void *base, struct virtio_vq_info *vq)
{
	struct iovec iov[VIRTIO_RPMB_MAXSEGS + 1];
	int n;
	int tlen = 0;
	uint16_t idx;
	struct virtio_rpmb *rpmb = (struct virtio_rpmb *)base;
	struct virtio_rpmb_ioctl_cmd *ioc;

	while (vq_has_descs(vq)) {
		n = vq_getchain(vq, &idx, iov, VIRTIO_RPMB_MAXSEGS, NULL);
		if (n < 3 || n > VIRTIO_RPMB_MAXSEGS) {
			DPRINTF(("Invalid package number.\n"));
			return;
		}
		ioc = (struct virtio_rpmb_ioctl_cmd *)(iov[0].iov_base);
		if (RPMB_IOC_SEQ_CMD != ioc->cmd) {
			DPRINTF(("found invalid command type.\n"));
			return;
		}
		ioc->result = virtio_rpmb_seq_handler(rpmb, iov, n, &tlen);
		if (tlen <= 0) {
			DPRINTF(("Invalid return length.\n"));
			return;
		}
		/*
		 * Release this chain and handle more
		 */
		vq_relchain(vq, idx, tlen);
	}
	vq_endchains(vq, 1);	/* Generate interrupt if appropriate. */
}
