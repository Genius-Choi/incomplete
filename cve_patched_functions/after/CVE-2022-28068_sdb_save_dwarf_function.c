static void sdb_save_dwarf_function(Function *dwarf_fcn, RList/*<Variable*>*/ *variables, Sdb *sdb) {
	char *sname = r_str_sanitize_sdb_key (dwarf_fcn->name);
	sdb_set (sdb, sname, "fcn", 0);

	char *addr_key = r_str_newf ("fcn.%s.addr", sname);
	char *addr_val = r_str_newf ("0x%" PFMT64x "", dwarf_fcn->addr);
	sdb_set (sdb, addr_key, addr_val, 0);
	free (addr_key);
	free (addr_val);

	/* so we can have name without sanitization */
	char *name_key = r_str_newf ("fcn.%s.name", sname);
	char *name_val = r_str_newf ("%s", dwarf_fcn->name);
	sdb_set (sdb, name_key, name_val, 0);
	free (name_key);
	free (name_val);

	char *signature_key = r_str_newf ("fcn.%s.sig", sname);
	sdb_set (sdb, signature_key, dwarf_fcn->signature, 0);
	free (signature_key);

	RStrBuf vars;
	r_strbuf_init (&vars);
	RListIter *iter;
	Variable *var;
	r_list_foreach (variables, iter, var) {
		if (!var->location) {
			/* NULL location probably means optimized out, maybe put a comment there */
			continue;
		}
		char *key = NULL;
		char *val = NULL;
		switch (var->location->kind) {
		case LOCATION_BP: {
			/* value = "type, storage, additional info based on storage (offset)" */

			r_strbuf_appendf (&vars, "%s,", var->name);
			key = r_str_newf ("fcn.%s.var.%s", sname, var->name);
			val = r_str_newf ("%s,%" PFMT64d ",%s", "b", var->location->offset, var->type);
			sdb_set (sdb, key, val, 0);
			break;
		}
		case LOCATION_SP: {
			/* value = "type, storage, additional info based on storage (offset)" */

			r_strbuf_appendf (&vars, "%s,", var->name);
			key = r_str_newf ("fcn.%s.var.%s", sname, var->name);
			val = r_str_newf ("%s,%" PFMT64d ",%s", "s", var->location->offset, var->type);
			sdb_set (sdb, key, val, 0);
			break;
		}
		case LOCATION_GLOBAL: {
			/* value = "type, storage, additional info based on storage (address)" */

			r_strbuf_appendf (&vars, "%s,", var->name);
			key = r_str_newf ("fcn.%s.var.%s", sname, var->name);
			val = r_str_newf ("%s,%" PFMT64u ",%s", "g", var->location->address, var->type);
			sdb_set (sdb, key, val, 0);
			break;
		}
		case LOCATION_REGISTER: {
			/* value = "type, storage, additional info based on storage (register name)" */

			r_strbuf_appendf (&vars, "%s,", var->name);
			key = r_str_newf ("fcn.%s.var.%s", sname, var->name);
			val = r_str_newf ("%s,%s,%s", "r", var->location->reg_name, var->type);
			sdb_set (sdb, key, val, 0);
			break;
		}

		default:
			/* else location is unknown (optimized out), skip the var */
			break;
		}
		free (key);
		free (val);
	}
	if (vars.len > 0) { /* remove the extra , */
		r_strbuf_slice (&vars, 0, vars.len - 1); /* leaks? */
	}
	char *vars_key = r_str_newf ("fcn.%s.vars", sname);
	char *vars_val = r_str_newf ("%s", r_strbuf_get (&vars));
	sdb_set (sdb, vars_key, vars_val, 0);
	free (vars_key);
	free (vars_val);
	r_strbuf_fini (&vars);
	free (sname);
}
