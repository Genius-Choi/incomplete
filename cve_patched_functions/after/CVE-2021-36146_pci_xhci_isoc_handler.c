pci_xhci_isoc_handler(void *arg, uint64_t param)
{
	struct xhci_ep_timer_data *pdata;
	struct xhci_trb trb;
	struct xhci_trb	trb_underrun = {
		.qwTrb0 = 0,
		.dwTrb2 = XHCI_TRB_2_ERROR_SET(XHCI_TRB_ERROR_RING_UNDERRUN),
		.dwTrb3 = XHCI_TRB_3_TYPE_SET(XHCI_TRB_EVENT_TRANSFER)
	};
	struct xhci_trb	trb_overrun = {
		.qwTrb0 = 0,
		.dwTrb2 = XHCI_TRB_2_ERROR_SET(XHCI_TRB_ERROR_RING_OVERRUN),
		.dwTrb3 = XHCI_TRB_3_TYPE_SET(XHCI_TRB_EVENT_TRANSFER)
	};

	pdata = arg;
	if (pdata == NULL) {
		UPRINTF(LFTL, "%s NULL arg\r\n", __func__);
		return;
	}

	if (pdata->dir == TOKEN_OUT) {
		trb_underrun.dwTrb3 |= (XHCI_TRB_3_SLOT_SET(pdata->slot) |
				XHCI_TRB_3_EP_SET(pdata->epnum));
		trb = trb_underrun;
	} else {
		trb_overrun.dwTrb3 |= (XHCI_TRB_3_SLOT_SET(pdata->slot) |
				XHCI_TRB_3_EP_SET(pdata->epnum));
		trb = trb_overrun;
	}

	if (!pdata->dev || !pdata->dev->xdev) {
		UPRINTF(LFTL, "%s: error, {x,}dev == NULL\r\n", __func__);
		return;
	}

	if (pci_xhci_insert_event(pdata->dev->xdev, &trb, 1) != 0)
		UPRINTF(LFTL, "Failed to inject isoc transfer complete event!\r\n");
	else
		UPRINTF(LINF, "send %srun to slot %d ep %d\r\n", pdata->dir == TOKEN_IN
				? "under" : "over", pdata->slot, pdata->epnum);
}
