parseFileAttributes(uint8_t* buffer, int bufPos, int maxBufPos, uint32_t* fileSize, uint64_t* lastModified)
{
    int endPos = maxBufPos;

    while (bufPos < endPos) {
        uint8_t tag = buffer[bufPos++];
        int length;

        bufPos = BerDecoder_decodeLength(buffer, &length, bufPos, endPos);
        if (bufPos < 0)
            return false;

        switch (tag) {
        case 0x80: /* sizeOfFile */
            if (fileSize != NULL)
                *fileSize = BerDecoder_decodeUint32(buffer, length, bufPos);
            break;
        case 0x81: /* lastModified */
            {
                if (lastModified != NULL) {
                    char gtString[40];
                    memcpy(gtString, buffer + bufPos, length);
                    gtString[length] = 0;
                    *lastModified = Conversions_generalizedTimeToMsTime(gtString);
                }
            }
            break;
        case 0x00: /* indefinite length end tag -> ignore */
            break;
        default:
            return false;
        }

        bufPos += length;
    }

    return true;
}
