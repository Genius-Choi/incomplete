static void calc_elapsed(switch_rtp_t *rtp_session, switch_rtp_ice_t *ice)
{
	switch_time_t ref_point;
	switch_time_t now;

	now = switch_micro_time_now();

	if (ice->last_ok && (!rtp_session->dtls || rtp_session->dtls->state == DS_READY)) {
		ref_point = ice->last_ok;
	} else {
		ref_point = rtp_session->first_stun;
	}

	if (!ref_point) ref_point = now;

	rtp_session->elapsed_stun = (unsigned int) ((now - ref_point) / 1000);

	if (rtp_session->last_media) {
		rtp_session->elapsed_media = (unsigned int) ((now - rtp_session->last_media) / 1000);
	} else {
		rtp_session->elapsed_media = MEDIA_TOO_LONG + 1;
	}

	if (rtp_session->last_adj) {
		rtp_session->elapsed_adj = (unsigned int) ((now - rtp_session->last_adj) / 1000);
	} else {
		rtp_session->elapsed_adj = ADJ_TOO_LONG + 1;
	}
}
