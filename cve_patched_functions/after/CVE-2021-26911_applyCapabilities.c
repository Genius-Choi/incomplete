void IMAPSession::applyCapabilities(IndexSet * capabilities)
{
    if (capabilities->containsIndex(IMAPCapabilityId)) {
        mIdentityEnabled = true;
    }
    if (capabilities->containsIndex(IMAPCapabilityXList)) {
        mXListEnabled = true;
    }
    if (capabilities->containsIndex(IMAPCapabilityGmail)) {
        mXListEnabled = false;
        mCondstoreEnabled = true;
        mIsGmail = true;
    }
    if (capabilities->containsIndex(IMAPCapabilityIdle)) {
        LOCK();
        mIdleEnabled = true;
        UNLOCK();
    }
    if (capabilities->containsIndex(IMAPCapabilityCondstore)) {
        mCondstoreEnabled = true;
    }
    if (capabilities->containsIndex(IMAPCapabilityQResync)) {
        mQResyncEnabled = true;
    }
    if (capabilities->containsIndex(IMAPCapabilityXYMHighestModseq)) {
        mXYMHighestModseqEnabled = true;
    }
    if (capabilities->containsIndex(IMAPCapabilityXOAuth2)) {
        mXOauth2Enabled = true;
    }
    if (mHermesServer) {
        // Hermes server improperly advertise a namespace capability.
    }
    else {
        if (capabilities->containsIndex(IMAPCapabilityNamespace)) {
            mNamespaceEnabled = true;
        }
    }
    if (capabilities->containsIndex(IMAPCapabilityCompressDeflate)) {
        mCompressionEnabled = true;
    }
}
