static int check_against_known_hosts(
	LIBSSH2_SESSION *session,
	LIBSSH2_KNOWNHOSTS *known_hosts,
	const char *hostname,
	int port,
	const char *key,
	size_t key_len,
	int key_type)
{
	int check, typemask, ret = 0;
	struct libssh2_knownhost *host = NULL;

	if (known_hosts == NULL)
		return 0;

	typemask = fingerprint_type_mask(key_type);
	check = libssh2_knownhost_checkp(known_hosts, hostname, port, key, key_len, typemask, &host);
	if (check == LIBSSH2_KNOWNHOST_CHECK_FAILURE) {
		ssh_error(session, "error checking for known host");
		return -1;
	}

	ret = check == LIBSSH2_KNOWNHOST_CHECK_MATCH ? 1 : 0;

	return ret;
}
