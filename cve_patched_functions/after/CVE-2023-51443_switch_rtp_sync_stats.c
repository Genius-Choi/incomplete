SWITCH_DECLARE(switch_status_t) switch_rtp_sync_stats(switch_rtp_t *rtp_session)
{
	if (!rtp_session) {
		return SWITCH_STATUS_FALSE;
	}

	if (rtp_session->flags[SWITCH_RTP_FLAG_VAD]) {
		switch_channel_t *channel = switch_core_session_get_channel(rtp_session->vad_data.session);

		switch_channel_set_variable_printf(channel, "vad_total_talk_time_ms", "%u", (uint32_t)rtp_session->vad_data.total_talk_time / 1000);
		switch_channel_set_variable_printf(channel, "vad_total_talk_time_sec", "%u", (uint32_t)rtp_session->vad_data.total_talk_time / 1000000);
	}

	do_mos(rtp_session);

	if (rtp_session->stats.inbound.error_log && !rtp_session->stats.inbound.error_log->stop) {
		rtp_session->stats.inbound.error_log->stop = switch_micro_time_now();
	}

	return SWITCH_STATUS_SUCCESS;
}
