streamPresentationContext(LST_HEAD ** presentationContextList,
        unsigned char *b, unsigned long *length)
{
    PRV_PRESENTATIONCONTEXTITEM * presentation;
    DUL_SUBITEM * transfer;
    OFCondition cond = EC_Normal;
    unsigned long subLength;

    *length = 0;

    presentation = (PRV_PRESENTATIONCONTEXTITEM*)LST_Head(presentationContextList);
    if (presentation == NULL) return DUL_LISTERROR;
    (void) LST_Position(presentationContextList, (LST_NODE*)presentation);

    while (presentation != NULL) {
        *b++ = presentation->type;
        *b++ = presentation->rsv1;

        COPY_SHORT_BIG(presentation->length, b);
        b += 2;
        *b++ = presentation->contextID;
        *b++ = presentation->rsv2;
        *b++ = presentation->result;
        *b++ = presentation->rsv3;
        *length += 8;

        if (presentation->abstractSyntax.length != 0) {
            cond = streamSubItem(&presentation->abstractSyntax, b, &subLength);
            if (cond.bad())
                return cond;
            b += subLength;
            *length += subLength;
        }
        transfer = (DUL_SUBITEM*)LST_Head(&presentation->transferSyntaxList);
        if (transfer == NULL) return DUL_LISTERROR;
        (void) LST_Position(&presentation->transferSyntaxList, (LST_NODE*)transfer);
        while (transfer != NULL) {
            if (transfer->length != 0) {
                cond = streamSubItem(transfer, b, &subLength);
                if (cond.bad())
                    return cond;
                b += subLength;
                *length += subLength;
            }
            transfer = (DUL_SUBITEM*)LST_Next(&presentation->transferSyntaxList);
        }
        presentation = (PRV_PRESENTATIONCONTEXTITEM*)LST_Next(presentationContextList);
    }
    return EC_Normal;
}
