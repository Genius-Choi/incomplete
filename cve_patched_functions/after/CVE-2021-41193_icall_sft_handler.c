static int icall_sft_handler(struct icall *icall,
			     const char *url,
			     struct econn_message *msg,
			     void *arg)
{
	struct wcall *wcall = arg;
	struct calling_instance *inst = wcall ? wcall->inst : NULL;
	char convid_anon[ANON_ID_LEN];
	char userid_anon[ANON_ID_LEN];
	char clientid_anon[ANON_CLIENT_LEN];
	void *context = wcall;
	struct wcall_ctx *ctx;
	char *str = NULL;
	int err = 0;

	if (!WCALL_VALID(wcall)) {
		warning("wcall(%p): icall_sft_handler: invalid wcall "
			"inst=%p\n", wcall, inst);
		return ENODEV;
	}
	
	if (inst->sfth == NULL)
		return ENOSYS;

	err = ctx_alloc(&ctx, inst, context);
	if (err)
		goto out;

	err = econn_message_encode(&str, msg);
	if (err)
		goto out;

	info("wcall(%p): c3_message_send: convid=%s from=%s.%s to=SFT msg=%H ctx=%p\n",
	     wcall, anon_id(convid_anon, wcall->convid),
	     anon_id(userid_anon, inst->userid), anon_client(clientid_anon, inst->clientid),
	     econn_message_brief, msg, ctx);

	err = inst->sfth(ctx, url, (uint8_t*)str, strlen(str), inst->arg);

out:
	mem_deref(str);

	return err;
}
