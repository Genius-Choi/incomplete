int bn_smb_leg(const bn_t a, const bn_t b) {
	bn_t t;
	int res;

	bn_null(t);

	if (bn_sign(b) == RLC_NEG) {
		RLC_THROW(ERR_NO_VALID);
		return 0;
	}

	if (bn_cmp(a, b) == RLC_EQ) {
		return 0;
	}

	RLC_TRY {
		bn_new(t);

		/* t = (b - 1)/2. */
		bn_sub_dig(t, b, 1);
		bn_rsh(t, t, 1);
		bn_mxp(t, a, t, b);
		res = 0;
		if (bn_cmp_dig(t, 1) == RLC_EQ) {
			res = 1;
		}
		bn_sub(t, b, t);
		if (bn_cmp_dig(t, 1) == RLC_EQ) {
			res = -1;
		}
	}
	RLC_CATCH_ANY {
		RLC_THROW(ERR_CAUGHT);
	}
	RLC_FINALLY {
		bn_free(t);
	}

	return res;
}
