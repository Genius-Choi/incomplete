static HRESULT CalculateWorkingFolders(
    __in BURN_CACHE* pCache,
    __in BURN_ENGINE_COMMAND* pInternalCommand
    )
{
    HRESULT hr = S_OK;
    LPWSTR sczBaseAcquisitionPath = NULL;

    hr = PathGetTempPath(&sczBaseAcquisitionPath, NULL);
    ExitOnFailure(hr, "Failed to get temp folder path for acquisition folder base.");

    hr = PathBackslashTerminate(&sczBaseAcquisitionPath);
    ExitOnFailure(hr, "Failed to backslashify base engine working directory.");

    hr = CalculatePotentialBaseWorkingFolders(pCache, pInternalCommand, sczBaseAcquisitionPath);
    ExitOnFailure(hr, "Failed to get potential base engine working directories.");

    hr = GuidFixedCreate(pCache->wzGuid);
    ExitOnFailure(hr, "Failed to create working folder guid.");

    pCache->wzGuid[GUID_STRING_LENGTH - 1] = L'\\';
    pCache->wzGuid[GUID_STRING_LENGTH] = L'\0';

    hr = PathConcatRelativeToFullyQualifiedBase(sczBaseAcquisitionPath, pCache->wzGuid, &pCache->sczAcquisitionFolder);
    ExitOnFailure(hr, "Failed to append random guid on to temp path for acquisition folder.");

LExit:
    ReleaseStr(sczBaseAcquisitionPath);

    return hr;
}
