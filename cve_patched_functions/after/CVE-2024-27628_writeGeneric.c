OFCondition EctEnhancedCT::writeGeneric(DcmItem& dataset)
{
    OFCondition result;
    if (m_SynchronisationModuleEnabled)
        result = m_SynchronisationModule.write(dataset);
    if (result.good())
        result = m_FG.setNumberOfFrames(
            DcmIODUtil::limitMaxFrames(m_Frames.size(), "Maximum number of frames exceeded, will write 2147483647"));
    if (result.good())
        result = m_FG.write(dataset);
    if (result.good())
        result = m_FGInterface.write(dataset);
    if (result.good())
        result = m_DimensionModule.write(dataset);
    if (result.good())
        result = m_AcquisitionContextModule.write(dataset);
    if (result.good())
        result = m_CommonInstanceReferenceModule.write(dataset);
    if (result.good())
        result = getIODGeneralSeriesModule().setModality("CT");
    if (result.good())
        result = IODImage::write(dataset);
    // Write after General Equipment Module from IODImage
    if (result.good())
        result = m_EnhancedGeneralEquipmentModule.write(dataset);

    if (result.good())
        result = DcmIODUtil::copyElementToDataset(
            result, dataset, m_ImageType, "4" /* vm */, "1" /*requirement type*/, "EnhancedCTImageModule");
    if (result.good())
        result = DcmIODUtil::copyElementToDataset(
            result, dataset, m_MultiEnergyCTAcquisition, "1", "3", "EnhancedCTImageModule");
    if (result.good())
        result
            = DcmIODUtil::copyElementToDataset(result, dataset, m_PixelPresentation, "1", "1", "EnhancedCTImageModule");
    if (result.good())
        result = DcmIODUtil::copyElementToDataset(
            result, dataset, m_VolumetricProperties, "1", "1", "EnhancedCTImageModule");
    if (result.good())
        result = DcmIODUtil::copyElementToDataset(
            result, dataset, m_VolumeBasedCalculationTechnique, "1", "1", "EnhancedCTImageModule");
    if (result.good())
        result
            = DcmIODUtil::copyElementToDataset(result, dataset, m_AcquisitionNumber, "1", "3", "EnhancedCTImageModule");
    if (result.good())
        result = DcmIODUtil::copyElementToDataset(
            result, dataset, m_AcquisitionDateTime, "1", "1C", "EnhancedCTImageModule");
    if (result.good())
        result = DcmIODUtil::copyElementToDataset(
            result, dataset, m_AcquisitionDuration, "1", "1C", "EnhancedCTImageModule");
    if (result.good())
        result = DcmIODUtil::copyElementToDataset(
            result, dataset, m_ContentQualification, "1", "1C", "EnhancedCTImageModule");
    if (result.good())
        result = DcmIODUtil::copyElementToDataset(result, dataset, m_ImageComments, "1", "3", "EnhancedCTImageModule");
    if (result.good())
        result = DcmIODUtil::copyElementToDataset(
            result, dataset, m_BurnedInAnnotation, "1", "1C", "EnhancedCTImageModule");
    if (result.good())
        result = DcmIODUtil::copyElementToDataset(
            result, dataset, m_RecognizableVisualFeatures, "1", "3", "EnhancedCTImageModule");
    if (result.good())
        result = DcmIODUtil::copyElementToDataset(
            result, dataset, m_LossyImageCompression, "1", "1", "EnhancedCTImageModule");
    if (result.good())
        result = DcmIODUtil::copyElementToDataset(
            result, dataset, m_LossyImageCompressionMethod, "1-n", "1C", "EnhancedCTImageModule");

    if (result.good())
        result = DcmIODUtil::copyElementToDataset(
            result, dataset, m_LossyImageCompressionRatio, "1-n", "1C", "EnhancedCTImageModule");

    m_PresentationLUTShape.putOFStringArray("IDENTITY");
    if (result.good())
        result = DcmIODUtil::copyElementToDataset(
            result, dataset, m_PresentationLUTShape, "1", "1", "EnhancedCTImageModule");
    if (result.good())
        result
            = DcmIODUtil::copyElementToDataset(result, dataset, m_IsoCenterPosition, "3", "3", "EnhancedCTImageModule");
    return result;
}
