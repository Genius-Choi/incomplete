static Jsi_RC SysRequireCmd(Jsi_Interp *interp, Jsi_Value *args, Jsi_Value *_this,
    Jsi_Value **ret, Jsi_Func *funcPtr)
{
    Jsi_Number n = 0;
    int argc = Jsi_ValueGetLength(interp, args);
    if (argc == 0)
        return Jsi_HashKeysDump(interp, interp->packageHash, ret, 0);
        
    Jsi_Value *vname = Jsi_ValueArrayIndex(interp, args, 0);
    const char *name = NULL;
    if (Jsi_ValueIsString(interp, vname)) {
        name = Jsi_ValueString(interp, vname, NULL);
        if (!Jsi_StrIsAlnum(name))
            name = NULL;
    }
    if (!name) 
        return Jsi_LogError("invalid or missing package name");
    if (argc>1) {
        Jsi_Value *v = Jsi_ValueArrayIndex(interp, args, 1);
        if (jsi_GetVerFromVal(interp, v, &n, 0) != JSI_OK)
            return JSI_ERROR;
        n = jsi_VersionNormalize(n, NULL, 0);
    }
    int isMain = interp->isMain;
    interp->isMain = 0;
    Jsi_Number ver = Jsi_PkgRequireEx(interp, name, n, NULL);
    interp->isMain = isMain;
    if (ver < 0)
        return JSI_ERROR;
    Jsi_RC rc = JSI_OK;
    if (argc==2) {
        if (ver < n) 
            rc = Jsi_LogType("package '%s' downlevel: %." JSI_NUMGFMT " < %." JSI_VERFMT_LEN JSI_NUMGFMT, name, ver, n);
        if (rc != JSI_OK)
            return rc;
        return jsi_PkgDumpInfo(interp, name, ret);
    }
    Jsi_Value *opts = Jsi_ValueArrayIndex(interp, args, 2);
       
    if (opts != NULL) {
        jsi_PkgInfo *pkg = jsi_PkgGet(interp, name);
        if (!pkg) return JSI_ERROR;
        Jsi_ModuleConf *mptr = &pkg->popts.modConf;
        if (Jsi_OptionsProcess(interp, jsiModuleOptions, mptr, opts, 0) < 0)
            return JSI_ERROR;
        if (pkg->popts.cmdSpec) {
            int *fl = &pkg->popts.cmdSpec->flags;
            if (mptr->Test) *fl |= JSI_CMD_LOG_TEST; else *fl &=  ~JSI_CMD_LOG_TEST;
            if (mptr->Debug) *fl |= JSI_CMD_LOG_DEBUG; else *fl &=  ~JSI_CMD_LOG_DEBUG;
            if (mptr->Trace) *fl |= JSI_CMD_LOG_TRACE; else *fl &=  ~JSI_CMD_LOG_TRACE;
        }
    }

    Jsi_ValueMakeNumber(interp, ret, ver);
    return rc;
}
