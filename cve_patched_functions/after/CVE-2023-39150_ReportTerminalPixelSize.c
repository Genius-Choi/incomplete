void SrvAnsiImpl::ReportTerminalPixelSize()
{
	// `CSI 4 ; height ; width t`
	wchar_t szReport[64];
	int width = 0, height = 0;
	RECT rcWnd = {};

	if (gState.conemuWndDC_ && GetClientRect(gState.conemuWndDC_, &rcWnd))
	{
		width = RectWidth(rcWnd);
		height = RectHeight(rcWnd);
	}

	if ((width <= 0 || height <= 0) && gState.realConWnd_ && GetClientRect(gState.realConWnd_, &rcWnd))
	{
		width = RectWidth(rcWnd);
		height = RectHeight(rcWnd);
	}

	if (width <= 0 || height <= 0)
	{
		_ASSERTE(width > 0 && height > 0);
		// Both DC and RealConsole windows were failed?
		const auto size = m_Table->GetSize();
		_ASSERTE(size.x > 0 && size.y > 0);
		const int defCharWidth = 8, defCharHeight = 14;
		width = size.x * defCharWidth;
		height = size.y * defCharHeight;
	}

	if (width > 0 && height > 0)
	{
		swprintf_c(szReport, L"\x1B[4;%u;%ut", (uint32_t)height, (uint32_t)width);
		ReportString(szReport);
	}
}
