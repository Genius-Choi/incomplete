uip_remove_ext_hdr(void)
{
  /* Remove ext header before TCP/UDP processing. */
  if(uip_ext_len > 0) {
    LOG_DBG("Removing IPv6 extension headers (extlen: %d, uiplen: %d)\n",
           uip_ext_len, uip_len);
    if(uip_len < UIP_IPH_LEN + uip_ext_len) {
      LOG_ERR("uip_len too short compared to ext len\n");
      uipbuf_clear();
      return false;
    }

    /* Set proto */
    UIP_IP_BUF->proto = uip_last_proto;
    /* Move IP payload to the "left"*/
    memmove(UIP_IP_PAYLOAD(0), UIP_IP_PAYLOAD(uip_ext_len),
	    uip_len - UIP_IPH_LEN - uip_ext_len);

    /* Update the IP length. */
    if(uipbuf_add_ext_hdr(-uip_ext_len) == false) {
      return false;
    }
    uipbuf_set_len_field(UIP_IP_BUF, uip_len - UIP_IPH_LEN);
  }
  return true;
}
