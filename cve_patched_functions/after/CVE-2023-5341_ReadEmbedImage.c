static Image *ReadEmbedImage(const ImageInfo *image_info,Image *image,
  const char *magick,ExceptionInfo *exception)
{
  const void
    *stream;

  Image
    *embed_image;

  ImageInfo
    *embed_info;

  MemoryInfo
    *pixel_info;

  size_t
    length;

  ssize_t
    count;

  unsigned char
    *pixels;

  /*
    Read embedded image.
  */
  length=(size_t) ((MagickOffsetType) GetBlobSize(image)-TellBlob(image));
  pixel_info=AcquireVirtualMemory(length,sizeof(*pixels));
  if (pixel_info == (MemoryInfo *) NULL)
    ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
  pixels=(unsigned char *) GetVirtualMemoryBlob(pixel_info);
  stream=ReadBlobStream(image,length,pixels,&count);
  if (count != (ssize_t) length)
    {
      pixel_info=RelinquishVirtualMemory(pixel_info);
      ThrowReaderException(CorruptImageError,"ImproperImageHeader");
    }
  embed_info=AcquireImageInfo();
  (void) FormatLocaleString(embed_info->filename,MagickPathExtent,
    "%s:%s",magick,image_info->filename);
  embed_image=BlobToImage(embed_info,stream,(size_t) count,exception);
  embed_info=DestroyImageInfo(embed_info);
  pixel_info=RelinquishVirtualMemory(pixel_info);
  (void) CloseBlob(image);
  if (embed_image != (Image *) NULL)
    {
      (void) CopyMagickString(embed_image->filename,image->filename,
        MagickPathExtent);
      (void) CopyMagickString(embed_image->magick_filename,
        image->magick_filename,MagickPathExtent);
      (void) CopyMagickString(embed_image->magick,image->magick,
        MagickPathExtent);
    }
  return(embed_image);
}
