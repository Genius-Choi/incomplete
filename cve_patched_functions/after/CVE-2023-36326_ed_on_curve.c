int ed_on_curve(const ed_t p) {
	ed_t t;
	int r = 0;

	ed_null(t);

	if (fp_is_zero(p->z)) {
		r = 0;
	} else {
		RLC_TRY {
			ed_new(t);
			ed_norm(t, p);

			ed_rhs(t->z, t);
#if ED_ADD == EXTND
			fp_mul(t->y, t->x, t->y);
			r = ((fp_cmp_dig(t->z, 1) == RLC_EQ) &&
					(fp_cmp(t->y, t->t) == RLC_EQ)) || ed_is_infty(p);
#else
			r = (fp_cmp_dig(t->z, 1) == RLC_EQ) || ed_is_infty(p);
#endif
		}
		RLC_CATCH_ANY {
			RLC_THROW(ERR_CAUGHT);
		}
		RLC_FINALLY {
			ed_free(t);
		}
	}
	return r;
}
