static void ds_options_callback( struct cell *t, int type,
		struct tmcb_params *ps )
{
	str uri = {0, 0};

	/* The Param does contain the group, in which the failed host
	 * can be found.*/
	if (!ps->param) {
		LM_DBG("No parameter provided, OPTIONS-Request was finished"
				" with code %d\n", ps->code);
		return;
	}

	/* The param is a (void*) Pointer, so we need to dereference it and
	 *  cast it to an int. */

	ds_options_callback_param_t *cb_param =
		(ds_options_callback_param_t*)(*ps->param);

	/* The SIP-URI is taken from the Transaction.
	 * Remove the "To: " (s+4) and the trailing new-line (s - 4 (To: )
	 * - 2 (\r\n)). */
	uri.s = t->to.s + 4;
	uri.len = t->to.len - 6;
	LM_DBG("OPTIONS-Request was finished with code %d (to %.*s, group %d)\n",
			ps->code, uri.len, uri.s, cb_param->set_id);

	/* ps->code contains the result-code of the request;
	 * We accept "200 OK" by default and the custom codes
	 * defined in options_reply_codes parameter*/
	if ((ps->code == 200) || check_options_rplcode(ps->code)) {
		/* Set the according entry back to "Active":
		 *  remove the Probing/Inactive Flag and reset the failure counter. */
		if (ds_set_state(cb_param->set_id, &uri,
					DS_INACTIVE_DST|DS_PROBING_DST|DS_RESET_FAIL_DST, 0,
					cb_param->partition) != 0)
		{
			LM_ERR("Setting the state failed (%.*s, group %d)\n", uri.len,
					uri.s, cb_param->set_id);
		}
	}
	/* if we always probe, and we get a timeout
	 * or a reponse that is not within the allowed
	 * reply codes, then disable*/
	if(ds_probing_mode==1 && ps->code != 200 &&
	(ps->code == 408 || !check_options_rplcode(ps->code)))
	{
		if (ds_set_state(cb_param->set_id, &uri, DS_PROBING_DST, 1,
					cb_param->partition) != 0)
		{
			LM_ERR("Setting the probing state failed (%.*s, group %d)\n",
					uri.len, uri.s, cb_param->set_id);
		}
	}

	return;
}
