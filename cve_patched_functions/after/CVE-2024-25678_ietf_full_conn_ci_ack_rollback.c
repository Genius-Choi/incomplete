ietf_full_conn_ci_ack_rollback (struct lsquic_conn *lconn,
                                                    struct ack_state *opaque)
{
    struct ietf_ack_state *const ack_state = (struct ietf_ack_state *) opaque;
    struct ietf_full_conn *conn = (struct ietf_full_conn *) lconn;

    conn->ifc_flags &= ~(IFC_ACK_HAD_MISS|IFC_ACK_QUED_APP);
    conn->ifc_flags |= (IFC_ACK_HAD_MISS|IFC_ACK_QUED_APP)
                                        & ack_state->conn_flags;

    conn->ifc_send_flags &= ~SF_SEND_PING;
    conn->ifc_send_flags |= SF_SEND_PING & ack_state->send_flags;

    conn->ifc_alset.as_armed_set &= ~ALBIT_ACK_APP;
    conn->ifc_alset.as_armed_set |= ALBIT_ACK_APP & ack_state->armed_set;

    conn->ifc_n_slack_akbl[PNS_APP]     = ack_state->n_slack_akbl;
    conn->ifc_n_slack_all               = ack_state->n_slack_all;
    conn->ifc_ping_unretx_thresh        = ack_state->unretx_thresh;

    LSQ_DEBUG("roll back ACK state");
}
