bool GpuExecutor::GetSymbol(const string& symbol_name,
                            ModuleHandle module_handle, void** mem,
                            size_t* bytes) {
  absl::MutexLock lock{&in_memory_modules_mu_};
  if (static_cast<bool>(module_handle)) {
    auto it = gpu_binary_to_module_.find(module_handle.id());
    CHECK(it != gpu_binary_to_module_.end());
    if (GpuDriver::GetModuleSymbol(
            context_, it->second.first, symbol_name.c_str(),
            reinterpret_cast<hipDeviceptr_t*>(mem), bytes)) {
      return true;
    }
  }

  for (auto& it : gpu_binary_to_module_) {
    if (GpuDriver::GetModuleSymbol(
            context_, it.second.first, symbol_name.c_str(),
            reinterpret_cast<hipDeviceptr_t*>(mem), bytes)) {
      return true;
    }
  }

  LOG(INFO) << "Falied to find symbol in any modules: " << symbol_name;
  return false;
}
