int ConnectionImpl::onBeforeFrameReceived(const nghttp2_frame_hd* hd) {
  ENVOY_CONN_LOG(trace, "about to recv frame type={}, flags={}", connection_,
                 static_cast<uint64_t>(hd->type), static_cast<uint64_t>(hd->flags));

  // Track all the frames without padding here, since this is the only callback we receive
  // for some of them (e.g. CONTINUATION frame, frames sent on closed streams, etc.).
  // HEADERS frame is tracked in onBeginHeaders(), DATA frame is tracked in onFrameReceived().
  if (hd->type != NGHTTP2_HEADERS && hd->type != NGHTTP2_DATA) {
    if (!trackInboundFrames(hd, 0)) {
      return NGHTTP2_ERR_FLOODED;
    }
  }

  return 0;
}
