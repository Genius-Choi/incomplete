make_snapshot_rec(frame_T *fr, frame_T **frp)
{
    *frp = ALLOC_CLEAR_ONE(frame_T);
    if (*frp == NULL)
	return FAIL;
    (*frp)->fr_layout = fr->fr_layout;
    (*frp)->fr_width = fr->fr_width;
    (*frp)->fr_height = fr->fr_height;
    if (fr->fr_next != NULL)
    {
	if (make_snapshot_rec(fr->fr_next, &((*frp)->fr_next)) == FAIL)
	    return FAIL;
    }
    if (fr->fr_child != NULL)
    {
	if (make_snapshot_rec(fr->fr_child, &((*frp)->fr_child)) == FAIL)
	    return FAIL;
    }
    if (fr->fr_layout == FR_LEAF && fr->fr_win == curwin)
	(*frp)->fr_win = curwin;
    return OK;
}
