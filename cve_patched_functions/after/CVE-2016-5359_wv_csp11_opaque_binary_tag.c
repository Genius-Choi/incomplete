wv_csp11_opaque_binary_tag(tvbuff_t *tvb, guint32 offset,
			   guint8 token, guint8 codepage, guint32 *length)
{
	guint32 data_len = tvb_get_guintvar(tvb, offset, length);
	char *str = NULL;

	switch (codepage) {
	case 0: /* Common code page */
		switch (token) {
		case 0x0B: /* <Code> */
		case 0x0F: /* <ContentSize> */
		case 0x1A: /* <MessageCount> */
		case 0x3C: /* <Validity> */
			str = wv_integer_from_opaque(tvb,
						     offset + *length, data_len);
			break;
		case 0x11: /* <DateTime> */
			str = wv_datetime_from_opaque(tvb,
						      offset + *length, data_len);
			break;
		default:
			break;
		}
		break;
	case 1: /* Access code page */
		switch (token) {
		case 0x1C: /* <KeepAliveTime> */
		case 0x32: /* <TimeToLive> */
			str = wv_integer_from_opaque(tvb,
						     offset + *length, data_len);
			break;
		default:
			break;
		}
		break;
	case 3: /* Client capability code page */
		switch (token) {
		case 0x06: /* <AcceptedContentLength> */
		case 0x0C: /* <MultiTrans> */
		case 0x0D: /* <ParserSize> */
		case 0x0E: /* <ServerPollMin> */
		case 0x12: /* <TCPPort> */
		case 0x13: /* <UDPPort> */
			str = wv_integer_from_opaque(tvb,
						     offset + *length, data_len);
			break;
		default:
			break;
		}
		break;
	case 6: /* Messaging code page */
		switch (token) {
		case 0x1A: /* <DeliveryTime> - not in 1.0 */
			str = wv_datetime_from_opaque(tvb,
						      offset + *length, data_len);
			break;
		default:
			break;
		}
		break;
	default:
		break;
	}
	if (str == NULL) { /* Error, or not parsed */
		str = wmem_strdup_printf(wmem_packet_scope(), "(%d bytes of unparsed opaque data)", data_len);
	}
	*length += data_len;

	return str;
}
