R_API bool r_str_glob(const char* str, const char *glob) {
	if (!glob) {
		return true;
	}
	char* begin = strchr (glob, '^');
	if (begin) {
		begin++;
		glob = begin;
	}
	while (*str) {
		if (!*glob) {
			return false;
		}
		switch (*glob) {
		case '*':
			glob++;
			if (!*glob) {
				return true;
			}
			// Advance glob an additional time if it is a '**'
			if (*glob == '*') {
				glob++;
				if (!*glob) {
					return true;
				}
			}
			// Check if there are additional wildcards
			// if so, we need to search for the substring in between the wildcards
			const char *needle_end = glob;
			while (*needle_end != '*' &&
					*needle_end != '?' &&
					*needle_end != '$' &&
					*needle_end != '^' &&
					*needle_end != '\0') {
				needle_end++;
			}
			// Find the pattern in between wildcards
			char* needle = r_str_ndup(glob, needle_end - glob);
			const char *advance_to = strstr (str, needle);
			free (needle);
			if (!advance_to) {
				return false;
			}
			// Advance str to found pattern
			while (*str) {
				if (str == advance_to) {
					break;
				}
				str++;
			}
			break;
		case '?':
			str++;
			glob++;
			break;
		default:
			if (*glob != *str) {
				return false;
			}
			str++;
			glob++;
		}
	}
	while (*glob == '*') {
		glob++;
	}
	return ((*glob == '$' && !*glob++)  || !*glob);
}
