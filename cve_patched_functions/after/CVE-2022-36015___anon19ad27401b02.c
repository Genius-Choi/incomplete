    .SetShapeFn([](shape_inference::InferenceContext* c) {
      ShapeHandle unused;

      // inputs must be scalars
      TF_RETURN_IF_ERROR(c->WithRank(c->input(0), 0, &unused));
      TF_RETURN_IF_ERROR(c->WithRank(c->input(1), 0, &unused));
      TF_RETURN_IF_ERROR(c->WithRank(c->input(2), 0, &unused));

      const Tensor* dim_t = c->input_tensor(0);
      const Tensor* num_results_t = c->input_tensor(1);

      int32_t dim = dim_t == nullptr ? InferenceContext::kUnknownDim
                                     : dim_t->scalar<int32>()();

      int32_t num_results = num_results_t == nullptr
                                ? InferenceContext::kUnknownDim
                                : num_results_t->scalar<int32>()();

      c->set_output(0, c->Matrix(num_results, dim));
      return Status::OK();
    });
