bool RTPSParticipantImpl::deleteUserEndpoint(Endpoint* p_endpoint)
{
    for(auto it=m_receiverResourcelist.begin();it!=m_receiverResourcelist.end();++it){
        (*it).mp_receiver->removeEndpoint(p_endpoint);
    }
    bool found = false;
    {
        if(p_endpoint->getAttributes()->endpointKind == WRITER)
        {
            boost::lock_guard<boost::recursive_mutex> guard(*mp_mutex);
            for(auto wit=m_userWriterList.begin();
                    wit!=m_userWriterList.end();++wit)
            {
                if((*wit)->getGuid().entityId == p_endpoint->getGuid().entityId) //Found it
                {
                    m_userWriterList.erase(wit);
                    found = true;
                    break;
                }
            }
            for(auto wit=m_allWriterList.begin();
                    wit!=m_allWriterList.end();++wit)
            {
                if((*wit)->getGuid().entityId == p_endpoint->getGuid().entityId) //Found it
                {
                    m_allWriterList.erase(wit);
                    found = true;
                    break;
                }
            }
        }
        else
        {
            boost::lock_guard<boost::recursive_mutex> guard(*mp_mutex);
            for(auto rit=m_userReaderList.begin()
                    ;rit!=m_userReaderList.end();++rit)
            {
                if((*rit)->getGuid().entityId == p_endpoint->getGuid().entityId) //Found it
                {
                    m_userReaderList.erase(rit);
                    found = true;
                    break;
                }
            }
            for(auto rit=m_allReaderList.begin()
                    ;rit!=m_allReaderList.end();++rit)
            {
                if((*rit)->getGuid().entityId == p_endpoint->getGuid().entityId) //Found it
                {
                    m_allReaderList.erase(rit);
                    found = true;
                    break;
                }
            }
        }
        if(!found)
            return false;
        //REMOVE FOR BUILTINPROTOCOLS
        if(p_endpoint->getAttributes()->endpointKind == WRITER)
            mp_builtinProtocols->removeLocalWriter((RTPSWriter*)p_endpoint);
        else
            mp_builtinProtocols->removeLocalReader((RTPSReader*)p_endpoint);
        //BUILTINPROTOCOLS
        boost::lock_guard<boost::recursive_mutex> guardParticipant(*mp_mutex);
    }
    //	boost::lock_guard<boost::recursive_mutex> guardEndpoint(*p_endpoint->getMutex());
    delete(p_endpoint);
    return true;
}
