static int load_known_hosts(LIBSSH2_KNOWNHOSTS **hosts, LIBSSH2_SESSION *session)
{
	git_str path = GIT_STR_INIT, home = GIT_STR_INIT;
	LIBSSH2_KNOWNHOSTS *known_hosts = NULL;
	int error;

	GIT_ASSERT_ARG(hosts);

	if ((error = git__getenv(&home, "HOME")) < 0)
		return error;

	if ((error = git_str_joinpath(&path, git_str_cstr(&home), KNOWN_HOSTS_FILE)) < 0)
		goto out;

	if ((known_hosts = libssh2_knownhost_init(session)) == NULL) {
		ssh_error(session, "error initializing known hosts");
		error = -1;
		goto out;
	}

	/*
	 * Try to read the file and consider not finding it as not trusting the
	 * host rather than an error.
	 */
	error = libssh2_knownhost_readfile(known_hosts, git_str_cstr(&path), LIBSSH2_KNOWNHOST_FILE_OPENSSH);
	if (error == LIBSSH2_ERROR_FILE)
		error = 0;
	if (error < 0)
		ssh_error(session, "error reading known_hosts");

out:
	*hosts = known_hosts;

	git_str_clear(&home);
	git_str_clear(&path);

	return error;
}
