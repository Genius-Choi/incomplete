main(int argc, char **argv)
{
    njs_int_t         ret;
    njs_uint_t        i;
    njs_opts_t        opts, op;
    njs_stat_t        stat;
    njs_test_suite_t  *suite;

    njs_memzero(&opts, sizeof(njs_opts_t));

    ret = njs_options_parse(&opts, argc, argv);
    if (ret != NJS_OK) {
        return (ret == NJS_DONE) ? EXIT_SUCCESS: EXIT_FAILURE;
    }

    (void) putenv((char *) "TZ=UTC");
    tzset();

    njs_mm_denormals(1);

    njs_memzero(&stat, sizeof(njs_stat_t));

    for (i = 0; i < njs_nitems(njs_suites); i++) {
        suite = &njs_suites[i];

        if (!njs_match_test(&opts, &suite->name)) {
            continue;
        }

        op = suite->opts;

        op.disassemble = opts.disassemble;
        op.repeat = opts.repeat ? opts.repeat : op.repeat;
        op.seed = opts.seed ? opts.seed : op.seed;
        op.verbose = opts.verbose;

        ret = suite->run(suite->tests, suite->n, &suite->name, &op, &stat);
        if (ret != NJS_OK) {
            return ret;
        }
    }

    njs_printf("TOTAL: %s [%ui/%ui]\n", stat.failed ? "FAILED" : "PASSED",
               stat.passed, stat.passed + stat.failed);

    return stat.failed ? EXIT_FAILURE : EXIT_SUCCESS;
}
