ValidationResult_t PKIDH::validate_remote_identity(IdentityHandle** remote_identity_handle,
        const IdentityHandle& local_identity_handle,
        IdentityToken&& remote_identity_token,
        const GUID_t& remote_participant_key,
        SecurityException& exception)
{
    assert(remote_identity_handle);
    assert(local_identity_handle.nil() == false);

    ValidationResult_t returnedValue = ValidationResult_t::VALIDATION_FAILED;

    const PKIIdentityHandle& lih = PKIIdentityHandle::narrow(local_identity_handle);

    if(!lih.nil())
    {
        // dds.ca.sn
        const std::string* property = DataHolderHelper::find_property_value(remote_identity_token, "dds.ca.sn");

        if(property == nullptr)
        {
            logWarning(AUTHENTICATION, "Not found property \"dds.ca.sn\" in remote identity token");
            return ValidationResult_t::VALIDATION_FAILED;
        }

        if(*property != lih->sn)
        {
            logWarning(AUTHENTICATION, "Invalid CA subject name in remote identity token");
            return ValidationResult_t::VALIDATION_FAILED;
        }

        // dds.ca.algo
        property = DataHolderHelper::find_property_value(remote_identity_token, "dds.ca.algo");

        if(property == nullptr)
        {
            logWarning(AUTHENTICATION, "Not found property \"dds.ca.algo\" in remote identity token");
            return ValidationResult_t::VALIDATION_FAILED;
        }

        if(*property != lih->algo)
        {
            logWarning(AUTHENTICATION, "Invalid CA signature algorithm in remote identity token");
            return ValidationResult_t::VALIDATION_FAILED;
        }

        // dds.cert.sn
        const std::string* cert_sn = DataHolderHelper::find_property_value(remote_identity_token, "dds.cert.sn");

        if(cert_sn == nullptr)
        {
            logWarning(AUTHENTICATION, "Not found property \"dds.cert.sn\" in remote identity token");
            return ValidationResult_t::VALIDATION_FAILED;
        }

        // dds.cert.algo
        const std::string* cert_algo = DataHolderHelper::find_property_value(remote_identity_token, "dds.cert.algo");

        if(cert_algo == nullptr)
        {
            logWarning(AUTHENTICATION, "Not found property \"dds.cert.algo\" in remote identity token");
            return ValidationResult_t::VALIDATION_FAILED;
        }


        PKIIdentityHandle* rih = new PKIIdentityHandle();

        (*rih)->sn = *cert_sn;
        (*rih)->algo = *cert_algo;
        (*rih)->participant_key_ = remote_participant_key;
        (*rih)->identity_token_ = std::move(remote_identity_token);
        *remote_identity_handle = rih;

        if(lih->participant_key_ < remote_participant_key )
            returnedValue = ValidationResult_t::VALIDATION_PENDING_HANDSHAKE_REQUEST;
        else
            returnedValue = ValidationResult_t::VALIDATION_PENDING_HANDSHAKE_MESSAGE;
    }

    return  returnedValue;
}
