void gf_fs_push_arg(GF_FilterSession *session, const char *szArg, Bool was_found, GF_FSArgItemType type, GF_Filter *meta_filter, const char *sub_opt_name)
{
	u32 meta_len = meta_filter ? (u32) strlen(meta_filter->freg->name) : 0;
	Bool create_if_not_found = GF_TRUE;
	if (session->flags & GF_FS_FLAG_NO_ARG_CHECK)
		return;

	//ignore any meta argument reported (found or not) that is not already present
	//if sub_opt_name, we must create an entry
	if (!sub_opt_name && (type==GF_ARGTYPE_META_REPORTING)) {
		create_if_not_found = GF_FALSE;
	}
	if (!session->parsed_args) session->parsed_args = gf_list_new();

	u32 k, acount = gf_list_count(session->parsed_args);
	GF_FSArgItem *ai=NULL;
	for (k=0; k<acount; k++) {
		ai = gf_list_get(session->parsed_args, k);
		if (!strcmp(ai->argname, szArg))
			break;

		if (meta_len
			&& !strncmp(ai->argname, meta_filter->freg->name, meta_len)
			&& ((ai->argname[meta_len]==':') || (ai->argname[meta_len]=='@'))
			&& !strcmp(ai->argname+meta_len+1, szArg)
		) {
			break;
		}
		ai = NULL;
	}
	if (!ai && create_if_not_found) {
		GF_SAFEALLOC(ai, GF_FSArgItem);
		if (ai) {
			ai->argname = gf_strdup(szArg);
			ai->type = type;
			if ((type==GF_ARGTYPE_META_REPORTING) && meta_filter) {
				ai->meta_filter = meta_filter->freg->name;
				ai->meta_opt = sub_opt_name;
			}
			gf_list_add(session->parsed_args, ai );
		}
	}
	if (!ai) return;

	if (type==GF_ARGTYPE_META_REPORTING) {
		//meta option declared as true by default at init but notified as not found
		if (ai->meta_state==3) {
			ai->meta_state = 0;
			if (!was_found) ai->opt_found = 0;
		}
		if (!ai->meta_state) {
			ai->opt_found = 0;
			ai->meta_state = 1;
			if (!ai->meta_filter) {
				ai->meta_filter = meta_filter->freg->name;
				ai->meta_opt = sub_opt_name;
			}
		}
		if (was_found)
			ai->meta_state = 2;
	} else if (was_found && (!ai->meta_state || !meta_filter) ) {
		ai->opt_found = 1;
		//initial declaration from filter setup: meta args are declared as true by default
		if (type==GF_ARGTYPE_LOCAL) {
			//forbid further meta state change
			ai->meta_state = 1;
			//meta option, mark as not found
			if (meta_filter) ai->meta_state = 3;
			else ai->meta_filter = NULL;
		}
	}
}
