bytebuf_add_avp(bytebuffer *bytebuf, struct l2tp_avp *avp, int value_len)
{
	struct l2tp_avp avp1;

	memcpy(&avp1, avp, sizeof(struct l2tp_avp));

	avp1.length = value_len + 6;
	avp1.vendor_id = htons(avp->vendor_id);
	avp1.attr_type = htons(avp->attr_type);
	*(uint16_t *)&avp1 = htons(*(uint16_t *)&avp1);

	if (bytebuffer_put(bytebuf, &avp1, 6) == NULL)
		return -1;
	if (bytebuffer_put(bytebuf, avp->attr_value, value_len) == NULL)
		return -1;

	return 0;
}
