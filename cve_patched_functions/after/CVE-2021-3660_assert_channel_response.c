assert_channel_response (MockTransport *transport,
                         const gchar *channel_id,
                         const gchar *expected_control,
                         const gchar *expected_body)
{
  GBytes *data;

  data = mock_transport_pop_channel (transport, channel_id);
  JsonNode *node = cockpit_json_parse (g_bytes_get_data (data, NULL), -1, NULL);
  cockpit_assert_json_eq (json_node_get_object (node), expected_control);
  json_node_unref (node);

  data = mock_transport_pop_channel (transport, channel_id);
  cockpit_assert_bytes_eq (data, expected_body, -1);
}
