static int members_json(struct wcall *wcall, char **mjson, char **anon_str)
{
	struct wcall_members *members = NULL;
	struct json_object *tmembs = NULL;
	struct json_object *jmembs = NULL;
	struct mbuf *pmb = NULL;
	char uid_anon[ANON_ID_LEN];
	char cid_anon[ANON_CLIENT_LEN];
	size_t i;
	int err = 0;
	
	err = ICALL_CALLE(wcall->icall, get_members, &members);
	if (err)
		return EBADF;

	if (!members) {
		warning("wcall(%p): members_json: members is NULL\n", wcall);
		err = ENOSYS;
		goto out;
	}

	//info("wcall: members_json: %d members\n", members->membc);
	tmembs = jzon_alloc_object();
	jzon_add_str(tmembs, "convid", "%s", wcall->convid);

	jmembs = json_object_new_array();
	if (!mjson) {
		err = ENOSYS;
		goto out;
	}

	pmb = mbuf_alloc(512);
	mbuf_printf(pmb, "%d members:", members->membc);
	for(i = 0; i < members->membc; ++i) {
		struct wcall_member *memb = &members->membv[i];
		struct json_object *jmemb;

		jmemb = jzon_alloc_object();
		if (!jmemb)
			continue;

		jzon_add_str(jmemb, "userid", "%s", memb->userid);
		jzon_add_str(jmemb, "clientid", "%s", memb->clientid);
		jzon_add_int(jmemb, "aestab", memb->audio_state);
		jzon_add_int(jmemb, "vrecv", memb->video_recv);
		jzon_add_int(jmemb, "muted", memb->muted);

		json_object_array_add(jmembs, jmemb);

		/* add to info string */
		anon_id(uid_anon, memb->userid);
		anon_client(cid_anon, memb->clientid);
		mbuf_printf(pmb, "{[%s.%s] aestab: %d vrecv: %d muted: %d}",
			    uid_anon, cid_anon,
			    memb->audio_state,
			    memb->video_recv,
			    memb->muted);
		if (i < members->membc - 1)
			mbuf_printf(pmb, ",");
	}

	pmb->pos = 0;
	mbuf_strdup(pmb, anon_str, pmb->end);
	mem_deref(pmb);

	json_object_object_add(tmembs, "members", jmembs);
	
	jzon_encode(mjson, tmembs);

 out:
	mem_deref(members);
	mem_deref(tmembs);

	return err;
}
