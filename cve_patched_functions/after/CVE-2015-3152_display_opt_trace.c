void display_opt_trace(struct st_connection *cn,
                       struct st_command *command,
                       int flags)
{
  if (!disable_query_log &&
      opt_trace_protocol_enabled &&
      !cn->pending &&
      !command->expected_errors.count &&
      match_re(&opt_trace_re, command->query))
  {
    st_command save_command= *command;
    DYNAMIC_STRING query_str;
    init_dynamic_string(&query_str,
                        "SELECT trace FROM information_schema.optimizer_trace"
                        " /* injected by --opt-trace-protocol */",
                        128, 128);

    command->query= query_str.str;
    command->query_len= query_str.length;
    command->end= strend(command->query);

    /* Sorted trace is not readable at all, don't bother to lower case */
    /* No need to keep old values, will be reset anyway */
    display_result_sorted= FALSE;
    display_result_lower= FALSE;
    run_query(cn, command, flags);

    dynstr_free(&query_str);
    *command= save_command;
  }
}
