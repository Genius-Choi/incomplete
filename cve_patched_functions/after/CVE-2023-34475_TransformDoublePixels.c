static void TransformDoublePixels(const int id,const Image* image,
  const LCMSInfo *source_info,const LCMSInfo *target_info,
  const cmsHTRANSFORM *transform,Quantum *q)
{
#define GetLCMSPixel(source_info,pixel,index) \
  (source_info->scale[index]*((QuantumScale*pixel)+source_info->translate[index]))
#define SetLCMSPixel(target_info,pixel,index) \
  ClampToQuantum(target_info->scale[index]*((QuantumRange*pixel)+target_info->translate[index]))

  double
    *p;

  ssize_t
    x;

  p=(double *) source_info->pixels[id];
  for (x=0; x < (ssize_t) image->columns; x++)
  {
    *p++=GetLCMSPixel(source_info,GetPixelRed(image,q),0);
    if (source_info->channels > 1)
      {
        *p++=GetLCMSPixel(source_info,GetPixelGreen(image,q),1);
        *p++=GetLCMSPixel(source_info,GetPixelBlue(image,q),2);
      }
    if (source_info->channels > 3)
      *p++=GetLCMSPixel(source_info,GetPixelBlack(image,q),3);
    q+=GetPixelChannels(image);
  }
  cmsDoTransform(transform[id],source_info->pixels[id],target_info->pixels[id],
    (unsigned int) image->columns);
  p=(double *) target_info->pixels[id];
  q-=GetPixelChannels(image)*image->columns;
  for (x=0; x < (ssize_t) image->columns; x++)
  {
    if (target_info->channels == 1)
      SetPixelGray(image,SetLCMSPixel(target_info,*p,0),q);
    else
      SetPixelRed(image,SetLCMSPixel(target_info,*p,0),q);
    p++;
    if (target_info->channels > 1)
      {
        SetPixelGreen(image,SetLCMSPixel(target_info,*p,1),q);
        p++;
        SetPixelBlue(image,SetLCMSPixel(target_info,*p,2),q);
        p++;
      }
    if (target_info->channels > 3)
      {
        SetPixelBlack(image,SetLCMSPixel(target_info,*p,3),q);
        p++;
      }
    q+=GetPixelChannels(image);
  }
}
