xrdp_mm_egfx_invalidate_wm_screen(struct xrdp_mm *self)
{
    int error = 0;

    LOG(LOG_LEVEL_INFO, "xrdp_mm_egfx_invalidate_wm_screen:");

    // Only invalidate the WM screen if the module is using the WM screen,
    // or we haven't loaded the module yet.
    //
    // Otherwise we may send client updates which conflict with the
    // updates sent directly from the module via the encoder.
    if (self->mod_uses_wm_screen_for_gfx || self->mod_handle == 0)
    {
        struct xrdp_bitmap *screen = self->wm->screen;
        struct xrdp_rect xr_rect;

        xr_rect.left = 0;
        xr_rect.top = 0;
        xr_rect.right = screen->width;
        xr_rect.bottom = screen->height;
        if (self->wm->screen_dirty_region == NULL)
        {
            self->wm->screen_dirty_region = xrdp_region_create(self->wm);
        }
        error = xrdp_region_add_rect(self->wm->screen_dirty_region, &xr_rect);
    }
    return error;
}
