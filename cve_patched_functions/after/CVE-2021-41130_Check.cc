void RequestHandler::Check(std::function<void(Status status)> continuation) {
  auto interception = [continuation, this](Status status) {
    if (status.ok()) {
      if (context_->cloud_trace()) {
        context_->StartBackendSpanAndSetTraceContext();
      }
      // Add InstanceIdentityToken to request header if needed, which is
      // required for backend routing.
      context_->AddInstanceIdentityToken();
    }

    continuation(status);
  };

  context_->set_check_continuation(interception);

  // Run the check flow.
  check_workflow_->Run(context_);
}
