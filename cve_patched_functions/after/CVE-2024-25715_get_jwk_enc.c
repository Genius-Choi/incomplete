static jwk_t * get_jwk_enc(struct _oidc_config * config, json_t * j_client, jwa_alg alg, jwa_enc enc) {
  jwks_t * jwks_pub, * jwks_subset;
  jwk_t * jwk = NULL, * jwk_import = NULL;
  const char * alg_kid_p = json_string_value(json_object_get(config->j_params, "client-alg_kid-parameter"));
  unsigned char key[64] = {0};
  size_t key_len = 64;

  if (r_jwks_init(&jwks_pub) == RHN_OK) {
    if (!json_string_null_or_empty(json_object_get(j_client, json_string_value(json_object_get(config->j_params, "client-pubkey-parameter"))))) {
      if ((jwk_import = r_jwk_quick_import(R_IMPORT_PEM, R_X509_TYPE_UNSPECIFIED, json_string_value(json_object_get(j_client, json_string_value(json_object_get(config->j_params, "client-pubkey-parameter")))), json_string_length(json_object_get(j_client, json_string_value(json_object_get(config->j_params, "client-pubkey-parameter")))))) != NULL) {
        r_jwks_append_jwk(jwks_pub, jwk_import);
        r_jwk_free(jwk_import);
      }
    }
    if (json_object_get(j_client, json_string_value(json_object_get(config->j_params, "client-jwks-parameter"))) != NULL) {
      if (r_jwks_import_from_json_t(jwks_pub, json_object_get(j_client, json_string_value(json_object_get(config->j_params, "client-jwks-parameter")))) != RHN_OK) {
        y_log_message(Y_LOG_LEVEL_ERROR, "get_jwk_enc - Error r_jwks_import_from_json_t");
      }
    }
    if (!json_string_null_or_empty(json_object_get(j_client, json_string_value(json_object_get(config->j_params, "client-jwks_uri-parameter"))))) {
      if (r_jwks_import_from_uri(jwks_pub, json_string_value(json_object_get(j_client, json_string_value(json_object_get(config->j_params, "client-jwks_uri-parameter")))), config->x5u_flags) != RHN_OK) {
        y_log_message(Y_LOG_LEVEL_ERROR, "get_jwk_enc - Error r_jwks_import_from_uri");
      }
    }
    if (!json_string_null_or_empty(json_object_get(j_client, alg_kid_p))) {
      jwk = r_jwks_get_by_kid(jwks_pub, json_string_value(json_object_get(j_client, alg_kid_p)));
      if (jwk == NULL) {
        y_log_message(Y_LOG_LEVEL_DEBUG, "Error, kid '%s' specified for client '%s' is invalid", json_string_value(json_object_get(j_client, alg_kid_p)), json_string_value(json_object_get(j_client, "client_id")));
      }
    } else if (alg == R_JWA_ALG_RSA1_5 || alg == R_JWA_ALG_RSA_OAEP || alg == R_JWA_ALG_RSA_OAEP_256) {
      jwks_subset = r_jwks_search_json_str(jwks_pub, "{\"kty\":\"RSA\"}");
      jwk = r_jwks_get_at(jwks_subset, 0);
      r_jwks_free(jwks_subset);
    } else if (alg == R_JWA_ALG_ECDH_ES || alg == R_JWA_ALG_ECDH_ES_A128KW || alg == R_JWA_ALG_ECDH_ES_A192KW || alg == R_JWA_ALG_ECDH_ES_A256KW) {
      jwks_subset = r_jwks_search_json_str(jwks_pub, "{\"kty\":\"EC\"}");
      jwk = r_jwks_get_at(jwks_subset, 0);
      r_jwks_free(jwks_subset);
      if (jwk == NULL) {
        jwks_subset = r_jwks_search_json_str(jwks_pub, "{\"kty\":\"OKP\"}");
        jwk = r_jwks_get_at(jwks_subset, 0);
        r_jwks_free(jwks_subset);
      }
    } else if (alg == R_JWA_ALG_A128KW || alg == R_JWA_ALG_A192KW || alg == R_JWA_ALG_A256KW ||
               alg == R_JWA_ALG_A128GCMKW || alg == R_JWA_ALG_A192GCMKW || alg == R_JWA_ALG_A256GCMKW ||
               alg == R_JWA_ALG_PBES2_H256 || alg == R_JWA_ALG_PBES2_H384 || alg == R_JWA_ALG_PBES2_H512) {
      if (!json_string_null_or_empty(json_object_get(j_client, "client_secret"))) {
        if (generate_digest_raw((alg == R_JWA_ALG_DIR?digest_SHA512:digest_SHA256), (const unsigned char *)json_string_value(json_object_get(j_client, "client_secret")), json_string_length(json_object_get(j_client, "client_secret")), key, &key_len)) {
          if (alg == R_JWA_ALG_DIR) {
            key_len = get_enc_key_size(enc);
          } else if (alg == R_JWA_ALG_A128GCMKW || alg == R_JWA_ALG_A128KW) {
            key_len = 16;
          } else if (alg == R_JWA_ALG_A192GCMKW || alg == R_JWA_ALG_A192KW) {
            key_len = 24;
          }
          jwk = r_jwk_quick_import(R_IMPORT_SYMKEY, key, key_len);
        } else {
          y_log_message(Y_LOG_LEVEL_ERROR, "get_jwk_enc - Error generate_digest_raw");
        }
      } else {
        y_log_message(Y_LOG_LEVEL_ERROR, "get_jwk_enc - Client '%s' has no secret available", json_string_value(json_object_get(j_client, "client_id")));
      }
    }
    r_jwks_free(jwks_pub);
  } else {
    y_log_message(Y_LOG_LEVEL_ERROR, "get_jwk_enc - Error r_jwks_init");
  }
  return jwk;
}
