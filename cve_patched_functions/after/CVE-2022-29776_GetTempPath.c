    std::wstring CFileBinary::GetTempPath()
    {
        if (!g_overrideTmpPath.empty())
            return g_overrideTmpPath;

#if defined(_WIN32) || defined(_WIN32_WCE) || defined(_WIN64)
        wchar_t pBuffer[MAX_PATH + 1];
        memset(pBuffer, 0, sizeof(wchar_t) * (MAX_PATH + 1));
        ::GetTempPathW(MAX_PATH, pBuffer);

        std::wstring sRet(pBuffer);

        size_t nSeparatorPos = sRet.find_last_of(wchar_t('/'));
        if (std::wstring::npos == nSeparatorPos)
        {
            nSeparatorPos = sRet.find_last_of(wchar_t('\\'));
        }

        if (std::wstring::npos == nSeparatorPos)
            return L"";

        return sRet.substr(0, nSeparatorPos);
#else
        char *folder = getenv("TEMP");

        if (NULL == folder)
            folder = getenv("TMP");
        if (NULL == folder)
            folder = getenv("TMPDIR");
        if (NULL == folder)
            folder = "/tmp";

        return NSFile::CUtf8Converter::GetUnicodeStringFromUTF8((BYTE*)folder, strlen(folder));
#endif
    }
