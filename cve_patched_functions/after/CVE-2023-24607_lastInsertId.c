QVariant QODBCResult::lastInsertId() const
{
    Q_D(const QODBCResult);
    QString sql;

    switch (driver()->dbmsType()) {
    case QSqlDriver::MSSqlServer:
    case QSqlDriver::Sybase:
        sql = "SELECT @@IDENTITY;"_L1;
        break;
    case QSqlDriver::MySqlServer:
        sql = "SELECT LAST_INSERT_ID();"_L1;
        break;
    case QSqlDriver::PostgreSQL:
        sql = "SELECT lastval();"_L1;
        break;
    default:
        break;
    }

    if (!sql.isEmpty()) {
        QSqlQuery qry(driver()->createResult());
        if (qry.exec(sql) && qry.next())
            return qry.value(0);

        qSqlWarning("QODBCResult::lastInsertId: Unable to get lastInsertId"_L1, d);
    } else {
        qSqlWarning("QODBCResult::lastInsertId: not implemented for this DBMS"_L1, d);
    }

    return QVariant();
}
