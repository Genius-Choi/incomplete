void s_ssl_read(CLI *c, void *ptr, int len) {
        /* simulate a blocking SSL_read */
    int num;

    while(len>0) {
        if(!SSL_pending(c->ssl)) {
            s_poll_init(c->fds, 0);
            s_poll_add(c->fds, c->ssl_rfd->fd, 1, 0); /* read */
            switch(s_poll_wait(c->fds, c->opt->timeout_busy, 0)) {
            case -1:
                sockerror("s_read: s_poll_wait");
                throw_exception(c, 1); /* error */
            case 0:
                s_log(LOG_INFO, "s_read: s_poll_wait:"
                    " TIMEOUTbusy exceeded: sending reset");
                throw_exception(c, 1); /* timeout */
            case 1:
                break; /* OK */
            default:
                s_log(LOG_ERR, "s_read: s_poll_wait: unknown result");
                throw_exception(c, 1); /* error */
            }
        }
        num=SSL_read(c->ssl, ptr, len);
        switch(num) {
        case -1: /* error */
            sockerror("SSL_read (s_ssl_read)");
            throw_exception(c, 1);
        case 0: /* EOF */
            s_log(LOG_ERR, "Unexpected socket close (s_ssl_read)");
            throw_exception(c, 1);
        }
        ptr=(uint8_t *)ptr+num;
        len-=num;
    }
}
