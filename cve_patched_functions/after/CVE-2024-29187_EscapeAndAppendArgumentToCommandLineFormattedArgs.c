static HRESULT EscapeAndAppendArgumentToCommandLineFormattedArgs(
    __deref_inout_z LPWSTR* psczCommandLine,
    __deref_inout_z_opt LPWSTR* psczObfuscatedCommandLine,
    __in __format_string LPCWSTR wzFormat,
    __in va_list args
    )
{
    HRESULT hr = S_OK;
    LPWSTR sczArgument = NULL;

    hr = AppEscapeCommandLineArgumentFormattedArgs(&sczArgument, wzFormat, args);
    ExitOnFailure(hr, "Failed to escape the argument for the command line.");

    hr = AppendEscapedArgumentToCommandLine(sczArgument, psczCommandLine, psczObfuscatedCommandLine);

LExit:
    ReleaseStr(sczArgument);

    return hr;
}
