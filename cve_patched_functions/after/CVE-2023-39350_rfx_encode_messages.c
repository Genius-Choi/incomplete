RFX_MESSAGE_LIST* rfx_encode_messages(RFX_CONTEXT* context, const RFX_RECT* rects, size_t numRects,
                                      const BYTE* data, UINT32 width, UINT32 height,
                                      UINT32 scanline, size_t* numMessages, size_t maxDataSize)
{
	WINPR_ASSERT(context);
	WINPR_ASSERT(numMessages);

	RFX_MESSAGE* message =
	    rfx_encode_message(context, rects, numRects, data, width, height, scanline);
	if (!message)
		return NULL;

	RFX_MESSAGE* list = rfx_split_message(context, message, numMessages, maxDataSize);
	rfx_message_free(context, message);
	if (!list)
		return NULL;

	return rfx_message_list_new(context, list, *numMessages);
}
