void nft_meta_inner_eval(const struct nft_expr *expr,
			 struct nft_regs *regs,
			 const struct nft_pktinfo *pkt,
			 struct nft_inner_tun_ctx *tun_ctx)
{
	const struct nft_meta *priv = nft_expr_priv(expr);
	u32 *dest = &regs->data[priv->dreg];

	switch (priv->key) {
	case NFT_META_PROTOCOL:
		nft_reg_store16(dest, (__force u16)tun_ctx->llproto);
		break;
	case NFT_META_L4PROTO:
		if (!(tun_ctx->flags & NFT_PAYLOAD_CTX_INNER_TH))
			goto err;

		nft_reg_store8(dest, tun_ctx->l4proto);
		break;
	default:
		WARN_ON_ONCE(1);
		goto err;
	}
	return;

err:
	regs->verdict.code = NFT_BREAK;
}
