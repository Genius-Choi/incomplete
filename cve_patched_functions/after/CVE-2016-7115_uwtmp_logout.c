static void uwtmp_logout(struct mt_connection *conn) {
	if (conn->pid > 0) {
#if defined(__FreeBSD__) || defined(__APPLE__)
		struct utmpx *utentp;
		struct utmpx utent;
		setutxent();
#else
		struct utmp *utentp;
		struct utmp utent;
		setutent();
#endif

#if defined(__FreeBSD__) || defined(__APPLE__)
		while ((utentp = getutxent()) != NULL) {
#else
		while ((utentp = getutent()) != NULL) {
#endif
			if (utentp->ut_pid == conn->pid && utentp->ut_id) {
				break;
			}
		}

		if (utentp) {
			utent = *utentp;

			utent.ut_type = DEAD_PROCESS;
			utent.ut_tv.tv_sec = time(NULL);

#if defined(__FreeBSD__) || defined(__APPLE__)
			pututxline(&utent);
			endutxent();
#else
			pututline(&utent);
			endutent();
			updwtmp(_PATH_WTMP, &utent);
#endif
		}
	}
}
