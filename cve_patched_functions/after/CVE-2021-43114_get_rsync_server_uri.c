get_rsync_server_uri(struct rpki_uri *src, char **result, size_t *result_len)
{
	char const *global;
	char *tmp;
	size_t global_len;
	unsigned int slashes;
	size_t i;

	global = uri_get_global(src);
	global_len = uri_get_global_len(src);
	slashes = 0;

	for (i = 0; i < global_len; i++) {
		if (global[i] == '/') {
			slashes++;
			if (slashes == 3)
				break;
		}
	}

	tmp = malloc(i + 1);
	if (tmp == NULL)
		return pr_enomem();

	strncpy(tmp, global, i);
	tmp[i] = '\0';

	*result_len = i;
	*result = tmp;

	return 0;
}
