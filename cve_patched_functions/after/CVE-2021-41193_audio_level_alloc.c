int audio_level_alloc(struct audio_level **levelp,
		      struct list *levell, bool is_self,
		      const char *userid, const char *clientid,
		      uint8_t aulevel, uint8_t aulevel_smooth)
{
	struct audio_level *level;
	int err;

	if (!levelp)
		return EINVAL;

	level = mem_zalloc(sizeof(*level), destructor);
	if (!level)
		return ENOMEM;

	err = str_dup(&level->userid, userid);
	err |= str_dup(&level->clientid, clientid);
	if (err)
		goto out;

	level->aulevel = aulevel;
	level->aulevel_smooth = aulevel_smooth;
	level->is_self = is_self;

	if (levell)
		list_append(levell, &level->le, level);

 out:
	if (err)
		mem_deref(level);

	return err;
}
