native_adapter_proc(struct virtio_i2c *vi2c, struct i2c_msg *msg)
{
	int ret;
	uint16_t addr;
	struct i2c_rdwr_ioctl_data work_queue;
	struct native_i2c_adapter *adapter;
	uint8_t status;

	addr = msg->addr;
	adapter = native_adapter_find(vi2c, addr);
	if (!adapter)
		return I2C_NO_DEV;

	work_queue.nmsgs = 1;
	work_queue.msgs = msg;

	ret = ioctl(adapter->fd, I2C_RDWR, &work_queue);
	if (ret < 0)
		status = I2C_MSG_ERR;
	else
		status = I2C_MSG_OK;
	if (msg->len)
		DPRINTF("i2c_core: i2c msg: flags=0x%x, addr=0x%x, len=0x%x buf=%x\n",
				msg->flags,
				msg->addr,
				msg->len,
				msg->buf[0]);
	else
		DPRINTF("i2c_core: i2c msg: flags=0x%x, addr=0x%x, len=0x%x\n",
				msg->flags,
				msg->addr,
				msg->len);
	return status;
}
