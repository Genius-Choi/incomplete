extern "C" void CoreUpdateRestartState(
    __in BURN_ENGINE_STATE* pEngineState,
    __in BURN_RESTART_STATE restartState
    )
{
    ::EnterCriticalSection(&pEngineState->csRestartState);

    if (pEngineState->fRestarting && restartState > pEngineState->restartState)
    {
        pEngineState->restartState = restartState;
    }

    ::LeaveCriticalSection(&pEngineState->csRestartState);
}
